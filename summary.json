[
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/Vue3x Composition API å¼‚æ­¥çŠ¶æ€å¤„ç†.md",
      "/home/zepang/WorkSpace/blog/posts/Vue3x Composition API å¼‚æ­¥çŠ¶æ€å¤„ç†.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"vue-useuseasyncstate\">vue-use/useAsyncState</h1>\n<p>å®˜æ–¹ç¤ºä¾‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">axios</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> useAsyncState <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@vueuse/core'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> state<span class=\"token punctuation\">,</span> ready <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useAsyncState</span><span class=\"token punctuation\">(</span>\n  axios\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://jsonplaceholder.typicode.com/todos/1'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">t</span> <span class=\"token arrow operator\">=></span> t<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹å…¶æºç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> ref <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'vue-demi'</span>\n\n<span class=\"token doc-comment comment\">/**\n * Reactive async state. Will not block your setup function and will triggers changes once\n * the promise is ready.\n *\n * <span class=\"token keyword\">@see</span>   <span class=\"token class-name\"><span class=\"token punctuation\">{</span>@link https<span class=\"token operator\">:</span>//vueuse<span class=\"token punctuation\">.</span>js<span class=\"token punctuation\">.</span>org/useAsyncState<span class=\"token punctuation\">}</span></span>\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">promise</span>         The promise / async function to be resolved\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">initialState</span>    The initial state, used until the first evaluation finishes\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">delay</span>           Delay (ms)\n * <span class=\"token keyword\">@param</span> <span class=\"token parameter\">catchFn</span>         Error handling callback\n */</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> useAsyncState<span class=\"token operator\">&#x3C;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n  promise<span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token operator\">&#x3C;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  initialState<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">,</span>\n  delay <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">catchFn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">Error</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>initialState<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> ready <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    promise\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// @ts-ignore</span>\n        state<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token operator\">=</span> data\n        ready<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">catch</span><span class=\"token punctuation\">(</span>catchFn<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>delay<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">else</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>run<span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> state<span class=\"token punctuation\">,</span> ready <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>useAsyncState</code> å†…éƒ¨ç»™æˆ‘ä»¬ç»´æŠ¤äº† <code>{ state, ready }</code>ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯é’ˆå¯¹æˆ‘ä»¬ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ä¸­çš„ <code>useUser</code> å‡½æ•°çš„ä¸€ä¸ªé€šç”¨æ€§å°è£…ã€‚</p>\n<ul>\n<li>å…¶æ–‡æ¡£[https://vueuse.js.org/core/useasyncstate/]</li>\n</ul>\n<h1 id=\"vue-composition-toolkituseasyncstate\">vue-composition-toolkit/useAsyncState</h1>\n<p>ä¸ <code>vue-use/useAsyncState</code> ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šè§£é‡Šäº†ï¼Œå…·ä½“çš„è¯å¯ä»¥çœ‹å…¶æºç <a href=\"https://github.com/HcySunYang/vue-composition-toolkit/blob/master/src/useAsyncState.ts\">https://github.com/HcySunYang/vue-composition-toolkit/blob/master/src/useAsyncState.ts</a></p>\n<h1 id=\"suspense\">Suspense</h1>\n<p><code>Suspense</code>å¹¶ä¸æ˜¯ç¤¾åŒºçš„æä¾›çš„è§£å†³æ–¹å¼ï¼Œè€Œæ˜¯å®˜æ–¹æä¾›çš„æ–°çš„ <code>å†…ç½®ç»„ä»¶</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span>template<span class=\"token operator\">></span>\n   <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Suspense</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>template #<span class=\"token keyword module\">default</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">GithubUser</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>template #fallback<span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span><span class=\"token maybe-class-name\">Loading</span><span class=\"token spread operator\">...</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Suspense</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n</code></pre></div>\n<p><code>Susepense</code>æä¾›çš„ä¾¿åˆ©ï¼š</p>\n<ul>\n<li>\n<p><code>Suspense</code> ç»„ä»¶æä¾›äº†ä¸¤ä¸ªæ’æ§½ <code>default</code> å’Œ <code>fallback</code>ï¼Œæ¥åˆ†åˆ«å±•ç¤ºæ•°æ®å’Œloading</p>\n</li>\n<li>\n<p>èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ <code>async</code> å…³é”®å­—å®šä¹‰ <code>setup</code> å‡½æ•°ï¼Œéœ€è¦ç»´æŠ¤çš„çŠ¶æ€æ•°æ®å°†å‡å°‘</p>\n</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token function\">defineComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">setup</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> user <span class=\"token operator\">=</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      name<span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://api.github.com/users/zepang'</span><span class=\"token punctuation\">)</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">login</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> user <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>æ³¨æ„ç‚¹ï¼š</p>\n<ul>\n<li>\n<p>éœ€è¦åœ¨<code>GithubUser</code>ç»„ä»¶çš„çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ <code>Suspense</code></p>\n</li>\n<li>\n<p>errorçŠ¶æ€ä»ç„¶éœ€è¦æˆ‘ä»¬è‡ªå·±ç»´æŠ¤</p>\n</li>\n</ul>\n<p>ç¤¾åŒºä¸­å½“ç„¶ä¹Ÿæä¾›äº†ç±»ä¼¼çš„åº“ï¼Œå¹¶ä¸”è§£å†³ä¸Šè¿°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªåº“å°±æ˜¯ <code>vue-promised</code></p>\n<h1 id=\"vue-promised\">vue-promised</h1>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Promised</span> <span class=\"token operator\">:</span>promise<span class=\"token operator\">=</span><span class=\"token string\">\"usersPromise\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>template v<span class=\"token operator\">-</span>slot<span class=\"token operator\">:</span>pending<span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span>p<span class=\"token operator\">></span>loading<span class=\"token spread operator\">...</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>template v<span class=\"token operator\">-</span>slot<span class=\"token operator\">=</span><span class=\"token string\">\"data\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span>h1<span class=\"token operator\">></span>name<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>template v<span class=\"token operator\">-</span>slot<span class=\"token operator\">:</span>rejected<span class=\"token operator\">=</span><span class=\"token string\">\"error\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span>p<span class=\"token operator\">></span><span class=\"token known-class-name class-name\">Error</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> error<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Promised</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n</code></pre></div>\n<ul>\n<li>vue-promisedçš„ç›¸å…³æ–‡æ¡£<a href=\"https://github.com/posva/vue-promised\">https://github.com/posva/vue-promised</a></li>\n</ul>\n<h1 id=\"vue-concurrency--usetask\">vue-concurrency â€” useTask</h1>\n<p>è§£å†³çš„é—®é¢˜å’Œä¸Šè¿°çš„å…¶ä»–åº“ç±»ä¼¼ï¼Œç›´æ¥è´´ä¸€ä¸‹å®˜æ–¹çš„ç¤ºä¾‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span>script<span class=\"token operator\">></span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token function\">defineComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> task <span class=\"token operator\">=</span> <span class=\"token function\">useTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">\"tada\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    task<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">perform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> task <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>div v<span class=\"token operator\">-</span><span class=\"token keyword control-flow\">if</span><span class=\"token operator\">=</span><span class=\"token string\">\"task.isRunning\"</span><span class=\"token operator\">></span>\n      <span class=\"token maybe-class-name\">Loading</span><span class=\"token spread operator\">...</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>div v<span class=\"token operator\">-</span><span class=\"token keyword control-flow\">else</span><span class=\"token operator\">-</span><span class=\"token keyword control-flow\">if</span><span class=\"token operator\">=</span><span class=\"token string\">\"task.isError\"</span><span class=\"token operator\">></span>\n      <span class=\"token maybe-class-name\">Something</span> went wrong\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span>div v<span class=\"token operator\">-</span><span class=\"token keyword control-flow\">else</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> task<span class=\"token punctuation\">.</span><span class=\"token property-access\">last</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n</code></pre></div>\n<p>å¦å¤–ï¼Œè¯¥åº“è¿˜åŒ…å«äº†å…¶ä»–æ¯”è¾ƒå®ç”¨çš„ç‰¹æ€§</p>\n<ul>\n<li>æ”¯æŒå–æ¶ˆä»»åŠ¡</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> latestData <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> getLatestTask <span class=\"token operator\">=</span> <span class=\"token function\">useTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      latestData<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/news'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// wait 5s</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">drop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ğŸ‘†such a task is fine to do. It will get canceled when the component is unmounted.</span>\n  getLatestTask<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">perform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// start polling right away</span>\n\n  <span class=\"token comment\">// if needed, you can pass methods to pause and resume the task to the template</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    getLatestTask<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cancelAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// a plain perform like that is safe because the task is set to `drop()`</span>\n    <span class=\"token comment\">// therefore it won't start a new instance if it's already running</span>\n    getLatestTask<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">perform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> getLatestTask<span class=\"token punctuation\">,</span> pause<span class=\"token punctuation\">,</span> resume <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>æ”¯æŒä»»åŠ¡ä¸²è¡Œï¼ŒèŠ‚æµï¼Œå¹¶å‘é™åˆ¶ç­‰ç­‰:</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> task <span class=\"token operator\">=</span> <span class=\"token function\">useTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">restartable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">maxConcurrency</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n<li>æ”¯æŒSSRï¼ŒTypescript</li>\n</ul>\n<p>å…·ä½“å†…å®¹è¯·æŸ¥çœ‹ç›¸å…³çš„æ–‡æ¡£ï¼š<a href=\"https://github.com/martinmalinda/vue-concurrency\">https://github.com/martinmalinda/vue-concurrency</a></p>\n",
    "frontmatter": {
      "title": "Vue3x Composition API å¼‚æ­¥çŠ¶æ€å¤„ç†",
      "date": "2020-10-08"
    },
    "toc": "<ul>\n<li><a href=\"#vue-useuseasyncstate\">vue-use/useAsyncState</a></li>\n<li><a href=\"#vue-composition-toolkituseasyncstate\">vue-composition-toolkit/useAsyncState</a></li>\n<li><a href=\"#suspense\">Suspense</a></li>\n<li><a href=\"#vue-promised\">vue-promised</a></li>\n<li><a href=\"#vue-concurrency--usetask\">vue-concurrency â€” useTask</a></li>\n</ul>\n",
    "name": "Vue3x Composition API å¼‚æ­¥çŠ¶æ€å¤„ç†",
    "id": "0b1d63fc0cb9bfefcfb6f55680142d5d",
    "next": {
      "name": "Vue3xç»„ä»¶æ¸²æŸ“",
      "id": "c228310886a810a45a4fcc807de3c954"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/Vue3xç»„ä»¶æ¸²æŸ“.md",
      "/home/zepang/WorkSpace/blog/posts/Vue3xç»„ä»¶æ¸²æŸ“.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"åº”ç”¨åˆå§‹åŒ–\">åº”ç”¨åˆå§‹åŒ–</h1>\n<p>æˆ‘ä»¬ç®€å•çš„åˆ›å»ºä¸€ä¸ªVue3xçš„åº”ç”¨ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">yarn create vite-app leraning-vue3x</code></pre></div>\n<p>Vueä¼šä»ä¸€ä¸ªæ ¹èŠ‚ç‚¹å¼€å§‹æ•´ä¸ªç»„ä»¶æ ‘çš„æ¸²æŸ“ï¼Œæ‰“å¼€ <code>src/main.js</code>ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> createApp <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'vue'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">App</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./App.vue'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token string\">'./index.css'</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token maybe-class-name\">App</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">mount</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#app'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Vue3xå¯¼å‡ºä¸€ä¸ªå‡½æ•°<code>createApp</code>æ¥åˆ›å»ºåº”ç”¨å®ä¾‹ï¼ˆ<code>app</code>ï¼‰ï¼Œè¿™ä¸Vue2xä½¿ç”¨ <code>new</code> å…³é”®å­—ç›´æ¥åˆ›å»ºå®ä¾‹ç•¥å¾®æœ‰æ‰€å·®åˆ«ï¼Œä¸è¿‡ä¸¤è€…æœ€ç»ˆéƒ½éœ€è¦é€šè¿‡è°ƒç”¨ <code>app.mount</code> æŒ‚è½½åˆ° <code>DOM</code> èŠ‚ç‚¹ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œåœ¨<code>createApp(app)</code>ä¹‹å‰æ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åå¯åŠ¨è¿ç”¨ï¼Œæ‰“å¼€<code>chrome</code>æµè§ˆå™¨å’Œæ§åˆ¶å°ï¼Œæˆ‘ä»¬é€šè¿‡æ–­ç‚¹è°ƒè¯•æ¥åˆ†æä¸€ä¸‹è¯¥å‡½æ•°å’Œ<code>app</code>åˆ›å»ºè¿‡ç¨‹ã€‚</p>\n<h1 id=\"createappå‡½æ•°\">createAppå‡½æ•°</h1>\n<p>okï¼Œé€šè¿‡æ–­ç‚¹ç›´æ¥è¿›å…¥<code>createApp</code>å†…éƒ¨ï¼Œå¯ä»¥å‘ç°<code>createApp</code>å¤§æ¦‚åšäº†ä¸‹è¾¹ä¸¤ä»¶äº‹æƒ…</p>\n<ul>\n<li>\n<p>åˆ›å»º app</p>\n</li>\n<li>\n<p>é‡å†™ app.mount å‡½æ•°ï¼Œå¹¶åœ¨å†…éƒ¨è°ƒç”¨åŸæ¥çš„ mount å‡½æ•°</p>\n</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> createApp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token spread operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1. åˆ›å»º app</span>\n    <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">ensureRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">injectNativeTagCheck</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// å¯¼å‡º app çš„ mount å‡½æ•°</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> mount <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> app<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 2. é‡å†™ mount å‡½æ•°</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">mount</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">containerOrSelector</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> <span class=\"token function\">normalizeContainer</span><span class=\"token punctuation\">(</span>containerOrSelector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>container<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span><span class=\"token property-access\">_component</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>component<span class=\"token punctuation\">.</span><span class=\"token property-access\">render</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>component<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            component<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span> <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// clear content before mounting</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// è°ƒç”¨åŸ app.mount</span>\n        <span class=\"token keyword\">const</span> proxy <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v-cloak'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-v-app'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> proxy<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€æ­¥åˆ†æä¸€ä¸‹å…·ä½“çš„è¿‡ç¨‹ã€‚</p>\n<h1 id=\"åˆ›å»ºapp\">åˆ›å»ºapp</h1>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token doc-comment comment\">/**\n * render = <span class=\"token punctuation\">{</span> render, hydrate, createApp <span class=\"token punctuation\">}</span>\n */</span>\n<span class=\"token keyword\">const</span> render <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token spread operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯viteåˆ›å»ºçš„é¡¹ç›®ï¼ŒcreateApp(App) ä¼ å…¥çš„Appç»„ä»¶ä¸ä»…æ˜¯å•æ–‡ä»¶å¯¼å‡ºçš„å¯¹è±¡å·²ç»æ˜¯ç»è¿‡viteè½¬åŒ–è¿‡çš„å¯¹è±¡ï¼Œå…¶å†…å·²ç»åŒ…å«renderå‡½æ•°</span>\n    <span class=\"token comment\">// å…·ä½“å¯ä»¥çœ‹ @vue/compiler-sfc è¿™ä¸ªä¾èµ– vue-loaderåŒæ ·ç”¨åˆ°äº†è¯¥ä¾èµ–</span>\n    <span class=\"token function\">ensureRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">render</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 1...</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">ensureRenderer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> renderer <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>renderer <span class=\"token operator\">=</span> <span class=\"token function\">createRenderer</span><span class=\"token punctuation\">(</span>rendererOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 2...</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createRenderer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">baseCreateRenderer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 3...</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">baseCreateRenderer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">options<span class=\"token punctuation\">,</span> createHydrationFns</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">path</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n1<span class=\"token punctuation\">,</span> n2<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">,</span> anchor <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> parentComponent <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> parentSuspense <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> isSVG <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> optimized <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token spread operator\">...</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">processText</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n1<span class=\"token punctuation\">,</span> n2<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">,</span> anchor</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token spread operator\">...</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">processCommentNode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n1<span class=\"token punctuation\">,</span> n2<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">,</span> anchor</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token spread operator\">...</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ç»„ä»¶æ¸²æŸ“çš„æ ¸å¿ƒé€»è¾‘</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">render</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">vnode<span class=\"token punctuation\">,</span> container</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span> \n       <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>vnode <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">.</span><span class=\"token property-access\">_vnode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">.</span><span class=\"token property-access\">_vnode</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">patch</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">.</span><span class=\"token property-access\">_vnode</span> <span class=\"token operator\">||</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">,</span> container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">flushPostFlushCbs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token property-access\">_vnode</span> <span class=\"token operator\">=</span> vnode<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        render<span class=\"token punctuation\">,</span>\n        hydrate<span class=\"token punctuation\">,</span>\n        createApp<span class=\"token operator\">:</span> <span class=\"token function\">createAppAPI</span><span class=\"token punctuation\">(</span>render<span class=\"token punctuation\">,</span> hydrate<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>é€šè¿‡è¿½è¸ªä»£ç ï¼Œå‘ç°Vueå¯¼å‡ºçš„<code>createApp</code>å‡½æ•°å†…ï¼Œåˆ›å»º<code>app</code>è°ƒç”¨çš„<code>createApp</code>å‡½æ•°å®é™…ä¸Šè°ƒç”¨çš„æ˜¯<code>createAppAPI</code>è¿”å›çš„å‡½æ•°<code>createApp</code>ã€‚</p>\n<p>è¯¥å‡½æ•°æ¸…æ™°çš„æè¿°äº† <code>app</code> è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä¸‹è¾¹æˆ‘è´´å‡ºäº†è¯¥å‡½æ•°çš„å…¨éƒ¨ä»£ç ï¼Œå¹¶åœ¨é‡è¦çš„åœ°æ–¹åšäº†ä¸€äº›æ³¨é‡Šã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">createAppContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        app<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        config<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            isNativeTag<span class=\"token operator\">:</span> <span class=\"token constant\">NO</span><span class=\"token punctuation\">,</span>\n            <span class=\"token dom variable\">performance</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            globalProperties<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            optionMergeStrategies<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            isCustomElement<span class=\"token operator\">:</span> <span class=\"token constant\">NO</span><span class=\"token punctuation\">,</span>\n            errorHandler<span class=\"token operator\">:</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">,</span>\n            warnHandler<span class=\"token operator\">:</span> <span class=\"token keyword nil\">undefined</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// å…¨å±€mixins</span>\n        mixins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// å…¨å±€æ’ä»¶</span>\n        components<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// å…¨å±€æŒ‡ä»¤</span>\n        directives<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// å…¨å±€çš„provide</span>\n        provides<span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createAppAPI</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">render<span class=\"token punctuation\">,</span> hydrate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">rootComponent<span class=\"token punctuation\">,</span> rootProps <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>rootProps <span class=\"token operator\">!=</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span><span class=\"token function\">isObject</span><span class=\"token punctuation\">(</span>rootProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">root props passed to app.mount() must be an object.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            rootProps <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token doc-comment comment\">/**</span>\n<span class=\"token doc-comment comment\">         * 1. åˆ›å»ºå…¨å±€çš„ä¸Šä¸‹æ–‡å¯¹è±¡</span>\n<span class=\"token doc-comment comment\">         * 2. åœ¨è°ƒç”¨ app.use app.mixin app.component app.directive ... ç­‰è¿™äº›æ–¹æ³•çš„æ—¶å€™åˆ†åˆ«ä¼šå¾€å…¨å±€ä¸Šä¸‹æ–‡ä¸­å­˜å…¥ä¸€äº›å±æ€§</span>\n<span class=\"token doc-comment comment\">         * 3. å…·ä½“çš„å†…å®¹å¯ä»¥æŸ¥çœ‹ä¸‹è¾¹çš„ä»£ç å’Œ createAppContext å‡½æ•°çš„è¿”å›å¯¹è±¡</span>\n<span class=\"token doc-comment comment\">         */</span> \n        <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> <span class=\"token function\">createAppContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> installedPlugins <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> isMounted <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token property-access\">app</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            _uid<span class=\"token operator\">:</span> uid$<span class=\"token number\">1</span><span class=\"token operator\">++</span><span class=\"token punctuation\">,</span>\n            _component<span class=\"token operator\">:</span> rootComponent<span class=\"token punctuation\">,</span>\n            _props<span class=\"token operator\">:</span> rootProps<span class=\"token punctuation\">,</span>\n            _container<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n            _context<span class=\"token operator\">:</span> context<span class=\"token punctuation\">,</span>\n            version<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">get</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">return</span> context<span class=\"token punctuation\">.</span><span class=\"token property-access\">config</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">set</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">app.config cannot be replaced. Modify individual options instead.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// å…¨å±€æ’ä»¶</span>\n            <span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">plugin<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>installedPlugins<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Plugin has already been applied to target app.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>plugin <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">.</span><span class=\"token property-access\">install</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    installedPlugins<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    plugin<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">install</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    installedPlugins<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>plugin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token function\">plugin</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">A plugin must either be a function or an object with an \"install\" </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">function.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// å…¨å±€mixins</span>\n            <span class=\"token function\">mixin</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mixin</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>__VUE_OPTIONS_API__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>context<span class=\"token punctuation\">.</span><span class=\"token property-access\">mixins</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>mixin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        context<span class=\"token punctuation\">.</span><span class=\"token property-access\">mixins</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>mixin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token comment\">// global mixin with props/emits de-optimizes props/emits</span>\n                        <span class=\"token comment\">// normalization caching.</span>\n                        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>mixin<span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span> <span class=\"token operator\">||</span> mixin<span class=\"token punctuation\">.</span><span class=\"token property-access\">emits</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                            context<span class=\"token punctuation\">.</span><span class=\"token property-access\">deopt</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Mixin has already been applied to target app'</span> <span class=\"token operator\">+</span>\n                            <span class=\"token punctuation\">(</span>mixin<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mixin<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Mixins are only available in builds supporting Options API'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// å…¨å±€ç»„ä»¶</span>\n            <span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> component</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">validateComponentName</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">.</span><span class=\"token property-access\">config</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>component<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword control-flow\">return</span> context<span class=\"token punctuation\">.</span><span class=\"token property-access\">components</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> context<span class=\"token punctuation\">.</span><span class=\"token property-access\">components</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Component \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" has already been registered in target app.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                context<span class=\"token punctuation\">.</span><span class=\"token property-access\">components</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> component<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// å…¨å±€æŒ‡ä»¤</span>\n            <span class=\"token function\">directive</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> directive</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">validateDirectiveName</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>directive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword control-flow\">return</span> context<span class=\"token punctuation\">.</span><span class=\"token property-access\">directives</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> context<span class=\"token punctuation\">.</span><span class=\"token property-access\">directives</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Directive \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" has already been registered in target app.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                context<span class=\"token punctuation\">.</span><span class=\"token property-access\">directives</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> directive<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">rootContainer<span class=\"token punctuation\">,</span> isHydrate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isMounted<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">const</span> vnode <span class=\"token operator\">=</span> <span class=\"token function\">createVNode</span><span class=\"token punctuation\">(</span>rootComponent<span class=\"token punctuation\">,</span> rootProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token comment\">// store app context on the root VNode.</span>\n                    <span class=\"token comment\">// this will be set on the root instance on initial mount.</span>\n                    vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">appContext</span> <span class=\"token operator\">=</span> context<span class=\"token punctuation\">;</span>\n                    <span class=\"token comment\">// HMR root reload</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        context<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">reload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token function\">cloneVNode</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> rootContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>isHydrate <span class=\"token operator\">&#x26;&#x26;</span> hydrate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">hydrate</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">,</span> rootContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">,</span> rootContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    isMounted <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                    app<span class=\"token punctuation\">.</span><span class=\"token property-access\">_container</span> <span class=\"token operator\">=</span> rootContainer<span class=\"token punctuation\">;</span>\n                    rootContainer<span class=\"token punctuation\">.</span><span class=\"token property-access\">__vue_app__</span> <span class=\"token operator\">=</span> app<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> __VUE_PROD_DEVTOOLS__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">devtoolsInitApp</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword control-flow\">return</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">component</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">proxy</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">App has already been mounted.\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">If you want to remount the same app, move your app creation logic </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">into a factory function and create fresh app instances for each </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mount - e.g. \\`const createMyApp = () => createApp(App)\\`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">unmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>isMounted<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">.</span><span class=\"token property-access\">_container</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> __VUE_PROD_DEVTOOLS__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">devtoolsUnmountApp</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Cannot unmount an app that is not mounted.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// å…¨å±€çš„provide</span>\n            <span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> key <span class=\"token keyword\">in</span> context<span class=\"token punctuation\">.</span><span class=\"token property-access\">provides</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">App already provides property with key \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\". </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">It will be overwritten with the new value.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token comment\">// TypeScript doesn't allow symbols as index type</span>\n                <span class=\"token comment\">// https://github.com/Microsoft/TypeScript/issues/24587</span>\n                context<span class=\"token punctuation\">.</span><span class=\"token property-access\">provides</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// è¿”å› app å¯¹è±¡</span>\n        <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre></div>\n<h1 id=\"é‡å†™-appmount\">é‡å†™ app.mount</h1>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">normalizeContainer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">container</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isString</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Failed to mount app: mount target selector returned null.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> container<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> createApp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token spread operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token comment\">// å¯¼å‡º app çš„ mount å‡½æ•°</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> mount <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> app<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 2. é‡å†™ mount å‡½æ•°</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">mount</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">containerOrSelector</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// è·å–containerï¼Œ</span>\n        <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> <span class=\"token function\">normalizeContainer</span><span class=\"token punctuation\">(</span>containerOrSelector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>container<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span><span class=\"token property-access\">_component</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>component<span class=\"token punctuation\">.</span><span class=\"token property-access\">render</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>component<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            component<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span> <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// clear content before mounting</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// è°ƒç”¨åŸ app.mount</span>\n        <span class=\"token keyword\">const</span> proxy <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v-cloak'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        container<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-v-app'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> proxy<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> app<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">createAppAPI</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">render<span class=\"token punctuation\">,</span> hydrate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">rootComponent<span class=\"token punctuation\">,</span> rootProps <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">rootContainer<span class=\"token punctuation\">,</span> isHydrate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isMounted<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// åˆ›å»ºVNode</span>\n                <span class=\"token keyword\">const</span> vnode <span class=\"token operator\">=</span> <span class=\"token function\">createVNode</span><span class=\"token punctuation\">(</span>rootComponent<span class=\"token punctuation\">,</span> rootProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// store app context on the root VNode.</span>\n                <span class=\"token comment\">// this will be set on the root instance on initial mount.</span>\n                vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">appContext</span> <span class=\"token operator\">=</span> context<span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// HMR root reload</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    context<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">reload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token function\">cloneVNode</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> rootContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>isHydrate <span class=\"token operator\">&#x26;&#x26;</span> hydrate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">hydrate</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">,</span> rootContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">,</span> rootContainer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                isMounted <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                app<span class=\"token punctuation\">.</span><span class=\"token property-access\">_container</span> <span class=\"token operator\">=</span> rootContainer<span class=\"token punctuation\">;</span>\n                rootContainer<span class=\"token punctuation\">.</span><span class=\"token property-access\">__vue_app__</span> <span class=\"token operator\">=</span> app<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> __VUE_PROD_DEVTOOLS__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">devtoolsInitApp</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">return</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">component</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">proxy</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">App has already been mounted.\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">If you want to remount the same app, move your app creation logic </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">into a factory function and create fresh app instances for each </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">mount - e.g. \\`const createMyApp = () => createApp(App)\\`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h1 id=\"åˆ›å»ºvnode\">åˆ›å»ºVNode</h1>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">_createVNode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">type<span class=\"token punctuation\">,</span> props <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> children <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> patchFlag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> dynamicProps <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> isBlockNode <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>type <span class=\"token operator\">||</span> type <span class=\"token operator\">===</span> <span class=\"token constant\">NULL_DYNAMIC_COMPONENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Invalid vnode type when creating vnode: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>type<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        type <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Comment</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isVNode</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// createVNode receiving an existing vnode. This happens in cases like</span>\n        <span class=\"token comment\">// &#x3C;component :is=\"vnode\"/></span>\n        <span class=\"token comment\">// #2078 make sure to merge refs during the clone instead of overwriting it</span>\n        <span class=\"token keyword\">const</span> cloned <span class=\"token operator\">=</span> <span class=\"token function\">cloneVNode</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">/* mergeRef: true */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>children<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">normalizeChildren</span><span class=\"token punctuation\">(</span>cloned<span class=\"token punctuation\">,</span> children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">return</span> cloned<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// class component normalization.</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isClassComponent</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        type <span class=\"token operator\">=</span> type<span class=\"token punctuation\">.</span><span class=\"token property-access\">__vccOpts</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// class &#x26; style normalization.</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// for reactive or proxy objects, we need to clone it to enable mutation.</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isProxy</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token maybe-class-name\">InternalObjectKey</span> <span class=\"token keyword\">in</span> props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            props <span class=\"token operator\">=</span> <span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">class</span><span class=\"token operator\">:</span> klass<span class=\"token punctuation\">,</span> style <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>klass <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span><span class=\"token function\">isString</span><span class=\"token punctuation\">(</span>klass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            props<span class=\"token punctuation\">.</span><span class=\"token property-access\">class</span> <span class=\"token operator\">=</span> <span class=\"token function\">normalizeClass</span><span class=\"token punctuation\">(</span>klass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isObject</span><span class=\"token punctuation\">(</span>style<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// reactive state objects need to be cloned since they are likely to be</span>\n            <span class=\"token comment\">// mutated</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isProxy</span><span class=\"token punctuation\">(</span>style<span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>style<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                style <span class=\"token operator\">=</span> <span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> style<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            props<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span> <span class=\"token operator\">=</span> <span class=\"token function\">normalizeStyle</span><span class=\"token punctuation\">(</span>style<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// encode the vnode type information into a bitmap</span>\n    <span class=\"token keyword\">const</span> shapeFlag <span class=\"token operator\">=</span> <span class=\"token function\">isString</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">?</span> <span class=\"token number\">1</span> <span class=\"token comment\">/* ELEMENT */</span>\n        <span class=\"token operator\">:</span>  <span class=\"token function\">isSuspense</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">?</span> <span class=\"token number\">128</span> <span class=\"token comment\">/* SUSPENSE */</span>\n            <span class=\"token operator\">:</span> <span class=\"token function\">isTeleport</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">?</span> <span class=\"token number\">64</span> <span class=\"token comment\">/* TELEPORT */</span>\n                <span class=\"token operator\">:</span> <span class=\"token function\">isObject</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span>\n                    <span class=\"token operator\">?</span> <span class=\"token number\">4</span> <span class=\"token comment\">/* STATEFUL_COMPONENT */</span>\n                    <span class=\"token operator\">:</span> <span class=\"token function\">isFunction</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span>\n                        <span class=\"token operator\">?</span> <span class=\"token number\">2</span> <span class=\"token comment\">/* FUNCTIONAL_COMPONENT */</span>\n                        <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> shapeFlag <span class=\"token operator\">&#x26;</span> <span class=\"token number\">4</span> <span class=\"token comment\">/* STATEFUL_COMPONENT */</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">isProxy</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        type <span class=\"token operator\">=</span> <span class=\"token function\">toRaw</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Vue received a Component which was made a reactive object. This can </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">lead to unnecessary performance overhead, and should be avoided by </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">marking the component with \\`markRaw\\` or using \\`shallowRef\\` </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">instead of \\`ref\\`.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nComponent that was made reactive: </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> vnode <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        __v_isVNode<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"__v_skip\"</span> <span class=\"token comment\">/* SKIP */</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token punctuation\">,</span>\n        props<span class=\"token punctuation\">,</span>\n        key<span class=\"token operator\">:</span> props <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">normalizeKey</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        ref<span class=\"token operator\">:</span> props <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">normalizeRef</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        scopeId<span class=\"token operator\">:</span> currentScopeId<span class=\"token punctuation\">,</span>\n        children<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        component<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        suspense<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        ssContent<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        ssFallback<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        dirs<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        transition<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        el<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        anchor<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        target<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        targetAnchor<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        staticCount<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        shapeFlag<span class=\"token punctuation\">,</span>\n        patchFlag<span class=\"token punctuation\">,</span>\n        dynamicProps<span class=\"token punctuation\">,</span>\n        dynamicChildren<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        appContext<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// validate key</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span> <span class=\"token operator\">!==</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">VNode created with invalid key (NaN). VNode type:</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">normalizeChildren</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">,</span> children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// normalize suspense children</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span> shapeFlag <span class=\"token operator\">&#x26;</span> <span class=\"token number\">128</span> <span class=\"token comment\">/* SUSPENSE */</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> content<span class=\"token punctuation\">,</span> fallback <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">normalizeSuspenseChildren</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">ssContent</span> <span class=\"token operator\">=</span> content<span class=\"token punctuation\">;</span>\n        vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">ssFallback</span> <span class=\"token operator\">=</span> fallback<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>shouldTrack$<span class=\"token number\">1</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&#x26;&#x26;</span>\n        <span class=\"token comment\">// avoid a block node from tracking itself</span>\n        <span class=\"token operator\">!</span>isBlockNode <span class=\"token operator\">&#x26;&#x26;</span>\n        <span class=\"token comment\">// has current parent block</span>\n        currentBlock <span class=\"token operator\">&#x26;&#x26;</span>\n        <span class=\"token comment\">// presence of a patch flag indicates this node needs patching on updates.</span>\n        <span class=\"token comment\">// component nodes also should always be patched, because even if the</span>\n        <span class=\"token comment\">// component doesn't need to update, it needs to persist the instance on to</span>\n        <span class=\"token comment\">// the next vnode so that it can be properly unmounted later.</span>\n        <span class=\"token punctuation\">(</span>patchFlag <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> shapeFlag <span class=\"token operator\">&#x26;</span> <span class=\"token number\">6</span> <span class=\"token comment\">/* COMPONENT */</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span>\n        <span class=\"token comment\">// the EVENTS flag is only for hydration and if it is the only flag, the</span>\n        <span class=\"token comment\">// vnode should not be considered dynamic due to handler caching.</span>\n        patchFlag <span class=\"token operator\">!==</span> <span class=\"token number\">32</span> <span class=\"token comment\">/* HYDRATE_EVENTS */</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        currentBlock<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> vnode<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>VNodeçš„ç»“æ„</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> vnode <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    __v_isVNode<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"__v_skip\"</span> <span class=\"token comment\">/* SKIP */</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    type<span class=\"token punctuation\">,</span>\n    props<span class=\"token punctuation\">,</span>\n    key<span class=\"token operator\">:</span> props <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">normalizeKey</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    ref<span class=\"token operator\">:</span> props <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">normalizeRef</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    scopeId<span class=\"token operator\">:</span> currentScopeId<span class=\"token punctuation\">,</span>\n    children<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    component<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    suspense<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    ssContent<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    ssFallback<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    dirs<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    transition<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    el<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    anchor<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    target<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    targetAnchor<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    staticCount<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    shapeFlag<span class=\"token punctuation\">,</span>\n    patchFlag<span class=\"token punctuation\">,</span>\n    dynamicProps<span class=\"token punctuation\">,</span>\n    dynamicChildren<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    appContext<span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2 id=\"sharpeflags\">SharpeFlags</h2>\n<p><code>https://github.com/vuejs/vue-next/blob/master/packages/shared/src/shapeFlags.ts</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">enum</span> <span class=\"token maybe-class-name\">ShapeFlags</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// html æˆ– svg æ ‡ç­¾</span>\n  <span class=\"token constant\">ELEMENT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// å‡½æ•°å¼ç»„ä»¶</span>\n  <span class=\"token constant\">FUNCTIONAL_COMPONENT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// æ™®é€šæœ‰çŠ¶æ€ç»„ä»¶</span>\n  <span class=\"token constant\">STATEFUL_COMPONENT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// å­èŠ‚ç‚¹æ˜¯çº¯æ–‡æœ¬</span>\n  <span class=\"token constant\">TEXT_CHILDREN</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// å­èŠ‚ç‚¹æ˜¯æ•°ç»„</span>\n  <span class=\"token constant\">ARRAY_CHILDREN</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// å­èŠ‚ç‚¹æ˜¯ slots</span>\n  <span class=\"token constant\">SLOTS_CHILDREN</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// Portal</span>\n  <span class=\"token constant\">PORTAL</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// Suspense</span>\n  <span class=\"token constant\">SUSPENSE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// éœ€è¦è¢«keepAliveçš„æœ‰çŠ¶æ€ç»„ä»¶</span>\n  <span class=\"token constant\">COMPONENT_SHOULD_KEEP_ALIVE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// å·²ç»è¢«keepAliveçš„æœ‰çŠ¶æ€ç»„ä»¶</span>\n  <span class=\"token constant\">COMPONENT_KEPT_ALIVE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// æœ‰çŠ¶æ€ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶éƒ½æ˜¯â€œç»„ä»¶â€ï¼Œç”¨ COMPONENT è¡¨ç¤º</span>\n  <span class=\"token constant\">COMPONENT</span> <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">ShapeFlags</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STATEFUL_COMPONENT</span> <span class=\"token operator\">|</span> <span class=\"token maybe-class-name\">ShapeFlags</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FUNCTIONAL_COMPONENT</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n",
    "frontmatter": {
      "title": "Vue3xç»„ä»¶æ¸²æŸ“",
      "date": "2020-11-05"
    },
    "toc": "<ul>\n<li>\n<p><a href=\"#%E5%BA%94%E7%94%A8%E5%88%9D%E5%A7%8B%E5%8C%96\">åº”ç”¨åˆå§‹åŒ–</a></p>\n</li>\n<li>\n<p><a href=\"#createapp%E5%87%BD%E6%95%B0\">createAppå‡½æ•°</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%88%9B%E5%BB%BAapp\">åˆ›å»ºapp</a></p>\n</li>\n<li>\n<p><a href=\"#%E9%87%8D%E5%86%99-appmount\">é‡å†™ app.mount</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%88%9B%E5%BB%BAvnode\">åˆ›å»ºVNode</a></p>\n<ul>\n<li><a href=\"#sharpeflags\">SharpeFlags</a></li>\n</ul>\n</li>\n</ul>\n",
    "name": "Vue3xç»„ä»¶æ¸²æŸ“",
    "id": "c228310886a810a45a4fcc807de3c954",
    "prev": {
      "name": "Vue3x Composition API å¼‚æ­¥çŠ¶æ€å¤„ç†",
      "id": "0b1d63fc0cb9bfefcfb6f55680142d5d"
    },
    "next": {
      "name": "vite åŸç†è§£æ(1)-viteå‘½ä»¤åšäº†ä»€ä¹ˆ",
      "id": "20520b7394c04937472b75071f39853b"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/vite åŸç†è§£æ(1)-viteå‘½ä»¤åšäº†ä»€ä¹ˆ.md",
      "/home/zepang/WorkSpace/blog/posts/vite åŸç†è§£æ(1)-viteå‘½ä»¤åšäº†ä»€ä¹ˆ.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¯å¢ƒå‡†å¤‡\">ç¯å¢ƒå‡†å¤‡</h1>\n<ul>\n<li>\n<p>VS Code</p>\n</li>\n<li>\n<p>Node.js</p>\n</li>\n<li>\n<p>Yarn</p>\n</li>\n<li>\n<p><a href=\"https://github.com/vitejs/vite\">vite: https://github.com/vitejs/vite</a></p>\n</li>\n</ul>\n<h1 id=\"ä»€ä¹ˆæ˜¯-vite-\">ä»€ä¹ˆæ˜¯ vite ?</h1>\n<p>ä¸€ä¸ªåŸºäºæµè§ˆå™¨åŸç”Ÿ ES imports çš„å¼€å‘æœåŠ¡å™¨ã€‚</p>\n<p>åœ¨é¡¹ç›®å¼€å‘æ¨¡å¼ä¸‹ï¼Œvite ä¼šæ ¹æ®æµè§ˆå™¨è§£æ <code>import</code> çš„è¯·æ±‚ï¼Œåœ¨æœåŠ¡ç«¯å®Œæˆç¼–è¯‘è¿”å›ä»£ç ã€‚</p>\n<p>vite æ‹¥æœ‰å¾ˆå¤šçš„ç‰¹æ€§ï¼Œæœ¬æ–‡ä»…é€šè¿‡å¯¹å…¶åœ¨ <code>development</code> æ¨¡å¼ä¸‹ç›¸å…³ä»£ç è¿›è¡Œåˆ†æå’Œæ¢ç©¶ä¸€äº›åŸç†ã€‚</p>\n<h1 id=\"ä»-vite-å‘½ä»¤å¼€å§‹\">ä» vite å‘½ä»¤å¼€å§‹</h1>\n<p>å¿«é€Ÿåˆ›å»ºä¸€ä¸ªviteé¡¹ç›®ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">yarn</span> create vite-app <span class=\"token operator\">&#x3C;</span>project-name<span class=\"token operator\">></span>\n</code></pre></div>\n<p>ï¼Œæ‰“å¼€ VS Codeï¼Œæ‰¾åˆ°é¡¹ç›® <code>node_modules/vite</code>ï¼ˆå‘ç°viteæ‰“åŒ…åçš„ä»£ç å¤§éƒ¨åˆ†å¯é˜…è¯»æ€§è‰¯å¥½ï¼Œè§‰å¾—ä¸ä¹ æƒ¯çš„å¯ä»¥ä½¿ç”¨ <code>npm link</code> ç›´æ¥æŸ¥çœ‹ vite çš„æºç ï¼‰ï¼Œé€šè¿‡æŸ¥çœ‹å…¶<code>package.json</code>æ–‡ä»¶çš„é…ç½®ï¼Œæ‰¾åˆ°å…¥å£æ–‡ä»¶ï¼Œé€šè¿‡å¿«é€Ÿçš„é˜…è¯»ï¼Œå¯ä»¥å®šä½åˆ° <code>vite</code> å‘½ä»¤çš„å…¥å£çš„ä»£ç å¦‚ä¸‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// node_modules/vite/dist/node/cli.js</span>\ncli\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[root]'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// default command</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">alias</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serve'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'--port &#x3C;port>'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[number]  port to listen to</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'--force'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[boolean]  force the optimizer to ignore the cache and re-bundle</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'--https'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[boolean]  start the server with TLS and HTTP/2 enabled</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'--open'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[boolean]  open browser on server start</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">action</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> argv</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        argv<span class=\"token punctuation\">.</span><span class=\"token property-access\">root</span> <span class=\"token operator\">=</span> root<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">resolveOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> argv<span class=\"token punctuation\">,</span> defaultMode<span class=\"token operator\">:</span> <span class=\"token string\">'development'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">runServe</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>é€šè¿‡ä¸€äº›å­—é¢ç†è§£ï¼Œè¿è¡Œ <code>vite</code> å‘½ä»¤ä¸»è¦ä¼šåšä¸¤ä»¶äº‹ï¼š</p>\n<ul>\n<li>\n<p>è·å–é…ç½®</p>\n</li>\n<li>\n<p>å¯åŠ¨æœåŠ¡</p>\n</li>\n</ul>\n<p>åœ¨è·å–é…ç½®ä¹‹å‰çš„ä½ç½®æ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œæ‰“å¼€ VS Code çš„è°ƒè¯•ç»ˆç«¯ï¼Œè¿è¡Œï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm run dev</code></pre></div>\n<h1 id=\"vite-è·å–é…ç½®è¿‡ç¨‹åˆ†æ\">vite è·å–é…ç½®è¿‡ç¨‹åˆ†æ</h1>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">resolveConfig</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mode<span class=\"token punctuation\">,</span> configPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cwd <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> resolvedPath<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> isTS <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>configPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// è·å–ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶è·¯å¾„</span>\n        resolvedPath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">,</span> configPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ç”¨æˆ·æœªé…ç½® resolvedPath çš„æƒ…å†µä¸‹ï¼Œå®šä½è·Ÿç›®å½•æ˜¯å¦æœ‰ 'vite.config.js'</span>\n        <span class=\"token keyword\">const</span> jsConfigPath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">,</span> <span class=\"token string\">'vite.config.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">existsSync</span><span class=\"token punctuation\">(</span>jsConfigPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            resolvedPath <span class=\"token operator\">=</span> jsConfigPath<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ç”¨æˆ·æœªé…ç½® resolvedPath çš„æƒ…å†µä¸‹ï¼Œå®šä½è·Ÿç›®å½•æ˜¯å¦æœ‰ 'vite.config.ts'</span>\n            <span class=\"token keyword\">const</span> tsConfigPath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">,</span> <span class=\"token string\">'vite.config.ts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">existsSync</span><span class=\"token punctuation\">(</span>tsConfigPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                isTS <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                resolvedPath <span class=\"token operator\">=</span> tsConfigPath<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>resolvedPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// æ²¡æœ‰ä»»ä½•é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ç›´æ¥è¯»å– env æ–‡ä»¶çš„é…ç½®ï¼Œå¹¶è¿”å›</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n            env<span class=\"token operator\">:</span> <span class=\"token function\">loadEnv</span><span class=\"token punctuation\">(</span>mode<span class=\"token punctuation\">,</span> cwd<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> userConfig<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isTS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// è·å– vite.config.js çš„é…ç½®</span>\n                userConfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span>resolvedPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>userConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// è·å– vit.config.tsçš„é…ç½®</span>\n        <span class=\"token punctuation\">}</span>\n        \n        config<span class=\"token punctuation\">.</span><span class=\"token property-access\">__path</span> <span class=\"token operator\">=</span> resolvedPath<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> config<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>é…ç½®æ–‡ä»¶çš„è·å–æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå…³é”®çš„æ³¨é‡Šæˆ‘éƒ½å†™åœ¨ä¸Šè¾¹äº†</p>\n<h1 id=\"vite-å¯åŠ¨æœåŠ¡è¿‡ç¨‹åˆ†æ\">vite å¯åŠ¨æœåŠ¡è¿‡ç¨‹åˆ†æ</h1>\n<p><code>node_modules/vite/dist/node/server/index.js</code>ä¸­æš´éœ²äº†ä¸€ä¸ª <code>createServer</code> ç”¨æ¥åˆ›å»ºæœåŠ¡å®ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> root <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> configureServer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> resolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> alias <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> transforms <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> vueCustomBlockTransforms <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> optimizeDeps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> enableEsbuild <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> assetsInclude <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">koa_1<span class=\"token punctuation\">.</span>default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token function\">resolveServer</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> watcher <span class=\"token operator\">=</span> chokidar_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">watch</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        ignored<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'**/node_modules/**'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'**/.git/**'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// #610</span>\n        awaitWriteFinish<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            stabilityThreshold<span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n            pollInterval<span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> resolver <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createResolver</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> resolvers<span class=\"token punctuation\">,</span> alias<span class=\"token punctuation\">,</span> assetsInclude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        root<span class=\"token punctuation\">,</span>\n        app<span class=\"token punctuation\">,</span>\n        server<span class=\"token punctuation\">,</span>\n        watcher<span class=\"token punctuation\">,</span>\n        resolver<span class=\"token punctuation\">,</span>\n        config<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// port is exposed on the context for hmr client connection</span>\n        <span class=\"token comment\">// in case the files are served under a different port</span>\n        port<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">port</span> <span class=\"token operator\">||</span> <span class=\"token number\">3000</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// attach server context to koa context</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">assign</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">read</span> <span class=\"token operator\">=</span> utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cachedRead</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// cors</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">cors</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        app<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@koa/cors'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">cors</span> <span class=\"token operator\">===</span> <span class=\"token string\">'boolean'</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">cors</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> resolvedPlugins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// é…ç½®å„ç§æ’ä»¶</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    resolvedPlugins<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">m</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> m <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">m</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> listen <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">listen</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bind</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    server<span class=\"token punctuation\">.</span><span class=\"token property-access\">listen</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">port<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>optimizeDeps<span class=\"token punctuation\">.</span><span class=\"token property-access\">auto</span> <span class=\"token operator\">!==</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../optimizer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">optimizeDeps</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    server<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">once</span><span class=\"token punctuation\">(</span><span class=\"token string\">'listening'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        context<span class=\"token punctuation\">.</span><span class=\"token property-access\">port</span> <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">address</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">port</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> server<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>é€šè¿‡ä»£ç åˆ†æï¼Œ<code>createServer</code> å‡½æ•°å¤§æ¦‚åšäº†ä¸€ä¸‹å‡ ä»¶äº‹ï¼š</p>\n<ul>\n<li>\n<p>ä¸ºäº†è·å¾—ä½¿ç”¨ä¸­é—´ä»¶çš„èƒ½åŠ›ï¼Œåˆ›å»º koaçš„ å®ä¾‹</p>\n</li>\n<li>\n<p>ä½¿ç”¨ <code>chokidar</code> åˆ›å»ºä¸€ä¸ª <code>watcher</code></p>\n</li>\n<li>\n<p>å°† <code>root, app, server, watcher, resolver, config, port</code> æŒ‚è½½åˆ° koa ä¸Šä¸‹æ–‡å¯¹è±¡</p>\n</li>\n<li>\n<p>é…ç½®å’ŒæŒ‚è½½å„ç§viteæœåŠ¡æ’ä»¶</p>\n</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> resolvedPlugins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// ç”ŸæˆsourceMapæ’ä»¶</span>\n    sourceMapPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// é‡å†™æ¨¡å—ä¸­importçš„å¯¼å…¥</span>\n    moduleRewritePlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// é‡å†™htmlä¸­scriptçš„å†…å®¹</span>\n    htmlRewritePlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ç”¨æˆ·å®šä¹‰çš„æ’ä»¶</span>\n    <span class=\"token spread operator\">...</span><span class=\"token method function property-access\">toArray</span><span class=\"token punctuation\">(</span>configureServer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// /vite/env è¿”å›ç¯å¢ƒå˜é‡æ’ä»¶</span>\n    envPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// è·å–æ¨¡å—å†…å®¹æ’ä»¶</span>\n    moduleResolvePlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ä»£ç†æ’ä»¶</span>\n    proxyPlugin<span class=\"token punctuation\">,</span>\n    clientPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// çƒ­æ›´æ–°æ’ä»¶</span>\n    hmrPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token spread operator\">...</span><span class=\"token punctuation\">(</span>transforms<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">||</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span>vueCustomBlockTransforms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span>\n      <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token function\">createServerTransformPlugin</span><span class=\"token punctuation\">(</span>\n            transforms<span class=\"token punctuation\">,</span>\n            vueCustomBlockTransforms<span class=\"token punctuation\">,</span>\n            resolver\n          <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// vueæ–‡ä»¶å¤„ç†æ’ä»¶</span>\n    vuePlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// css èµ„æºå¤„ç†</span>\n    cssPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// esbuildå¤„ç†èµ„æºæ’ä»¶</span>\n    enableEsbuild <span class=\"token operator\">?</span> esbuildPlugin <span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// JSON èµ„æºå¤„ç†æ’ä»¶</span>\n    jsonPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// å¤„ç†é™æ€èµ„æºæ’ä»¶</span>\n    assetPathPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// å¤„ç† webWorker æ’ä»¶</span>\n    webWorkerPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// å¤„ç† wasm æ’ä»¶</span>\n    wasmPlugin<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// é™æ€èµ„æºæœåŠ¡æ’ä»¶</span>\n    serveStaticPlugin\n  <span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>å½“æœåŠ¡è¿è¡Œèµ·æ¥ä¹‹åï¼Œç­‰å¾…èµ„æºè¯·æ±‚ï¼Œç„¶åé’ˆå¯¹ä¸åŒçš„è¯·æ±‚èµ°å¯¹åº”çš„æ’ä»¶å¤„ç†å’Œè¿”å›å†…å®¹å°±å®Œäº†ã€‚</p>\n",
    "frontmatter": {
      "title": "vite åŸç†è§£æ(1)-viteå‘½ä»¤åšäº†ä»€ä¹ˆ",
      "date": "2020-09-10"
    },
    "toc": "<ul>\n<li><a href=\"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">ç¯å¢ƒå‡†å¤‡</a></li>\n<li><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-vite-\">ä»€ä¹ˆæ˜¯ vite ?</a></li>\n<li><a href=\"#%E4%BB%8E-vite-%E5%91%BD%E4%BB%A4%E5%BC%80%E5%A7%8B\">ä» vite å‘½ä»¤å¼€å§‹</a></li>\n<li><a href=\"#vite-%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90\">vite è·å–é…ç½®è¿‡ç¨‹åˆ†æ</a></li>\n<li><a href=\"#vite-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90\">vite å¯åŠ¨æœåŠ¡è¿‡ç¨‹åˆ†æ</a></li>\n</ul>\n",
    "name": "vite åŸç†è§£æ(1)-viteå‘½ä»¤åšäº†ä»€ä¹ˆ",
    "id": "20520b7394c04937472b75071f39853b",
    "prev": {
      "name": "Vue3xç»„ä»¶æ¸²æŸ“",
      "id": "c228310886a810a45a4fcc807de3c954"
    },
    "next": {
      "name": "vite åŸç†è§£æ(2)-é‡å†™npmæ¨¡å—(moduleRewritePlugin)å’Œ@modules",
      "id": "56a707945bbb4370daf0bfe1e01800ef"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/vite åŸç†è§£æ(2)-é‡å†™npmæ¨¡å—(moduleRewritePlugin)å’Œ@modules.md",
      "/home/zepang/WorkSpace/blog/posts/vite åŸç†è§£æ(2)-é‡å†™npmæ¨¡å—(moduleRewritePlugin)å’Œ@modules.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¯å¢ƒå‡†å¤‡\">ç¯å¢ƒå‡†å¤‡</h1>\n<ul>\n<li>\n<p>VS Code</p>\n</li>\n<li>\n<p>Node.js</p>\n</li>\n<li>\n<p>Yarn</p>\n</li>\n</ul>\n<h1 id=\"es-modules\">ES modules</h1>\n<p>å…³äº ES modules ï¼Œæ–‡ç« ä¸åšè¿‡å¤šçš„ä»‹ç»ï¼Œå…·ä½“è¯·æŸ¥çœ‹ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules</a></p>\n<p>æ¥ç€ä¸Šä¸€ç¯‡æ–‡ç« çš„è¿›åº¦ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®<code>locahost:3000</code>ï¼ŒæŸ¥çœ‹ä¸€ä¸‹<code>index.html</code>çš„ä»£ç ï¼š</p>\n<p><img src=\"/images/vite-es-modules-html.png\" alt=\"\"></p>\n<p><code>script</code>æ ‡ç­¾æŒ‡å®šäº†<code>type=\"module\"</code>å‘ŠçŸ¥æµè§ˆå™¨è¿™æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ‰¾åˆ°æ§åˆ¶å°çš„<code>network > js</code>ï¼Œåœ¨è¯·æ±‚èµ„æºä¸­æŸ¥çœ‹ä¸€ä¸‹<code>main.js</code>çš„ä»£ç ï¼š</p>\n<p><img src=\"/images/vite-es-modules-main.jpg\" alt=\"\"></p>\n<p>ä»£ç ä¸­ç›´æ¥ä½¿ç”¨<code>import</code>å…³é”®å­—å»å¯¼å…¥<code>vue</code>ï¼ŒåŒæ—¶ï¼Œæµè§ˆå™¨ä¼šä»¥å‘å‡ºè¯·æ±‚åŠ è½½è¯¥èµ„æº</p>\n<p><img src=\"/images/vite-es-modules-request-vue.jpg\" alt=\"\"></p>\n<h1 id=\"é‡å†™ä¾èµ–è·¯å¾„---modules\">é‡å†™ä¾èµ–è·¯å¾„ -> @modules</h1>\n<p>é€šè¿‡ä¸Šè¾¹çš„ä¸€ä¸ªæˆªå›¾ï¼Œå¯ä»¥å‘ç°æµè§ˆå™¨åŠ è½½çš„<code>main.js</code>ä¸­å¯¼å‡º<code>vue</code>çš„ä»£ç å’Œæºä»£ç å¹¶ä¸ä¸€è‡´ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// source</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">vue</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'vue'</span>\n\n<span class=\"token comment\">// loaded</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">vue</span> <span class=\"token keyword module\">from</span> '@modules<span class=\"token operator\">/</span>vue\n</code></pre></div>\n<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æœ‰æåˆ°ä¸€ä¸ªæ’ä»¶<code>moduleRewritePlugin</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Plugin for rewriting served js.</span>\n<span class=\"token comment\">// - Rewrites named module imports to `/@modules/:id` requests, e.g.</span>\n<span class=\"token comment\">//   \"vue\" => \"/@modules/vue\"</span>\n<span class=\"token comment\">// - Rewrites files containing HMR code (reference to `import.meta.hot`) to</span>\n<span class=\"token comment\">//   inject `import.meta.hot` and track HMR boundary accept whitelists.</span>\n<span class=\"token comment\">// - Also tracks importer/importee relationship graph during the rewrite.</span>\n<span class=\"token comment\">//   The graph is used by the HMR plugin to perform analysis on file change.</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">moduleRewritePlugin</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> root<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">,</span> watcher<span class=\"token punctuation\">,</span> resolver <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">===</span> <span class=\"token number\">304</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// we are doing the js rewrite after all other middlewares have finished;</span>\n        <span class=\"token comment\">// this allows us to post-process javascript produced by user middlewares</span>\n        <span class=\"token comment\">// regardless of the extension of the original files.</span>\n        <span class=\"token keyword\">const</span> publicPath <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">response</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">is</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            <span class=\"token operator\">!</span>cssUtils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isCSSRequest</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            <span class=\"token operator\">!</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.map'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            <span class=\"token operator\">!</span>resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isPublicRequest</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            <span class=\"token comment\">// skip internal client</span>\n            publicPath <span class=\"token operator\">!==</span> serverPluginClient_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">clientPublicPath</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            <span class=\"token comment\">// need to rewrite for &#x3C;script>\\&#x3C;template> part in vue files</span>\n            <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.vue'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">vue</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'style'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readBody</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> cacheKey <span class=\"token operator\">=</span> publicPath <span class=\"token operator\">+</span> content<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> isHmrRequest <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">t</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isHmrRequest <span class=\"token operator\">&#x26;&#x26;</span> rewriteCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(cached) </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> rewriteCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">await</span> es_module_lexer_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">init</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// dynamic import may contain extension-less path,</span>\n                <span class=\"token comment\">// (.e.g import(runtimePathString))</span>\n                <span class=\"token comment\">// so we need to normalize importer to ensure it contains extension</span>\n                <span class=\"token comment\">// before we perform hmr analysis.</span>\n                <span class=\"token comment\">// on the other hand, static import is guaranteed to have extension</span>\n                <span class=\"token comment\">// because they must all have gone through module rewrite.</span>\n                <span class=\"token keyword\">const</span> importer <span class=\"token operator\">=</span> utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeUnRelatedHmrQuery</span><span class=\"token punctuation\">(</span>resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">normalizePublicPath</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> <span class=\"token function\">rewriteImports</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">,</span> importer<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isHmrRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    rewriteCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(skipped) </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æºä»£ç çš„ä»¥åæ³¨é‡Šè§£é‡Šäº†è¯¥æ’ä»¶ä¼šé‡å†™<code>js</code>æ–‡ä»¶ä¸­æ¨¡å—å¯¼å…¥ï¼Œå¹¶ä¸”è¿˜ç‰¹æ„æä¾›äº†ä¾‹å­ \"vue\" => \"/@modules/vue\"ï¼Œ<code>import vue from 'vue'</code>è¿™æ ·çš„å¯¼å…¥æ¨¡å—çš„ä»£ç å°†ä¼šè¢«é‡å†™ä¸º<code>import vue from '@modules/vue</code>ã€‚</p>\n<p>å¯ä»¥çœ‹ä¸‹å…·ä½“çš„ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">rewriteImports</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> importer<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">,</span> timestamp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// #806 strip UTF-8 BOM</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">charCodeAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0xfeff</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        source <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> imports <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// es-module-lerxer</span>\n            imports <span class=\"token operator\">=</span> es_module_lexer_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> hasHMR <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'import.meta.hot'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> hasEnv <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'import.meta.env'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>imports<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">||</span> hasHMR <span class=\"token operator\">||</span> hasEnv<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>importer<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">: rewriting</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">magic_string_1<span class=\"token punctuation\">.</span>default</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> hasReplaced <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> prevImportees <span class=\"token operator\">=</span> serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">importeeMap</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>importer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> currentImportees <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">importeeMap</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>importer<span class=\"token punctuation\">,</span> currentImportees<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> imports<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> s<span class=\"token operator\">:</span> start<span class=\"token punctuation\">,</span> e<span class=\"token operator\">:</span> end<span class=\"token punctuation\">,</span> d<span class=\"token operator\">:</span> dynamicIndex<span class=\"token punctuation\">,</span> ss<span class=\"token operator\">:</span> expStart<span class=\"token punctuation\">,</span> se<span class=\"token operator\">:</span> expEnd <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> imports<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">substring</span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">const</span> hasViteIgnore <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token escape\">\\/</span><span class=\"token special-escape escape\">\\*</span><span class=\"token charclass class-name\">\\s</span><span class=\"token quantifier number\">*</span>@vite-ignore<span class=\"token charclass class-name\">\\s</span><span class=\"token quantifier number\">*</span><span class=\"token special-escape escape\">\\*</span><span class=\"token escape\">\\/</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// ...</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>dynamicIndex <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span> hasLiteralDynamicId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token comment\">// do not rewrite external imports</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isExternalUrl</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword control-flow\">continue</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">const</span> resolved <span class=\"token operator\">=</span> exports<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveImport</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> importer<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">,</span> timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>resolved <span class=\"token operator\">!==</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">    \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" --> \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resolved<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isOptimizedCjs</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>dynamicIndex <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                                <span class=\"token keyword\">const</span> exp <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">substring</span><span class=\"token punctuation\">(</span>expStart<span class=\"token punctuation\">,</span> expEnd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token keyword\">const</span> replacement <span class=\"token operator\">=</span> <span class=\"token function\">transformCjsImport</span><span class=\"token punctuation\">(</span>exp<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolved<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">overwrite</span><span class=\"token punctuation\">(</span>expStart<span class=\"token punctuation\">,</span> expEnd<span class=\"token punctuation\">,</span> replacement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token punctuation\">}</span>\n                            <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>hasLiteralDynamicId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                                <span class=\"token comment\">// rewrite `import('package')`</span>\n                                s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">overwrite</span><span class=\"token punctuation\">(</span>dynamicIndex<span class=\"token punctuation\">,</span> end <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">import('</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resolved<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">').then(m=>m.default)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token punctuation\">}</span>\n                        <span class=\"token punctuation\">}</span>\n                        <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                            s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">overwrite</span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">,</span> hasLiteralDynamicId <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resolved<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> resolved<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span>\n                        hasReplaced <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token comment\">// save the import chain for hmr analysis</span>\n                    <span class=\"token keyword\">const</span> importee <span class=\"token operator\">=</span> utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cleanUrl</span><span class=\"token punctuation\">(</span>resolved<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>importee <span class=\"token operator\">!==</span> importer <span class=\"token operator\">&#x26;&#x26;</span>\n                        <span class=\"token comment\">// no need to track hmr client or module dependencies</span>\n                        importee <span class=\"token operator\">!==</span> serverPluginClient_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">clientPublicPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        currentImportees<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>importee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">debugHmr</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">        </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>importer<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> imports </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>importee<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">ensureMapEntry</span><span class=\"token punctuation\">(</span>serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">importerMap</span><span class=\"token punctuation\">,</span> importee<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>importer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>id <span class=\"token operator\">!==</span> <span class=\"token string\">'import.meta'</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>hasViteIgnore<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">warn</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[vite] ignored dynamic import(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) in </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>importer<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">// ..</span>\n            <span class=\"token keyword control-flow\">return</span> hasReplaced <span class=\"token operator\">?</span> s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> source<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>importer<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">: no imports found.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">return</span> source<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">resolveImport</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> importer<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">,</span> timestamp</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    id <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">alias</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>utils_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">bareImportRE</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// directly resolve bare module names to its entry path so that relative</span>\n        <span class=\"token comment\">// imports from it (including source map urls) can work correctly</span>\n        id <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/@modules/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveBareModuleRequest</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> importer<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 1. relative to absolute</span>\n        <span class=\"token comment\">//    ./foo -> /some/path/foo</span>\n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> pathname<span class=\"token punctuation\">,</span> query <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveRelativeRequest</span><span class=\"token punctuation\">(</span>importer<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 2. resolve dir index and extensions.</span>\n        pathname <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">normalizePublicPath</span><span class=\"token punctuation\">(</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 3. mark non-src imports</span>\n        <span class=\"token comment\">// å¦‚æœä¸æ»¡è¶³ /\\.(?:(?:j|t)sx?|vue)$|\\.mjs$/ åˆ™ä¼šåœ¨ import 'xxxx?import' è·¯å¾„åŠ ä¸Šquery</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>query <span class=\"token operator\">&#x26;&#x26;</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>pathname<span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>resolver_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">jsSrcRE</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            query <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?import</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        id <span class=\"token operator\">=</span> pathname <span class=\"token operator\">+</span> query<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 4. force re-fetch dirty imports by appending timestamp</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> dirtyFiles <span class=\"token operator\">=</span> serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">hmrDirtyFilesMap</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>timestamp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> cleanId <span class=\"token operator\">=</span> utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cleanUrl</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// only rewrite if:</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>dirtyFiles <span class=\"token operator\">&#x26;&#x26;</span> dirtyFiles<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span>cleanId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 1. this is a marked dirty file (in the import chain of the changed file)</span>\n            id <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&#x26;</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">t=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>timestamp<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">latestVersionsMap</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span>cleanId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 2. this file was previously hot-updated and has an updated version</span>\n            id <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&#x26;</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">t=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>serverPluginHmr_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">latestVersionsMap</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>cleanId<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> id<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>ä»£ç æ€»ä½“å¤§æ¦‚çš„æ­¥éª¤ï¼š</p>\n<ol>\n<li>ä½¿ç”¨ <code>es-module-lexer</code> è§£æ <code>js</code> æ‹¿åˆ° import çš„å†…å®¹</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword control-flow\">await</span> es_module_lexer_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">init</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\nimports <span class=\"token operator\">=</span> es_module_lexer_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">substring</span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>åˆ¤æ–­ <code>import</code> èµ„æºçš„è·¯å¾„æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„ï¼Œæ˜¯çš„è¯æ˜¯ä¸º<code>npm</code>çš„æ¨¡å—</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\nutils_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">bareImportRE</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<ol start=\"3\">\n<li>è¿”å›<code>vue</code>çš„æ¨¡å—å¯¼å…¥è·¯å¾„ 'vue' => '@modules/vue'ï¼Œç„¶åä½¿ç”¨ <code>magic-string</code> è¿›è¡Œé‡å†™å¹¶è¿”å›ç»“æœ</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> magic_string_1 <span class=\"token operator\">=</span> <span class=\"token function\">__importDefault</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"magic-string\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">const</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">magic_string_1<span class=\"token punctuation\">.</span>default</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\ns<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">overwrite</span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">,</span> hasLiteralDynamicId <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>resolved<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> resolved<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword control-flow\">return</span> hasReplaced <span class=\"token operator\">?</span> s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> source<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ...</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> <span class=\"token function\">rewriteImports</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">,</span> importer<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h1 id=\"modulevuejs-åœ¨å“ªï¼Ÿ\">@module/vue.js åœ¨å“ªï¼Ÿ</h1>\n<p>å½“æµè§ˆå™¨å‘èµ·è¯·æ±‚<code>localhost:3000/@modules/vue.js</code>ï¼Œä¼šç»è¿‡æ’ä»¶<code>moduleResolvePlugin</code>ï¼Œä¸‹è¾¹æ˜¯å…¶å®Œæ•´çš„ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// plugin for resolving /@modules/:id requests.</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> moduleResolvePlugin<span class=\"token operator\">:</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">ServerPlugin</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> root<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">,</span> resolver <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> vueResolved <span class=\"token operator\">=</span> <span class=\"token function\">resolveVue</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n\n  app<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>moduleRE<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// path maybe contain encode chars</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">decodeURIComponent</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replace</span><span class=\"token punctuation\">(</span>moduleRE<span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">=</span> <span class=\"token string\">'js'</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">serve</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> file<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> type<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      moduleIdToFileMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span>\n      moduleFileToIdMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>type<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getDebugPath</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">await</span> ctx<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">read</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// special handling for vue runtime in case it's not installed</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>vueResolved<span class=\"token punctuation\">.</span><span class=\"token property-access\">isLocal</span> <span class=\"token operator\">&#x26;&#x26;</span> id <span class=\"token keyword\">in</span> vueResolved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>vueResolved <span class=\"token keyword module\">as</span> any<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'non-local vue'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// already resolved and cached</span>\n    <span class=\"token keyword\">const</span> cachedPath <span class=\"token operator\">=</span> moduleIdToFileMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cachedPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> cachedPath<span class=\"token punctuation\">,</span> <span class=\"token string\">'cached'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// resolve from vite optimized modules</span>\n    <span class=\"token keyword\">const</span> optimized <span class=\"token operator\">=</span> <span class=\"token function\">resolveOptimizedModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>optimized<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> optimized<span class=\"token punctuation\">,</span> <span class=\"token string\">'optimized'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> referer <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'referer'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> importer<span class=\"token operator\">:</span> string <span class=\"token operator\">|</span> <span class=\"token keyword nil\">undefined</span>\n    <span class=\"token comment\">// this is a map file request from browser dev tool</span>\n    <span class=\"token keyword\">const</span> isMapFile <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.map'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>referer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      importer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>referer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">pathname</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>isMapFile<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// for some reason Chrome doesn't provide referer for source map requests.</span>\n      <span class=\"token comment\">// do our best to reverse-infer the importer.</span>\n      importer <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token special-escape escape\">\\.</span>map<span class=\"token anchor function\">$</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> importerFilePath <span class=\"token operator\">=</span> importer <span class=\"token operator\">?</span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">requestToFile</span><span class=\"token punctuation\">(</span>importer<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> root\n    <span class=\"token comment\">// #829 node package has sub-package(has package.json), should check it before `resolveNodeModuleFile`</span>\n    <span class=\"token keyword\">const</span> nodeModuleInfo <span class=\"token operator\">=</span> <span class=\"token function\">resolveNodeModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>nodeModuleInfo<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> nodeModuleInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">entryFilePath</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'node_modules'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> nodeModuleFilePath <span class=\"token operator\">=</span> <span class=\"token function\">resolveNodeModuleFile</span><span class=\"token punctuation\">(</span>importerFilePath<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>nodeModuleFilePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> nodeModuleFilePath<span class=\"token punctuation\">,</span> <span class=\"token string\">'node_modules'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>isMapFile <span class=\"token operator\">&#x26;&#x26;</span> importer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// the resolveNodeModuleFile doesn't work with linked pkg</span>\n      <span class=\"token comment\">// our last try: infer from the dir of importer</span>\n      <span class=\"token keyword\">const</span> inferMapPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>importerFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">basename</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">existsSync</span><span class=\"token punctuation\">(</span>inferMapPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> inferMapPath<span class=\"token punctuation\">,</span> <span class=\"token string\">'map file in linked pkg'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>\n      chalk<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">red</span><span class=\"token punctuation\">(</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[vite] Failed to resolve module import \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\". </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n          <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(imported by </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>importer <span class=\"token operator\">||</span> <span class=\"token string\">'unknown'</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">=</span> <span class=\"token number\">404</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æŸ¥çœ‹æ³¨é‡Šå‘ç°ä¸‹è¾¹ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">serve</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> file<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> type<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    moduleIdToFileMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span>\n    moduleFileToIdMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>type<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getDebugPath</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">await</span> ctx<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">read</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token comment\">// resolve from vite optimized modules</span>\n<span class=\"token keyword\">const</span> optimized <span class=\"token operator\">=</span> <span class=\"token function\">resolveOptimizedModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>optimized<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">serve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> optimized<span class=\"token punctuation\">,</span> <span class=\"token string\">'optimized'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>é€šè¿‡<code>serve</code>å‡½æ•°å¯ä»¥çŒœæµ‹ä¸€ä¸‹ <code>const optimized</code> åº”è¯¥æ˜¯è¿”å›çš„æ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰¾åˆ°<code>resolveOptimizedModule</code>å‡½æ•°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">resolveOptimizedModule</span><span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">root<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span>\n  id<span class=\"token operator\">:</span> string</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> string <span class=\"token operator\">|</span> <span class=\"token keyword nil\">undefined</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>root<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">const</span> cached <span class=\"token operator\">=</span> viteOptimizedMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cached<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> cached\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> cacheDir <span class=\"token operator\">=</span> <span class=\"token function\">resolveOptimizedCacheDir</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>cacheDir<span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">tryResolve</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    file <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">existsSync</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">statSync</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      viteOptimizedMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">return</span> file\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">tryResolve</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">tryResolve</span><span class=\"token punctuation\">(</span>id <span class=\"token operator\">+</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æœç„¶å¦‚æ­¤ï¼Œè¿”å›çš„å°±æ˜¯æ–‡ä»¶çš„è·¯å¾„ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæ‰¾ä¸‹<code>const cacheDir = resolveOptimizedCacheDir(root)</code>ä¸­çš„<code>resolveOptimizedCacheDir</code>çœ‹ä¸‹æ–‡ä»¶ç›®å½•</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">OPTIMIZE_CACHE_DIR</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">node_modules/.vite_opt_cache</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">resolveOptimizedCacheDir</span><span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">root<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span>\n  pkgPath<span class=\"token operator\">?</span><span class=\"token operator\">:</span> string</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> string <span class=\"token operator\">|</span> <span class=\"token keyword null nil\">null</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cached <span class=\"token operator\">=</span> cacheDirCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">!==</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span> cached\n  pkgPath <span class=\"token operator\">=</span> pkgPath <span class=\"token operator\">||</span> <span class=\"token function\">lookupFile</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">package.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">/* pathOnly */</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pkgPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword null nil\">null</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> cacheDir <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>pkgPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">OPTIMIZE_CACHE_DIR</span><span class=\"token punctuation\">)</span>\n  cacheDirCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> cacheDir<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> cacheDir\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å‘ç°æ–‡ä»¶ç›®å½•æ˜¯<code>node_modules/.vite_opt_cache</code>ã€‚</p>\n<p>æ‰“å¼€å¯¹åº”ç›®å½•æŸ¥å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ–‡ä»¶<code>vue.js</code>ï¼š</p>\n<p><img src=\"/images/vite-es-modules-tree.png\" alt=\"\"></p>\n<p>ä¹‹åå°±ç®€å•äº†ï¼Œ<code>serve</code>å‡½æ•°å°†ä¼šä½¿ç”¨<code>ctx.read</code>ä¹Ÿå°±æ˜¯<code>cachedRead</code>è¯»å–æ–‡ä»¶ï¼Œç„¶åç¼“å­˜ï¼Œç„¶åè¿”å›ç»“æœã€‚å…·ä½“çš„ä»£ç æˆ‘ä¹Ÿè´´ä¸€ä¸‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token doc-comment comment\">/**</span>\n<span class=\"token doc-comment comment\"> * Read a file with in-memory cache.</span>\n<span class=\"token doc-comment comment\"> * Also sets appropriate headers and body on the Koa context.</span>\n<span class=\"token doc-comment comment\"> * This is exposed on middleware context as `ctx.read` with the `ctx` already</span>\n<span class=\"token doc-comment comment\"> * bound, so it can be used as `ctx.read(file)`.</span>\n<span class=\"token doc-comment comment\"> */</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">cachedRead</span><span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">ctx<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Context</span> <span class=\"token operator\">|</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n  file<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span>\n  poll <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span></span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Buffer</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> lastModified <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">statSync</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">mtimeMs</span>\n  <span class=\"token keyword\">const</span> cached <span class=\"token operator\">=</span> fsReadCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Cache-Control'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'no-cache'</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">=</span> mime<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">lookup</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">'application/octet-stream'</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">&#x26;&#x26;</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">lastModified</span> <span class=\"token operator\">===</span> lastModified<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// a private marker in case the user ticks \"disable cache\" during dev</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">__notModified</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">etag</span> <span class=\"token operator\">=</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">etag</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">lastModified</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">lastModified</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'If-None-Match'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">etag</span> <span class=\"token operator\">&#x26;&#x26;</span> seenUrls<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">=</span> <span class=\"token number\">304</span>\n      <span class=\"token punctuation\">}</span>\n      seenUrls<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token punctuation\">)</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// #395 some file is an binary file, eg. font</span>\n  <span class=\"token keyword\">let</span> content <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readFile</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>poll <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>content<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">untilModified</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span>\n    content <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readFile</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Populate the \"sourcesContent\" array and resolve relative paths in the</span>\n  <span class=\"token comment\">// \"sources\" array, so the debugger can trace back to the original source.</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.map'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> map<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">RawSourceMap</span> <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>map<span class=\"token punctuation\">.</span><span class=\"token property-access\">sourcesContent</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>map<span class=\"token punctuation\">.</span><span class=\"token property-access\">sources</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">every</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token property-access\">isAbsolute</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> sourcesContent <span class=\"token operator\">=</span> map<span class=\"token punctuation\">.</span><span class=\"token property-access\">sourcesContent</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">const</span> sourceRoot <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> map<span class=\"token punctuation\">.</span><span class=\"token property-access\">sourceRoot</span> <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n      map<span class=\"token punctuation\">.</span><span class=\"token property-access\">sources</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span>\n        map<span class=\"token punctuation\">.</span><span class=\"token property-access\">sources</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">source<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> originalPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>sourceRoot<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sourcesContent<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n              sourcesContent<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n                <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">cachedRead</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> originalPath<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ENOENT'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>\n                  chalk<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">red</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[vite] Sourcemap \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>file<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" points to non-existent source: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>originalPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span>\n                  <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token keyword control-flow\">return</span> source\n              <span class=\"token punctuation\">}</span>\n              <span class=\"token keyword control-flow\">throw</span> err\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword control-flow\">return</span> originalPath\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n      map<span class=\"token punctuation\">.</span><span class=\"token property-access\">sourcesContent</span> <span class=\"token operator\">=</span> sourcesContent\n      content <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Buffer</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> etag <span class=\"token operator\">=</span> <span class=\"token function\">getETag</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span>\n  fsReadCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    content<span class=\"token punctuation\">,</span>\n    etag<span class=\"token punctuation\">,</span>\n    lastModified\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">etag</span> <span class=\"token operator\">=</span> etag\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">lastModified</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>lastModified<span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> content\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">=</span> <span class=\"token number\">200</span>\n\n    <span class=\"token comment\">// watch the file if it's out of root.</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> root<span class=\"token punctuation\">,</span> watcher <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx\n    <span class=\"token function\">watchFileIfOutOfRoot</span><span class=\"token punctuation\">(</span>watcher<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">return</span> content\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h1 id=\"modulesvuejs-æ˜¯ä½•æ—¶ç”Ÿæˆçš„ï¼Ÿ\">@modules/vue.js æ˜¯ä½•æ—¶ç”Ÿæˆçš„ï¼Ÿ</h1>\n<p>åœ¨åˆ›å»º vite server çš„ä»£ç çš„æ—¶å€™ï¼Œ<code>createServer</code>ä¼šé‡æ–°<code>server.listen</code>æ–¹æ³•</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    server<span class=\"token punctuation\">.</span><span class=\"token property-access\">listen</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">port<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>optimizeDeps<span class=\"token punctuation\">.</span><span class=\"token property-access\">auto</span> <span class=\"token operator\">!==</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../optimizer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">optimizeDeps</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword control-flow\">return</span> server<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ²¡é”™ï¼Œ<code>vue.js</code>è¿™ä¸€ç±»çš„npmæ¨¡å—å°±æ˜¯åœ¨<code>optimizeDeps</code>å†…è¿›è¡Œæ‰“åŒ…è¾“å‡ºåˆ°<code>node_modules/.vite_opt_cache</code>ï¼Œæ‰¾åˆ° <code>optimizeDeps</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">optimizeDeps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">,</span> asCommand <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> log <span class=\"token operator\">=</span> asCommand <span class=\"token operator\">?</span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">log</span> <span class=\"token operator\">:</span> debug<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">root</span> <span class=\"token operator\">||</span> process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// warn presence of web_modules</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">existsSync</span><span class=\"token punctuation\">(</span>path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> <span class=\"token string\">'web_modules'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">warn</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[vite] vite 0.15 has built-in dependency pre-bundling and resolving </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">from web_modules is no longer supported.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> pkgPath <span class=\"token operator\">=</span> utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">lookupFile</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">package.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">/* pathOnly */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pkgPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">package.json not found. Skipping.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> cacheDir <span class=\"token operator\">=</span> <span class=\"token function\">resolveOptimizedCacheDir</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> pkgPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> hashPath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">,</span> <span class=\"token string\">'hash'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> depHash <span class=\"token operator\">=</span> <span class=\"token function\">getDepHash</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">__path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">force</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> prevhash<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n            prevhash <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readFile</span><span class=\"token punctuation\">(</span>hashPath<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// hash is consistent, no need to re-bundle</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>prevhash <span class=\"token operator\">===</span> depHash<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hash is consistent. Skipping. Use --force to override.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">remove</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">ensureDir</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">optimizeDeps</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> resolver <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createResolver</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">resolvers</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">alias</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">assetsInclude</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Determine deps to optimize. The goal is to only pre-bundle deps that falls</span>\n    <span class=\"token comment\">// under one of the following categories:</span>\n    <span class=\"token comment\">// 1. Has imports to relative files (e.g. lodash-es, lit-html)</span>\n    <span class=\"token comment\">// 2. Has imports to bare modules that are not in the project's own deps</span>\n    <span class=\"token comment\">//    (i.e. esm that imports its own dependencies, e.g. styled-components)</span>\n    <span class=\"token keyword control-flow\">await</span> es_module_lexer_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">init</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> qualified<span class=\"token punctuation\">,</span> external <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">resolveQualifiedDeps</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Resolve deps from linked packages in a monorepo</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span><span class=\"token property-access\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        options<span class=\"token punctuation\">.</span><span class=\"token property-access\">link</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">linkedDep</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> depRoot <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveFrom</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>linkedDep<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/package.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> qualified<span class=\"token operator\">:</span> q<span class=\"token punctuation\">,</span> external<span class=\"token operator\">:</span> e <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">resolveQualifiedDeps</span><span class=\"token punctuation\">(</span>depRoot<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>qualified<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    qualified<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> q<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>external<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    external<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// Force included deps - these can also be deep paths</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span><span class=\"token property-access\">include</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        options<span class=\"token punctuation\">.</span><span class=\"token property-access\">include</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> pkg <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveNodeModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>pkg <span class=\"token operator\">&#x26;&#x26;</span> pkg<span class=\"token punctuation\">.</span><span class=\"token property-access\">entryFilePath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                qualified<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pkg<span class=\"token punctuation\">.</span><span class=\"token property-access\">entryFilePath</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveNodeModuleFile</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    qualified<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> filePath<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span>qualified<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeFile</span><span class=\"token punctuation\">(</span>hashPath<span class=\"token punctuation\">,</span> depHash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">No listed dependency requires optimization. Skipping.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>asCommand<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// This is auto run on server start - let the user know that we are</span>\n        <span class=\"token comment\">// pre-optimizing deps</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">greenBright</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[vite] Optimizable dependencies detected:</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span>qualified<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">, </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">let</span> spinner<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> msg <span class=\"token operator\">=</span> asCommand\n        <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Pre-bundling dependencies to speed up dev server page load...</span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Pre-bundling them to speed up dev server page load...\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(this will be run only when your dependencies have changed)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEBUG</span> <span class=\"token operator\">||</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n        spinner <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ora'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">+</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> pluginsPreBuild<span class=\"token punctuation\">,</span> pluginsPostBuild<span class=\"token punctuation\">,</span> pluginsOptimizer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>rollupInputOptions <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">rollupInputOptions</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> rollup <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rollup'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> bundle <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> rollup<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">rollup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            input<span class=\"token operator\">:</span> qualified<span class=\"token punctuation\">,</span>\n            external<span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// treeshake: { moduleSideEffects: 'no-external' },</span>\n            onwarn<span class=\"token operator\">:</span> build_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">onRollupWarning</span><span class=\"token punctuation\">(</span>spinner<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token spread operator\">...</span>rollupInputOptions<span class=\"token punctuation\">,</span>\n            plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                pluginAssets_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createDepAssetExternalPlugin</span><span class=\"token punctuation\">(</span>resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                entryAnalysisPlugin_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">entryAnalysisPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token spread operator\">...</span><span class=\"token punctuation\">(</span><span class=\"token keyword control-flow\">await</span> build_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createBaseRollupPlugins</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                pluginAssets_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createDepAssetPlugin</span><span class=\"token punctuation\">(</span>resolver<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token spread operator\">...</span>pluginsOptimizer\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> output <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> bundle<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">generate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token spread operator\">...</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">rollupOutputOptions</span><span class=\"token punctuation\">,</span>\n            format<span class=\"token operator\">:</span> <span class=\"token string\">'es'</span><span class=\"token punctuation\">,</span>\n            exports<span class=\"token operator\">:</span> <span class=\"token string\">'named'</span><span class=\"token punctuation\">,</span>\n            entryFileNames<span class=\"token operator\">:</span> <span class=\"token string\">'[name].js'</span><span class=\"token punctuation\">,</span>\n            chunkFileNames<span class=\"token operator\">:</span> <span class=\"token string\">'common/[name]-[hash].js'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        spinner <span class=\"token operator\">&#x26;&#x26;</span> spinner<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> chunk <span class=\"token keyword\">of</span> output<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'chunk'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> fileName <span class=\"token operator\">=</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">fileName</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">,</span> fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">ensureDir</span><span class=\"token punctuation\">(</span>path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeFile</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'asset'</span> <span class=\"token operator\">&#x26;&#x26;</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">fileName</span> <span class=\"token operator\">===</span> <span class=\"token string\">'_analysis.json'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">fileName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeFile</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">source</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeFile</span><span class=\"token punctuation\">(</span>hashPath<span class=\"token punctuation\">,</span> depHash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        spinner <span class=\"token operator\">&#x26;&#x26;</span> spinner<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>asCommand<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">red</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n[vite] Dep optimization failed with error:</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">red</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span> <span class=\"token operator\">===</span> <span class=\"token string\">'PARSE_ERROR'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cyan</span><span class=\"token punctuation\">(</span>path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">relative</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token property-access\">loc</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dim</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">frame</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">match</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Node built-in'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Tip:\\nMake sure your \"dependencies\" only include packages that you\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">intend to use in the browser. If it's a Node.js package, it\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">should be in \"devDependencies\".\\n\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">If you do intend to use this dependency in the browser and the\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">dependency does not actually use these Node built-ins in the\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">browser, you can add the dependency (not the built-in) to the\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\"optimizeDeps.allowNodeBuiltins\" option in vite.config.js.\\n\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">If that results in a runtime error, then unfortunately the\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">package is not distributed in a web-friendly format. You should\\n</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">open an issue in its repo, or look for a modern alternative.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token comment\">// TODO link to docs once we have it</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>resolveQualifiedDeps</code>å‡½æ•°å°†è·å–éœ€è¦rollupå¤„ç†çš„ä¾èµ–ï¼Œå…¶è·å–ä¾èµ–çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">resolveQualifiedDeps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> resolver</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> include<span class=\"token punctuation\">,</span> exclude<span class=\"token punctuation\">,</span> link <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> options<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> pkgContent <span class=\"token operator\">=</span> utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">lookupFile</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'package.json'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pkgContent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n            qualified<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            external<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> pkg <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>pkgContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> deps <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span>pkg<span class=\"token punctuation\">.</span><span class=\"token property-access\">dependencies</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> qualifiedDeps <span class=\"token operator\">=</span> deps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>include <span class=\"token operator\">&#x26;&#x26;</span> include<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// already force included</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>exclude <span class=\"token operator\">&#x26;&#x26;</span> exclude<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (excluded)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>link <span class=\"token operator\">&#x26;&#x26;</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (link)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">KNOWN_IGNORE_LIST</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (internal excluded)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// #804</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@types/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (ts declaration)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> pkgInfo <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveNodeModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pkgInfo <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>pkgInfo<span class=\"token punctuation\">.</span><span class=\"token property-access\">entryFilePath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (cannot resolve entry)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[vite] cannot resolve entry for dependency </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cyan</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> entryFilePath <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> pkgInfo<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>resolver_1<span class=\"token punctuation\">.</span><span class=\"token property-access\">supportedExts</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>entryFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (entry is not js)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">existsSync</span><span class=\"token punctuation\">(</span>entryFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (entry file does not exist)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[vite] dependency </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> declares non-existent entry file </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>entryFilePath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readFileSync</span><span class=\"token punctuation\">(</span>entryFilePath<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>imports<span class=\"token punctuation\">,</span> exports<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> es_module_lexer_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>exports<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">export<span class=\"token charclass class-name\">\\s</span><span class=\"token quantifier number\">+</span><span class=\"token special-escape escape\">\\*</span><span class=\"token charclass class-name\">\\s</span><span class=\"token quantifier number\">+</span>from</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">optimizing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (no exports, likely commonjs)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> s<span class=\"token punctuation\">,</span> e <span class=\"token punctuation\">}</span> <span class=\"token keyword\">of</span> imports<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            i <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">alias</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> i<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">optimizing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (contains relative imports)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>deps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">optimizing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (imports sub dependencies)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipping </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (single esm file, doesn't need optimization)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> qualified <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    qualifiedDeps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        qualified<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveNodeModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">entryFilePath</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// mark non-optimized deps as external</span>\n    <span class=\"token keyword\">const</span> external <span class=\"token operator\">=</span> deps\n        <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token operator\">!</span>qualifiedDeps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// make sure aliased deps are external</span>\n        <span class=\"token comment\">// https://github.com/vitejs/vite-plugin-react/issues/4</span>\n        <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">alias</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        qualified<span class=\"token punctuation\">,</span>\n        external\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>é¦–å…ˆå»æ ¹ç›®å½•çš„<code>package.json</code>ä¸­æ‰¾å…¶<code>dependencies</code></li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> deps <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span>pkg<span class=\"token punctuation\">.</span><span class=\"token property-access\">dependencies</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n<li>éå†è·å–æ¯ä¸ªä¾èµ–çš„ä¿¡æ¯<code>pkgInfo</code></li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> pkgInfo <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveNodeModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n<li>ä½¿ç”¨ es-module-lexer å»è·å–æ¯ä¸ªä¾èµ–çš„ç›¸å…³ä¾èµ–</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> qualifiedDeps <span class=\"token operator\">=</span> deps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> entryFilePath <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> pkgInfo<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>imports<span class=\"token punctuation\">,</span> exports<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> es_module_lexer_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> s<span class=\"token punctuation\">,</span> e <span class=\"token punctuation\">}</span> <span class=\"token keyword\">of</span> imports<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        i <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">alias</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> i<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">optimizing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (contains relative imports)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>deps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">optimizing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (imports sub dependencies)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n</code></pre></div>\n<ul>\n<li>è¿”å›æ‰€æœ‰çš„ä¾èµ–çš„è·¯å¾„</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> qualified <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nqualifiedDeps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    qualified<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> resolver_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveNodeModule</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">entryFilePath</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    qualified<span class=\"token punctuation\">,</span>\n    external\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æ¯”å¦‚:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  qualified<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>vue<span class=\"token operator\">:</span><span class=\"token string\">'/mnt/c/Users/zpo/learning-vue3x/node_modules/vue/dist/vue.runtime.esm-bundler.js'</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æœ€åï¼Œä½¿ç”¨ rollup å¯¹æ”¶é›†çš„ä¾èµ–è¿›è¡Œæ‰“åŒ…å¹¶è¾“å‡ºåˆ° <code>node_modules/.vite_opt_cache</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cacheDir <span class=\"token operator\">=</span> <span class=\"token function\">resolveOptimizedCacheDir</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> pkgPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> rollup <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rollup'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> bundle <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> rollup<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">rollup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        input<span class=\"token operator\">:</span> qualified<span class=\"token punctuation\">,</span>\n        external<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// treeshake: { moduleSideEffects: 'no-external' },</span>\n        onwarn<span class=\"token operator\">:</span> build_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">onRollupWarning</span><span class=\"token punctuation\">(</span>spinner<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token spread operator\">...</span>rollupInputOptions<span class=\"token punctuation\">,</span>\n        plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            pluginAssets_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createDepAssetExternalPlugin</span><span class=\"token punctuation\">(</span>resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            entryAnalysisPlugin_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">entryAnalysisPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token spread operator\">...</span><span class=\"token punctuation\">(</span><span class=\"token keyword control-flow\">await</span> build_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createBaseRollupPlugins</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            pluginAssets_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createDepAssetPlugin</span><span class=\"token punctuation\">(</span>resolver<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token spread operator\">...</span>pluginsOptimizer\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> output <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> bundle<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">generate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token spread operator\">...</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">rollupOutputOptions</span><span class=\"token punctuation\">,</span>\n        format<span class=\"token operator\">:</span> <span class=\"token string\">'es'</span><span class=\"token punctuation\">,</span>\n        exports<span class=\"token operator\">:</span> <span class=\"token string\">'named'</span><span class=\"token punctuation\">,</span>\n        entryFileNames<span class=\"token operator\">:</span> <span class=\"token string\">'[name].js'</span><span class=\"token punctuation\">,</span>\n        chunkFileNames<span class=\"token operator\">:</span> <span class=\"token string\">'common/[name]-[hash].js'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    spinner <span class=\"token operator\">&#x26;&#x26;</span> spinner<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> chunk <span class=\"token keyword\">of</span> output<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'chunk'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> fileName <span class=\"token operator\">=</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">fileName</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">,</span> fileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">ensureDir</span><span class=\"token punctuation\">(</span>path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeFile</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'asset'</span> <span class=\"token operator\">&#x26;&#x26;</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">fileName</span> <span class=\"token operator\">===</span> <span class=\"token string\">'_analysis.json'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>cacheDir<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">fileName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeFile</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">.</span><span class=\"token property-access\">source</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">await</span> fs_extra_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeFile</span><span class=\"token punctuation\">(</span>hashPath<span class=\"token punctuation\">,</span> depHash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n",
    "frontmatter": {
      "title": "vite åŸç†è§£æ(2)-é‡å†™npmæ¨¡å—(moduleRewritePlugin)å’Œ@modules",
      "date": "2020-09-28"
    },
    "toc": "<ul>\n<li><a href=\"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">ç¯å¢ƒå‡†å¤‡</a></li>\n<li><a href=\"#es-modules\">ES modules</a></li>\n<li><a href=\"#%E9%87%8D%E5%86%99%E4%BE%9D%E8%B5%96%E8%B7%AF%E5%BE%84---modules\">é‡å†™ä¾èµ–è·¯å¾„ -> @modules</a></li>\n<li><a href=\"#modulevuejs-%E5%9C%A8%E5%93%AA%EF%BC%9F\">@module/vue.js åœ¨å“ªï¼Ÿ</a></li>\n<li><a href=\"#modulesvuejs-%E6%98%AF%E4%BD%95%E6%97%B6%E7%94%9F%E6%88%90%E7%9A%84%EF%BC%9F\">@modules/vue.js æ˜¯ä½•æ—¶ç”Ÿæˆçš„ï¼Ÿ</a></li>\n</ul>\n",
    "name": "vite åŸç†è§£æ(2)-é‡å†™npmæ¨¡å—(moduleRewritePlugin)å’Œ@modules",
    "id": "56a707945bbb4370daf0bfe1e01800ef",
    "prev": {
      "name": "vite åŸç†è§£æ(1)-viteå‘½ä»¤åšäº†ä»€ä¹ˆ",
      "id": "20520b7394c04937472b75071f39853b"
    },
    "next": {
      "name": "vite åŸç†è§£æ(3)-è§£æSFC(Vue Single File)",
      "id": "8d8914f9964874ae658642580b508059"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/vite åŸç†è§£æ(3)-è§£æSFC(Vue Single File).md",
      "/home/zepang/WorkSpace/blog/posts/vite åŸç†è§£æ(3)-è§£æSFC(Vue Single File).html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¯å¢ƒå‡†å¤‡\">ç¯å¢ƒå‡†å¤‡</h1>\n<ul>\n<li>\n<p>VS Code</p>\n</li>\n<li>\n<p>Node.js</p>\n</li>\n<li>\n<p>Yarn</p>\n</li>\n</ul>\n<h1 id=\"å¤šæ¬¡åŠ è½½vueæ–‡ä»¶\">å¤šæ¬¡åŠ è½½.vueæ–‡ä»¶</h1>\n<p>ä»ä¸Šä¸€ç« èŠ‚ï¼š[vite åŸç†è§£æ(2)-é‡å†™npmæ¨¡å—(moduleRewritePlugin)å’Œ@modules] ä¸­ï¼Œå‘ç° <code>main.js</code> æ˜¯ç›´æ¥åŠ è½½<code>App.vue</code>æ–‡ä»¶ï¼š</p>\n<p><img src=\"/images/vite-es-modules-main.jpg\" alt=\"\"></p>\n<p>é€šè¿‡<code>import</code>å…³é”®å­—å¯¼å…¥çš„é™æ€èµ„æºï¼Œéƒ½ä¼šä»¥è¯·æ±‚çš„æ–¹å¼è¿›è¡ŒåŠ è½½ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥é€šè¿‡<code>chrome</code>çš„æ§åˆ¶å°æ¥çœ‹ä¸‹å…¶å…·ä½“çš„å†…å®¹ã€‚</p>\n<p>æ‰“å¼€<code>chrome -> network</code>å¯ä»¥çœ‹åˆ°è¿‡æ»¤å‡ºæ¥çš„<code>App.vue</code>çš„èµ„æºæœ‰ä¸‰ä¸ªï¼š</p>\n<p><img src=\"/images/vit-vueplugin-vue-3.jpg\" alt=\"\"></p>\n<p>å…¶ä¸­<code>App.vue</code>æ˜¯é€šè¿‡<code>main.js</code>åŠ è½½çš„ï¼Œå…¶å†…å®¹ä¸ºï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">HelloWorld</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'/src/components/HelloWorld.vue'</span>\n\n<span class=\"token keyword\">const</span> __script <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'App'</span><span class=\"token punctuation\">,</span>\n    components<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token maybe-class-name\">HelloWorld</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">import</span> <span class=\"token string\">\"/src/App.vue?type=style&#x26;index=0\"</span>\n<span class=\"token keyword module\">import</span> <span class=\"token string\">\"/src/App.vue?type=style&#x26;index=1\"</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span>render <span class=\"token keyword module\">as</span> __render<span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"/src/App.vue?type=template\"</span>\n__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">render</span> <span class=\"token operator\">=</span> __render\n__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">__hmrId</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"/src/App.vue\"</span>\n<span class=\"token keyword\">typeof</span> __VUE_HMR_RUNTIME__ <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span> <span class=\"token operator\">&#x26;&#x26;</span> __VUE_HMR_RUNTIME__<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createRecord</span><span class=\"token punctuation\">(</span>__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">__hmrId</span><span class=\"token punctuation\">,</span> __script<span class=\"token punctuation\">)</span>\n__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">__file</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"/mnt/c/Users/zpo/learning-vue3x/src/App.vue\"</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> __script\n<span class=\"token comment\">//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9tbnQvYy9Vc2Vycy96cG8vbGVhcm5pbmctdnVlM3gvc3JjL0FwcC52dWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQU9BLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOztBQUVuRCxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO0VBQ2IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNYLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtJQUNWLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ1g7QUFDRiIsImZpbGUiOiIvbW50L2MvVXNlcnMvenBvL2xlYXJuaW5nLXZ1ZTN4L3NyYy9BcHAudnVlIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIjx0ZW1wbGF0ZT5cbiAgPCEtLSA8aW1nIGFsdD1cIlZ1ZSBsb2dvXCIgc3JjPVwiLi9hc3NldHMvbG9nby5wbmdcIiAvPlxuICA8SGVsbG9Xb3JsZCBtc2c9XCJIZWxsbyBWdWUgMy4wICsgVml0ZVwiIC8+IC0tPlxuICA8ZGl2PjwvZGl2PlxuPC90ZW1wbGF0ZT5cblxuPHNjcmlwdD5cbmltcG9ydCBIZWxsb1dvcmxkIGZyb20gJy4vY29tcG9uZW50cy9IZWxsb1dvcmxkLnZ1ZSdcblxuZXhwb3J0IGRlZmF1bHQge1xuICBuYW1lOiAnQXBwJyxcbiAgY29tcG9uZW50czoge1xuICAgIEhlbGxvV29ybGRcbiAgfVxufVxuPC9zY3JpcHQ+XG5cbjxzdHlsZT5cbmh0bWwsIGJvZHkge1xuICBtYXJnaW46IDA7XG59XG48L3N0eWxlPlxuXG48c3R5bGU+XG5odG1sLCBib2R5IHtcbiAgcGFkZGluZzogMDtcbn1cbjwvc3R5bGU+XG4iXX0=</span>\n</code></pre></div>\n<p>å¦å¤–ä¸¤ä¸ª<code>App.vue?type=template</code>å’Œ<code>App.vue?type=style&#x26;index=0</code>æ˜¯é€šè¿‡<code>App.vue</code>èµ„æºè¿›è¡ŒåŠ è½½çš„ï¼Œå…¶å†…å®¹åˆ†åˆ«ä¸ºï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span>createCommentVNode <span class=\"token keyword module\">as</span> _createCommentVNode<span class=\"token punctuation\">,</span> createVNode <span class=\"token keyword module\">as</span> _createVNode<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Fragment</span> <span class=\"token keyword module\">as</span> _Fragment<span class=\"token punctuation\">,</span> openBlock <span class=\"token keyword module\">as</span> _openBlock<span class=\"token punctuation\">,</span> createBlock <span class=\"token keyword module\">as</span> _createBlock<span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"/@modules/vue.js\"</span>\n\n<span class=\"token keyword\">const</span> _hoisted_1 <span class=\"token operator\">=</span> <span class=\"token comment\">/*#__PURE__*/</span>\n<span class=\"token function\">_createVNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token comment\">/* HOISTED */</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_ctx<span class=\"token punctuation\">,</span> _cache<span class=\"token punctuation\">,</span> $props<span class=\"token punctuation\">,</span> $setup<span class=\"token punctuation\">,</span> $data<span class=\"token punctuation\">,</span> $options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token function\">_openBlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">_createBlock</span><span class=\"token punctuation\">(</span>_Fragment<span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token function\">_createCommentVNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" &#x3C;img alt=\\\"Vue logo\\\" src=\\\"./assets/logo.png\\\" />\\n  &#x3C;HelloWorld msg=\\\"Hello Vue 3.0 + Vite\\\" /> \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> _hoisted_1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2112</span> <span class=\"token comment\">/* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9tbnQvYy9Vc2Vycy96cG8vbGVhcm5pbmctdnVlM3gvc3JjL0FwcC52dWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Z0NBR0UsYUFBVzs7OztJQUZYLDBIQUM2QztJQUM3QyxVQUFXIiwiZmlsZSI6Ii9tbnQvYy9Vc2Vycy96cG8vbGVhcm5pbmctdnVlM3gvc3JjL0FwcC52dWUiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiPHRlbXBsYXRlPlxuICA8IS0tIDxpbWcgYWx0PVwiVnVlIGxvZ29cIiBzcmM9XCIuL2Fzc2V0cy9sb2dvLnBuZ1wiIC8+XG4gIDxIZWxsb1dvcmxkIG1zZz1cIkhlbGxvIFZ1ZSAzLjAgKyBWaXRlXCIgLz4gLS0+XG4gIDxkaXY+PC9kaXY+XG48L3RlbXBsYXRlPlxuXG48c2NyaXB0PlxuaW1wb3J0IEhlbGxvV29ybGQgZnJvbSAnLi9jb21wb25lbnRzL0hlbGxvV29ybGQudnVlJ1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIG5hbWU6ICdBcHAnLFxuICBjb21wb25lbnRzOiB7XG4gICAgSGVsbG9Xb3JsZFxuICB9XG59XG48L3NjcmlwdD5cblxuPHN0eWxlPlxuaHRtbCwgYm9keSB7XG4gIG1hcmdpbjogMDtcbn1cbjwvc3R5bGU+XG5cbjxzdHlsZT5cbmh0bWwsIGJvZHkge1xuICBwYWRkaW5nOiAwO1xufVxuPC9zdHlsZT5cbiJdfQ==</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> updateStyle <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"/vite/client\"</span>\n<span class=\"token keyword\">const</span> css <span class=\"token operator\">=</span> <span class=\"token string\">\"\\nhtml, body {\\n  margin: 0;\\n}\\n\"</span>\n<span class=\"token function\">updateStyle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"7ac74a55-0\"</span><span class=\"token punctuation\">,</span> css<span class=\"token punctuation\">)</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> css\n</code></pre></div>\n<h1 id=\"vueplugin\">vuePlugin</h1>\n<p>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹<code>vite</code>å¤„ç†<code>.vue</code>æ–‡ä»¶å’Œè¿”å›ä¸Šè¿°æ–‡ä»¶å†…å®¹çš„æ’ä»¶æºç --<code>vuePlugin</code>ã€‚</p>\n<p>ä»¥ä¸‹æ˜¯å…¶å®Œæ•´çš„ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> vuePlugin<span class=\"token operator\">:</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">ServerPlugin</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\n  root<span class=\"token punctuation\">,</span>\n  app<span class=\"token punctuation\">,</span>\n  resolver<span class=\"token punctuation\">,</span>\n  watcher<span class=\"token punctuation\">,</span>\n  config\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">etagCacheCheck</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Context</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">etag</span> <span class=\"token operator\">=</span> <span class=\"token function\">getEtag</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">=</span>\n      seenUrls<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">has</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">etag</span> <span class=\"token operator\">===</span> ctx<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'If-None-Match'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">304</span> <span class=\"token operator\">:</span> <span class=\"token number\">200</span>\n    seenUrls<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  app<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ctx.vue is set by other tools like vitepress so that vite knows to treat</span>\n    <span class=\"token comment\">// non .vue files as vue files.</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.vue'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">vue</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span>\n    <span class=\"token keyword\">const</span> publicPath <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span>\n    <span class=\"token keyword\">let</span> filePath <span class=\"token operator\">=</span> resolver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">requestToFile</span><span class=\"token punctuation\">(</span>publicPath<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// upstream plugins could've already read the file</span>\n    <span class=\"token keyword\">const</span> descriptor <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">parseSFC</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>descriptor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ç¬¬ä¸€æ¬¡è¯·æ±‚ xxx.vue æ–‡ä»¶ä¸å¸¦ query.type</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>query<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// watch potentially out of root vue file since we do a custom read here</span>\n      <span class=\"token function\">watchFileIfOutOfRoot</span><span class=\"token punctuation\">(</span>watcher<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span> <span class=\"token operator\">&#x26;&#x26;</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        filePath <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">resolveSrcImport</span><span class=\"token punctuation\">(</span>\n          root<span class=\"token punctuation\">,</span>\n          descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">,</span>\n          ctx<span class=\"token punctuation\">,</span>\n          resolver\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">=</span> <span class=\"token string\">'js'</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> code<span class=\"token punctuation\">,</span> map <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">compileSFCMain</span><span class=\"token punctuation\">(</span>\n        descriptor<span class=\"token punctuation\">,</span>\n        filePath<span class=\"token punctuation\">,</span>\n        publicPath<span class=\"token punctuation\">,</span>\n        root\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// å†™å…¥ import xxx.vue?type = template</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> code\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span> <span class=\"token operator\">=</span> map\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">etagCacheCheck</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">// ä¸Šä¸€æ­¥è¿”å›çš„ç»“æœï¼Œå°†ä¼šè¯·æ±‚ xxx.vue?type=template</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'template'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> templateBlock <span class=\"token operator\">=</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span><span class=\"token operator\">!</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>templateBlock<span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        filePath <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">resolveSrcImport</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> templateBlock<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">=</span> <span class=\"token string\">'js'</span>\n      <span class=\"token keyword\">const</span> cached <span class=\"token operator\">=</span> vueCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> bindingMetadata <span class=\"token operator\">=</span> cached <span class=\"token operator\">&#x26;&#x26;</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span> <span class=\"token operator\">&#x26;&#x26;</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">bindings</span>\n      <span class=\"token keyword\">const</span> vueSpecifier <span class=\"token operator\">=</span> <span class=\"token function\">resolveBareModuleRequest</span><span class=\"token punctuation\">(</span>\n        root<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'vue'</span><span class=\"token punctuation\">,</span>\n        publicPath<span class=\"token punctuation\">,</span>\n        resolver\n      <span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// å€ŸåŠ© @vue/compiler-sfc template -> renderå‡½æ•°</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> code<span class=\"token punctuation\">,</span> map <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">compileSFCTemplate</span><span class=\"token punctuation\">(</span>\n        root<span class=\"token punctuation\">,</span>\n        templateBlock<span class=\"token punctuation\">,</span>\n        filePath<span class=\"token punctuation\">,</span>\n        publicPath<span class=\"token punctuation\">,</span>\n        descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> s<span class=\"token punctuation\">.</span><span class=\"token property-access\">scoped</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        bindingMetadata<span class=\"token punctuation\">,</span>\n        vueSpecifier<span class=\"token punctuation\">,</span>\n        config\n      <span class=\"token punctuation\">)</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> code\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span> <span class=\"token operator\">=</span> map\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">etagCacheCheck</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'style'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span><span class=\"token property-access\">index</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> styleBlock <span class=\"token operator\">=</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span><span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>styleBlock<span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        filePath <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">resolveSrcImport</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> styleBlock<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">hash_sum</span><span class=\"token punctuation\">(</span>publicPath<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">compileSFCStyle</span><span class=\"token punctuation\">(</span>\n        root<span class=\"token punctuation\">,</span>\n        styleBlock<span class=\"token punctuation\">,</span>\n        index<span class=\"token punctuation\">,</span>\n        filePath<span class=\"token punctuation\">,</span>\n        publicPath<span class=\"token punctuation\">,</span>\n        config\n      <span class=\"token punctuation\">)</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">=</span> <span class=\"token string\">'js'</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> <span class=\"token function\">codegenCss</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>index<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span><span class=\"token property-access\">modules</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">etagCacheCheck</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'custom'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span><span class=\"token property-access\">index</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> customBlock <span class=\"token operator\">=</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">customBlocks</span><span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>customBlock<span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        filePath <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">resolveSrcImport</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> customBlock<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">resolveCustomBlock</span><span class=\"token punctuation\">(</span>\n        customBlock<span class=\"token punctuation\">,</span>\n        index<span class=\"token punctuation\">,</span>\n        filePath<span class=\"token punctuation\">,</span>\n        publicPath\n      <span class=\"token punctuation\">)</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">=</span> <span class=\"token string\">'js'</span>\n      ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> result\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">etagCacheCheck</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> handleVueReload <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>watcher<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">handleVueReload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">filePath<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span>\n    timestamp<span class=\"token operator\">:</span> number <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    content<span class=\"token operator\">?</span><span class=\"token operator\">:</span> string</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  watcher<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.vue'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">handleVueReload</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h1 id=\"vueplugin-å¤„ç†-appvue-è¯·æ±‚çš„è¿‡ç¨‹\">vuePlugin å¤„ç† App.vue è¯·æ±‚çš„è¿‡ç¨‹</h1>\n<ol>\n<li>å‰ç«¯åŠ è½½ <code>App.vue</code> èµ„æº -> ç¬¬ä¸€æ¬¡åŠ è½½</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">App</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'App.vue'</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>vite æœåŠ¡è¿‡æ»¤å‡º <code>.vue</code> æ–‡ä»¶çš„è¯·æ±‚</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.vue'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">vue</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// å¤„ç† App.vue æ–‡ä»¶é€»è¾‘</span>\n</code></pre></div>\n<ol start=\"3\">\n<li>parseSFCå¤„ç†<code>App.vue</code>æ–‡ä»¶ -> descriptor</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> descriptor <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">parseSFC</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// parseSFCä¸»è¦é€»è¾‘ï¼š</span>\n\n<span class=\"token comment\">// 1. è¯»å–`App.vue`æ–‡ä»¶</span>\n\n<span class=\"token comment\">// 2. è·å–`@vue/compiler-sfc`</span>\n\n<span class=\"token comment\">// 3. è°ƒç”¨`@vue/compiler-sfc`çš„`parse`æ–¹æ³• -> descriptor</span>\n\n<span class=\"token comment\">// 4. const descriptor = {</span>\n<span class=\"token comment\">//       filename,</span>\n<span class=\"token comment\">//       source,</span>\n<span class=\"token comment\">//       template: null,</span>\n<span class=\"token comment\">//       script: null,</span>\n<span class=\"token comment\">//       scriptSetup: null,</span>\n<span class=\"token comment\">//       styles: [],</span>\n<span class=\"token comment\">//       customBlocks: [],</span>\n<span class=\"token comment\">//       cssVars: []</span>\n<span class=\"token comment\">//   };</span>\n</code></pre></div>\n<p>æ¯”è¾ƒå¥½å¥‡<code>@vue/compiler-sfc</code>åšäº†ä»€ä¹ˆï¼Œå¤§æ¦‚å–µäº†ä¸€ä¸‹ï¼š</p>\n<ul>\n<li>è°ƒç”¨ <code>@vue/compiler-domï¼ˆå…¶å®å†…éƒ¨è°ƒç”¨çš„æ˜¯@vue/compiler-coreï¼‰</code> çš„ <code>parse</code> ç”Ÿæˆ <code>ast</code> å¯¹è±¡ï¼Œå¤§æ¦‚æ˜¯ä¸‹è¾¹çš„ç»“æ„ï¼š</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// @vue/compiler-core çš„  createRoot å‡½æ•°</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">children<span class=\"token punctuation\">,</span> loc <span class=\"token operator\">=</span> locStub</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token number\">0</span> <span class=\"token comment\">/* ROOT */</span><span class=\"token punctuation\">,</span>\n        children<span class=\"token punctuation\">,</span>\n        helpers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        components<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        directives<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        hoists<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        cached<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        temps<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        codegenNode<span class=\"token operator\">:</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">,</span>\n        loc\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>æ ¹æ®<code>ast</code>ç”Ÿæˆ descriptor.template, descriptor.script, descriptor.scriptSetup, descriptor.stylesï¼Œdescriptor.customBlocksï¼ŒåŒ…å«å¦‚ä¸‹å±æ€§ï¼š</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">block</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  attrs<span class=\"token punctuation\">,</span>\n  content<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">type</span><span class=\"token punctuation\">,</span>\n  loc \n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å…·ä½“çš„ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">ast<span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">!==</span> <span class=\"token number\">1</span> <span class=\"token comment\">/* ELEMENT */</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>node<span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span><span class=\"token function\">hasSrc</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">switch</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span><span class=\"token property-access\">tag</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">'template'</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> templateBlock <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span> <span class=\"token operator\">=</span> <span class=\"token function\">createBlock</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                templateBlock<span class=\"token punctuation\">.</span><span class=\"token property-access\">ast</span> <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                errors<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">createDuplicateBlockError</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">'script'</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">const</span> scriptBlock <span class=\"token operator\">=</span> <span class=\"token function\">createBlock</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> pad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> isSetup <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>scriptBlock<span class=\"token punctuation\">.</span><span class=\"token property-access\">attrs</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">setup</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>isSetup <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">scriptSetup</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">scriptSetup</span> <span class=\"token operator\">=</span> scriptBlock<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isSetup <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span> <span class=\"token operator\">=</span> scriptBlock<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            errors<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">createDuplicateBlockError</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> isSetup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token string\">'style'</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">const</span> styleBlock <span class=\"token operator\">=</span> <span class=\"token function\">createBlock</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> pad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>styleBlock<span class=\"token punctuation\">.</span><span class=\"token property-access\">attrs</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">vars</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                errors<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SyntaxError</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&#x3C;style vars> has been replaced by a new proposal: </span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://github.com/vuejs/rfcs/pull/231</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>styleBlock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword module\">default</span><span class=\"token operator\">:</span>\n            descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">customBlocks</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">createBlock</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> pad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n<li>\n<p>ä¸º descriptor.template, descriptor.script, descriptor.scriptSetup, descriptor.stylesï¼Œdescriptor.customBlocks ç”Ÿæˆsourcemap</p>\n</li>\n<li>\n<p>è·å– css å˜é‡ -> descriptor.cssVars</p>\n</li>\n</ul>\n<ol start=\"4\">\n<li>ç¬¬ä¸€æ¬¡åŠ è½½çš„<code>url</code>ä¸å¸¦<code>query.type</code>, ç»è¿‡ <code>compileSFCMain</code> å¤„ç†ä¹‹åç›´æ¥å°±è¿”å›äº†ç»“æœ</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>query<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// watch potentially out of root vue file since we do a custom read here</span>\n    utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">watchFileIfOutOfRoot</span><span class=\"token punctuation\">(</span>watcher<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span> <span class=\"token operator\">&#x26;&#x26;</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        filePath <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">resolveSrcImport</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">,</span> resolver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">=</span> <span class=\"token string\">'js'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> code<span class=\"token punctuation\">,</span> map <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">compileSFCMain</span><span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span> <span class=\"token operator\">=</span> code<span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span> <span class=\"token operator\">=</span> map<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">etagCacheCheck</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>compileSFCMain</code> ä¼šæ ¹æ®ä¸Šè¾¹ descriptor.template, descriptor.script, descriptor.scriptSetup, descriptor.stylesï¼Œdescriptor.customBlocks ä»£ç å—åšä¸åŒå¤„ç†:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">compileSFCMain</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">descriptor<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">,</span> root</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> cached <span class=\"token operator\">=</span> exports<span class=\"token punctuation\">.</span><span class=\"token property-access\">vueCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">&#x26;&#x26;</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> hash_sum_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">(</span>publicPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> code <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> content <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> map<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> script <span class=\"token operator\">=</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> compiler <span class=\"token operator\">=</span> resolveVue_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveCompiler</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// descriptor.scriptä»£ç å—</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span> <span class=\"token operator\">||</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">scriptSetup</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> compiler<span class=\"token punctuation\">.</span><span class=\"token property-access\">compileScript</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n            script <span class=\"token operator\">=</span> compiler<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">compileScript</span><span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                id\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">red</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n[vite] SFC &#x3C;script setup> compilation error:\\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dim</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">white</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        content <span class=\"token operator\">=</span> script<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">;</span>\n        map <span class=\"token operator\">=</span> script<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">.</span><span class=\"token property-access\">lang</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ts'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> esbuildService_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">transform</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                loader<span class=\"token operator\">:</span> <span class=\"token string\">'ts'</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            content <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span><span class=\"token punctuation\">;</span>\n            map <span class=\"token operator\">=</span> serverPluginSourceMap_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">mergeSourceMap</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">,</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    code <span class=\"token operator\">+=</span> compiler_sfc_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">rewriteDefault</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">,</span> <span class=\"token string\">'__script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> hasScoped <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> hasCSSModules <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// descriptor.stylesä»£ç å—</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">s<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> styleRequest <span class=\"token operator\">=</span> publicPath <span class=\"token operator\">+</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?type=style&#x26;index=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token property-access\">scoped</span><span class=\"token punctuation\">)</span>\n                hasScoped <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token property-access\">module</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasCSSModules<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nconst __cssModules = __script.__cssModules = {}</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n                    hasCSSModules <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">const</span> styleVar <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">__style</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">const</span> moduleName <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> s<span class=\"token punctuation\">.</span><span class=\"token property-access\">module</span> <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span> <span class=\"token operator\">?</span> s<span class=\"token punctuation\">.</span><span class=\"token property-access\">module</span> <span class=\"token operator\">:</span> <span class=\"token string\">'$style'</span><span class=\"token punctuation\">;</span>\n                code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nimport </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>styleVar<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> from </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>styleRequest <span class=\"token operator\">+</span> <span class=\"token string\">'&#x26;module'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n                code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n__cssModules[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>moduleName<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">] = </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>styleVar<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nimport </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>styleRequest<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>hasScoped<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n__script.__scopeId = \"data-v-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// descriptor.customBlocksä»£ç å—</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">customBlocks</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">customBlocks</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> attrsQuery <span class=\"token operator\">=</span> <span class=\"token function\">attrsToQuery</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span><span class=\"token property-access\">attrs</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span><span class=\"token property-access\">lang</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> blockTypeQuery <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&#x26;blockType=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>querystring_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">escape</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> customRequest <span class=\"token operator\">=</span> publicPath <span class=\"token operator\">+</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?type=custom&#x26;index=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>blockTypeQuery<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>attrsQuery<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> customVar <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">block</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nimport </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>customVar<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> from </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>customRequest<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">if (typeof </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>customVar<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> === 'function') </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>customVar<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">(__script)\\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// descriptor.templateä»£ç å—</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> templateRequest <span class=\"token operator\">=</span> publicPath <span class=\"token operator\">+</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?type=template</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nimport { render as __render } from </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>templateRequest<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n__script.render = __render</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n__script.__hmrId = </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>publicPath<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\ntypeof __VUE_HMR_RUNTIME__ !== 'undefined' &#x26;&#x26; __VUE_HMR_RUNTIME__.createRecord(__script.__hmrId, __script)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n__script.__file = </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    code <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nexport default __script</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        code<span class=\"token punctuation\">,</span>\n        map<span class=\"token punctuation\">,</span>\n        bindings<span class=\"token operator\">:</span> script <span class=\"token operator\">?</span> script<span class=\"token punctuation\">.</span><span class=\"token property-access\">bindings</span> <span class=\"token operator\">:</span> <span class=\"token keyword nil\">undefined</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cached <span class=\"token operator\">=</span> cached <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span> styles<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> customs<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span> <span class=\"token operator\">=</span> result<span class=\"token punctuation\">;</span>\n    exports<span class=\"token punctuation\">.</span><span class=\"token property-access\">vueCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> cached<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ¥çœ‹ä¸‹å¯¹äº<code>descriptor.script</code>(<code>&#x3C;script></code>)ä»£ç å—çš„å¤„ç†:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// descriptor.scriptä»£ç å—</span>\n    \n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">script</span> <span class=\"token operator\">||</span> descriptor<span class=\"token punctuation\">.</span><span class=\"token property-access\">scriptSetup</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> compiler<span class=\"token punctuation\">.</span><span class=\"token property-access\">compileScript</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// @vue/complier-sfc çš„ compileScript å‡½æ•°</span>\n        script <span class=\"token operator\">=</span> compiler<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">compileScript</span><span class=\"token punctuation\">(</span>descriptor<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            id\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">red</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n[vite] SFC &#x3C;script setup> compilation error:\\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dim</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">white</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">yellow</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    content <span class=\"token operator\">=</span> script<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">;</span>\n    map <span class=\"token operator\">=</span> script<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">.</span><span class=\"token property-access\">lang</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ts'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// è‹¥æ˜¯tsè¿˜éœ€è¦è°ƒç”¨ esbuild è¿›è¡Œå¤„ç†</span>\n        <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> esbuildService_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">transform</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            loader<span class=\"token operator\">:</span> <span class=\"token string\">'ts'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        content <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span><span class=\"token punctuation\">;</span>\n        map <span class=\"token operator\">=</span> serverPluginSourceMap_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">mergeSourceMap</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">,</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>@vue/compiler-sfc</code> çš„ <code>compileScript</code>ä¼šè°ƒç”¨<code>@babel/parser</code>å»å¤„ç†<code>&#x3C;script></code>çš„ä»£ç ï¼Œæ­¤å¤–ï¼Œè¿˜å¯ä»¥ç•™æ„ä¸‹ <code>analyzeBindingsFromOptions</code> å‡½æ•°</p>\n<p>ç”±äº<code>compileScript</code>å‡½æ•°ä»£ç è¿‡å¤šï¼Œè¿™é‡Œä»…ç²˜è´´éƒ¨åˆ†ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> parser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@babel/parser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">compileScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">sfc<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>scriptSetup<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>script<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[@vue/compiler-sfc] SFC contains no &#x3C;script> tags.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>scriptLang <span class=\"token operator\">&#x26;&#x26;</span> scriptLang <span class=\"token operator\">!==</span> <span class=\"token string\">'ts'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// do not process non js/ts script blocks</span>\n            <span class=\"token keyword control-flow\">return</span> script<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> scriptAst <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                plugins<span class=\"token punctuation\">,</span>\n                sourceType<span class=\"token operator\">:</span> <span class=\"token string\">'module'</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">program</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> bindings <span class=\"token operator\">=</span> <span class=\"token function\">analyzeScriptBindings</span><span class=\"token punctuation\">(</span>scriptAst<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> needRewrite <span class=\"token operator\">=</span> cssVars<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">||</span> hasInheritAttrsFlag<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> content <span class=\"token operator\">=</span> script<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>needRewrite<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                content <span class=\"token operator\">=</span> <span class=\"token function\">rewriteDefault</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">__default__</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> plugins<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cssVars<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    content <span class=\"token operator\">+=</span> <span class=\"token function\">genNormalScriptCssVarsCode</span><span class=\"token punctuation\">(</span>cssVars<span class=\"token punctuation\">,</span> bindings<span class=\"token punctuation\">,</span> scopeId<span class=\"token punctuation\">,</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>options<span class=\"token punctuation\">.</span><span class=\"token property-access\">isProd</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>hasInheritAttrsFlag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    content <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">__default__.inheritAttrs = false</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                content <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\nexport default __default__</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token spread operator\">...</span>script<span class=\"token punctuation\">,</span>\n                content<span class=\"token punctuation\">,</span>\n                bindings<span class=\"token punctuation\">,</span>\n                scriptAst\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// silently fallback if parse fails since user may be using custom</span>\n            <span class=\"token comment\">// babel syntax</span>\n            <span class=\"token keyword control-flow\">return</span> script<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">analyzeScriptBindings</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ast</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> node <span class=\"token keyword\">of</span> ast<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ExportDefaultDeclaration'</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            node<span class=\"token punctuation\">.</span><span class=\"token property-access\">declaration</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ObjectExpression'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">analyzeBindingsFromOptions</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span><span class=\"token property-access\">declaration</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">analyzeBindingsFromOptions</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> bindings <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> property <span class=\"token keyword\">of</span> node<span class=\"token punctuation\">.</span><span class=\"token property-access\">properties</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ObjectProperty'</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            <span class=\"token operator\">!</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">computed</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'Identifier'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// props</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">===</span> <span class=\"token string\">'props'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// props: ['foo']</span>\n                <span class=\"token comment\">// props: { foo: ... }</span>\n                <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> <span class=\"token function\">getObjectOrArrayExpressionKeys</span><span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    bindings<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"props\"</span> <span class=\"token comment\">/* PROPS */</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">// inject</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">===</span> <span class=\"token string\">'inject'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// inject: ['foo']</span>\n                <span class=\"token comment\">// inject: { foo: {} }</span>\n                <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> <span class=\"token function\">getObjectOrArrayExpressionKeys</span><span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    bindings<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"options\"</span> <span class=\"token comment\">/* OPTIONS */</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">// computed &#x26; methods</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ObjectExpression'</span> <span class=\"token operator\">&#x26;&#x26;</span>\n                <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">===</span> <span class=\"token string\">'computed'</span> <span class=\"token operator\">||</span> property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">===</span> <span class=\"token string\">'methods'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// methods: { foo() {} }</span>\n                <span class=\"token comment\">// computed: { foo() {} }</span>\n                <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> <span class=\"token function\">getObjectExpressionKeys</span><span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    bindings<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"options\"</span> <span class=\"token comment\">/* OPTIONS */</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// setup &#x26; data</span>\n        <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ObjectMethod'</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'Identifier'</span> <span class=\"token operator\">&#x26;&#x26;</span>\n            <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">===</span> <span class=\"token string\">'setup'</span> <span class=\"token operator\">||</span> property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">===</span> <span class=\"token string\">'data'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> bodyItem <span class=\"token keyword\">of</span> property<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// setup() {</span>\n                <span class=\"token comment\">//   return {</span>\n                <span class=\"token comment\">//     foo: null</span>\n                <span class=\"token comment\">//   }</span>\n                <span class=\"token comment\">// }</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>bodyItem<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ReturnStatement'</span> <span class=\"token operator\">&#x26;&#x26;</span>\n                    bodyItem<span class=\"token punctuation\">.</span><span class=\"token property-access\">argument</span> <span class=\"token operator\">&#x26;&#x26;</span>\n                    bodyItem<span class=\"token punctuation\">.</span><span class=\"token property-access\">argument</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">'ObjectExpression'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> <span class=\"token function\">getObjectExpressionKeys</span><span class=\"token punctuation\">(</span>bodyItem<span class=\"token punctuation\">.</span><span class=\"token property-access\">argument</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        bindings<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span>\n                            property<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">===</span> <span class=\"token string\">'setup'</span>\n                                <span class=\"token operator\">?</span> <span class=\"token string\">\"setup-maybe-ref\"</span> <span class=\"token comment\">/* SETUP_MAYBE_REF */</span>\n                                <span class=\"token operator\">:</span> <span class=\"token string\">\"data\"</span> <span class=\"token comment\">/* DATA */</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> bindings<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ç»è¿‡ä¸€ç³»åˆ—çš„æ‹¼æ¥ä¹‹åï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸€é˜¶æ®µè¿”å›çš„å†…å®¹è¿˜ä¼šç»è¿‡<code>moduleRewritePlugin</code>çš„å¤„ç†</p>\n<p>æœ€ç»ˆè¿”å›å¦‚ä¸‹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">HelloWorld</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'/src/components/HelloWorld.vue'</span>\n\n<span class=\"token keyword\">const</span> __script <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'App'</span><span class=\"token punctuation\">,</span>\n    components<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token maybe-class-name\">HelloWorld</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">import</span> <span class=\"token string\">\"/src/App.vue?type=style&#x26;index=0\"</span>\n<span class=\"token keyword module\">import</span> <span class=\"token string\">\"/src/App.vue?type=style&#x26;index=1\"</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span>render <span class=\"token keyword module\">as</span> __render<span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"/src/App.vue?type=template\"</span>\n__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">render</span> <span class=\"token operator\">=</span> __render\n__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">__hmrId</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"/src/App.vue\"</span>\n<span class=\"token keyword\">typeof</span> __VUE_HMR_RUNTIME__ <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span> <span class=\"token operator\">&#x26;&#x26;</span> __VUE_HMR_RUNTIME__<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createRecord</span><span class=\"token punctuation\">(</span>__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">__hmrId</span><span class=\"token punctuation\">,</span> __script<span class=\"token punctuation\">)</span>\n__script<span class=\"token punctuation\">.</span><span class=\"token property-access\">__file</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"/mnt/c/Users/zpo/learning-vue3x/src/App.vue\"</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> __script\n<span class=\"token comment\">//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9tbnQvYy9Vc2Vycy96cG8vbGVhcm5pbmctdnVlM3gvc3JjL0FwcC52dWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQU9BLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOztBQUVuRCxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO0VBQ2IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNYLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtJQUNWLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ1g7QUFDRiIsImZpbGUiOiIvbW50L2MvVXNlcnMvenBvL2xlYXJuaW5nLXZ1ZTN4L3NyYy9BcHAudnVlIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIjx0ZW1wbGF0ZT5cbiAgPCEtLSA8aW1nIGFsdD1cIlZ1ZSBsb2dvXCIgc3JjPVwiLi9hc3NldHMvbG9nby5wbmdcIiAvPlxuICA8SGVsbG9Xb3JsZCBtc2c9XCJIZWxsbyBWdWUgMy4wICsgVml0ZVwiIC8+IC0tPlxuICA8ZGl2PjwvZGl2PlxuPC90ZW1wbGF0ZT5cblxuPHNjcmlwdD5cbmltcG9ydCBIZWxsb1dvcmxkIGZyb20gJy4vY29tcG9uZW50cy9IZWxsb1dvcmxkLnZ1ZSdcblxuZXhwb3J0IGRlZmF1bHQge1xuICBuYW1lOiAnQXBwJyxcbiAgY29tcG9uZW50czoge1xuICAgIEhlbGxvV29ybGRcbiAgfVxufVxuPC9zY3JpcHQ+XG5cbjxzdHlsZT5cbmh0bWwsIGJvZHkge1xuICBtYXJnaW46IDA7XG59XG48L3N0eWxlPlxuXG48c3R5bGU+XG5odG1sLCBib2R5IHtcbiAgcGFkZGluZzogMDtcbn1cbjwvc3R5bGU+XG4iXX0=</span>\n</code></pre></div>\n<ol start=\"5\">\n<li>é€šè¿‡ä¸Šè¾¹çš„ <code>compileSFCMain</code> å‡½æ•°å’Œ<code>App.vue</code>ç¬¬ä¸€æ¬¡è¯·æ±‚è¿”å›çš„å†…å®¹å¯ä»¥å‘ç°ï¼Œ<code>&#x3C;style></code> <code>&#x3C;template></code> å—çš„å…·ä½“å¤„ç†å¹¶æ²¡æœ‰åœ¨è¯¥å‡½æ•°å†…å¤„ç†ï¼Œè€Œæ˜¯é€šè¿‡<code>import</code>å¯¼å…¥<code>App.vue?type=${type}</code>å†æ¬¡å‘èµ·äº†è¯·æ±‚</li>\n</ol>\n<p><code>type=template</code>ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">compileSFCTemplate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> template<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">,</span> scoped<span class=\"token punctuation\">,</span> bindingMetadata<span class=\"token punctuation\">,</span> vueSpecifier<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> vueCompilerOptions<span class=\"token punctuation\">,</span> vueTransformAssetUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> vueTemplatePreprocessOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> cached <span class=\"token operator\">=</span> exports<span class=\"token punctuation\">.</span><span class=\"token property-access\">vueCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cached <span class=\"token operator\">&#x26;&#x26;</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>publicPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> template cache hit</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> compileTemplate <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> resolveVue_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveCompiler</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> vueTransformAssetUrls <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        vueTransformAssetUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            base<span class=\"token operator\">:</span> path_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">posix</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>publicPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token spread operator\">...</span>vueTransformAssetUrls\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> preprocessLang <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span><span class=\"token property-access\">lang</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> preprocessOptions <span class=\"token operator\">=</span> preprocessLang <span class=\"token operator\">&#x26;&#x26;</span> vueTemplatePreprocessOptions<span class=\"token punctuation\">[</span>preprocessLang<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>preprocessLang <span class=\"token operator\">===</span> <span class=\"token string\">'pug'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        preprocessOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            doctype<span class=\"token operator\">:</span> <span class=\"token string\">'html'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token spread operator\">...</span>preprocessOptions\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> hash_sum_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">(</span>publicPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> code<span class=\"token punctuation\">,</span> map<span class=\"token punctuation\">,</span> errors <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">compileTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        source<span class=\"token operator\">:</span> template<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">,</span>\n        id<span class=\"token punctuation\">,</span>\n        scoped<span class=\"token punctuation\">,</span>\n        filename<span class=\"token operator\">:</span> filePath<span class=\"token punctuation\">,</span>\n        inMap<span class=\"token operator\">:</span> template<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span><span class=\"token punctuation\">,</span>\n        transformAssetUrls<span class=\"token operator\">:</span> vueTransformAssetUrls<span class=\"token punctuation\">,</span>\n        compilerOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token spread operator\">...</span>vueCompilerOptions<span class=\"token punctuation\">,</span>\n            bindingMetadata<span class=\"token punctuation\">,</span>\n            runtimeModuleName<span class=\"token operator\">:</span> vueSpecifier<span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// for backwards compat only</span>\n            scopeId<span class=\"token operator\">:</span> scoped <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">data-v-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token keyword null nil\">null</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        preprocessLang<span class=\"token punctuation\">,</span>\n        preprocessOptions<span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">preprocessCustomRequire</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span>utils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveFrom</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>errors<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>chalk_1<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">red</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n[vite] SFC template compilation error: </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        errors<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> e <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">logError</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> template<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">sourcesContent</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        code<span class=\"token punctuation\">,</span>\n        map<span class=\"token operator\">:</span> map\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cached <span class=\"token operator\">=</span> cached <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span> styles<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> customs<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">template</span> <span class=\"token operator\">=</span> result<span class=\"token punctuation\">;</span>\n    exports<span class=\"token punctuation\">.</span><span class=\"token property-access\">vueCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> cached<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>publicPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> template compiled in </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ms.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>type=style</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">compileSFCStyle</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> style<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> cssPreprocessOptions<span class=\"token punctuation\">,</span> cssModuleOptions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> cached <span class=\"token operator\">=</span> exports<span class=\"token punctuation\">.</span><span class=\"token property-access\">vueCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cachedEntry <span class=\"token operator\">=</span> cached <span class=\"token operator\">&#x26;&#x26;</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span> <span class=\"token operator\">&#x26;&#x26;</span> cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span><span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>cachedEntry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>publicPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> style cache hit</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> cachedEntry<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> generateCodeFrame <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> resolveVue_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveCompiler</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> resource <span class=\"token operator\">=</span> filePath <span class=\"token operator\">+</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">?type=style&#x26;index=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>index<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword control-flow\">await</span> cssUtils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">compileCss</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        source<span class=\"token operator\">:</span> style<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">,</span>\n        filename<span class=\"token operator\">:</span> resource<span class=\"token punctuation\">,</span>\n        id<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        scoped<span class=\"token operator\">:</span> style<span class=\"token punctuation\">.</span><span class=\"token property-access\">scoped</span> <span class=\"token operator\">!=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        modules<span class=\"token operator\">:</span> style<span class=\"token punctuation\">.</span><span class=\"token property-access\">module</span> <span class=\"token operator\">!=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// @ts-ignore TODO @deprecated</span>\n        vars<span class=\"token operator\">:</span> style<span class=\"token punctuation\">.</span><span class=\"token property-access\">vars</span> <span class=\"token operator\">!=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span>\n        preprocessLang<span class=\"token operator\">:</span> style<span class=\"token punctuation\">.</span><span class=\"token property-access\">lang</span><span class=\"token punctuation\">,</span>\n        preprocessOptions<span class=\"token operator\">:</span> cssPreprocessOptions<span class=\"token punctuation\">,</span>\n        modulesOptions<span class=\"token operator\">:</span> cssModuleOptions\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cssUtils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">recordCssImportChain</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">dependencies</span><span class=\"token punctuation\">,</span> resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n    result<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span> <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> cssUtils_1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">rewriteCssUrls</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token property-access\">code</span><span class=\"token punctuation\">,</span> publicPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cached <span class=\"token operator\">=</span> cached <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span> styles<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> customs<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    cached<span class=\"token punctuation\">.</span><span class=\"token property-access\">styles</span><span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> result<span class=\"token punctuation\">;</span>\n    exports<span class=\"token punctuation\">.</span><span class=\"token property-access\">vueCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> cached<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>publicPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> style compiled in </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ms</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n",
    "frontmatter": {
      "title": "vite åŸç†è§£æ(3)-è§£æSFC(Vue Single File)",
      "date": "2020-09-18"
    },
    "toc": "<ul>\n<li><a href=\"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">ç¯å¢ƒå‡†å¤‡</a></li>\n<li><a href=\"#%E5%A4%9A%E6%AC%A1%E5%8A%A0%E8%BD%BDvue%E6%96%87%E4%BB%B6\">å¤šæ¬¡åŠ è½½.vueæ–‡ä»¶</a></li>\n<li><a href=\"#vueplugin\">vuePlugin</a></li>\n<li><a href=\"#vueplugin-%E5%A4%84%E7%90%86-appvue-%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BF%87%E7%A8%8B\">vuePlugin å¤„ç† App.vue è¯·æ±‚çš„è¿‡ç¨‹</a></li>\n</ul>\n",
    "name": "vite åŸç†è§£æ(3)-è§£æSFC(Vue Single File)",
    "id": "8d8914f9964874ae658642580b508059",
    "prev": {
      "name": "vite åŸç†è§£æ(2)-é‡å†™npmæ¨¡å—(moduleRewritePlugin)å’Œ@modules",
      "id": "56a707945bbb4370daf0bfe1e01800ef"
    },
    "next": {
      "name": "ä¸€äº›å…³äºGitçš„å†…å®¹",
      "id": "9d416bfd8ea5d650c625f97e4f7839c6"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/ä¸€äº›å…³äºGitçš„å†…å®¹.md",
      "/home/zepang/WorkSpace/blog/posts/ä¸€äº›å…³äºGitçš„å†…å®¹.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"æ¦‚è¿°\">æ¦‚è¿°</h1>\n<p>è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯å¸®åŠ©å¤§å®¶äº†è§£å¹¶å¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨gitï¼Œæ•´ç†äº†ä¸€äº›æˆ‘è§‰å¾—éœ€è¦äº†è§£çš„å†…å®¹ï¼Œç¯‡å¹…ä¸é•¿ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ·±å…¥çš„å†…å®¹ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢çš„å†…å®¹ï¼š</p>\n<ul>\n<li>\n<p>åŸºæœ¬ä½¿ç”¨å’Œä¸‰ä¸ªåˆ†åŒºæ¦‚å¿µ</p>\n</li>\n<li>\n<p>gitå¦‚ä½•ä¿å­˜ä¿¡æ¯</p>\n</li>\n<li>\n<p>gitçš„å¸¸ç”¨å‘½ä»¤å’Œä½¿ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<p>å¦‚æœéœ€è¦æ¯”è¾ƒå…¨é¢çš„äº†è§£gitçš„å†…å®¹å¯ä»¥æŸ¥çœ‹å®˜æ–¹æä¾›çš„æ–‡æ¡£ã€‚</p>\n<h2 id=\"åŸºæœ¬ä½¿ç”¨å’Œä¸‰ä¸ªåˆ†åŒºæ¦‚å¿µ\">åŸºæœ¬ä½¿ç”¨å’Œä¸‰ä¸ªåˆ†åŒºæ¦‚å¿µ</h2>\n<p>å¯¹äºç»å¸¸ä½¿ç”¨gitçš„å¼€å‘ï¼Œåœ¨ä¸€å¤©çš„å·¥ä½œä¸­ï¼Œè‡³å°‘ä¼šé‡å¤è‹¥å¹²æ¬¡ä¸‹è¾¹çš„æµç¨‹</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">git init // åœ¨å½“å‰ç›®å½•ä¸‹åˆå§‹åŒ–ä¸€ä¸ªgitç‰ˆæœ¬åº“ï¼Œè¯¥å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª`.git`ç›®å½•\n\n\n\n// åœ¨å½“å‰ç›®å½•ä¸­æ·»åŠ ä¸€äº›æ–‡ä»¶æˆ–è€…ä¿®æ”¹ä¸€äº›æ–‡ä»¶\n\n\n\ngit add . // å°†å½“å‰å·¥ä½œåŒºçš„æ‰€æœ‰å†…å®¹è¿›è¡Œæš‚å­˜\n\n\n\ngit commit -m &#x26;#39;update&#x26;#39; // å°†æš‚å­˜çš„å†…å®¹æäº¤åˆ°ç‰ˆæœ¬åº“ï¼Œå¹¶æ·»åŠ æè¿°ä¿¡æ¯\n\n\n\ngit push origin branch-name // å°†ä»£ç æäº¤åˆ°è¿œç¨‹çš„ä»£ç ä»“åº“</code></pre></div>\n<p>å¯¹äºä¸€äº›åˆå­¦è€…æƒ³è¦ä¸é æ­»è®°ç¡¬èƒŒè®°ä½ä¸Šè¾¹çš„commitæµç¨‹ï¼Œä½ éœ€è¦çŸ¥é“gitçš„ä¸‰ä¸ªåˆ†åŒºã€‚</p>\n<p>gitçš„æœ¬åœ°æ•°æ®ç®¡ç†å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªåˆ†åŒºï¼š</p>\n<ul>\n<li>\n<p>å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰</p>\n<p>é€šå¸¸å°±æ˜¯æŒ‡æˆ‘ä»¬çš„æ–‡ä»¶ç›®å½•æˆ–è€…é¡¹ç›®ç›®å½•</p>\n</li>\n<li>\n<p>æš‚å­˜åŒºï¼ˆStageï¼‰</p>\n<p>gitåœ¨å·¥ä½œç›®å½•å’Œç‰ˆæœ¬åº“ä¹‹é—´åŠ è®¾äº†ä¸€å±‚ç´¢å¼•ï¼ˆindexï¼‰ï¼Œç”¨ æ¥æš‚å­˜ï¼ˆstageï¼‰ã€æ”¶é›†æˆ–è€…ä¿®æ”¹</p>\n</li>\n<li>\n<p>ç‰ˆæœ¬åº“ï¼ˆHistoryï¼‰</p>\n<p>ç”¨æ¥å­˜æ”¾æ¯ä¸€æ¬¡æäº¤çš„å¿«ç…§</p>\n</li>\n</ul>\n<p>åœ¨å·¥ä½œä¸­ï¼Œä¸ºäº†åä½œå¼€å‘æˆ–è€…ä»£ç ä»£ç ç®¡ç†ï¼Œé€šå¸¸æˆ‘ä»¬è¿˜ä¼šä½¿ç”¨<code>git push</code>å‘½ä»¤å°†ç‰ˆæœ¬åº“çš„æ•°æ®æäº¤åˆ°è¿œç¨‹çš„ä»“åº“ã€‚</p>\n<p>ä»¥ä¸‹å›¾ç‰‡æ¥è‡ªç½‘ç»œ</p>\n<p><img src=\"/images/git-three-part.jpg\" alt=\"ä¸‰ä¸ªåˆ†åŒº\"></p>\n<p>å¦‚æœè¿˜æƒ³è¦æ›´åŠ æ·±å…¥çš„äº†è§£<code>git add</code>ï¼Œ<code>git commit</code>éƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼Œé‚£ä¹ˆä½ éœ€è¦çŸ¥é“gitå¤§æ¦‚æ˜¯å¦‚ä½•å­˜å‚¨ä¿¡æ¯çš„ã€‚</p>\n<h2 id=\"gitå¦‚ä½•å­˜å‚¨ä¿¡æ¯\">gitå¦‚ä½•å­˜å‚¨ä¿¡æ¯</h2>\n<p>gitç‰ˆæœ¬åº“ä½ å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®åº“ï¼Œgitä¸»è¦ç»´æŠ¤ä¸¤ä¸ªä¸»è¦çš„æ•°æ®ç»“æ„ï¼šå¯¹è±¡åº“å’Œç´¢å¼•ã€‚</p>\n<p>å¯¹è±¡åº“åŒ…å«ä½ çš„åŸå§‹æ•°æ®æ–‡ä»¶å’Œæ‰€ æœ‰æ—¥å¿—æ¶ˆæ¯ã€ä½œè€…ä¿¡æ¯ã€æ—¥æœŸï¼Œä»¥åŠå…¶ä»–ç”¨æ¥é‡å»ºé¡¹ç›®ä»»æ„ç‰ˆæœ¬æˆ–åˆ† æ”¯çš„ä¿¡æ¯ã€‚</p>\n<p>ç´¢å¼•æè¿°æ•´ä¸ªç‰ˆæœ¬åº“çš„ç›®å½•ç»“æ„ã€‚</p>\n<p>æˆ‘ä»¬è¿˜æ˜¯ç»“åˆä¸€ä¸‹å®é™…çš„æ¡ˆä¾‹æ¥è¯´æ˜å§ã€‚</p>\n<p>åˆå§‹åŒ–ä¸€ä¸ªGitçš„ç‰ˆæœ¬åº“ï¼Œç„¶ååˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›å†…å®¹ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> init \n\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"console.log('app')\"</span> <span class=\"token operator\">></span> app.js\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"console.log('app')\"</span> <span class=\"token operator\">></span> index.js\n\n\ntree\n<span class=\"token builtin class-name\">.</span>\nâ”œâ”€â”€ app.js\nâ””â”€â”€ index.js\n</code></pre></div>\n<p>ä½¿ç”¨<code>git add .</code>å‘½ä»¤å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œè¿™ä¸ªæ—¶å€™ä¼šåˆ›å»ºç´¢å¼•ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>git status</code>å’Œ<code>git ls-files</code>å‘½ä»¤æ¥æŸ¥çœ‹ç´¢å¼•çš„çŠ¶æ€å’Œç›®å½•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> status\nOn branch master\n\n\nNo commits yet\n\n\nChanges to be committed:\n  <span class=\"token punctuation\">(</span>use <span class=\"token string\">\"git rm --cached &#x3C;file>...\"</span> to unstage<span class=\"token punctuation\">)</span>\n\n\n        new file:   app.js\n        new file:   index.js\n\n\n<span class=\"token function\">git</span> ls-files --stage\n<span class=\"token number\">100644</span> fe6b72dcf87d057d45129f5cf281c1cb6277a010 <span class=\"token number\">0</span>       app.js\n<span class=\"token number\">100644</span> 7f7cc294ff052479b84bd1c13a510a616588af8e <span class=\"token number\">0</span>       index.js\n</code></pre></div>\n<p>é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦é€šè¿‡<code>git add</code>å‘½ä»¤å»ºç«‹ç´¢å¼•ï¼Ÿ</p>\n<p>æ˜¯å› ä¸ºå½“æ‰§è¡Œgit commitå‘½ä»¤çš„æ—¶å€™ï¼ŒGitä¼šé€šè¿‡æ£€æŸ¥ç´¢å¼•è€Œä¸æ˜¯å·¥ä½œç›®å½•æ¥æ‰¾åˆ°æäº¤çš„å†…å®¹</p>\n<p>å¦‚æœä½ æ²¡æœ‰å…ˆä½¿ç”¨<code>git add</code>æ·»åŠ ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œcommitçš„æ—¶å€™ä½ ä¼šæ”¶åˆ°ä¸‹è¾¹çš„æç¤º</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">nothing to commit, working tree clean</code></pre></div>\n<h2 id=\"objectsç›®å½•\">objectsç›®å½•</h2>\n<p>ä½¿ç”¨<code>git init</code>å‘½ä»¤åˆå§‹åŒ–ç‰ˆæœ¬åº“çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¼šåœ¨å·¥ä½œç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª<code>.git</code>çš„æ–‡ä»¶ç›®å½•</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">tree -L <span class=\"token number\">1</span> .git\n\n\n.git\nâ”œâ”€â”€ COMMIT_EDITMSG\nâ”œâ”€â”€ FETCH_HEAD\nâ”œâ”€â”€ HEAD\nâ”œâ”€â”€ ORIG_HEAD\nâ”œâ”€â”€ config\nâ”œâ”€â”€ description\nâ”œâ”€â”€ hooks\nâ”œâ”€â”€ index\nâ”œâ”€â”€ info\nâ”œâ”€â”€ logs\nâ”œâ”€â”€ objects\nâ”œâ”€â”€ packed-refs\nâ””â”€â”€ refs\n</code></pre></div>\n<p>ä¸Šè¾¹è¿è¡Œçš„<code>git add .</code>å‘½ä»¤ä¼šåœ¨<code>.git/objects</code>ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªç›®å½•æ–‡ä»¶ï¼Œç”¨äºä¿å­˜æ–‡ä»¶çš„ä¿¡æ¯ï¼Œé€šè¿‡<code>tree</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°å¯¹åº”çš„æ–‡ä»¶</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">tree .git/objects\n\n\n.git/objects\nâ”œâ”€â”€ 7f\nâ”‚   â””â”€â”€ 7cc294ff052479b84bd1c13a510a616588af8e\nâ”œâ”€â”€ fe\nâ”‚   â””â”€â”€ 6b72dcf87d057d45129f5cf281c1cb6277a010\nâ”œâ”€â”€ info\nâ””â”€â”€ pack\n</code></pre></div>\n<h2 id=\"gitå¯¹è±¡\">gitå¯¹è±¡</h2>\n<p>ä¹‹å‰æåˆ°äº†å¯¹è±¡åº“ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹gitçš„å¯¹è±¡çš„å†…å®¹ã€‚</p>\n<p>gitæä¾›äº†<code>cat-file</code>å‘½ä»¤æŸ¥çœ‹å¯¹è±¡çš„ç±»å‹å¯¹è±¡å†…å®¹ï¼Œ</p>\n<p>gitçš„å¯¹è±¡åº“åŒ…å«4ç§å¯¹è±¡ï¼š</p>\n<ul>\n<li>å— blob</li>\n<li>ç›®å½•æ ‘ tree</li>\n<li>æäº¤ commit</li>\n<li>æ ‡ç­¾ tag</li>\n</ul>\n<p>æ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ª40ä½çš„åå…­è¿›åˆ¶æ•°ç»„æˆçš„å¯å¯»å€çš„å†…å®¹åç§°ï¼Œè¿™ä¸ªå€¼æ˜¯å‘å¯¹è±¡çš„å†…å®¹åº”ç”¨SHA1å¾—åˆ°çš„æ•£åˆ—å€¼ï¼Œè¿™ä¸ªæ•£åˆ—å€¼å”¯ä¸€æœ‰æ•ˆä¸”å®Œå…¨ç”±å¯¹è±¡å†…å®¹å†³å®šã€‚</p>\n<p><code>git add</code>ä¼šåœ¨<code>.git/objects</code>ç›®å½•ä¸‹åˆ›å»º<code>blob</code>å¯¹è±¡ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªç›®å½•æ–‡ä»¶ã€‚</p>\n<p>ä½¿ç”¨<code>git cat-file</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°å¯¹è±¡çš„ç±»å‹å’Œå†…å®¹</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> caf-file -t fe6b72dcf87d057d45129f5cf281c1cb6277a010\nblob\n<span class=\"token function\">git</span> caf-file -t 7f7cc294ff052479b84bd1c13a510a616588af8e\nblob\n\n\n<span class=\"token function\">git</span> caf-file -p fe6b72dcf87d057d45129f5cf281c1cb6277a010\nconsole.log<span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">git</span> caf-file -p 7f7cc294ff052479b84bd1c13a510a616588af8e\nconsole.log<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>æ¥ä¸‹æ¥ï¼Œå°†æš‚å­˜åŒºçš„å†…å®¹æäº¤åˆ°ç‰ˆæœ¬åº“</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> commit -m <span class=\"token string\">'update'</span>\n\n\n<span class=\"token punctuation\">[</span>master <span class=\"token punctuation\">(</span>root-commit<span class=\"token punctuation\">)</span> 65fdbfb<span class=\"token punctuation\">]</span> update\n <span class=\"token number\">2</span> files changed, <span class=\"token number\">2</span> insertions<span class=\"token punctuation\">(</span>+<span class=\"token punctuation\">)</span>\n create mode <span class=\"token number\">100644</span> app.js\n create mode <span class=\"token number\">100644</span> index.js\n\n\ntree .git/objects/\n\n\n.git/objects/\nâ”œâ”€â”€ <span class=\"token number\">65</span>\nâ”‚   â””â”€â”€ fdbfbfd99f20a3d792fd2c5951324afde1b8f1\nâ”œâ”€â”€ 6d\nâ”‚   â””â”€â”€ 5e4e2a71c52c661a19b8268384fd7093405f10\nâ”œâ”€â”€ 7f\nâ”‚   â””â”€â”€ 7cc294ff052479b84bd1c13a510a616588af8e\nâ”œâ”€â”€ fe\nâ”‚   â””â”€â”€ 6b72dcf87d057d45129f5cf281c1cb6277a010\nâ”œâ”€â”€ info\nâ””â”€â”€ pack\n</code></pre></div>\n<p><code>git commit</code>å‘½ä»¤ä¼šåœ¨<code>.git/objects</code>ç›®å½•ä¸‹åˆ›å»º<code>tree</code>å¯¹è±¡å’Œ<code>commit</code>å¯¹è±¡</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> cat-file -t 6d5e4e2a71c52c661a19b8268384fd7093405f10\ntree\n\n\n<span class=\"token function\">git</span> cat-file -t 65fdbfbfd99f20a3d792fd2c5951324afde1b8f1\ncommit\n</code></pre></div>\n<h2 id=\"gitå¯¹è±¡å…³ç³»\">gitå¯¹è±¡å…³ç³»</h2>\n<p>æˆ‘ä»ã€Šgitç‰ˆæœ¬ç®¡ç†ã€‹ä¸€ä¹¦ä¸­æˆªå–äº†ä¸€å¼ å›¾ï¼Œç”¨æ¥è¯´æ˜gitå¯¹è±¡çš„å…³ç³»ï¼š</p>\n<p><img src=\"/images/git-object.png\" alt=\"\"></p>\n<p>ä¸‹è¾¹æ˜¯treeå¯¹è±¡é‡Œè¾¹çš„å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> cat-file -p 6d5e4e2a71c52c661a19b8268384fd7093405f10\n<span class=\"token number\">100644</span> blob fe6b72dcf87d057d45129f5cf281c1cb6277a010    app.js\n<span class=\"token number\">100644</span> blob 7f7cc294ff052479b84bd1c13a510a616588af8e    index.js\n</code></pre></div>\n<ul>\n<li>100644 æ˜¯æ–‡ä»¶çš„è¯»å†™æƒé™å±æ€§ï¼Œç†Ÿæ‚‰chmodçš„äººåº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰</li>\n<li>blob fe6b72dcf87d057d45129f5cf281c1cb6277a010 blobçš„å¯¹è±¡å</li>\n<li>app.js ä¸blobå…³è”çš„æ–‡ä»¶åå­—</li>\n</ul>\n<p>ç„¶åå†æ¥çœ‹çœ‹commitçš„å†…å®¹</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> cat-file -p 65fdbfbfd99f20a3d792fd2c5951324afde1b8f1\ntree 6d5e4e2a71c52c661a19b8268384fd7093405f10\nauthor zepang <span class=\"token operator\">&#x3C;</span>ummlq4@gmail.com<span class=\"token operator\">></span> <span class=\"token number\">1577961062</span> +0800\ncommitter zepang <span class=\"token operator\">&#x3C;</span>ummlq4@gmail.com<span class=\"token operator\">></span> <span class=\"token number\">1577961062</span> +0800\n\n\nupdate\n</code></pre></div>\n<ul>\n<li>tree 6d5e4e2a71c52c661a19b8268384fd7093405f10 æ ‡è¯†å…³è”æ–‡ä»¶çš„æ ‘å¯¹è±¡çš„åç§°</li>\n<li>author zepang <a href=\"mailto:ummlq4@gmail.com\">ummlq4@gmail.com</a> 1577961062 +0800 ä½œè€…çš„åå­—å’Œåˆ›ä½œçš„æ—¶é—´</li>\n<li>committer zepang <a href=\"mailto:ummlq4@gmail.com\">ummlq4@gmail.com</a> 1577961062 +0800 æŠŠæ–°ç‰ˆæœ¬æ”¾åˆ°ç‰ˆæœ¬åº“çš„äººï¼ˆæäº¤è€…ï¼‰çš„åå­—å’Œæäº¤çš„æ—¶é—´</li>\n<li>update å¯¹æœ¬æ¬¡ä¿®è®¢åŸå› çš„è¯´æ˜ï¼ˆæäº¤æ¶ˆæ¯ï¼‰</li>\n</ul>\n<p>å½“å‰HEADæŒ‡å‘çš„æ˜¯masteråˆ†æ”¯ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹<code>.git/refs/head/master</code>ä¸­ä¿å­˜çš„å¯¹è±¡åç§°</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">cat</span> .git/refs/head/master\n\n\n65fdbfbfd99f20a3d792fd2c5951324afde1b8f1 // æ˜¯å½“å‰çš„commitå¯¹è±¡\n</code></pre></div>\n<p>æ‰€ä»¥ï¼Œæ¡ˆä¾‹ä¸­blobï¼Œtreeï¼Œcommitè¿™å‡ ä¸ªå¯¹è±¡çš„å›¾ç¤ºå…³ç³»åº”ä¸ºï¼š</p>\n<p><img src=\"/images/git-object-relation-1.png\" alt=\"\"></p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹app.jsçš„å†…å®¹ï¼Œå¹¶ä½œä¸ºä¸€æ¬¡æäº¤ï¼Œç„¶ååœ¨çœ‹çœ‹<code>.git/objects</code>çš„å†…å®¹</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> count-objects\n<span class=\"token number\">7</span> objects, <span class=\"token number\">0</span> kilobytes\n\n\ntree .git/objects/\n\n\n.git/objects/\nâ”œâ”€â”€ <span class=\"token number\">13</span>\nâ”‚   â””â”€â”€ 7c5ad58c117d04cd09ba0adfcc0f15beb5f59d\nâ”œâ”€â”€ <span class=\"token number\">65</span>\nâ”‚   â””â”€â”€ fdbfbfd99f20a3d792fd2c5951324afde1b8f1\nâ”œâ”€â”€ 6d\nâ”‚   â””â”€â”€ 5e4e2a71c52c661a19b8268384fd7093405f10\nâ”œâ”€â”€ 7f\nâ”‚   â””â”€â”€ 7cc294ff052479b84bd1c13a510a616588af8e\nâ”œâ”€â”€ ea\nâ”‚   â””â”€â”€ 61ada05f2a3bcfda48230d8f511decf026b367\nâ”œâ”€â”€ f6\nâ”‚   â””â”€â”€ 8afe902f9b946699ee61f7177461ef311b1134\nâ”œâ”€â”€ fe\nâ”‚   â””â”€â”€ 6b72dcf87d057d45129f5cf281c1cb6277a010\nâ”œâ”€â”€ info\nâ””â”€â”€ pack\n</code></pre></div>\n<p>å‘ç°å¤šå‡ºäº†3ä¸ªå¯¹è±¡ã€‚</p>\n<p>ç”±ä¹‹å‰çš„å†…å®¹æˆ‘ä»¬å¾—çŸ¥ï¼Œcommitå¯¹è±¡é‡ŒåŒ…å«treeå¯¹è±¡çš„ä¿¡æ¯ï¼Œtreeå¯¹è±¡é‡Œè¾¹åŒ…å«blobå¯¹è±¡ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™æ¬¡ç›´æ¥ä»commitå¯¹è±¡å¼€å§‹æŸ¥çœ‹ï¼Œæ‰¾å‡ºå¤šå‡ºçš„å¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚</p>\n<p>é€šè¿‡<code>git log</code>å‘½ä»¤æ‹¿åˆ°æœ€æ–°çš„commit åç§°ä¸º<code>f68afe902f9b946699ee61f7177461ef311b1134</code>ï¼Œå€¼ä¸ä¹‹å‰ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> cat-file -p f68afe902f9b946699ee61f7177461ef311b1134\ntree 137c5ad58c117d04cd09ba0adfcc0f15beb5f59d // æ–°å¯¹è±¡\nparent 65fdbfbfd99f20a3d792fd2c5951324afde1b8f1\nauthor zepang <span class=\"token operator\">&#x3C;</span>ummlq4@gmail.com<span class=\"token operator\">></span> <span class=\"token number\">1578018373</span> +0800\ncommitter zepang <span class=\"token operator\">&#x3C;</span>ummlq4@gmail.com<span class=\"token operator\">></span> <span class=\"token number\">1578018373</span> +0800\n\n\nmodify\n\n\n<span class=\"token function\">git</span> cat-file -p 137c5ad58c117d04cd09ba0adfcc0f15beb5f59d\n<span class=\"token number\">100644</span> blob ea61ada05f2a3bcfda48230d8f511decf026b367    app.js // æ–°å¯¹è±¡\n<span class=\"token number\">100644</span> blob 7f7cc294ff052479b84bd1c13a510a616588af8e    index.js // ä¹‹å‰çš„å¯¹è±¡\n\n\n<span class=\"token function\">git</span> cat-file -p ea61ada05f2a3bcfda48230d8f511decf026b367 \nconsole.log<span class=\"token punctuation\">(</span><span class=\"token string\">'modify'</span><span class=\"token punctuation\">)</span> // ä¿å­˜ç€æ–°çš„å†…å®¹\n<span class=\"token function\">git</span> cat-file -p 7f7cc294ff052479b84bd1c13a510a616588af8e \nconsole.log<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token function\">cat</span> .git/refs/head/master\n\n\nf68afe902f9b946699ee61f7177461ef311b1134 // masterä¸­ä¿å­˜çš„commitçš„å¯¹è±¡ä¿¡æ¯ä¹Ÿæ”¹å˜äº†\n</code></pre></div>\n<p>ç”±æ­¤ï¼Œæˆ‘ä»¬åšå‡ºæ–°çš„å…³ç³»å›¾ä¸ºï¼š</p>\n<p><img src=\"/images/git-object-relation-2.png\" alt=\"\"></p>\n<p>ä¹‹å‰æˆ‘ä»¬æåˆ°å…³äºå¯¹è±¡çš„åç§°æ˜¯ä¸€ä¸ªç”±å¯¹è±¡å†…å®¹å†³å®šçš„SHA1æ•£åˆ—å€¼ï¼Œå½“<code>app.js</code>ä¸­çš„å†…å®¹ä¿®æ”¹ä¹‹åï¼Œapp.jså¯¹åº”çš„blobå¯¹è±¡ä»¥åŠä¸Šå±‚çš„treeå¯¹è±¡å’Œcommitå¯¹è±¡çš„å¼•ç”¨å¯¹è±¡éƒ½æ˜¯æ ¹æ®å†…å®¹æ–°è®¡ç®—å‡ºçš„å¯¹è±¡ï¼Œåªæœ‰index.jså¯¹åº”çš„blobå¯¹è±¡è¿˜æ˜¯ä¹‹å‰çš„å¯¹è±¡ã€‚</p>\n<p>æ‰€ä»¥ï¼ŒGitå­˜å‚¨ç€æ¯ä¸€ä¸ªç‰ˆæœ¬çš„å¯¹è±¡å‰¯æœ¬ï¼Œå¯¹è±¡ä¸­ä¿å­˜ç€å®Œæ•´çš„æ–‡ä»¶å‰¯æœ¬ã€‚æˆ‘ä»¬å›é€€ï¼Œåˆ‡æ¢æˆ–è€…ä¿®æ”¹ç‰ˆæœ¬å†…å®¹å®é™…ä¸Šå°±æ˜¯æ”¹å˜å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€‚</p>\n<h1 id=\"gitçš„å¸¸ç”¨å‘½ä»¤å’Œä½¿ç”¨åœºæ™¯\">gitçš„å¸¸ç”¨å‘½ä»¤å’Œä½¿ç”¨åœºæ™¯</h1>\n<p>ä¸‹è¾¹å·¥ä½œä¸­å¯èƒ½ä¼šé‡åˆ°çš„åœºæ™¯ï¼Œæ¶‰åŠå‘½ä»¤çš„å…·ä½“ç”¨æ³•éœ€è¦è‡ªå·±å»æŸ¥çœ‹è¯¦ç»†çš„è¯´æ˜æ–‡æ¡£ï¼š</p>\n<h3 id=\"åŸºæœ¬çš„å‘½ä»¤\">åŸºæœ¬çš„å‘½ä»¤</h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">// åˆ‡æ¢åˆ†æ”¯\n<span class=\"token function\">git</span> checkout <span class=\"token operator\">&#x3C;</span>branch<span class=\"token operator\">></span>\n// åˆ‡æ¢æ–°åˆ†æ”¯\n<span class=\"token function\">git</span> checkout -b <span class=\"token operator\">&#x3C;</span>new branch<span class=\"token operator\">></span>\n// æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€\nâ€‹git status\n// æš‚å­˜\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token operator\">&#x3C;</span>name<span class=\"token operator\">></span>\n// æäº¤\n<span class=\"token function\">git</span> commit -m <span class=\"token operator\">&#x3C;</span>message<span class=\"token operator\">></span>\n// æ¨é€è¿œç¨‹ä»“åº“\n<span class=\"token function\">git</span> push origin <span class=\"token operator\">&#x3C;</span>branch<span class=\"token operator\">></span>\n</code></pre></div>\n<h3 id=\"è¿œç¨‹ä»“åº“ç›¸å…³\">è¿œç¨‹ä»“åº“ç›¸å…³</h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> remote --help\n</code></pre></div>\n<h3 id=\"å›é€€ä»£ç \">å›é€€ä»£ç </h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> reset --help\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">éœ€è¦æ³¨æ„çš„--hard --mixed --softçš„åŒºåˆ«ï¼š\n\n\n\n--hardï¼šå›é€€å°†ä¼šå½±å“ç´¢å¼•å’Œå·¥ä½œåŒº\n\n\n\n--mixedï¼šè¿™ä¸ªæ˜¯é»˜è®¤çš„å‚æ•°ï¼Œå›é€€ä»…å½±å“ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯æš‚å­˜åŒº\n\n\n\n--softï¼šä¸å½±å“ç´¢å¼•å’Œå·¥ä½œåŒºï¼Œå›é€€ä¹‹åç›´æ¥å¯ä»¥ç›´æ¥commit</code></pre></div>\n<h3 id=\"å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦åˆ‡æ¢åˆ†æ”¯ä¿®æ”¹å…¶ä»–å†…å®¹\">å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦åˆ‡æ¢åˆ†æ”¯ä¿®æ”¹å…¶ä»–å†…å®¹</h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">// å°†æ–‡ä»¶å­˜åˆ°ä¸´æ—¶ç©ºé—´ï¼Œä¹‹åå†å–å‡º\n\n\n<span class=\"token function\">git</span> stash \n\n\n// å…ˆæäº¤ä¸€ä¸ªcommitï¼Œå›æ¥ä¹‹åä¿®æ”¹å®Œåœ¨ä½¿ç”¨ --amendï¼Œä¼šå°†å½“å‰çš„ä¿®æ”¹åˆå¹¶åˆ°ä¸Šä¸€ä¸ªcommitï¼Œå¹¶ä¸”è¿˜èƒ½ä¿®æ”¹æè¿°ä¿¡æ¯\n\n\n<span class=\"token function\">git</span> commit --amend \n</code></pre></div>\n<h3 id=\"ä»£ç è¯¯æ“ä½œéœ€è¦æ‰¾å›ï¼Œæˆ–è€…æŸ¥çœ‹æ“ä½œå†…å®¹\">ä»£ç è¯¯æ“ä½œéœ€è¦æ‰¾å›ï¼Œæˆ–è€…æŸ¥çœ‹æ“ä½œå†…å®¹</h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">// å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„æ“ä½œæ­¥éª¤\n<span class=\"token function\">git</span> reflog\n</code></pre></div>\n<p>â€‹</p>\n<h3 id=\"ä¸å°å¿ƒå°†å¤§æ–‡ä»¶æäº¤åˆ°äº†gitä¸­\">ä¸å°å¿ƒå°†å¤§æ–‡ä»¶æäº¤åˆ°äº†gitä¸­</h3>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">// ä½¿ç”¨ git rm å‘½ä»¤å°†å…¶åˆ é™¤\n\ngit rm // åŒæ—¶åˆ é™¤ç´¢å¼•å’Œå·¥ä½œåŒº\ngit rm --cached // ä»…åˆ é™¤ç´¢å¼•</code></pre></div>\n<h3 id=\"å½“ä½ æƒ³å–å¦ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„commitåˆ°å½“å‰åˆ†æ”¯\">å½“ä½ æƒ³å–å¦ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„commitåˆ°å½“å‰åˆ†æ”¯</h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">// é¦–å…ˆä½ å¾—çŸ¥é“éœ€è¦å–çš„commitçš„åç§°ï¼Œå°±æ˜¯hashå€¼ï¼Œç„¶åä½¿ç”¨ <span class=\"token function\">git</span> cherry-pick å‘½ä»¤å°±èƒ½å¤Ÿå°†commitæ¬è¿è¿‡æ¥ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°å†²çª\n\n\n<span class=\"token function\">git</span> cherry-pick <span class=\"token operator\">&#x3C;</span>commit<span class=\"token operator\">></span>\n</code></pre></div>\n<h3 id=\"å¤šäººåä½œçš„æ—¶å€™ä½ ä¼šå‘ç°ï¼Œå½“ä½ ä½¿ç”¨ä½¿ç”¨git-branch--a-æŸ¥çœ‹åˆ†æ”¯çš„æ—¶å€™ï¼Œä¼šå‡ºç°å¾ˆå¤šè¿œç¨‹å·²ç»åˆ é™¤çš„åˆ†æ”¯ï¼Œå¦‚æœä½ æƒ³è¦åˆ é™¤è¿™äº›ä¸éœ€è¦å±•ç¤ºåˆ†æ”¯åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¾¹çš„å‘½ä»¤ï¼š\">å¤šäººåä½œçš„æ—¶å€™ä½ ä¼šå‘ç°ï¼Œå½“ä½ ä½¿ç”¨ä½¿ç”¨git branch -a æŸ¥çœ‹åˆ†æ”¯çš„æ—¶å€™ï¼Œä¼šå‡ºç°å¾ˆå¤šè¿œç¨‹å·²ç»åˆ é™¤çš„åˆ†æ”¯ï¼Œå¦‚æœä½ æƒ³è¦åˆ é™¤è¿™äº›ä¸éœ€è¦å±•ç¤ºåˆ†æ”¯åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¾¹çš„å‘½ä»¤ï¼š</h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> remote prune origin \n</code></pre></div>\n<h3 id=\"git-diff-å‘½ä»¤\">git diff å‘½ä»¤</h3>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> <span class=\"token function\">diff</span>                å·¥ä½œåŒº vs æš‚å­˜åŒº\n<span class=\"token function\">git</span> <span class=\"token function\">diff</span> <span class=\"token function\">head</span>           å·¥ä½œåŒº vs ç‰ˆæœ¬åº“\n<span class=\"token function\">git</span> <span class=\"token function\">diff</span> â€“cached        æš‚å­˜åŒº vs ç‰ˆæœ¬åº“\n</code></pre></div>\n<p>æ¨èä½¿ç”¨git difftoolï¼Œæ¯”git diffæ›´å¥½ç”¨çš„å‘½ä»¤ï¼Œæœ€å¥½ç”¨çš„è¿˜æ˜¯ç›´æ¥å®‰è£…ç¼–è¾‘å™¨çš„æ’ä»¶ã€‚</p>\n<h3 id=\"git-merge-å’Œ-git-rebase\">git merge å’Œ git rebase</h3>\n<p>ä½¿ç”¨å‰å¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼Œgit mergeèƒ½å¤Ÿä¿å­˜åˆ†æ”¯å®Œæ•´çš„å†å²è®°å½•ï¼Œgit rebaseä¼šå°†éœ€è¦åˆå¹¶commitæ·»åŠ åˆ°ç›®æ ‡åˆ†æ”¯ï¼Œç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šç±»ä¼¼çš„æ–‡ç« è®²çš„æ¯”è¾ƒè¯¦ç»†ï¼Œå¤§å®¶å¯ä»¥å»æœç´¢ä¸€ä¸‹ï¼Œå…·ä½“ä½¿ç”¨å“ªä¸ªå‘½ä»¤ï¼Œæ ¹æ®å›¢é˜Ÿçš„è§„èŒƒæˆ–è€…ä¸ªäººå–œå¥½æ¥å®šã€‚</p>\n",
    "frontmatter": {
      "title": "ä¸€äº›å…³äºGitçš„å†…å®¹",
      "date": "2019-01-10"
    },
    "toc": "<ul>\n<li>\n<p><a href=\"#%E6%A6%82%E8%BF%B0\">æ¦‚è¿°</a></p>\n<ul>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%92%8C%E4%B8%89%E4%B8%AA%E5%88%86%E5%8C%BA%E6%A6%82%E5%BF%B5\">åŸºæœ¬ä½¿ç”¨å’Œä¸‰ä¸ªåˆ†åŒºæ¦‚å¿µ</a></li>\n<li><a href=\"#git%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E4%BF%A1%E6%81%AF\">gitå¦‚ä½•å­˜å‚¨ä¿¡æ¯</a></li>\n<li><a href=\"#objects%E7%9B%AE%E5%BD%95\">objectsç›®å½•</a></li>\n<li><a href=\"#git%E5%AF%B9%E8%B1%A1\">gitå¯¹è±¡</a></li>\n<li><a href=\"#git%E5%AF%B9%E8%B1%A1%E5%85%B3%E7%B3%BB\">gitå¯¹è±¡å…³ç³»</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#git%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\">gitçš„å¸¸ç”¨å‘½ä»¤å’Œä½¿ç”¨åœºæ™¯</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%91%BD%E4%BB%A4\">åŸºæœ¬çš„å‘½ä»¤</a></li>\n<li><a href=\"#%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9B%B8%E5%85%B3\">è¿œç¨‹ä»“åº“ç›¸å…³</a></li>\n<li><a href=\"#%E5%9B%9E%E9%80%80%E4%BB%A3%E7%A0%81\">å›é€€ä»£ç </a></li>\n<li><a href=\"#%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%9C%80%E8%A6%81%E5%88%87%E6%8D%A2%E5%88%86%E6%94%AF%E4%BF%AE%E6%94%B9%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9\">å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦åˆ‡æ¢åˆ†æ”¯ä¿®æ”¹å…¶ä»–å†…å®¹</a></li>\n<li><a href=\"#%E4%BB%A3%E7%A0%81%E8%AF%AF%E6%93%8D%E4%BD%9C%E9%9C%80%E8%A6%81%E6%89%BE%E5%9B%9E%EF%BC%8C%E6%88%96%E8%80%85%E6%9F%A5%E7%9C%8B%E6%93%8D%E4%BD%9C%E5%86%85%E5%AE%B9\">ä»£ç è¯¯æ“ä½œéœ€è¦æ‰¾å›ï¼Œæˆ–è€…æŸ¥çœ‹æ“ä½œå†…å®¹</a></li>\n<li><a href=\"#%E4%B8%8D%E5%B0%8F%E5%BF%83%E5%B0%86%E5%A4%A7%E6%96%87%E4%BB%B6%E6%8F%90%E4%BA%A4%E5%88%B0%E4%BA%86git%E4%B8%AD\">ä¸å°å¿ƒå°†å¤§æ–‡ä»¶æäº¤åˆ°äº†gitä¸­</a></li>\n<li><a href=\"#%E5%BD%93%E4%BD%A0%E6%83%B3%E5%8F%96%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF%E4%B8%8A%E7%9A%84commit%E5%88%B0%E5%BD%93%E5%89%8D%E5%88%86%E6%94%AF\">å½“ä½ æƒ³å–å¦ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„commitåˆ°å½“å‰åˆ†æ”¯</a></li>\n<li><a href=\"#%E5%A4%9A%E4%BA%BA%E5%8D%8F%E4%BD%9C%E7%9A%84%E6%97%B6%E5%80%99%E4%BD%A0%E4%BC%9A%E5%8F%91%E7%8E%B0%EF%BC%8C%E5%BD%93%E4%BD%A0%E4%BD%BF%E7%94%A8%E4%BD%BF%E7%94%A8git-branch--a-%E6%9F%A5%E7%9C%8B%E5%88%86%E6%94%AF%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%BE%88%E5%A4%9A%E8%BF%9C%E7%A8%8B%E5%B7%B2%E7%BB%8F%E5%88%A0%E9%99%A4%E7%9A%84%E5%88%86%E6%94%AF%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%83%B3%E8%A6%81%E5%88%A0%E9%99%A4%E8%BF%99%E4%BA%9B%E4%B8%8D%E9%9C%80%E8%A6%81%E5%B1%95%E7%A4%BA%E5%88%86%E6%94%AF%E5%90%8D%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E4%B8%8B%E8%BE%B9%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%9A\">å¤šäººåä½œçš„æ—¶å€™ä½ ä¼šå‘ç°ï¼Œå½“ä½ ä½¿ç”¨ä½¿ç”¨git branch -a æŸ¥çœ‹åˆ†æ”¯çš„æ—¶å€™ï¼Œä¼šå‡ºç°å¾ˆå¤šè¿œç¨‹å·²ç»åˆ é™¤çš„åˆ†æ”¯ï¼Œå¦‚æœä½ æƒ³è¦åˆ é™¤è¿™äº›ä¸éœ€è¦å±•ç¤ºåˆ†æ”¯åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹è¾¹çš„å‘½ä»¤ï¼š</a></li>\n<li><a href=\"#git-diff-%E5%91%BD%E4%BB%A4\">git diff å‘½ä»¤</a></li>\n<li><a href=\"#git-merge-%E5%92%8C-git-rebase\">git merge å’Œ git rebase</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
    "name": "ä¸€äº›å…³äºGitçš„å†…å®¹",
    "id": "9d416bfd8ea5d650c625f97e4f7839c6",
    "prev": {
      "name": "vite åŸç†è§£æ(3)-è§£æSFC(Vue Single File)",
      "id": "8d8914f9964874ae658642580b508059"
    },
    "next": {
      "name": "ä½¿ç”¨ Next.js SSG å’Œ Markdown åˆ›å»ºåšå®¢",
      "id": "7c63ed8670a327e4a87f9dc1a158bd10"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/ä½¿ç”¨ Next.js SSG å’Œ Markdown åˆ›å»ºåšå®¢.md",
      "/home/zepang/WorkSpace/blog/posts/ä½¿ç”¨ Next.js SSG å’Œ Markdown åˆ›å»ºåšå®¢.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¯å¢ƒå‡†å¤‡\">ç¯å¢ƒå‡†å¤‡</h1>\n<ul>\n<li>\n<p>Node.js</p>\n</li>\n<li>\n<p>Npm, npx</p>\n</li>\n<li>\n<p>VS Code</p>\n</li>\n</ul>\n<h1 id=\"ä»€ä¹ˆæ˜¯-ssgï¼Ÿ\">ä»€ä¹ˆæ˜¯ SSGï¼Ÿ</h1>\n<p>é™æ€ç«™ç‚¹ç”Ÿæˆå™¨SSGæ˜¯ä»‹äºä¼ ç»Ÿé™æ€ç«™ç‚¹å’ŒåŠ¨æ€ç«™ç‚¹ä¹‹é—´çš„ä¸€ç§æŠ˜ä¸­è§£å†³æ–¹æ¡ˆã€‚</p>\n<p>ä¼ ç»Ÿæ„ä¹‰çš„é™æ€ç½‘ç«™å†…å®¹å›ºå®šï¼Œè€ŒåŠ¨æ€ç½‘ç«™åˆ™ä¼šæ ¹æ®è·å–çš„æ•°æ®åŠ¨æ€çš„æ¸²æŸ“å†…å®¹ã€‚</p>\n<p>SGGä¸ä¸Šè¾¹ä¸¤è€…çš„åŒºåˆ«æ˜¯SSGä¼šæå‰ï¼ˆæ‰“åŒ…ç¼–è¯‘ï¼‰è·å–æ•°æ®ï¼Œæ•°æ®æ¥æºå¯èƒ½æ˜¯é€šè¿‡APIæˆ–è€…Markdownã€JSONæ–‡ä»¶ç­‰ç­‰ï¼Œç„¶åæ ¹æ®è·å–çš„æ•°æ®è¾“å‡ºHTMLé™æ€æ–‡ä»¶ã€‚</p>\n<p>next.js9.3ç‰ˆæœ¬å®£å¸ƒæ”¯æŒSSGï¼Œå…·ä½“æŸ¥çœ‹è¯¥æ–‡ç« <a href=\"https://nextjs.org/blog/next-9-3#next-gen-static-site-generation-ssg-support\">https://nextjs.org/blog/next-9-3#next-gen-static-site-generation-ssg-support</a>ã€‚</p>\n<p>æœ¬æ–‡å°†å°è¯•é…ç½®ä¸€ä¸ª Next.js SSG Blog Starter é¡¹ç›®ï¼Œå¹¶åŸºäºè¯¥é¡¹ç›®åˆ›å»ºä¸ªäººåšå®¢ã€‚</p>\n<h1 id=\"åˆå§‹åŒ–ä¸€ä¸ªnextjsé¡¹ç›®\">åˆå§‹åŒ–ä¸€ä¸ªnext.jsé¡¹ç›®</h1>\n<p>æ‰“å¼€next.jsçš„æ–‡æ¡£ï¼ŒæŒ‰ç…§æ­¥éª¤å¿«é€Ÿåˆ›å»ºä¸€ä¸ªnext.jsåº”ç”¨</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npx create-next-app\n\n# æ–‡ä»¶ç›®å½•å¦‚ä¸‹\n.\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ package.json\nâ”œâ”€â”€ pages\nâ”œâ”€â”€ public\nâ”œâ”€â”€ styles\nâ””â”€â”€ yarn.lock</code></pre></div>\n<p>åˆ›å»ºå®Œæˆä¹‹åæˆ‘ä»¬å…ˆè¿›å…¥ç›®å½•ï¼Œå¯åŠ¨ä¸€ä¸‹é¡¹ç›®ï¼Œç¡®ä¿æ²¡æœ‰é—®é¢˜</p>\n<h1 id=\"å°è¯•ä½¿ç”¨getstaticpropsæå‰è·å–æ•°æ®\">å°è¯•ä½¿ç”¨getStaticPropsæå‰è·å–æ•°æ®</h1>\n<p>çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£å¯¹getStaticPropså‡½æ•°çš„æè¿°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">If you export an async function called getStaticProps from a page, Next.js will pre-render this page at build time using the props returned by getStaticProps.</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// will be passed to the page component as props</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»º<code>/posts</code>ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªMarkdownçš„æ–‡ä»¶<code>index.md</code>ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\"># hello next.js</code></pre></div>\n<p>æ”¹é€ <code>index.js</code>çš„å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">fs</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'fs'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">path</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'path'</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Home</span></span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> markdown <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&#x3C;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>markdown<span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> markdown <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readFileSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'posts/index.md'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      markdown\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ‰“å¼€æµè§ˆå™¨ï¼Œå¯ä»¥çœ‹åˆ°æ ‡é¢˜<code># hello next.js</code>ï¼ŒæˆåŠŸçš„æ‹¿åˆ°äº†æ•°æ®ã€‚</p>\n<h1 id=\"è·å–æ–‡ç« å…ƒä¿¡æ¯ï¼ˆmetadataï¼‰å’Œå†…å®¹\">è·å–æ–‡ç« å…ƒä¿¡æ¯ï¼ˆmetaDataï¼‰å’Œå†…å®¹</h1>\n<p>åœ¨ä½¿ç”¨Markdownå†™æ–‡ç« çš„æ—¶å€™ï¼Œä¸ºäº†åŒºåˆ«æ–‡ç« çš„ä¸€äº›å…ƒä¿¡æ¯å’Œæ–‡ç« å†…å®¹ï¼Œé€šå¸¸ä¼šä½¿ç”¨yamlè¯­æ³•æ¥æè¿°æ–‡ç« å…ƒä¿¡æ¯ã€‚</p>\n<p>æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ç‰‡æ–‡ç« <code>/post/ç¬¬ä¸€ç¯‡æ–‡ç« .md</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-md\"><code class=\"language-md\"><span class=\"token hr punctuation\">---</span>\n<span class=\"token title important\">title: ç¬¬ä¸€ç¯‡æ–‡ç« \n<span class=\"token punctuation\">---</span></span>\n\n<span class=\"token title important\"><span class=\"token punctuation\">#</span> ç¬¬ä¸€ç¯‡æ–‡ç« </span>\n\nç¬¬ä¸€ç¯‡æ–‡ç« å†…å®¹\n</code></pre></div>\n<p>æˆ‘ä»¬ä½¿ç”¨<code>front-matter</code>å¤„ç†å…ƒä¿¡æ¯å’Œè·å–éœ€è¦çš„Markdownå†…å®¹</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">yarn add front-matter</code></pre></div>\n<p>ä¸‹é¢æ˜¯æ”¹é€ åçš„<code>index.js</code>æ–‡ä»¶å†…å®¹:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">fs</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'fs'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">path</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'path'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">frontMatter</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'front-matter'</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Home</span></span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> posts <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">page</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span>main className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">main</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span>ul<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span>\n            posts<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span>\n              <span class=\"token operator\">&#x3C;</span>li key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span>span className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">titleWrapper</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n                  <span class=\"token operator\">&#x3C;</span>a className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">meta</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span>span className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">date</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">meta</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">date</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n             <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>main<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> postsDirectory <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'posts'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readdirSync</span><span class=\"token punctuation\">(</span>postsDirectory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token special-escape escape\">\\.</span>md<span class=\"token anchor function\">$</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>postsDirectory<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> attributes<span class=\"token punctuation\">,</span> body <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">frontMatter</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// ç¡®ä¿titleå­˜åœ¨</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'[object Object]'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      attributes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> title<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">basename</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>attributes<span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      attributes<span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span> <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">basename</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n      meta<span class=\"token operator\">:</span> attributes<span class=\"token punctuation\">,</span>\n      content<span class=\"token operator\">:</span> body\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      posts\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ‰“å¼€é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ç« çš„æ ‡é¢˜</p>\n<h1 id=\"ä½¿ç”¨-react-markdown-æ¸²æŸ“markdown\">ä½¿ç”¨ react-markdown æ¸²æŸ“Markdown</h1>\n<p>å®‰è£…ä¾èµ–<code>react-markdown</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">yarn add react-markdown</code></pre></div>\n<p>æ”¹é€ index.jsæ—³ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">ReactMarkdown</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-markdown'</span>\n<span class=\"token spread operator\">...</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Home</span></span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> posts <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">page</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span>main className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">main</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span>ul<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span>\n            posts<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span>\n              <span class=\"token operator\">&#x3C;</span>li key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span>span className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">titleWrapper</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n                  <span class=\"token operator\">&#x3C;</span>a className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">meta</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span>span className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span><span class=\"token property-access\">date</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">meta</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">date</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n             <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n        <span class=\"token comment\">// æ–‡ç« å†…å®¹</span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">ReactMarkdown</span> children<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>markdown<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">ReactMarkdown</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>main<span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token spread operator\">...</span>\n</code></pre></div>\n<p>é‡æ–°è¿è¡Œé¡¹ç›®ï¼Œé¡µé¢å·²ç»å‘ˆç°å‡ºäº†Markdownæ–‡ä»¶å†…å®¹ã€‚</p>\n<h1 id=\"ä½¿ç”¨nextjsåŠ¨æ€è·¯ç”±\">ä½¿ç”¨Next.jsåŠ¨æ€è·¯ç”±</h1>\n<p>SSGæ‰“åŒ…å‡ºæ¥çš„éƒ½æ˜¯é™æ€é¡µé¢ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦ä¸ºæ¯ä¸ªMarkdownæ–‡ç« é¡µè¾“å‡ºä¸€ä¸ªHTMLæ–‡ç« é¡µï¼Œé€šè¿‡è®¿é—®URLä¸Šçš„é™æ€æ–‡ä»¶åæ¥è®¿é—®HTMLé¡µé¢ã€‚</p>\n<p>ä¸ºäº†è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œéœ€è¦ç”¨åˆ°next.jsçš„åŠ¨æ€è·¯ç”±å’Œ<code>getStaticPaths</code>å‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨é€šè¿‡åœ¨<code>next.config.js</code>ä¸­é…ç½®<code>exportPathMap</code>æ¥æ›¿æ¢<code>getStaticPaths</code>å‡½æ•°çš„ä½œç”¨ã€‚</p>\n<p>å…ˆæ¥å°è¯•ä¸€ä¸‹next.jsçš„åŠ¨æ€è·¯ç”±ï¼Œåˆ›å»º<code>pages/post/[postName].js</code>ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> useRouter <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'next/router'</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">post</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&#x3C;</span>h1<span class=\"token operator\">></span>è¿™æ˜¯æ–‡ç« <span class=\"token punctuation\">{</span>router<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">postName</span><span class=\"token punctuation\">}</span>çš„è¯¦æƒ…é¡µé¢<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä¹‹åå¯ä»¥é€šè¿‡<code>localhost:3000/post/:postName</code>æ¥è®¿é—®é¡µé¢ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<code>next/router</code>çš„<code>useRouter</code> hooksåˆ›å»ºçš„routerå¯¹è±¡è·å– <code>postName</code> çš„å€¼ã€‚</p>\n<p>åœ¨æ”¹é€ <code>pages/post/[postName].js</code>ä¹‹å‰ï¼Œå…ˆæŠŠ<code>index.js</code>æ–‡ä»¶ä¸­çš„ä¸€äº›é€šç”¨æ–¹æ³•æåˆ°<code>/utils/index.js</code>æ–‡ä»¶ä¸­ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">fs</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'fs'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">path</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'path'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">frontMatter</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'front-matter'</span>\n\n<span class=\"token keyword\">const</span> postsDirectory <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'posts'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getAllPosts</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readdirSync</span><span class=\"token punctuation\">(</span>postsDirectory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token special-escape escape\">\\.</span>md<span class=\"token anchor function\">$</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">test</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">basename</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">extname</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">getPost</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> posts\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getPost</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">filename</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>postsDirectory<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>filename<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.md</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> attributes<span class=\"token punctuation\">,</span> body <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">frontMatter</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// ç¡®ä¿titleå­˜åœ¨</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'[object Object]'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    attributes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> title<span class=\"token operator\">:</span> filename <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>attributes<span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    attributes<span class=\"token punctuation\">.</span><span class=\"token property-access\">title</span> <span class=\"token operator\">=</span> filename\n  <span class=\"token punctuation\">}</span>\n\n  attributes<span class=\"token punctuation\">.</span><span class=\"token property-access\">filename</span> <span class=\"token operator\">=</span> filename\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    meta<span class=\"token operator\">:</span> attributes<span class=\"token punctuation\">,</span>\n    content<span class=\"token operator\">:</span> body\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ¥ä¸‹æ¥åœ¨<code>pages/post/[postName].js</code>åŠ å…¥<code>getStaticPaths</code>å‡½æ•°å’Œ<code>getStaticPropså‡½æ•°</code>ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> useRouter <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'next/router'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> getAllPosts<span class=\"token punctuation\">,</span> getPost <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'../../utils'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">ReactMarkdown</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-markdown'</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">post</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> post <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span>h1<span class=\"token operator\">></span>è¿™æ˜¯æ–‡ç« <span class=\"token punctuation\">{</span>router<span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">postName</span><span class=\"token punctuation\">}</span>çš„è¯¦æƒ…é¡µé¢<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">ReactMarkdown</span> children<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">ReactMarkdown</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">contxt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> post <span class=\"token operator\">=</span> <span class=\"token function\">getPost</span><span class=\"token punctuation\">(</span>contxt<span class=\"token punctuation\">.</span><span class=\"token property-access\">params</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">postName</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      post\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticPaths</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token function\">getAllPosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> paths <span class=\"token operator\">=</span> posts<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n      params<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> \n        <span class=\"token comment\">// å…¼å®¹ä¸­æ–‡å‘½åéœ€è¦ä½¿ç”¨ encodeURIComponentï¼Œå¦åˆ™æ— æ³•æ ¹æ®URLçš„æ–‡ä»¶åæ‰¾åˆ°å¯¹åº”æ–‡ä»¶</span>\n        postName<span class=\"token operator\">:</span> <span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">meta</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">filename</span><span class=\"token punctuation\">)</span> \n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    paths<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ä¸å­˜åœ¨çš„æ–‡ç« æ˜¾ç¤º404</span>\n    fallback<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> \n</code></pre></div>\n<p>ç›®å‰å·²ç»å¯ä»¥é€šè¿‡è®¿é—®<code>localhost:3000/post/:postName</code>æ­£ç¡®çš„å±•ç¤ºMarkdownæ–‡ç« é¡µé¢å’Œå†…å®¹ã€‚</p>\n<h1 id=\"æ·»åŠ markdownä»£ç å—çš„è¯­æ³•é«˜äº®\">æ·»åŠ markdownä»£ç å—çš„è¯­æ³•é«˜äº®</h1>\n<p><code>react-markdown</code> é»˜è®¤æ²¡æœ‰è¯­æ³•é«˜äº®ï¼Œè¯­æ³•é«˜äº®éœ€è¦ç”¨åˆ°å¦å¤–ä¸€ä¸ªä¾èµ– <code>react-syntax-highlighter</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">yarn add react-syntax-highlighter</code></pre></div>\n<p>å…³äº <code>react-syntax-highlighter</code> çš„ä½¿ç”¨è¿™é‡Œä¸åšè¿‡å¤šè¯´æ˜ï¼Œå…·ä½“çš„è¯å»æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£å³å¯ã€‚</p>\n<p>ä¸ºäº†ä½¿çš„ <code>react-syntax-highlighter</code> é…åˆ <code>react-markdown</code>ï¼Œéœ€è¦ä½¿ç”¨<code>react-markdown</code>çš„è‡ªå®šä¹‰<code>renderers</code>ï¼Œæ–‡æ¡£ä¹Ÿæœ‰æåˆ°ç›¸å…³çš„å†…å®¹ã€‚</p>\n<p>ä¿®æ”¹<code>pages/post/[postName].js</code>çš„ä»£ç ï¼Œé’ˆå¯¹<code>code</code>æ ‡ç­¾çš„å†…å®¹äº¤ç»™<code>CodeBlock</code>ç»„ä»¶å¤„ç†ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token spread operator\">...</span>\n<span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">ReactMarkdown</span> children<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">content</span><span class=\"token punctuation\">}</span> renderers<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> code<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">CodeBlock</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">ReactMarkdown</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token spread operator\">...</span>\n</code></pre></div>\n<p>åˆ›å»ºæ–‡ä»¶<code>components/CodeBlock.js</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Prism</span> <span class=\"token keyword module\">as</span> <span class=\"token maybe-class-name\">SyntaxHighlighter</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-syntax-highlighter'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> okaidia <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-syntax-highlighter/dist/cjs/styles/prism'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">CodeBlock</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> language<span class=\"token punctuation\">,</span> value <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">SyntaxHighlighter</span> language<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>language<span class=\"token punctuation\">}</span> style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>okaidia<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">SyntaxHighlighter</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token maybe-class-name\">CodeBlock</span>\n</code></pre></div>\n<p>è¿™æ ·markdownä¸­ä»£ç å—çš„è¯­æ³•é«˜äº®å°±å¤„ç†å®Œäº†ã€‚</p>\n",
    "frontmatter": {
      "title": "ä½¿ç”¨ Next.js SSG å’Œ Markdown åˆ›å»ºåšå®¢",
      "date": "2020-11-29"
    },
    "toc": "<ul>\n<li><a href=\"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">ç¯å¢ƒå‡†å¤‡</a></li>\n<li><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-ssg%EF%BC%9F\">ä»€ä¹ˆæ˜¯ SSGï¼Ÿ</a></li>\n<li><a href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AAnextjs%E9%A1%B9%E7%9B%AE\">åˆå§‹åŒ–ä¸€ä¸ªnext.jsé¡¹ç›®</a></li>\n<li><a href=\"#%E5%B0%9D%E8%AF%95%E4%BD%BF%E7%94%A8getstaticprops%E6%8F%90%E5%89%8D%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE\">å°è¯•ä½¿ç”¨getStaticPropsæå‰è·å–æ•°æ®</a></li>\n<li><a href=\"#%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E5%85%83%E4%BF%A1%E6%81%AF%EF%BC%88metadata%EF%BC%89%E5%92%8C%E5%86%85%E5%AE%B9\">è·å–æ–‡ç« å…ƒä¿¡æ¯ï¼ˆmetaDataï¼‰å’Œå†…å®¹</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8-react-markdown-%E6%B8%B2%E6%9F%93markdown\">ä½¿ç”¨ react-markdown æ¸²æŸ“Markdown</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8nextjs%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1\">ä½¿ç”¨Next.jsåŠ¨æ€è·¯ç”±</a></li>\n<li><a href=\"#%E6%B7%BB%E5%8A%A0markdown%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9A%84%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE\">æ·»åŠ markdownä»£ç å—çš„è¯­æ³•é«˜äº®</a></li>\n</ul>\n",
    "name": "ä½¿ç”¨ Next.js SSG å’Œ Markdown åˆ›å»ºåšå®¢",
    "id": "7c63ed8670a327e4a87f9dc1a158bd10",
    "prev": {
      "name": "ä¸€äº›å…³äºGitçš„å†…å®¹",
      "id": "9d416bfd8ea5d650c625f97e4f7839c6"
    },
    "next": {
      "name": "åœ¨çº¿Web IDE--code serveréƒ¨ç½²",
      "id": "00e7f2b491b451d6822c03c6285ad404"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/åœ¨çº¿Web IDE--code serveréƒ¨ç½².md",
      "/home/zepang/WorkSpace/blog/posts/åœ¨çº¿Web IDE--code serveréƒ¨ç½².html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¯å¢ƒå‡†å¤‡\">ç¯å¢ƒå‡†å¤‡</h1>\n<ul>\n<li>\n<p>ä¸€å°æœåŠ¡å™¨</p>\n</li>\n<li>\n<p>Dockerç¯å¢ƒ</p>\n</li>\n<li>\n<p>Nginx</p>\n</li>\n</ul>\n<h1 id=\"code-server-éƒ¨ç½²\">Code Server éƒ¨ç½²</h1>\n<ul>\n<li><code>code-server</code> <a href=\"https://github.com/cdr/code-server\">https://github.com/cdr/code-server</a></li>\n</ul>\n<p>ç”±äºä¹‹å‰ä½¿ç”¨è¿‡dockerï¼Œç¯å¢ƒéƒ½è¿˜åœ¨ï¼Œæ‰€ä»¥ï¼Œé€‰æ‹©ä½¿ç”¨dockerçš„æ–¹å¼è¿›è¡Œéƒ¨ç½²</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> -p ~/.config\n\ndocker run -it --name code-server -p <span class=\"token number\">127.0</span>.0.1:8080:8080 <span class=\"token punctuation\">\\</span>\n  -v <span class=\"token string\">\"<span class=\"token environment constant\">$HOME</span>/.config:/home/coder/.config\"</span> <span class=\"token punctuation\">\\</span>\n  -v <span class=\"token string\">\"<span class=\"token environment constant\">$PWD</span>:/home/coder/project\"</span> <span class=\"token punctuation\">\\</span>\n  -u <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> -u<span class=\"token variable\">)</span></span>:<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> -g<span class=\"token variable\">)</span></span>\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token comment\"># æ­¤å¤„å¡«å†™ç­‰ä¼šè®¿é—®Web IDEå¯†ç </span>\n  -e <span class=\"token string\">\"PASSWORD=xxxxx\"</span>\n  codercom/code-server:latest\n</code></pre></div>\n<p>è·‘å®Œä¹‹åæŸ¥çœ‹ä¸€ä¸‹å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">âœ  ~ docker container <span class=\"token function\">ls</span> -a\nCONTAINER ID   IMAGE                         COMMAND                  CREATED       STATUS       PORTS                    NAMES\n62d7182c80ea   codercom/code-server:latest   <span class=\"token string\">\"/usr/bin/entrypointâ€¦\"</span>   <span class=\"token number\">8</span> hours ago   Up <span class=\"token number\">8</span> hours   <span class=\"token number\">0.0</span>.0.0:8080-<span class=\"token operator\">></span><span class=\"token number\">8080</span>/tcp   code-server\n</code></pre></div>\n<p>è¿‡ç¨‹è¿›è¡Œçš„è¿˜æ¯”è¾ƒé¡ºåˆ©ï¼Œä¸€æ­¥å°±æˆåŠŸäº†</p>\n<h1 id=\"nginx-é…ç½®\">Nginx é…ç½®</h1>\n<p>åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸ŠåŠ ä¸€ä¸ª <code>location</code> çš„é…ç½®å—</p>\n<div class=\"remark-highlight\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">location</span> <span class=\"token operator\">/</span>code<span class=\"token operator\">-</span><span class=\"token keyword\">server</span><span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">proxy_pass</span> <span class=\"token keyword\">http</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">proxy_set_header</span> Host <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">proxy_set_header</span> Upgrade <span class=\"token variable\">$http_upgrade</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">proxy_set_header</span> Connection upgrade<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">proxy_set_header</span> Accept<span class=\"token operator\">-</span>Encoding <span class=\"token keyword\">gzip</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>https://example.com/code-server</code>ï¼Œå‡ºç°è¾“å…¥æ¡†ï¼Œè¾“å…¥åˆšæ‰è®¾ç½®çš„å¯†ç ï¼Œè¿›å…¥IDE</p>\n<p><img src=\"/images/vscode-web-ide.png\" alt=\"\"></p>\n<p>å…³äºcode-serverçš„é…ç½®å¯ä»¥æŸ¥çœ‹æ–‡æ¡£æˆ–è€…æœç´¢ç›¸å…³çš„æ–‡ç« </p>\n<p>å…³äºæ¢çš„é—®é¢˜æ ¹æ®ä¸ªäººçš„éœ€æ±‚å¤„ç†å°±å¥½äº†</p>\n<p>å‚è€ƒï¼š</p>\n<ul>\n<li>https://blog.0x233.cn/2020/04/11/code-server/</li>\n</ul>\n",
    "frontmatter": {
      "title": "åœ¨çº¿Web IDE--code serveréƒ¨ç½²",
      "date": "2020-12-17"
    },
    "toc": "<ul>\n<li><a href=\"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">ç¯å¢ƒå‡†å¤‡</a></li>\n<li><a href=\"#code-server-%E9%83%A8%E7%BD%B2\">Code Server éƒ¨ç½²</a></li>\n<li><a href=\"#nginx-%E9%85%8D%E7%BD%AE\">Nginx é…ç½®</a></li>\n</ul>\n",
    "name": "åœ¨çº¿Web IDE--code serveréƒ¨ç½²",
    "id": "00e7f2b491b451d6822c03c6285ad404",
    "prev": {
      "name": "ä½¿ç”¨ Next.js SSG å’Œ Markdown åˆ›å»ºåšå®¢",
      "id": "7c63ed8670a327e4a87f9dc1a158bd10"
    },
    "next": {
      "name": "å¿«é€Ÿä¸Šæ‰‹React + graphql + apollo + node + express",
      "id": "3dc73e8be1ecf317881766ca2737b8fb"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/å¿«é€Ÿä¸Šæ‰‹React + graphql + apollo + node + express.md",
      "/home/zepang/WorkSpace/blog/posts/å¿«é€Ÿä¸Šæ‰‹React + graphql + apollo + node + express.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¯å¢ƒå‡†å¤‡\">ç¯å¢ƒå‡†å¤‡</h1>\n<ul>\n<li>\n<p>éœ€è¦nodeç¯å¢ƒï¼Œç‰ˆæœ¬å¤§äº10.0ï¼Œå»ºè®®ä½¿ç”¨nvmæ¥å®‰è£…node</p>\n</li>\n<li>\n<p>åŒ…ç®¡ç†å™¨å¯ä»¥æ˜¯npmæˆ–è€…yarn</p>\n</li>\n<li>\n<p>vscodeç¼–è¾‘å™¨</p>\n</li>\n<li>\n<p>æºç ï¼š<a href=\"https://github.com/zepang/practice-demo-with-graphql\">https://github.com/zepang/practice-demo-with-graphql</a></p>\n</li>\n</ul>\n<h1 id=\"ä»¥ä¸‹æ˜¯-react--graphql--apollo--node--express-åœ¨é¡¹ç›®ä¸­çš„é€»è¾‘å…³ç³»\">ä»¥ä¸‹æ˜¯ React + graphql + apollo + node + express åœ¨é¡¹ç›®ä¸­çš„é€»è¾‘å…³ç³»</h1>\n<p><img src=\"/images/react+graphql+apollo+node+express/work-follow.png\" alt=\"\"></p>\n<p>é¡¹ç›®åˆ†ä¸ºä¸¤éƒ¨åˆ†</p>\n<ul>\n<li>\n<p>å®¢æˆ·ç«¯ï¼ˆreact + apollo + graphqlï¼‰</p>\n</li>\n<li>\n<p>æœåŠ¡ç«¯ï¼ˆnode + express + apollo + graphql) + æ•°æ®åº“</p>\n</li>\n</ul>\n<h1 id=\"åˆå§‹åŒ–é¡¹ç›®\">åˆå§‹åŒ–é¡¹ç›®</h1>\n<h2 id=\"1-æ–°å»ºé¡¹ç›®ç›®å½•\">1. æ–°å»ºé¡¹ç›®ç›®å½•</h2>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">mkdir</span> graphql-books\n\n<span class=\"token function\">npm</span> init -y\n</code></pre></div>\n<h2 id=\"2-å®‰è£…reactå’Œreact-dom\">2. å®‰è£…reactå’Œreact-dom</h2>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> react react-dom --save\n</code></pre></div>\n<p>ä¸ºäº†å°½é‡æ¸…æ¥šçš„çœ‹åˆ°é¡¹ç›®çš„å†…å®¹ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨create-react-appè¿™æ ·çš„è„šæ‰‹æ¶ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¿˜éœ€é…ç½®ä¸€ä¸‹reacté¡¹ç›®çš„å¼€å‘ç¯å¢ƒ</p>\n<h2 id=\"3-æ­å»ºreactçš„å¼€å‘ç¯å¢ƒ\">3. æ­å»ºreactçš„å¼€å‘ç¯å¢ƒ</h2>\n<ul>\n<li>æ–°å»º <code>public/index.html</code></li>\n</ul>\n<p>reactçš„é¡¹ç›®å’Œvueä¸€æ ·éƒ½æ˜¯å•é¡µé¢åº”ç”¨ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå…¥å£çš„é¡µé¢æ–‡ä»¶ï¼Œå¡«å…¥ä¸‹é¢çš„å†…å®¹ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&#x3C;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ie=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>title</span><span class=\"token punctuation\">></span></span>Graphql-books<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>body</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token comment\">&#x3C;!-- è·ŸèŠ‚ç‚¹ --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>html</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<ul>\n<li>å®‰è£… webpack å’Œ webpack-dev-server</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> webpack webpack-cli webpack-dev-server --save-dev\n</code></pre></div>\n<p>å®‰è£…åŒ…çš„æ—¶å€™å°½é‡å®‰è£…æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœé‡åˆ°ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œåé¢å¯ä»¥æ…¢æ…¢è§£å†³ï¼Œä¹‹åçš„å®‰è£…åŒ…ä¹Ÿæ˜¯ä¸€æ ·çš„é€‰æ‹©ã€‚</p>\n<ul>\n<li>å®‰è£…babelæ¥å¤„ç†jsï¼Œjsxæ–‡ä»¶</li>\n</ul>\n<p>å¤„ç†jsxè¯­æ³•éœ€è¦ç”¨åˆ° <code>@babel/preset-react</code> é¢„è®¾</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev @babel/core @babel/cli @babel/preset-env @babel/preset-react\n</code></pre></div>\n<p>æ ¹ç›®å½•æ·»åŠ <code>.babelrc</code>æ–‡ä»¶ï¼Œå¡«å…¥ä¸‹é¢å†…å®¹</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">{\n  &#x26;quot;presets&#x26;quot;: [\n    &#x26;quot;@babel/preset-env&#x26;quot;,\n    &#x26;quot;@babel/preset-react&#x26;quot;\n  ]\n}</code></pre></div>\n<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<code>presets</code>çš„é…ç½®ä»æœ€åä¸€ä¸ªå¼€å§‹æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å…ˆå¤„ç†jsxï¼Œç„¶åå†å¤„ç†jsã€‚<code>plugins</code>çš„é¡ºåºç›¸åã€‚</p>\n<ul>\n<li>å®‰è£…babel-loaderå’Œ html-webpack-plugin</li>\n</ul>\n<p>ä¸ºäº†æ–¹ä¾¿æ¸…é™¤ä¸Šä¸€æ¬¡è¾“å‡ºçš„æ–‡ä»¶ï¼Œé¡ºä¾¿æŠŠ <code>clean-webpack-plugin</code>ä¹Ÿå®‰è£…ä¸€ä¸‹</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev babel-loader html-webpack-plugin clean-webpack-plugin\n</code></pre></div>\n<p>åˆ›å»º<code>webpack.client.config.js</code>ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">CleanWebpackPlugin</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clean-webpack-plugin'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">HtmlWebpackPlugin</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html-webpack-plugin'</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  mode<span class=\"token operator\">:</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">,</span>\n  entry<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src/client/index.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token string\">'bundle.js'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token special-escape escape\">\\.</span>js<span class=\"token anchor function\">$</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        loader<span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  devServer<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    port<span class=\"token operator\">:</span> <span class=\"token number\">3000</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">CleanWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      template<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'public/index.html'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æœ€ååœ¨ <code>package.json</code> æ–‡ä»¶ä¸­çš„\"scripts\"æ·»åŠ  <code>\"start\": \"webpack-dev-server --progress --hot --config webpack.client.config.js\"</code>ã€‚</p>\n<ul>\n<li>è¿è¡Œæœ¬åœ°å¼€å‘å‘½ä»¤</li>\n</ul>\n<p>åœ¨ <code>src/client/index.js</code>å¡«å…¥ä¸‹è¾¹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">React</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">ReactDOM</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-dom'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">App</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./App'</span>\n\n<span class=\"token maybe-class-name\">ReactDOM</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">App</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>åˆ›å»º <code>src/client/App.js</code>ï¼Œå¡«å…¥ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Component</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span><span class=\"token maybe-class-name\">Hello</span> world<span class=\"token operator\">!</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre></div>\n<p>æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥æ ¹ç›®å½•ï¼Œè¿è¡Œ<code>npm run start</code>ï¼Œå³å¯çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>\n<p><img src=\"/images/react+graphql+apollo+node+express/hello-world.png\" alt=\"\"></p>\n<p>æˆ‘ä»¬å‘ç°ç»ˆç«¯æ§åˆ¶å°è¾“å‡ºçš„å†…å®¹è¾ƒä¹±ï¼Œå¯ä»¥é€šè¿‡å®‰è£…å¹¶æ·»åŠ  <code>friendly-errors-webpack-plugin</code> æ¥æ¸…é™¤ä¸€äº›ä¸å‹å¥½çš„æç¤ºï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev friendly-errors-webpack-plugin\n</code></pre></div>\n<p>å¼•å…¥å¹¶åœ¨webpack pluginsä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">FriendlyErrorsWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  clearConsole<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  compilationSuccessInfo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    messages<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">You application is running here http://localhost:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<ul>\n<li>æ·»åŠ eslint</li>\n</ul>\n<p>æ‰¾ä¸€ç§å¤§å®¶æ¯”è¾ƒè®¤å¯ä½¿ç”¨å¹¿æ³›çš„è§„èŒƒçš„é…ç½®ï¼Œæ¯”å¦‚<code>eslint-config-airbnb</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">npx install-peerdeps --dev eslint-config-airbnb\n</code></pre></div>\n<p>è¿™é‡Œä½¿ç”¨äº†install-peerdepsè¿›è¡Œå®‰è£…ï¼Œinstall-peerdepså¯ä»¥å®‰è£…ä¾èµ–å¯¹ç­‰çš„ä¾èµ–åŒ…ï¼Œé¿å…å„ç§åŒ…ç‰ˆæœ¬ä¸å¯¹å‡ºç°å…¼å®¹é—®é¢˜ã€‚</p>\n<p>å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬å‘ç°åŒæ—¶å®‰è£…äº†å¦‚ä¸‹åŒ…ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">+ eslint-config-airbnb@18.0.1\n+ eslint-plugin-react-hooks@1.7.0\n+ eslint-plugin-jsx-a11y@6.2.3\n+ eslint-plugin-react@7.16.0\n+ eslint-plugin-import@2.18.2\n+ eslint@6.1.0\n</code></pre></div>\n<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªeslintçš„é…ç½®æ–‡ä»¶</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">npx eslint --init\n</code></pre></div>\n<p>é€‰æ‹© <code>to check syntax and find problems</code> æ£€æŸ¥è¯­æ³•å¹¶æ‰¾åˆ°é—®é¢˜ï¼Œåé¢çš„è‡ªè¡Œé€‰æ‹©</p>\n<p>æˆ–è€…ä½ ä¸ç”¨æå‰å®‰è£…åŒ…ï¼Œç›´æ¥ä½¿ç”¨ <code>npx eslint --init</code>ï¼Œæœ€åé€‰æ‹©ä¸€ç§å¸¸ç”¨çš„é…ç½®ï¼Œå®ƒè‡ªåŠ¨ä¼šè¿›è¡Œå®‰è£…</p>\n<p>ç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº†babelï¼Œæ‰€ä»¥è¿˜éœ€è¦å®‰è£…<code>babel-eslint</code>ï¼Œé¿å…babelè½¬æ¢çš„è¯­æ³•æŠ¥é”™é—®é¢˜ã€‚</p>\n<p>ä¸‹è¾¹æ˜¯æˆ‘çš„eslinté…ç½®å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  env<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    es6<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">extends</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'airbnb'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  globals<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token maybe-class-name\">Atomics</span><span class=\"token operator\">:</span> <span class=\"token string\">'readonly'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token maybe-class-name\">SharedArrayBuffer</span><span class=\"token operator\">:</span> <span class=\"token string\">'readonly'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ä½¿ç”¨ babel-eslint</span>\n  parser<span class=\"token operator\">:</span> <span class=\"token string\">'babel-eslint'</span><span class=\"token punctuation\">,</span>\n  parserOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    ecmaFeatures<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      jsx<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    ecmaVersion<span class=\"token operator\">:</span> <span class=\"token number\">2018</span><span class=\"token punctuation\">,</span>\n    sourceType<span class=\"token operator\">:</span> <span class=\"token string\">'module'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'react'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'react/jsx-filename-extension'</span><span class=\"token operator\">:</span> <span class=\"token string\">'off'</span> <span class=\"token comment\">// ä¹ æƒ¯ä½¿ç”¨ï¼Œä¸è¦æ±‚jsxä¸€å®šè¦å†™åœ¨jsxæ–‡ä»¶ä¸­</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>é‚£ä¹ˆè¿™æ ·ä¸€æ¥åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œç¼–è¾‘å™¨é’ˆå¯¹é”™è¯¯çš„æ ¼å¼è‡ªåŠ¨ç»™å‡ºæç¤ºï¼Œå¦‚æœä½ æƒ³ä¸€æ¬¡ä¿®å¤å¤šä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä½ è¿˜å¯ä»¥åœ¨package.jsonä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint src/client --fix\"</span><span class=\"token punctuation\">,</span>\n</code></pre></div>\n<ul>\n<li>é¢å¤–çš„å†…å®¹</li>\n</ul>\n<p><strong>ä½¿ç”¨ properties initializer(ç›´æ¥å£°æ˜ç±»å±æ€§)</strong></p>\n<p>åœ¨reactä¸­ï¼Œé€šå¸¸å£°æ˜stateçš„ä¸€å†™æ³•æ˜¯ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">state</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>è¿™æ˜¯å®˜æ–¹æ–‡æ¡£ä¸Šæä¾›çš„å†™æ³•ï¼Œä¹Ÿç¬¦åˆå’±ä»¬åˆšæ‰é…ç½®çš„airbnbçš„eslintè§„åˆ™ï¼Œstate in constructorã€‚</p>\n<p>å¦‚æœä½ è§‰å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ä¸‹è¾¹çš„å†™æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">state</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä½¿ç”¨è¿™ç§å†™æ³•ï¼Œéœ€è¦æ·»åŠ  <code>@babel/plugin-proposal-class-properties</code> è¿™ä¸ªåŒ…ï¼Œå› ä¸ºç›®å‰jsä¸æ”¯æŒè¿™ç§å†™æ³•ã€‚ä¸è¦å¿˜è®°åœ¨<code>.babelrc</code>ä¸­æ·»åŠ æ’ä»¶é…ç½®é¡¹</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"@babel/plugin-proposal-class-properties\"</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p><strong>ä¸€äº›å¿…è¦çš„loaderé…ç½®</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token special-escape escape\">\\.</span>css<span class=\"token anchor function\">$</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  use<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'style-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n  test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token special-escape escape\">\\.</span><span class=\"token group punctuation\">(</span>png<span class=\"token alternation keyword\">|</span>jpe<span class=\"token quantifier number\">?</span>g<span class=\"token alternation keyword\">|</span>gif<span class=\"token alternation keyword\">|</span>svg<span class=\"token group punctuation\">)</span><span class=\"token anchor function\">$</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token operator\">:</span> <span class=\"token string\">'url-loader'</span><span class=\"token punctuation\">,</span>\n  options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    limit<span class=\"token operator\">:</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">,</span>\n    fallback<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      loader<span class=\"token operator\">:</span> <span class=\"token string\">'file-loader'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        name<span class=\"token operator\">:</span> <span class=\"token string\">'static/[name].[hash:7].[ext]'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</code></pre></div>\n<p>è‡ªè¡Œå®‰è£…å¯¹åº”çš„loader</p>\n<h2 id=\"4-æ­å»ºnode--graphqlçš„åç«¯çš„æœåŠ¡\">4. æ­å»ºnode + graphqlçš„åç«¯çš„æœåŠ¡</h2>\n<p>å…³äºgraphqlçš„åŸºæœ¬æ¦‚å¿µï¼ŒåŸºæœ¬ä½¿ç”¨å‡å¯æŸ¥è¯¢Graphqlçš„å®˜ç½‘<a href=\"https://graphql.github.io\">https://graphql.github.io</a></p>\n<p>å…³äºgraphqlçš„å®è·µåº”ç”¨çš„è¯ï¼Œå¯ä»¥æŸ¥ä¸‹How to Graphql è¿™ä¸ªç½‘ç«™<a href=\"https://www.howtographql.com\">https://www.howtographql.com</a></p>\n<ul>\n<li>å¼€å¯express http æœåŠ¡</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> express --save\n</code></pre></div>\n<p>åˆ›å»º <code>src/server/index.js</code>æ–‡ä»¶ï¼Œå¡«å…¥å¦‚ä¸‹å†…å®¹:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">express</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'express'</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello world'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Listening on port 8000!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>åœ¨å¼€å‘ç¯å¢ƒä¸‹è‡ªåŠ¨é‡å¯åº”ç”¨ï¼Œéœ€è¦å®‰è£…<code>nodemon</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save-dev nodemon</code></pre></div>\n<p>ä¸ºäº†æœ‰æ›´å¥½çš„è¯­æ³•æ”¯æŒï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…<code>@babel/node</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save-dev @babel/node @babel/core</code></pre></div>\n<p>åœ¨package.jsonä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶å°†ä¹‹å‰startå‘½ä»¤åç§°æ¢æˆclientï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"server\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nodemon --exec babel-node src/server/index.js --watch\"</span>\n</code></pre></div>\n<p>è¿™æ ·å°±å¯ä»¥é€šè¿‡<code>npm run server</code>æ¥å¯åŠ¨expressæœåŠ¡ã€‚</p>\n<p>æ¥ä¸‹æ¥æ·»åŠ ä¸€äº›å¸¸ç”¨çš„åŒ…</p>\n<p>helmet: å®‰å…¨</p>\n<p>cors: è·¨ç«™è®¿é—®</p>\n<p>compressionï¼šå‹ç¼©</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save helmet cors compression</code></pre></div>\n<ul>\n<li>æ•´åˆexpresså’Œapollo</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save apollo-server-express graphql graphql-tools</code></pre></div>\n<p>åˆ›å»º<code>src/server/services/graphql/index.js</code>,<code>src/server/services/graphql/schema.js</code>, <code>src/server/services/graphql/resolvers.js</code></p>\n<p>åœ¨ <code>graphql/index.js</code>ä¸­åˆ›å»º<code>apollo-server</code>å®ä¾‹å¹¶æš´éœ²</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">ApolloServer</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'apollo-server-express'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> makeExecutableSchema <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'graphql-tools'</span>\n\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">Resolvers</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./resolvers'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">Schema</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./schema'</span>\n\n<span class=\"token keyword\">const</span> executableSchema <span class=\"token operator\">=</span> <span class=\"token function\">makeExecutableSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Schema</span><span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Resolvers</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  schema<span class=\"token operator\">:</span> executableSchema<span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> req <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> req\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> server\n</code></pre></div>\n<p>ç„¶åï¼Œåœ¨<code>server/index.js</code>å¼•å…¥å®ä¾‹ï¼Œå¹¶é€šè¿‡å®ä¾‹çš„<code>applyMiddleware</code>æ–¹æ³•ï¼Œä»¥ä¸­é—´ä»¶çš„æ–¹å¼æ³¨å†Œ<code>graphql</code>æœåŠ¡ã€‚ä¸‹è¾¹æ˜¯<code>express-graphql</code>å’Œ<code>apollo-server-express</code>åŒ…æ³¨å†Œ<code>graphql</code>æ–¹å¼ï¼š</p>\n<p>express-graphql</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> graphqlHTTP <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express-graphql'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ...</span>\napp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'graphql'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">graphqlHTTP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ...</span>\n</code></pre></div>\n<p>apollo-server-express</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">ApolloServer</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'apollo-server-express'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nserver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">applyMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>app<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ...</span>\n</code></pre></div>\n<p>ä¸¤ç§æ–¹å¼çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>\n<ul>\n<li>logæ—¥å¿—æ”¶é›†</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install winston</code></pre></div>\n<p>åˆ›å»º<code>src/server/helper/logger.js</code>æ–‡ä»¶ï¼Œå¡«å…¥ä¸‹è¾¹å†…å®¹</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">winston</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'winston'</span>\n\n<span class=\"token keyword\">const</span> transports <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">winston<span class=\"token punctuation\">.</span>transports<span class=\"token punctuation\">.</span>File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token string\">'error.log'</span><span class=\"token punctuation\">,</span>\n    level<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">winston<span class=\"token punctuation\">.</span>transports<span class=\"token punctuation\">.</span>File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token string\">'combined.log'</span><span class=\"token punctuation\">,</span>\n    level<span class=\"token operator\">:</span> <span class=\"token string\">'verbose'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">const</span> logger <span class=\"token operator\">=</span> winston<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  level<span class=\"token operator\">:</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span>\n  format<span class=\"token operator\">:</span> winston<span class=\"token punctuation\">.</span><span class=\"token property-access\">format</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  transports\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  logger<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">winston<span class=\"token punctuation\">.</span>transports<span class=\"token punctuation\">.</span>Console</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    format<span class=\"token operator\">:</span> winston<span class=\"token punctuation\">.</span><span class=\"token property-access\">format</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">simple</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> logger\n</code></pre></div>\n<p>ç„¶ååœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹ç›´æ¥å¼•å…¥ä½¿ç”¨ï¼Œä¾‹ï¼š<code>logger.log({ level: 'info', message: 'Post was created' })</code>ï¼Œæ ¹æ®levelçš„ä¸åŒä¼šæ”¶é›†åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚</p>\n<h2 id=\"5-é“¾æ¥æ•°æ®åº“\">5. é“¾æ¥æ•°æ®åº“</h2>\n<ul>\n<li>å®‰è£…æœ¬åœ°mysql</li>\n</ul>\n<p>æ ¹æ®ä¸åŒçš„ç³»ç»Ÿç¯å¢ƒé€‰æ‹©ä¸åŒçš„å®‰è£…æ–¹å¼ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ubuntu18.04ï¼Œä¸‹è¾¹æ˜¯å®‰è£…æ­¥éª¤ï¼š</p>\n<ol>\n<li>æ›´æ–°å’Œå‡çº§ç³»ç»ŸåŒ…</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo apt-get update &#x26;amp;&#x26;amp; sudo apt-get upgrade</code></pre></div>\n<ol start=\"2\">\n<li>å®‰è£…MySQLã€PHPã€apache</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo apt-get install apache2 mysql-server php php-pear php-mysql</code></pre></div>\n<p>å®‰è£…å®Œæ¯•ä¹‹åä½¿ç”¨<code>sudo -i</code>è¿›å…¥rootè´¦æˆ·ï¼Œè¿è¡Œä¸‹è¾¹å‘½ä»¤</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">mysql_secure_installation</code></pre></div>\n<p>å¦‚æœå‡ºç°é”™è¯¯<code>Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock'</code>ï¼Œè¯·ç›´æ¥åœæ­¢MySQLï¼Œç„¶åé‡å¯ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mysql stop\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mysql start\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">!</span>-- å†æ¬¡è¿è¡Œ --<span class=\"token operator\">></span>\nmysql_secure_installation\n</code></pre></div>\n<p>é™¤äº†è¦æ³¨æ„è®¾ç½®å¯†ç ä¹‹å¤–ï¼Œå…¶ä»–çš„ä¸ç”¨ç®¡éƒ½å¯ä»¥</p>\n<p>ç„¶åé€šè¿‡ <code>mysql -u root</code> è¿›å…¥MySQLçš„shellç•Œé¢ï¼Œåˆ›å»ºä¸€ä¸ªæœ¬åœ°å¼€å‘çš„ç”¨æˆ·ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">GRANT ALL PRIVILEGES ON *.* TO &#x26;#39;devuser&#x26;#39;@&#x26;#39;%&#x26;#39; IDENTIFIED BY &#x26;#39;devuser&#x26;#39;;</code></pre></div>\n<ol>\n<li>å®‰è£…phpmyadmin</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo apt-get install phpmyadmin</code></pre></div>\n<p>å®‰è£…çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå½“è®©ä½ é€‰æ‹©web serverçš„æ—¶å€™é€‰æ‹© apache2</p>\n<p>å»ºç«‹è½¯é“¾</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sudo ln -s /usr/share/phpmyadmin /var/www/html/phpmyadmin</code></pre></div>\n<p>é€šè¿‡æµè§ˆå™¨è®¿é—®<code>http://localhost/phpmyadmin</code>å³å¯ã€‚å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·ä¸Šç½‘æŸ¥é˜…èµ„æ–™ã€‚</p>\n<ul>\n<li>nodejs é“¾æ¥æ•°æ®åº“</li>\n</ul>\n<p>è¿æ¥æ•°æ®åº“ä¹‹å‰ï¼Œéœ€è¦åˆ›å»ºæ•°æ®åº“</p>\n<p>æ‰“å¼€phpmyadminçš„sqlé¢æ¿ï¼Œè¾“å…¥å¹¶æ‰§è¡Œä¸‹è¾¹è¯­å¥</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">CREATE DATABASE graphbook_dev CHARACTER SET utf8 COLLATE utf8_general_ci;</code></pre></div>\n<p>å®‰è£…å¯¹åº”çš„nodeåŒ…</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save sequelize mysql2</code></pre></div>\n<p>æ–°å»º<code>src/server/database/index.js</code>ï¼Œå¡«å…¥ä¸‹è¾¹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">Sequelize</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'sequelize'</span>\n\n<span class=\"token keyword\">const</span> sequelize <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sequelize</span><span class=\"token punctuation\">(</span><span class=\"token string\">'graphbook_dev'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'devuser'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'devuser'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  host<span class=\"token operator\">:</span> <span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span>\n  dialect<span class=\"token operator\">:</span> <span class=\"token string\">'mysql'</span><span class=\"token punctuation\">,</span>\n  pool<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    max<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n    min<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    acquire<span class=\"token operator\">:</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">,</span>\n    idle<span class=\"token operator\">:</span> <span class=\"token number\">10000</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>å…³äº<code>sequelize</code>çš„ä½¿ç”¨ï¼Œå¯ä»¥å»çœ‹çœ‹ç›¸å…³æ–‡æ¡£ï¼Œå¦‚æœä½ æƒ³å¿«é€Ÿä¸Šæ‰‹ä¸€ä¸ªä¸œè¥¿ï¼Œæˆ‘è§‰å¾—è¾¹å­¦è¾¹ç”¨å°±å¥½äº†ã€‚æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹æ•°æ®åº“èƒ½å¦è¿æ¥ï¼Œå‡ºç°é—®é¢˜çš„è¯ï¼Œè¯·å¯¹ç…§æ§åˆ¶å°çš„errorä¿¡æ¯è‡ªè¡Œè§£å†³ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">sequelize\n  <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Connection has been established successfully.'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Unable to connect to the database:'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>é€šå¸¸æ ¹æ®ç¯å¢ƒçš„ä¸åŒï¼Œéœ€è¦æ›´æ¢æ•°æ®åº“çš„è¿æ¥é…ç½®ã€‚</p>\n<p>åˆ›å»º<code>src/server/config/index.js</code>ï¼Œæ·»åŠ <code>development</code>å’Œ<code>production</code>ç¯å¢ƒä¸‹çš„é…ç½®ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  development<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    username<span class=\"token operator\">:</span> <span class=\"token string\">'devuser'</span><span class=\"token punctuation\">,</span>\n    password<span class=\"token operator\">:</span> <span class=\"token string\">'devuser'</span><span class=\"token punctuation\">,</span>\n    database<span class=\"token operator\">:</span> <span class=\"token string\">'graphbook_dev'</span><span class=\"token punctuation\">,</span>\n    host<span class=\"token operator\">:</span> <span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span>\n    dialect<span class=\"token operator\">:</span> <span class=\"token string\">'mysql'</span><span class=\"token punctuation\">,</span>\n    operatorsAliases<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    pool<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      max<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n      min<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      acquire<span class=\"token operator\">:</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">,</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token number\">10000</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  production<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    host<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">host</span><span class=\"token punctuation\">,</span>\n    username<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">username</span><span class=\"token punctuation\">,</span>\n    password<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">password</span><span class=\"token punctuation\">,</span>\n    database<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">database</span><span class=\"token punctuation\">,</span>\n    logging<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    dialect<span class=\"token operator\">:</span> <span class=\"token string\">'mysql'</span><span class=\"token punctuation\">,</span>\n    operatorsAliases<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    pool<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      max<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n      min<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      acquire<span class=\"token operator\">:</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">,</span>\n      idle<span class=\"token operator\">:</span> <span class=\"token number\">10000</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ç„¶ååœ¨<code>database/index.js</code>ä¸­å¼•å…¥é…ç½®é¡¹ã€‚</p>\n<ul>\n<li>models çš„ migrations</li>\n</ul>\n<p>åˆ›å»º<code>src/server/models</code>å’Œ<code>src/server/migrations</code>æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«å­˜æ”¾sequelizeçš„æ¨¡å‹æ–‡ä»¶ï¼ˆmodelsï¼‰å’Œè¿ç§»æ–‡ä»¶ï¼ˆmigrationsï¼‰ã€‚</p>\n<p>æ¨¡å‹æ–‡ä»¶é€šå¸¸æ˜¯ç”¨æ¥å®šä¹‰æ¨¡å‹å’Œæ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„ã€‚æ¯”å¦‚åˆ—å­—æ®µç±»å‹ï¼Œåˆ—å­—æ®µæ ¡éªŒç­‰ã€‚</p>\n<p>è¿ç§»æ–‡ä»¶è®°å½•äº†å¦‚ä½•å°†æ•°æ®åº“æ›´æ–°æˆ–è€…æ¢å¤åˆ°ç›®æ ‡çŠ¶æ€ï¼Œä½ å¯ä»¥è®¤ä¸ºç±»ä¼¼gitè¿™ä¸€ç±»çš„ç‰ˆæœ¬å·¥å…·çš„logè®°å½•ã€‚</p>\n<p>å…³äºsequelizeçš„æ›´å¤šå†…å®¹ï¼Œè¯·çœ‹sequelizeçš„æ–‡æ¡£å†…å®¹ã€‚</p>\n<p>é€šå¸¸æˆ‘ä»¬åˆ›å»ºmodelsæˆ–è€…migrationsçš„æ—¶å€™ï¼Œä¸ºäº†æ–¹ä¾¿ä¼šä½¿ç”¨sequelize-cliå·¥å…·ï¼Œé€šè¿‡å·¥å…·æä¾›çš„å‘½ä»¤è¡Œå‘½ä»¤æ¥è¿›è¡Œåˆ›å»ºmodelså’Œmigrationsæ–‡ä»¶ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install -g sequelize-cli</code></pre></div>\n<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize model:generate --models-path src/server/models --name Post --attributes text:text --migrations-path src/server/migrations</code></pre></div>\n<p><code>src/server/models/post.js</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sequelize<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">DataTypes</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">Post</span> <span class=\"token operator\">=</span> sequelize<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">define</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Post'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    text<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">DataTypes</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TEXT</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">associate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">models</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// associations can be defined here</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>é€šè¿‡è°ƒç”¨<code>sequelize.define</code>æ–¹æ³•å®šä¹‰<code>Post</code>çš„æ¨¡å‹ï¼Œæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æ¨¡å‹çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«æ¨¡å‹çš„å±æ€§å’Œå¯¹åº”çš„æ•°æ®ç±»å‹çš„é˜Ÿå½¢ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯é…ç½®å¯¹è±¡ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        allowNull<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        autoIncrement<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        primaryKey<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      text<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TEXT</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      createdAt<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        allowNull<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DATE</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      updatedAt<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        allowNull<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DATE</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dropTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>migrationæ–‡ä»¶ä¸»è¦æœ‰ä¸¤ä¸ªå‡½æ•°upå’Œdownã€‚</p>\n<p>upå‡½æ•°ä¸­è®°å½•çš„æ˜¯å½“æˆ‘ä»¬è¿è¡Œmigrationçš„æ—¶å€™çš„åŠ¨ä½œï¼Œä¸Šè¾¹çš„upå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªPostsè¡¨ï¼Œç„¶åå®šä¹‰idï¼Œtextï¼ŒcreatedAtï¼ŒupdatedAtåˆ—ã€‚</p>\n<p>downå‡½æ•°ä¼šåœ¨å›æ»šæˆ–è€…å–æ¶ˆmigrationçš„æ—¶å€™æ‰§è¡Œï¼Œæ¯”å¦‚ä¸Šé¢çš„downå‡½æ•°ä¼šå–æ¶ˆæˆ‘ä»¬åˆ›å»ºçš„Postsè¡¨ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬å°±åˆ›å»ºäº†ä¸€ä¸ªpostçš„æ¨¡å‹æ–‡ä»¶å’Œè¿ç§»æ–‡ä»¶ã€‚</p>\n<p>å¦‚æœä½ çœ‹äº†sequelizeçš„migrationçš„éƒ¨åˆ†æ–‡ä»¶å†…å®¹ï¼Œä½ å°±ä¼šçŸ¥é“ï¼Œåœ¨è¿è¡Œmigrationä¹‹å‰è¿˜éœ€è¦æä¾›æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ã€‚æ­£ç¡®çš„æ­¥éª¤æ˜¯åœ¨é¡¹ç›®çš„ç›®å½•ä¸‹ä½¿ç”¨<code>sequelize init</code> å‘½ä»¤æ¥åˆå§‹åŒ–åˆ›å»ºä»¥ä¸‹ä¼šç”¨çš„æ–‡ä»¶ç›®å½•ï¼š</p>\n<ul>\n<li>config, contains config file, which tells CLI how to connect  with database</li>\n<li>models, contains all models for your project</li>\n<li>migrations, contains all migration files</li>\n<li>seeders, contains all seed files</li>\n</ul>\n<p>æˆ‘ä»¬ä¹‹å‰é€šè¿‡æ‰‹åŠ¨çš„æ–¹å¼åˆ›å»ºäº†è¿™å‡ ä¸ªæ–‡ä»¶ï¼Œå°±ä¸éœ€è¦é€šè¿‡å‘½ä»¤å†æ¬¡åˆ›å»ºäº†ã€‚</p>\n<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæœ¬æ¬¡çš„è¿ç§»ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize\tdb:migrate\t--migrations-path\tsrc/server/migrations\t--config src/server/config/index.js</code></pre></div>\n<p>åœ¨<code>localhost/phpmyadmin</code>å¯ä»¥çœ‹åˆ°æ•°æ®åº“å·²ç»åˆ›å»ºäº†æˆ‘ä»¬éœ€è¦çš„Postsè¡¨ï¼š</p>\n<p><img src=\"/images/react+graphql+apollo+node+express/Posts-table.jpg\" alt=\"\"></p>\n<p>è™½ç„¶æˆ‘ä»¬åˆ›å»ºäº†modelï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰å¼•å…¥å®ƒä»¬ï¼Œç°åœ¨éœ€è¦å°†è¿™äº›modelåœ¨<code>src/server/models/index.js</code>ä¸­ç»Ÿä¸€å¼•å…¥ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">fs</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'fs'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">path</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'path'</span>\n\n<span class=\"token keyword\">const</span> basename <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">basename</span><span class=\"token punctuation\">(</span>__filename<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getModels</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sequelize</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> models <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  fs\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readdirSync</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span>file <span class=\"token operator\">!==</span> basename<span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> model <span class=\"token operator\">=</span> sequelize<span class=\"token punctuation\">.</span><span class=\"token keyword module\">import</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      models<span class=\"token punctuation\">[</span>model<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> model\n\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">[</span>model<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">associate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        models<span class=\"token punctuation\">[</span>model<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">associate</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> models\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>sequelizeæä¾›äº†<code>import</code>è¿™ä¸ªå®ä¾‹æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯ <code>import</code> æ–¹æ³•çš„æºç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span><span class=\"token punctuation\">(</span>importPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// is it a relative path?</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">normalize</span><span class=\"token punctuation\">(</span>importPath<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>importPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// make path relative to the caller</span>\n    <span class=\"token keyword\">const</span> callerFilename <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Utils</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getFileName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> callerPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dirname</span><span class=\"token punctuation\">(</span>callerFilename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    importPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>callerPath<span class=\"token punctuation\">,</span> importPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">importCache</span><span class=\"token punctuation\">[</span>importPath<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> defineCall <span class=\"token operator\">=</span> arguments<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">></span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span>importPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> defineCall <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ES6 module compatibility</span>\n      defineCall <span class=\"token operator\">=</span> defineCall<span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">importCache</span><span class=\"token punctuation\">[</span>importPath<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">defineCall</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">DataTypes</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">importCache</span><span class=\"token punctuation\">[</span>importPath<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä¸»è¦å°±åšäº†ä¸¤ä»¶äº‹ï¼Œç¬¬ä¸€ï¼Œé˜²æ­¢é‡å¤å¼•å…¥modelï¼Œç”¨äº†ä¸€ä¸ªimportCacheå¯¹è±¡ç¼“å­˜äº†å·²ç»å¼•å…¥çš„modelï¼›ç¬¬äºŒï¼Œå¼•å…¥modelæ–‡ä»¶çš„å®é™…ä¸Šæ˜¯å¼•å…¥åˆ›å»ºmodelçš„æ–¹æ³•ï¼Œè¿™é‡Œç›´æ¥è°ƒç”¨äº†åˆ›å»ºmodelçš„æ–¹æ³•ï¼Œå¹¶ä¼ å…¥äº†éœ€è¦çš„å‚æ•°ï¼Œè¿”å›å½“å‰çš„modelå¯¹è±¡ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬åœ¨<code>src/server/database/index.js</code>ä¸­å¼•å…¥modelsï¼Œå¹¶ä½œä¸ºæš´éœ²å¯¹è±¡å±æ€§ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">getModels</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'../models'</span>\n\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">const</span> models <span class=\"token operator\">=</span> <span class=\"token function\">getModels</span><span class=\"token punctuation\">(</span>sequelize<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token spread operator\">...</span>models<span class=\"token punctuation\">,</span>\n  sequelize<span class=\"token punctuation\">,</span>\n  <span class=\"token maybe-class-name\">Sequelize</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>seeders</li>\n</ul>\n<p>å½“æˆ‘ä»¬éœ€è¦ç»™æ•°æ®åº“æ·»åŠ ä¸€äº›å‡æ•°æ®æˆ–è€…åˆå§‹åŒ–ä¸€äº›æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°seederï¼Œè¿™äº›æ•°æ®é€šå¸¸ä¹Ÿå«åšç§å­æ•°æ®ã€‚</p>\n<p>sequelize-cli ä¸ºæˆ‘ä»¬æä¾›äº†seedå‘½ä»¤ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºseedersæ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾seedersï¼Œè¿è¡Œä¸‹è¾¹å‘½ä»¤ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize seed:generate --name fake-posts --seeders-path src/server/seeders</code></pre></div>\n<p><img src=\"/images/react+graphql+apollo+node+express/seeder.png\" alt=\"\"></p>\n<ul>\n<li>ç»“åˆsequelizeå’Œapollo</li>\n</ul>\n<p>ç”¨æˆ·é€šè¿‡graphqlå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªqueryæˆ–è€…mutationçš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡å­—æ®µå¯¹åº”çš„resolveré‡Œçš„é€»è¾‘æ¥è¿”å›æˆ–è€…æ›´æ–°æ•°æ®ã€‚ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†dbçš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦å°†dbå¼•å…¥åˆ°resolverå‡½æ•°ä¸­ï¼Œè®©sequelizeå’Œapolloç»“åˆèµ·æ¥ã€‚</p>\n<p>æˆ‘ä»¬å°†dbé€šè¿‡å‚æ•°çš„æ–¹å¼ä¼ å…¥åˆ°resolveré‡Œè¾¹ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯¹ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶åšä»¥ä¸‹ä¿®æ”¹ï¼š</p>\n<p><code>src/server/graphql/resolvers</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">resolver</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> db <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Post</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> db\n  <span class=\"token keyword\">const</span> resolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token maybe-class-name\">RootQuery</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">posts</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> order<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">'createdAt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DESC'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ....</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">return</span> resolvers\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>src/server/graphql/index.js</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">utils</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> executableSchema <span class=\"token operator\">=</span> <span class=\"token function\">makeExecutableSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    typeDefs<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Schema</span><span class=\"token punctuation\">,</span>\n    resolvers<span class=\"token operator\">:</span> <span class=\"token function\">resolver</span><span class=\"token punctuation\">(</span>utils<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    schema<span class=\"token operator\">:</span> executableSchema<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> req <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> req\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> server\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><code>src/server/index.js</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">graphql</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./graphql'</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">utils</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  graphql<span class=\"token operator\">:</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span>utils<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p><code>src/server/index.js</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">serviceLoader</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./services'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">db</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./database'</span>\n\n<span class=\"token keyword\">const</span> services <span class=\"token operator\">=</span> <span class=\"token function\">serviceLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  db\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ...</span>\n</code></pre></div>\n<p>è‡³æ­¤ï¼Œå·²ç»æ­£å¸¸çš„è¿æ¥æ•°æ®åº“</p>\n<h2 id=\"6-sequelize--graphqlä½¿ç”¨\">6. sequelize + graphqlä½¿ç”¨</h2>\n<ul>\n<li>modelå…³è”å…³ç³»</li>\n</ul>\n<p>è¿™é‡Œä»¥userå’Œpostä¸ºä¾‹</p>\n<p>é¦–å…ˆéœ€è¦åˆ›å»ºuserçš„modelå’Œmigration</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize mode:generate --models-path src/server/models --name User --attributes avatar:string,username:string</code></pre></div>\n<p>ä¸ºäº†å»ºç«‹userå’Œpostçš„å…³è”ï¼Œæˆ‘ä»¬éœ€è¦ç»™postæ·»åŠ å¤–é”®ï¼Œè¿™ä¸ªå¤–é”®ä¸ºuserIdï¼Œåˆ›å»ºä¸€ä¸ªæ·»åŠ å¤–é”®çš„è¿ç§»ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize migration:create --migrations-path src/server/migrations --name add-userId-to-post</code></pre></div>\n<ul>\n<li>æ·»åŠ å¤–é”®</li>\n</ul>\n<p>å…³äºsequelizeæ·»åŠ å¤–é”®çš„è¯­æ³•ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£ï¼Œæ‰¾åˆ°æˆ‘ä»¬åˆ›å»ºçš„è¿ç§»ç›´æ¥å¡«å…¥ä¸‹é¢å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'userId'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addConstraint</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'userId'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'foreign key'</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">:</span> <span class=\"token string\">'fk_user_id'</span><span class=\"token punctuation\">,</span>\n        references<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          table<span class=\"token operator\">:</span> <span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span>\n          field<span class=\"token operator\">:</span> <span class=\"token string\">'id'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        onDelete<span class=\"token operator\">:</span> <span class=\"token string\">'cascade'</span><span class=\"token punctuation\">,</span>\n        onUpdate<span class=\"token operator\">:</span> <span class=\"token string\">'cascade'</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeConstraint</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fk_user_id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'userId'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>è¿è¡Œmigration</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize db:migrate:all --migrations-path src/server/migrations --config src/server/config/index.js</code></pre></div>\n<p>å¦‚æœå‡ºç°æŠ¥é”™ï¼Œè¯·è¿è¡Œä¸‹è¾¹çš„å‘½ä»¤å–æ¶ˆè¿ç§»</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize db:migrate:undo:all --migrations-path src/server/migrations --config src/server/config/index.js</code></pre></div>\n<p>æˆ‘åœ¨å†™çš„æ—¶å€™å‡ºç°å› ä¸ºæ•°æ®åº“åç§°å†™é”™ï¼Œä½†æ˜¯åˆåˆ›å»ºäº†å¤–é”®ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥åˆ é™¤ userId å­—æ®µã€‚åœ¨è¿™ç§æƒ…å†µï¼Œå¦‚æœsequelizeæä¾›çš„apiæ— æ³•å–æ¶ˆè¿ç§»çš„æƒ…å†µä¸‹ï¼Œè¯·å°è¯•ç›´æ¥ä½¿ç”¨æ•°æ®åº“çš„shellï¼Œå…ˆåˆ é™¤å¤–é”®ï¼Œåœ¨åˆ é™¤åˆ—å­—æ®µï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µçš„ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">ALTER TABLE tbl_name DROP FOREIGN KEY fk_symbol;\nALTER TABLE Posts DROP userId;</code></pre></div>\n<ul>\n<li>å…³è”model</li>\n</ul>\n<p>é™¤äº†ç»™æ•°æ®åº“æ·»åŠ å¤–é”®ä¹‹å¤–ï¼Œè¿˜éœ€è¦é€šè¿‡sequelizeæä¾›çš„ç‰¹å®šæ–¹å¼ï¼Œå…³è”å¯¹åº”çš„modelã€‚</p>\n<p>æ¯”å¦‚è¿™é‡Œçš„userå’Œpostï¼Œå°±æ˜¯1å¯¹Nçš„å…³ç³»ã€‚</p>\n<p>ä¸‹è¾¹æ˜¯sequelizeçš„è¯­æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// post.js</span>\n<span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">associate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">models</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// associations can be defined here</span>\n  <span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">belongsTo</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">User</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// user.js</span>\n<span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">associate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">models</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// associations can be defined here</span>\n  <span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasMany</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">Post</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>å¦å¤–è¿™é‡Œçº æ­£ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä¹‹å‰åœ¨<code>src/server/models/index.js</code>ä¸­å¼•å…¥modelsçš„å†™æ³•æœ‰å†™é—®é¢˜ï¼Œä¸‹è¾¹æ˜¯ä¿®æ­£çš„å†™æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getModels</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sequelize</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> models <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  fs\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readdirSync</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span>file <span class=\"token operator\">!==</span> basename<span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> model <span class=\"token operator\">=</span> sequelize<span class=\"token punctuation\">.</span><span class=\"token keyword module\">import</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      models<span class=\"token punctuation\">[</span>model<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> model\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// ç»™associateå‡½æ•°ä¼ å…¥çš„modelså¿…é¡»æ˜¯åŒ…å«æ‰€æœ‰modelsçš„å¯¹è±¡</span>\n  <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">associate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      models<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">associate</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> models\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>è™½ç„¶æˆ‘ä»¬ç°åœ¨å·²ç»å…³è”äº†userå’Œpostï¼Œä½†æ˜¯ç›®å‰æ•°æ®åº“ä¸­useræ˜¯æ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™useræ·»åŠ ä¸€äº›ç§å­æ•°æ®ã€‚å¦å¤–ï¼Œè™½ç„¶ä¹‹å‰å·²ç»æ·»åŠ äº†postçš„ç§å­æ•°æ®ï¼Œä½†æ˜¯userIdå¹¶æ²¡æœ‰æŒ‡å®šæ­£ç¡®çš„userIdã€‚</p>\n<p>é¦–å…ˆå°†å–æ¶ˆä¹‹å‰çš„postç§å­æ•°æ®</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize db:seed:undo:all --seeders-path src/server/seeders --config src/server/config/index.js</code></pre></div>\n<p>ç„¶ååˆ é™¤ä¹‹å‰çš„<code>xxxxxx-fake-post.js</code>æ–‡ä»¶ï¼Œåˆ›å»ºfake-user ç§å­æ•°æ®ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize seed:generate\t--name\tfake-users\t--seeders-path\tsrc/server/seeders</code></pre></div>\n<p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkInsert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      avatar<span class=\"token operator\">:</span> <span class=\"token string\">'/uploads/avatar1.png'</span><span class=\"token punctuation\">,</span>\n      username<span class=\"token operator\">:</span> <span class=\"token string\">'TestUser'</span><span class=\"token punctuation\">,</span>\n      createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      updatedAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      avatar<span class=\"token operator\">:</span> <span class=\"token string\">'/uploads/avatar2.png'</span><span class=\"token punctuation\">,</span>\n      username<span class=\"token operator\">:</span> <span class=\"token string\">'TestUser2'</span><span class=\"token punctuation\">,</span>\n      createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      updatedAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkDelete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>åˆ›å»ºfake-postsç§å­æ•°æ®ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize seed:generate\t--name\tfake-posts\t--seeders-path\tsrc/server/seeders</code></pre></div>\n<p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token property-access\">sequelize</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">query</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'SELECT id from Users;'</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">users</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> usersRows <span class=\"token operator\">=</span> users<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkInsert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        text<span class=\"token operator\">:</span> <span class=\"token string\">'Lorem ipsum 2'</span><span class=\"token punctuation\">,</span>\n        userId<span class=\"token operator\">:</span> usersRows<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">,</span>\n        createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        updatedAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        text<span class=\"token operator\">:</span> <span class=\"token string\">'Lorem ipsum 2'</span><span class=\"token punctuation\">,</span>\n        userId<span class=\"token operator\">:</span> usersRows<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">,</span>\n        createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        updatedAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkDelete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Posts'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n</code></pre></div>\n<p>åˆ é™¤åœ¨åˆ›å»ºä¸»è¦éœ€è¦åˆ›å»ºpostç§å­æ•°æ®çš„æ—¶å€™éœ€è¦æŸ¥è¯¢userï¼Œæ‰€ä»¥éœ€è¦æå‰æ·»åŠ useræ•°æ®</p>\n<p>è¿è¡Œseedå‘½ä»¤</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize db:seed:all --seeders-path src/server/seeders --config src/server/config/index.js</code></pre></div>\n<p>ä½¿ç”¨phpmyadminæŸ¥çœ‹ä¸€ä¸‹ç»“æœ</p>\n<p><img src=\"/images/react+graphql+apollo+node+express/userId-post.png\" alt=\"\"></p>\n<p><img src=\"/images/react+graphql+apollo+node+express/userId-user.png\" alt=\"\"></p>\n<p>å›¾ä¸­userçš„idå’Œpostçš„idæ˜¯æ•°æ®åº“è‡ªå¢çš„idï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿ç§»å›æ»šçš„ç„¶åå†åˆ›å»ºæ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸ªidå¹¶ä¸ä¼šä»1å¼€å§‹ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºpostçš„ç§å­æ•°æ®çš„æ—¶å€™ï¼Œæå‰ä½¿ç”¨äº†queryæŸ¥è¯¢äº†å­˜åœ¨çš„userçš„id</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰çš„queryæŸ¥è¯¢æ‰€æœ‰çš„postï¼š</p>\n<p><img src=\"/images/react+graphql+apollo+node+express/insomnia-post-user-null.png\" alt=\"\"></p>\n<p>ç„¶åæˆ‘ä»¬å‘ç°posté‡Œè¾¹çš„userè¿”å›çš„ç»“æœæ˜¯nullï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å®šä¹‰post user çš„ resolverã€‚graphqlä¼šå»æŸ¥æ‰¾æ²¡æœ‰å­—æ®µå¯¹åº”çš„resolverï¼Œæ²¡æœ‰æ‰¾åˆ°åˆ™ä¼šè¿”å›nullã€‚æ¥ä¸‹æ¥åœ¨resolverä¸­æ·»åŠ ä¸‹è¾¹ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">resolver</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> db <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">User</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> db\n  <span class=\"token keyword\">const</span> resolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token maybe-class-name\">Post</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">user</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">post<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> post<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å› ä¸ºuserå’Œpostçš„modelå·²ç»è¿›è¡Œçš„å…³è”ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨post.getUser()è·å–å½“å‰æ–‡ç« çš„ç”¨æˆ·ã€‚ç„¶åå†æ¬¡æŸ¥è¯¢ï¼Œå¾—åˆ°äº†æ­£ç¡®çš„ç»“æœï¼š</p>\n<p><img src=\"/images/react+graphql+apollo+node+express/insomnia-post-user.png\" alt=\"\"></p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­æ”¹å†™addPostçš„resolverå‡½æ•°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">addPost</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> post <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> args\n  logger<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> level<span class=\"token operator\">:</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'Post was created'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">users</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> usersRow <span class=\"token operator\">=</span> users<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token spread operator\">...</span>post\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">newPost</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        newPost<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setUser</span><span class=\"token punctuation\">(</span>usersRow<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> newPost\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>éœ€è¦åœ¨åˆ›å»ºpostçš„æ—¶å€™ï¼Œä¸»åŠ¨å»ç»™è®¾ç½®userIdï¼Œç”¨æ¥å…³è”userã€‚</p>\n<ul>\n<li>å¤šå¯¹å¤šå…³ç³»</li>\n</ul>\n<p>åˆ›å»ºä¸€ä¸ªchat æ¨¡å‹å’Œè¿ç§»</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize model:generate --models-path src/server/models --name Chat --attributes text:string --migrations-path src/server/migrations</code></pre></div>\n<p>åœ¨ chat å’Œ user çš„modelæ–‡ä»¶ä¸­æ·»åŠ å¤šå¯¹å¤šçš„å…³è”</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token maybe-class-name\">Chat</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">associate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">models</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// associations can be defined here</span>\n  <span class=\"token maybe-class-name\">Chat</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">belongsToMany</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">User</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> through<span class=\"token operator\">:</span> <span class=\"token string\">'user-chat'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">associate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">models</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// associations can be defined here</span>\n  <span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasMany</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">Post</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">belongsToMany</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">Chat</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> through<span class=\"token operator\">:</span> <span class=\"token string\">'user-chat'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å¤šå¯¹å¤šçš„å…³è”éœ€è¦é€šè¿‡å¦ä¸€ä¸ªæ¨¡å‹æ¥è¿›è¡Œå…³è”</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token maybe-class-name\">Chat</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">belongsToMany</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">User</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> through<span class=\"token operator\">:</span> <span class=\"token string\">'user-chat'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">belongsToMany</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">Chat</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> through<span class=\"token operator\">:</span> <span class=\"token string\">'user-chat'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>sequelizeä¼šåˆ›å»ºuser-chatè¿™ä¸ªmodelï¼Œå¹¶å…·æœ‰userIdå’ŒchatIdè¿™ä¸¤ä¸ªç­‰æ•ˆå¤–é”®</p>\n<p>ä½†æ˜¯sequelizeä¸ä¼šè‡ªåŠ¨å»åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦é¢å¤–åˆ›å»ºä¸€å¼ user-chatçš„è¡¨</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize migration:create --name create-user-chat --migrations-path src/server/migrations</code></pre></div>\n<p>å¹¶æ·»åŠ userIdå’ŒchatIdåˆ—ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'UserChat'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        allowNull<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        autoIncrement<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        primaryKey<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      userId<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      chatId<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      createdAt<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        allowNull<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DATE</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      updatedAt<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        allowNull<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Sequelize</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DATE</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dropTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'UserChat'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>ä½¿ç”¨è¿ç§»å‘½ä»¤è¿›è¡Œè¿ç§»</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€äº›ç§å­æ•°æ®ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize seed:generate --name fake-chats --seeders-path src/server/seeders</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkInsert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Chats'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      updatedAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkDelete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Chats'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">sequelize seed:generate --name fake-chats-uses-relations --seeders-path src/server/seeders</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> usersAndChats <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      queryInterface<span class=\"token punctuation\">.</span><span class=\"token property-access\">sequelize</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SELECT id from Users;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      queryInterface<span class=\"token punctuation\">.</span><span class=\"token property-access\">sequelize</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SELECT id from Chats;'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword control-flow\">return</span> usersAndChats<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">rows</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> rows<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">const</span> chats <span class=\"token operator\">=</span> rows<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n      <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>chats<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkInsert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user-chat'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        userId<span class=\"token operator\">:</span> users<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">,</span>\n        chatId<span class=\"token operator\">:</span> chats<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">,</span>\n        createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        updatedAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        userId<span class=\"token operator\">:</span> users<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">,</span>\n        chatId<span class=\"token operator\">:</span> chats<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">,</span>\n        createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        updatedAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Sequelize</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bulkDelete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user-chat'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æ•°æ®å‡†å¤‡å®Œæ¯•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»™graphqlæ·»åŠ å¯¹åº”çš„schemea</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"></span>\n<span class=\"token string\">// ...</span>\n<span class=\"token string\">type User {</span>\n<span class=\"token string\">  id: Int</span>\n<span class=\"token string\">  avatar: String</span>\n<span class=\"token string\">  username: String</span>\n<span class=\"token string\">  chats: [Chat]</span>\n<span class=\"token string\">}</span>\n<span class=\"token string\">type Chat {</span>\n<span class=\"token string\">  id: Int</span>\n<span class=\"token string\">  messages: [Message],</span>\n<span class=\"token string\">  users: [User]</span>\n<span class=\"token string\">}</span>\n<span class=\"token string\"></span>\n<span class=\"token string\">type RootQuery {</span>\n<span class=\"token string\">  posts: [Post]</span>\n<span class=\"token string\">  chats: [Chat]</span>\n<span class=\"token string\">}</span>\n<span class=\"token string\">// ...</span>\n<span class=\"token string\"></span><span class=\"token template-punctuation string\">`</span></span>\n</code></pre></div>\n<p>ç„¶åå†æ·»åŠ å¯¹åº”resolverï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token maybe-class-name\">User</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">chats</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">user<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> user<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getChats</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token maybe-class-name\">Chat</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">users</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">chat<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> chat<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token maybe-class-name\">RootQuery</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">posts</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">Post</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> order<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">'createdAt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DESC'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">chats</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">users</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>users<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> usersRow <span class=\"token operator\">=</span> users<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token maybe-class-name\">Chat</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          include<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n            model<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">User</span><span class=\"token punctuation\">,</span>\n            required<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            through<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> where<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> userId<span class=\"token operator\">:</span> usersRow<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            model<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Message</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä¸‹è¾¹æ˜¯æŸ¥è¯¢ç»“æœï¼š</p>\n<p><img src=\"/images/react+graphql+apollo+node+express/chat-user.jpg\" alt=\"\"></p>\n<h2 id=\"7-react--graphql-client\">7. react + graphql client</h2>\n<p>é€šè¿‡express + apollo serverå·²ç»æ­å»ºèµ·æ¥çš„äº†ä¸€äº›åç«¯æ¥å£æœåŠ¡ã€‚æ¥ä¸‹æ¥è¿›è¡Œéœ€è¦ä½¿ç”¨react + apollo clientæ­å»ºèµ·å‰ç«¯çš„ graphql clientã€‚</p>\n<ul>\n<li>ä½¿ç”¨ react åˆ›å»º apollo client</li>\n</ul>\n<p>å…ˆæ¥å®‰è£…ä¸€äº›å¿…è¦çš„åŒ…</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save apollo-boost @apollo/react-hooks graphql</code></pre></div>\n<p>å®‰è£… <code>apollo-boot</code>ç›¸å½“äºå®‰è£…å¦‚ä¸‹çš„åŒ…</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install apollo-client apollo-cache-inmemory apollo-link-http apollo-link-error apollo-link graphql-tag --save</code></pre></div>\n<p>åˆ›å»º <code>src/client/apollo/index.js</code>ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªç®€å•çš„apollo client</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">ApolloClient</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'apollo-boost'</span>\n\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  uri<span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:8000/graphql'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> client\n</code></pre></div>\n<p>é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ä¸€ä¸‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">gql</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'graphql-tag'</span>\nclient<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  query<span class=\"token operator\">:</span> gql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token graphql language-graphql\">\n  <span class=\"token punctuation\">{</span>\n    posts <span class=\"token punctuation\">{</span>\n      id\n      text\n      user <span class=\"token punctuation\">{</span>\n        avatar\n        username\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<ul>\n<li>åœ¨reactä¸­ä½¿ç”¨ apollo client</li>\n</ul>\n<p><code>@apollo/react-hooks</code>ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€åŒ…è£¹å±‚ç»„ä»¶--<code>ApolloProvider</code>ï¼Œå’Œ reactçš„ Context.Providerç±»ä¼¼ã€‚</p>\n<p>æˆ‘ä»¬éœ€è¦åœ¨æœ€ä¸Šå±‚ç»„ä»¶åœ¨åŒ…è£¹ä¸€å±‚<code>ApolloProvider</code>ï¼Œå¹¶æä¾›<code>client</code>å±æ€§</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">React</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">ReactDOM</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-dom'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">App</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./App'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">ApolloProvider</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@apollo/react-hooks'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">client</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./apollo/index.js'</span>\n\n<span class=\"token maybe-class-name\">ReactDOM</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">ApolloProvider</span> client<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>client<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">App</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">ApolloProvider</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p><strong>åœ¨ç»„ä»¶å†…ä½¿ç”¨ apollo client</strong></p>\n<p>apolloæä¾›äº†å¤šç§é€‰æ‹©ï¼š</p>\n<ol>\n<li>ç›´æ¥ä½¿ç”¨åˆšæ‰æˆ‘ä»¬åˆ›å»ºå¹¶æš´éœ²çš„clientçš„å®ä¾‹æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼å®˜æ–¹æ–‡æ¡£æ²¡æœ‰ï¼Œæ‰€ä»¥ä¸æ¨è</li>\n<li>ä½¿ç”¨<code>@apollo/react-hooks</code>ï¼Œä»¥ç¬¬ä¸‰æ–¹<code>hooks</code>çš„æ–¹å¼ä½¿ç”¨ï¼Œè¿™æ˜¯ç›®å‰æœ€æ–°å®˜æ–¹æ–‡æ¡£æä¾›å¹¶æ¨èçš„ä¸€ç§æ–¹å¼, <a href=\"https://www.apollographql.com/docs/react/api/react-hooks/\">https://www.apollographql.com/docs/react/api/react-hooks/</a></li>\n<li>ä½¿ç”¨<code>@apollo/react-components</code>ï¼Œä»¥ç»„ä»¶çš„æ–¹å¼æ¥ä½¿ç”¨ï¼Œ<a href=\"https://www.apollographql.com/docs/react/api/react-components/\">https://www.apollographql.com/docs/react/api/react-components/</a></li>\n<li>ä½¿ç”¨<code>@apollo/react-hoc</code>ï¼Œç±»ä¼¼äº<code>react-redux</code>çš„<code>connect</code>ç»„ä»¶ï¼Œç»™æ¯ä¸€ä¸ªç”¨åˆ°äº† apollo clientçš„ç»„ä»¶ï¼Œç”¨é«˜é˜¶ç»„ä»¶é‡æ–°åŒ…è£…çš„æ–¹å¼æ¥ä½¿ç”¨ï¼Œ<a href=\"https://www.apollographql.com/docs/react/api/react-hoc/\">https://www.apollographql.com/docs/react/api/react-hoc/</a></li>\n</ol>\n<p>è¿™é‡Œå…ˆä½¿ç”¨<code>@apollo/react-components</code></p>\n<p>åˆ›å»º<code>src/client/Feed.js</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">React</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Helmet</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react-helmet'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">gql</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'graphql-tag'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Query</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Mutation</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@apollo/react-components'</span>\n\n<span class=\"token keyword module\">import</span> <span class=\"token string\">'../../assets/css/style.css'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">GET_POSTS</span> <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token graphql language-graphql\"><span class=\"token punctuation\">{</span>\n  posts <span class=\"token punctuation\">{</span>\n    id\n    text\n    user <span class=\"token punctuation\">{</span>\n      avatar\n      username\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">ADD_POST</span> <span class=\"token operator\">=</span> gql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token graphql language-graphql\">\n<span class=\"token keyword\">mutation</span> addPost<span class=\"token punctuation\">(</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">:</span> PostInput<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  addPost<span class=\"token punctuation\">(</span><span class=\"token attr-name\">post</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    id\n    text\n    user <span class=\"token punctuation\">{</span>\n      username\n      avatar\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Feed</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    postContent<span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function-variable function\">handlePostContentChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      postContent<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span><span class=\"token property-access\">target</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function-variable function\">handleSubmit</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> posts<span class=\"token punctuation\">,</span> postContent <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">state</span>\n    <span class=\"token keyword\">const</span> newPost <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> posts<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      text<span class=\"token operator\">:</span> postContent<span class=\"token punctuation\">,</span>\n      user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        avatar<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">?</span> avatar1 <span class=\"token operator\">:</span> avatar2<span class=\"token punctuation\">,</span>\n        username<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fake User-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>posts<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevState</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      posts<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>newPost<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>prevState<span class=\"token punctuation\">.</span><span class=\"token property-access\">posts</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      postContent<span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> postContent <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">state</span>\n    <span class=\"token keyword\">const</span> self <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"container\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Helmet</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&#x3C;</span>title<span class=\"token operator\">></span><span class=\"token maybe-class-name\">Graphbook</span> <span class=\"token operator\">-</span> <span class=\"token maybe-class-name\">Feed</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n          <span class=\"token operator\">&#x3C;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"description\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"Newsfeed of all your all your friends on Graphbook\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Helmet</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"postForm\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Mutation</span> mutation<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token constant\">ADD_POST</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n            <span class=\"token punctuation\">{</span><span class=\"token parameter\">addPost</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span>\n              <span class=\"token operator\">&#x3C;</span>form onSubmit<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                e<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> variables<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> post<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> postContent <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                    self<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prevState</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                      postContent<span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span>textarea\n                  value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>postContent<span class=\"token punctuation\">}</span>\n                  onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">handlePostContentChange</span><span class=\"token punctuation\">}</span>\n                  placeholder<span class=\"token operator\">=</span><span class=\"token string\">\"Write your custom post!\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">\"submit\"</span> value<span class=\"token operator\">=</span><span class=\"token string\">\"Submit\"</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n              <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Mutation</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"feed\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Query</span> query<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token constant\">GET_POSTS</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n            <span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> loading<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>loading<span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">'loading ...'</span>\n              <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span> error<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span>\n              <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> posts <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data\n\n              <span class=\"token keyword control-flow\">return</span> posts<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span>\n                <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"post\"</span> key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n                  <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"header\"</span><span class=\"token operator\">></span>\n                    <span class=\"token operator\">&#x3C;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">user</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">avatar</span><span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n                    <span class=\"token operator\">&#x3C;</span>h2<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">user</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">username</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n                  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n                  <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"content\"</span><span class=\"token operator\">></span>\n                    <span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token property-access\">text</span><span class=\"token punctuation\">}</span>\n                  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n                <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n              <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Query</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æˆ‘è¿™é‡Œæ¼”ç¤ºäº†<code>Query</code>å’Œ<code>Mutation</code>ä¸¤ç§ç»„ä»¶çš„ç”¨æ³•ï¼Œæ›´åŠ è¯¦ç»†çš„è¯´æ˜è¯·æŸ¥çœ‹æ–‡æ¡£ã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸¤ç§ç»„ä»¶æ¥å—çš„å­ç»„ä»¶éƒ½æ˜¯åŒ…å«ç‰¹æ®Šå‚æ•°çš„å‡½æ•°ï¼Œä¸èƒ½æ˜¯ä¸€èˆ¬çš„å­ç»„ä»¶ã€‚</p>\n<ul>\n<li>æ›´æ–°è§†å›¾</li>\n</ul>\n<p>å½“æˆ‘ä»¬ä½¿ç”¨<code>Mutation</code>ç»„ä»¶è¿›è¡Œæ›´æ–°æ•°æ®ä¹‹åï¼Œåˆ—è¡¨å±•ç¤ºçš„æ•°æ®éœ€è¦æ›´æ–°ã€‚</p>\n<p>apollo ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§é€‰æ‹©ã€‚</p>\n<p>ç¬¬ä¸€ç§æ˜¯æ›´æ–°æ¥å£å®Œæˆä¹‹åå†æ¬¡å‘å‡ºè·å–postsçš„query</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Mutation</span> \n  mutation<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token constant\">ADD_POST</span><span class=\"token punctuation\">}</span>\n  refetchQueries<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>query<span class=\"token operator\">:</span>\t<span class=\"token constant\">GET_POSTS</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Mutation</span><span class=\"token operator\">></span>\n</code></pre></div>\n<p>ç¬¬äºŒç§æ˜¯æ›´æ–°æ¥å£å®Œæˆä¹‹åæ›´æ–°æœ¬åœ°cacheçš„æ•°æ®</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Mutation</span> \n  mutation<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token constant\">ADD_POST</span><span class=\"token punctuation\">}</span>\n  update<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">store<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> addPost <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">readQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> query<span class=\"token operator\">:</span> <span class=\"token constant\">GET_POSTS</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    data<span class=\"token punctuation\">.</span><span class=\"token property-access\">posts</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">unshift</span><span class=\"token punctuation\">(</span>addPost<span class=\"token punctuation\">)</span>\n    store<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">writeQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> query<span class=\"token operator\">:</span> <span class=\"token constant\">GET_POSTS</span><span class=\"token punctuation\">,</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Mutation</span><span class=\"token operator\">></span>\n</code></pre></div>\n<p><strong>Optimistic UI</strong></p>\n<p>Optimistic UI æ˜¯æŒ‡åœ¨çœŸäº‹æ•°æ®å›æ¥ä¹‹å‰ä½¿ç”¨å‡æ•°æ®æ¥æ›´æ–°UIï¼Œä¸€æ—¦çœŸå®æ•°æ®è¿”å›ä¹‹åï¼Œç«‹å³ä½¿ç”¨çœŸå®çš„æ•°æ®æ¸²æŸ“UIå¹¶æ›¿æ¢åˆ°å‡æ•°æ®æ¸²æŸ“çš„UIã€‚</p>\n<p><code>@apollo/react-components</code>çš„<code>Mutation</code>ç»„ä»¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå±æ€§<code>optimisticResponse</code>æ¥å®ç°è¿™ä¸ªæ•ˆæœï¼Œ<a href=\"https://www.apollographql.com/docs/react/performance/optimistic-ui/\">https://www.apollographql.com/docs/react/performance/optimistic-ui/</a>ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Mutation</span>\n  <span class=\"token comment\">// ...</span>\n  optimisticResponse<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n    __typename<span class=\"token operator\">:</span> <span class=\"token string\">'mutation'</span><span class=\"token punctuation\">,</span>\n    addPost<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      __typename<span class=\"token operator\">:</span> <span class=\"token string\">'Post'</span><span class=\"token punctuation\">,</span>\n      text<span class=\"token operator\">:</span> postContent<span class=\"token punctuation\">,</span>\n      id<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        __typename<span class=\"token operator\">:</span> <span class=\"token string\">'User'</span><span class=\"token punctuation\">,</span>\n        username<span class=\"token operator\">:</span> <span class=\"token string\">'Loading...'</span><span class=\"token punctuation\">,</span>\n        avatar<span class=\"token operator\">:</span> <span class=\"token string\">'/public/loading.gif'</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Mutation</span><span class=\"token operator\">></span>\n</code></pre></div>\n<p>å…¶ä¸­<code>__typename</code>ä¸ºæˆ‘ä»¬å®šä¹‰åœ¨graphqlçš„å­—æ®µï¼Œå…¶ä»–çš„éƒ¨åˆ†åˆ™æ˜¯æ¨¡æ‹Ÿçš„æ•°æ®ï¼Œç»“æ„éœ€è¦å’Œgraphqlå®šä¹‰çš„å­—æ®µç»“æ„ä¸€è‡´ã€‚</p>\n<p>https://github.com/apollographql/apollo-client/blob/master/packages/apollo-client/src/core/networkStatus.ts</p>\n<p>å…³äºqueryå’Œmutationçš„ä¸€äº›åŸºæœ¬ç”¨æ³•å°±è¿™äº›ï¼Œäº†è§£æ›´å¤šè¿˜æ˜¯éœ€è¦å¤šçœ‹æ–‡æ¡£å’Œæ¡ˆä¾‹ã€‚</p>\n<h2 id=\"å®‰è£…-fontawesome\">å®‰è£… FontAwesome</h2>\n<p>ä¸‹è¾¹æ˜¯fontAwesomeçš„githubé“¾æ¥ï¼š\n<a href=\"https://github.com/FortAwesome/react-fontawesome#get-started\">https://github.com/FortAwesome/react-fontawesome#get-started</a></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save @fortawesome/fontawesome-svg-core @fortawesome/free-solid-svg-icons @fortawesome/react-fontawesome</code></pre></div>\n<p>æ–‡æ¡£ä¸Šæä¾›äº†ä¸¤ç§å¼•å…¥æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³åœ¨æ•´ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨libraryçš„æ–¹å¼å¼•å…¥ï¼Œåˆ›å»º<code>src/components/fontawesome.js</code>æ–‡ä»¶ï¼Œå¡«å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> library <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@fortawesome/fontawesome-svg-core'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> faAngleDown <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@fortawesome/free-solid-svg-icons'</span>\n\nlibrary<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>faAngleDown<span class=\"token punctuation\">)</span>\n\n</code></pre></div>\n<p>ç„¶ååœ¨<code>App.js</code>ä¸­å¼•å…¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æˆ‘ä»¬åœ¨æ‰€æœ‰çš„è‡ªå®šä¹‰ç»„ä»¶ä¸­ä½¿ç”¨</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token string\">'./components/fontawesome'</span>\n\n</code></pre></div>\n<p>å½“ä½ éœ€è¦å®Œæ•´çš„å›¾æ ‡æ—¶ï¼Œä½ éœ€è¦å®‰è£…</p>\n<h1 id=\"å‰ç«¯ç›¸å…³çš„åŒ…\">å‰ç«¯ç›¸å…³çš„åŒ…</h1>\n<ul>\n<li>react-helmet</li>\n</ul>\n<p><em>This reusable React component will manage all of your changes to the document head.</em></p>\n<p>æ¯”å¦‚ç”¨æ¥æ”¹å˜HTMLçš„titleå’Œdescription</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">npm install --save react-helmet</code></pre></div>\n<h1 id=\"reactå¼€å‘éœ€è¦ä¸»è¦çš„åœ°æ–¹\">Reactå¼€å‘éœ€è¦ä¸»è¦çš„åœ°æ–¹</h1>\n<h3 id=\"ç»‘å®šäº‹ä»¶çš„æ—¶å€™thisæŒ‡å‘\">ç»‘å®šäº‹ä»¶çš„æ—¶å€™thisæŒ‡å‘</h3>\n<p>æˆ‘æ˜¯å»ºè®®ç»Ÿä¸€ä½¿ç”¨å»ºé€šå‡½æ•°æ–¹å¼å£°åå‡½æ•°ï¼Œä½¿ç”¨çš„æ—¶å€™ä¹Ÿä¸éœ€è¦ä½¿ç”¨bindè¿›è¡Œç»‘å®šã€‚</p>\n",
    "frontmatter": {
      "title": "å¿«é€Ÿä¸Šæ‰‹React + graphql + apollo + node + express",
      "date": "2019-12-16"
    },
    "toc": "<ul>\n<li>\n<p><a href=\"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">ç¯å¢ƒå‡†å¤‡</a></p>\n</li>\n<li>\n<p><a href=\"#%E4%BB%A5%E4%B8%8B%E6%98%AF-react--graphql--apollo--node--express-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E9%80%BB%E8%BE%91%E5%85%B3%E7%B3%BB\">ä»¥ä¸‹æ˜¯ React + graphql + apollo + node + express åœ¨é¡¹ç›®ä¸­çš„é€»è¾‘å…³ç³»</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE\">åˆå§‹åŒ–é¡¹ç›®</a></p>\n<ul>\n<li><a href=\"#1-%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95\">1. æ–°å»ºé¡¹ç›®ç›®å½•</a></li>\n<li><a href=\"#2-%E5%AE%89%E8%A3%85react%E5%92%8Creact-dom\">2. å®‰è£…reactå’Œreact-dom</a></li>\n<li><a href=\"#3-%E6%90%AD%E5%BB%BAreact%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83\">3. æ­å»ºreactçš„å¼€å‘ç¯å¢ƒ</a></li>\n<li><a href=\"#4-%E6%90%AD%E5%BB%BAnode--graphql%E7%9A%84%E5%90%8E%E7%AB%AF%E7%9A%84%E6%9C%8D%E5%8A%A1\">4. æ­å»ºnode + graphqlçš„åç«¯çš„æœåŠ¡</a></li>\n<li><a href=\"#5-%E9%93%BE%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93\">5. é“¾æ¥æ•°æ®åº“</a></li>\n<li><a href=\"#6-sequelize--graphql%E4%BD%BF%E7%94%A8\">6. sequelize + graphqlä½¿ç”¨</a></li>\n<li><a href=\"#7-react--graphql-client\">7. react + graphql client</a></li>\n<li><a href=\"#%E5%AE%89%E8%A3%85-fontawesome\">å®‰è£… FontAwesome</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8C%85\">å‰ç«¯ç›¸å…³çš„åŒ…</a></p>\n</li>\n<li>\n<p><a href=\"#react%E5%BC%80%E5%8F%91%E9%9C%80%E8%A6%81%E4%B8%BB%E8%A6%81%E7%9A%84%E5%9C%B0%E6%96%B9\">Reactå¼€å‘éœ€è¦ä¸»è¦çš„åœ°æ–¹</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%97%B6%E5%80%99this%E6%8C%87%E5%90%91\">ç»‘å®šäº‹ä»¶çš„æ—¶å€™thisæŒ‡å‘</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
    "name": "å¿«é€Ÿä¸Šæ‰‹React + graphql + apollo + node + express",
    "id": "3dc73e8be1ecf317881766ca2737b8fb",
    "prev": {
      "name": "åœ¨çº¿Web IDE--code serveréƒ¨ç½²",
      "id": "00e7f2b491b451d6822c03c6285ad404"
    },
    "next": {
      "name": "ç§»åŠ¨ç«¯é€‚é…çš„ä¸€äº›æ¦‚å¿µ",
      "id": "2958ee3836ab74361ac191f4a1a02f7c"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/ç§»åŠ¨ç«¯é€‚é…çš„ä¸€äº›æ¦‚å¿µ.md",
      "/home/zepang/WorkSpace/blog/posts/ç§»åŠ¨ç«¯é€‚é…çš„ä¸€äº›æ¦‚å¿µ.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"å“åº”å¼å’Œè‡ªé€‚åº”å¸ƒå±€\">å“åº”å¼å’Œè‡ªé€‚åº”å¸ƒå±€</h1>\n<p>èƒ½å¤Ÿåœ¨ä¸åŒçš„å°ºå¯¸çš„å±å¹•ä¸‹å“åº”å¼çš„å±•ç¤ºå†…å®¹ç§°ä¹‹ä¸ºå“åº”å¼çš„å¸ƒå±€ï¼Œé€šå¸¸ï¼Œå±å¹•å°ºå¯¸ä¹‹é—´ç›¸å·®è¾ƒå¤§ã€‚</p>\n<p>åœ¨åŒä¸€ç±»æˆ–è€…å±å¹•æƒ³å·®ä¸å¤šçš„è®¾å¤‡ä¸­è¿›è¡Œå¸ƒå±€é€‚é…ç§°ä¹‹ä¸ºè‡ªé€‚åº”å¸ƒå±€ã€‚æ¯”å¦‚ä¸åŒçš„æ‰‹æœºä¹‹é—´ã€‚</p>\n<p>å¦å¤–éœ€è¦æé†’çš„æ˜¯ï¼Œåœ¨å¯¹é¡µé¢è¦æ±‚æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå»ºè®®å•ç‹¬é€‚é…ç§»åŠ¨ç«¯çš„å¸ƒå±€ã€‚</p>\n<h1 id=\"ç‰©ç†åƒç´ å’Œè®¾å¤‡ç‹¬ç«‹åƒç´ \">ç‰©ç†åƒç´ å’Œè®¾å¤‡ç‹¬ç«‹åƒç´ </h1>\n<p>ç‰©ç†åƒç´ é€šå¸¸åˆç§°ä¸ºè®¾å¤‡åƒç´ ï¼Œæ˜¯æ˜¾ç¤ºè®¾å¤‡ä¸­ä¸€ä¸ªæœ€å¾®å°çš„ç‰©ç†éƒ¨ä»¶ã€‚ä¸€ä¸ªè®¾å¤‡çš„ç‰©ç†åƒç´ æ˜¯ä¸å˜çš„ï¼Œæ¯ä¸ªåƒç´ éƒ½å¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿè®¾ç½®æ˜¾ç¤ºçš„äº®åº¦é¢œè‰²ã€‚</p>\n<p>æ‰€è°“çš„ä¸€å€å±ï¼ŒäºŒå€å±ï¼Œä¸‰å€å±å°±æ˜¯æŒ‡ä½¿ç”¨å¤šå°‘çš„ç‰©ç†åƒç´ æ¥æ˜¾ç¤ºä¸€ä¸ªcssçš„åƒç´ ã€‚æ‹¿ä¸€å¼ å›¾æ¥å…·ä½“è¯´æ˜ï¼š</p>\n<p><img src=\"./retina-web.jpg\" alt=\"\"></p>\n<p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ™®é€šå±å¹•ä¸‹ï¼Œ1ä¸ªcssåƒç´ å¯¹åº”ç€1ä¸ªç‰©ç†åƒç´ ï¼›åœ¨Retinaå±å¹•ä¸‹ï¼Œä¸€ä¸ªcssåƒç´ å¯¹åº”çš„å´æ˜¯4ä¸ªåƒç´ </strong></p>\n<p>è®¾å¤‡ç‹¬ç«‹åƒç´ é€šå¸¸åˆç§°ä¸ºä¸è®¾å¤‡æ— å…³åƒç´ ï¼Œæ¯”å¦‚cssåƒç´ ã€‚åŒæ ·å¤§å°çš„cssåƒç´ è¡¨ç¤ºçš„å†…å®¹ï¼Œåœ¨æ™®é€šå±å¹•å’ŒRetinaå±å¹•å æ®çš„ç©ºé—´æ˜¯ä¸€æ ·çš„ã€‚</p>\n<h1 id=\"è®¾å¤‡åƒç´ æ¯”\">è®¾å¤‡åƒç´ æ¯”</h1>\n<p>è®¾å¤‡åƒç´ æ¯”ï¼ˆdevice pixel ratioï¼‰ï¼Œç®€ç§°dprï¼Œå³ç‰©ç†åƒç´ å’Œè®¾å¤‡ç‹¬ç«‹åƒç´ çš„æ¯”å€¼ã€‚</p>\n<p>åœ¨webæµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>window.devicePixelRatio</code> æ¥è·å– dprã€‚</p>\n<p>æ­¤å¤–ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨cssçš„åª’ä½“æŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°dprï¼Œæ¥åŒºåˆ†å¤šå€å±è®¾å¤‡</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@media</span> <span class=\"token punctuation\">(</span><span class=\"token property\">-webkit-min-device-pixel-ratio</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token property\">min-device-pixel-ratio</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h1 id=\"å¸ƒå±€è§†å£ï¼Œè§†è§‰è§†å£ï¼Œç†æƒ³è§†å£\">å¸ƒå±€è§†å£ï¼Œè§†è§‰è§†å£ï¼Œç†æƒ³è§†å£</h1>\n<p>**å¸ƒå±€è§†å£ï¼š**å°±æ˜¯æŒ‡æµè§ˆå™¨ä¸­ç”¨æ¥æ˜¾ç¤ºç½‘é¡µçš„åŒºåŸŸã€‚</p>\n<p>åœ¨pcç«¯ï¼Œå¸ƒå±€è§†å£çš„å¤§å°å°±æ˜¯æŒ‡æµè§ˆå™¨çš„çª—å£å¤§å°ã€‚</p>\n<p>åœ¨ç§»åŠ¨ç«¯ï¼Œæµè§ˆå™¨ä¸ºäº†é˜²æ­¢pcç«¯ç½‘é¡µåœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºæ‹¥æŒ¤ï¼Œä¼šç»™å¸ƒå±€è§†å£è®¾ç½®ä¸€ä¸ªç‰¹å®šçš„å®½åº¦ï¼Œå¤§éƒ¨åˆ†çš„ä¸º980pxã€‚</p>\n<p>æœ‰çš„äººä¼šè¯´ä¸å¯¹å‘€ï¼Œæˆ‘æ‰‹æœºç«¯çœ‹åˆ°çš„ç½‘é¡µå®½åº¦å°±æ˜¯å’Œå±å¹•å®½åº¦çš„å¤§å°æ˜¯ä¸€è‡´çš„ï¼Œé‚£æ˜¯å› ä¸ºç°åœ¨å¤§éƒ¨åˆ†ç§»åŠ¨ç«¯çš„ç½‘é¡µï¼Œéƒ½ä½¿ç”¨çš„æ˜¯ç†æƒ³è§†å£ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡document.documentElement.clientWidth / clientHeightæ¥è·å–å¸ƒå±€è§†å£å¤§å°ã€‚</p>\n<p>**è§†è§‰è§†å£ï¼š**ç”¨æˆ·æ­£åœ¨çœ‹åˆ°çš„ç½‘é¡µçš„åŒºåŸŸã€‚</p>\n<p>ç”¨æˆ·å¯ä»¥é€šè¿‡ç¼©æ”¾æ¥æŸ¥çœ‹ç½‘ç«™çš„å†…å®¹ã€‚</p>\n<p>å¦‚æœç”¨æˆ·ç¼©å°ç½‘ç«™ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ç½‘ç«™åŒºåŸŸå°†å˜å¤§ï¼Œæ­¤æ—¶è§†è§‰è§†å£ä¹Ÿå˜å¤§äº†ï¼ŒåŒç†ï¼Œç”¨æˆ·æ”¾å¤§ç½‘ç«™ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°çš„ç½‘ç«™åŒºåŸŸå°†ç¼©å°ï¼Œæ­¤æ—¶è§†è§‰è§†å£ä¹Ÿå˜å°äº†ã€‚</p>\n<p>ä½†æ˜¯æ— è®ºç”¨æˆ·å¦‚ä½•ç¼©æ”¾ï¼Œéƒ½ä¸ä¼šæ”¹å˜å¸ƒå±€è§†å£çš„å¤§å°ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡window.innerWidth / innerHeightæ¥è·å–è§†è§‰è§†å£å¤§å°ã€‚</p>\n<p>**ç†æƒ³è§†å£ï¼š**å½“å¸ƒå±€è§†å£å¤§å°ç­‰äºè§†è§‰è§†å£çš„æ—¶å€™ï¼Œå³ä¸ºç†æƒ³è§†å£ã€‚</p>\n<p>å¯ä»¥æ·»åŠ ä¸‹è¾¹çš„ä»£ç æ¥è¾¾åˆ°ç†æƒ³è§†å£çš„æ•ˆæœï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡screen.width / heightæ¥è·å–ç†æƒ³è§†å£å¤§å°ã€‚</p>\n<p>éœ€è¦æ³¨æ„ï¼Œé€šè¿‡è®¾ç½®viewportï¼Œä¼šå½±å“åˆ°cssåª’ä½“æŸ¥è¯¢ã€‚</p>\n<p>äº†è§£ä»¥ä¸Šå‡ ä¸ªæ¦‚å¿µå°±å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥è¿›å…¥ä¸»é¢˜ï¼Œè®²è®²å¼€å‘ä¸­éœ€è¦äº†è§£çš„å†…å®¹ã€‚</p>\n<h1 id=\"è®¾è®¡ç¨¿çš„åƒç´ è½¬æ¢\">è®¾è®¡ç¨¿çš„åƒç´ è½¬æ¢</h1>\n<p>é€šå¸¸ï¼Œè€ƒè™‘åˆ°Retinaå±å¹•èƒ½å¤Ÿæ˜¾ç¤ºçš„ç‰©ç†åƒç´ ï¼Œè®¾è®¡å¸ˆåœ¨è®¾è®¡æ—¶ï¼Œä¼šåŸºäºiphone6ç»™å‡º750pxæˆ–è€…1125pxçš„è®¾è®¡ç¨¿ï¼Œè¿™ç§è®¾è®¡ç¨¿åˆ†åˆ«å«äºŒå€å›¾å’Œä¸‰å€å›¾ã€‚</p>\n<p>åœ¨è¿›è¡Œé¡µé¢å¸ƒå±€çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†ç‰©ç†åƒç´ è½¬æ¢æˆè®¾å¤‡ç‹¬ç«‹åƒç´ ã€‚</p>\n<p>ä»¥750pxè®¾è®¡ç¨¿ä¸ºä¾‹ï¼Œè®¾è®¡ç¨¿ä¸­ä¸€ä¸ªå…ƒç´ çš„é«˜åº¦ä¸º200pxã€‚</p>\n<p>åœ¨ç†æƒ³è§†å£çš„æƒ…å†µä¸‹ï¼Œiphone6çš„è§†å£å¤§å°ä¸º375pxã€‚</p>\n<p>è¦æƒ³ä¿è¯è¿™ä¸ªå…ƒç´ åœ¨375pxçš„è§†å£ä¸­æ­£ç¡®çš„å±•ç¤ºï¼Œæˆ‘ä»¬å°±éœ€è¦ä¿è¯å®ƒçš„å±å æ¯”ï¼Œåˆ™æˆ‘ä»¬ç»™å®šçš„cssåƒç´ åº”ä¸º200px/2=100pxã€‚</p>\n<p>ä»¥1125pxè®¾è®¡ç¨¿ä¸ºä¾‹å°±å¾—é™¤ä»¥3ã€‚</p>\n<p>åœ¨ä»¥ä¸Šçš„å‰æä¸‹ï¼Œå¦‚æœè¦é€‚é…å…¶ä»–å±å¹•å¤§å°å’Œiphone6ä¸åŒçš„æœºå‹ï¼Œå¦‚ä½•ä¿è¯å†…å®¹å±å æ¯”ï¼Ÿ</p>\n<h1 id=\"åŸºäºremçš„flexible\">åŸºäºremçš„flexible</h1>\n<p>ä¸ºäº†è§£å†³ç§»åŠ¨ç«¯ä¸åŒå±å¹•ï¼ˆå¤§å°ï¼‰çš„æœºå‹çš„å¸ƒå±€é—®é¢˜ã€‚</p>\n<p>æ‰€ä»¥åœ¨å¾ˆæ—©ä¹‹å‰æ·˜å®å°±å‡ºæ¥äº†åŸºäºremçš„å¸ƒå±€è§£å†³æ–¹æ¡ˆflexible.jsã€‚</p>\n<p>æˆ‘ä»¬çœ‹ä¸‹flexible.jsçš„åŸç†ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// set 1rem = viewWidth / 10</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">setRemUnit</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> rem <span class=\"token operator\">=</span> docEl<span class=\"token punctuation\">.</span><span class=\"token property-access\">clientWidth</span> <span class=\"token operator\">/</span> <span class=\"token number\">10</span>\n    docEl<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">fontSize</span> <span class=\"token operator\">=</span> rem <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">setRemUnit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>é€šè¿‡jsè®¡ç®—è·ŸèŠ‚ç‚¹çš„å­—å·å¤§å°ï¼Œç„¶åç”¨remä½œä¸ºå•ä½ã€‚</p>\n<p>è¿˜æ˜¯ä»¥750pxè®¾è®¡ç¨¿ä¸ºä¾‹ï¼Œå‡è®¾Yä¸ºè®¾è®¡ç¨¿æŸä¸ªå…ƒç´ çš„å°ºå¯¸ï¼Œyä¸ºå±å¹•ä¸­çš„csså°ºå¯¸ï¼Œä¸ºä¿æŒå…ƒç´ åœ¨è®¾è®¡ç¨¿å’Œå±å¹•çš„å æ¯”ï¼Œåˆ™æ»¡è¶³Y/750 = y/10*remã€‚</p>\n<p>æ‰€ä»¥è®¡ç®—å¾— y = (Y * 10 * rem)/750 (å•ä½px) = Y/75 (å•ä½rem)ï¼Œæœ‰çš„æ—¶å€™ä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œä¼šå°†è¿™ä¸ª10æ¢æˆ75ï¼Œä¹Ÿå°±æ˜¯å±å¹•75ç­‰åˆ†ã€‚</p>\n<p>ä¹‹åéšç€viewportå•ä½åœ¨æµè§ˆå™¨ä¸­é€æ¸å…¼å®¹ï¼Œæ‰€ä»¥flexibleè¿™ç§remçš„æ–¹æ¡ˆé€æ¸è¢«åºŸå¼ƒï¼Œè¿™ç§æ–¹æ¡ˆå®é™…ä¸Šå°±æ˜¯viewportå•ä½çš„æ›¿ä»£å“ã€‚</p>\n<h1 id=\"viewportå•ä½\">viewportå•ä½</h1>\n<p>vhã€vwæ–¹æ¡ˆå³å°†è§†è§‰è§†å£å®½åº¦ window.innerWidthå’Œè§†è§‰è§†å£é«˜åº¦ window.innerHeight ç­‰åˆ†ä¸º 100 ä»½ã€‚</p>\n<ul>\n<li>\n<p>vw(Viewport's width)ï¼š1vwç­‰äºè§†è§‰è§†å£çš„1%</p>\n</li>\n<li>\n<p>vh(Viewport's height) :1vh ä¸ºè§†è§‰è§†å£é«˜åº¦çš„1%</p>\n</li>\n<li>\n<p>vmin : vw å’Œ vh ä¸­çš„è¾ƒå°å€¼</p>\n</li>\n<li>\n<p>vmax : é€‰å– vw å’Œ vh ä¸­çš„è¾ƒå¤§å€¼</p>\n</li>\n</ul>\n<p>å¦‚æœè§†è§‰è§†å£ä¸º375pxï¼Œé‚£ä¹ˆ1vw = 3.75pxï¼Œè¿™æ—¶UIç»™å®šä¸€ä¸ªå…ƒç´ çš„å®½ä¸º75pxï¼ˆè®¾å¤‡ç‹¬ç«‹åƒç´ ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®ƒè®¾ç½®ä¸º75 / 3.75 = 20vwã€‚</p>\n<p>è¿™é‡Œçš„æ¯”ä¾‹å…³ç³»æˆ‘ä»¬ä¹Ÿä¸ç”¨è‡ªå·±æ¢ç®—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PostCSSçš„ postcss-px-to-viewport æ’ä»¶å¸®æˆ‘ä»¬å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®UIç»™çš„è®¾è®¡å›¾å†™pxå•ä½å³å¯ã€‚</p>\n<p>å½“ç„¶ï¼Œæ²¡æœ‰ä¸€ç§æ–¹æ¡ˆæ˜¯åå…¨åç¾çš„ï¼ŒvwåŒæ ·æœ‰ä¸€å®šçš„ç¼ºé™·ï¼š</p>\n<ul>\n<li>\n<p>pxè½¬æ¢æˆvwä¸ä¸€å®šèƒ½å®Œå…¨æ•´é™¤ï¼Œå› æ­¤æœ‰ä¸€å®šçš„åƒç´ å·®ã€‚</p>\n</li>\n<li>\n<p>æ¯”å¦‚å½“å®¹å™¨ä½¿ç”¨vwï¼Œmarginé‡‡ç”¨pxæ—¶ï¼Œå¾ˆå®¹æ˜“é€ æˆæ•´ä½“å®½åº¦è¶…è¿‡100vwï¼Œä»è€Œå½±å“å¸ƒå±€æ•ˆæœã€‚</p>\n</li>\n</ul>\n<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥é¿å…çš„ï¼Œä¾‹å¦‚ä½¿ç”¨paddingä»£æ›¿marginï¼Œå¹¶ä¸”é…åˆbox-sizingï¼Œç¢°åˆ°vwå’Œpxæ··åˆä½¿ç”¨çš„æ—¶å€™ï¼Œç»“åˆcalc()å‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å®Œç¾çš„è§£å†³ã€‚</p>\n",
    "frontmatter": {
      "title": "ç§»åŠ¨ç«¯é€‚é…çš„ä¸€äº›æ¦‚å¿µ",
      "date": "2018-01-10"
    },
    "toc": "<ul>\n<li><a href=\"#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%92%8C%E8%87%AA%E9%80%82%E5%BA%94%E5%B8%83%E5%B1%80\">å“åº”å¼å’Œè‡ªé€‚åº”å¸ƒå±€</a></li>\n<li><a href=\"#%E7%89%A9%E7%90%86%E5%83%8F%E7%B4%A0%E5%92%8C%E8%AE%BE%E5%A4%87%E7%8B%AC%E7%AB%8B%E5%83%8F%E7%B4%A0\">ç‰©ç†åƒç´ å’Œè®¾å¤‡ç‹¬ç«‹åƒç´ </a></li>\n<li><a href=\"#%E8%AE%BE%E5%A4%87%E5%83%8F%E7%B4%A0%E6%AF%94\">è®¾å¤‡åƒç´ æ¯”</a></li>\n<li><a href=\"#%E5%B8%83%E5%B1%80%E8%A7%86%E5%8F%A3%EF%BC%8C%E8%A7%86%E8%A7%89%E8%A7%86%E5%8F%A3%EF%BC%8C%E7%90%86%E6%83%B3%E8%A7%86%E5%8F%A3\">å¸ƒå±€è§†å£ï¼Œè§†è§‰è§†å£ï¼Œç†æƒ³è§†å£</a></li>\n<li><a href=\"#%E8%AE%BE%E8%AE%A1%E7%A8%BF%E7%9A%84%E5%83%8F%E7%B4%A0%E8%BD%AC%E6%8D%A2\">è®¾è®¡ç¨¿çš„åƒç´ è½¬æ¢</a></li>\n<li><a href=\"#%E5%9F%BA%E4%BA%8Erem%E7%9A%84flexible\">åŸºäºremçš„flexible</a></li>\n<li><a href=\"#viewport%E5%8D%95%E4%BD%8D\">viewportå•ä½</a></li>\n</ul>\n",
    "name": "ç§»åŠ¨ç«¯é€‚é…çš„ä¸€äº›æ¦‚å¿µ",
    "id": "2958ee3836ab74361ac191f4a1a02f7c",
    "prev": {
      "name": "å¿«é€Ÿä¸Šæ‰‹React + graphql + apollo + node + express",
      "id": "3dc73e8be1ecf317881766ca2737b8fb"
    },
    "next": {
      "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šç¯‡",
      "id": "c34d6ff7671cf4ca397b709b871b1f32"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šç¯‡.md",
      "/home/zepang/WorkSpace/blog/posts/ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šç¯‡.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¬¬ä¸€éƒ¨åˆ†\">ç¬¬ä¸€éƒ¨åˆ†</h1>\n<h2 id=\"ç¬¬ä¸€ç« -ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ\">ç¬¬ä¸€ç«  ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<p>å­˜å‚¨å’ŒæŸ¥æ‰¾å˜é‡çš„è§„åˆ™ã€‚</p>\n<h3 id=\"11-ç¼–è¯‘åŸç†ï¼š\">1.1 ç¼–è¯‘åŸç†ï¼š</h3>\n<ul>\n<li>JavaScriptå®é™…ä¸Šä¸€é—¨ç¼–è¯‘è¯­è¨€ã€‚ä»»ä½•JavaScriptçš„ä»£ç åœ¨æ‰§è¡Œå‰éƒ½è¦è¿›è¡Œç¼–è¯‘ã€‚å¤§éƒ¨åˆ†çš„ç¼–è¯‘å‘ç”Ÿåœ¨ä»£ç æ‰§è¡Œå‰çš„å‡ å¾®å¦™ï¼ˆç”šè‡³æ›´çŸ­ï¼‰ã€‚</li>\n<li>ç¼–è¯‘çš„ä¸‰ä¸ªè¿‡ç¨‹ï¼š\n<ul>\n<li>åˆ†è¯/è¯æ³•åˆ†æ</li>\n<li>è§£æ/è¯­æ³•åˆ†æ</li>\n<li>ä»£ç ç”Ÿæˆ</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"12-ä½œç”¨åŸŸçš„ç†è§£\">1.2 ä½œç”¨åŸŸçš„ç†è§£</h3>\n<ul>\n<li>å¯¹ JavaScript ä»£ç è¿›è¡Œå¤„ç†æ—¶éœ€è¦å‚ä¸çš„ä¸‰ä¸ªæˆå‘˜ å¼•æ“ï¼Œç¼–è¯‘å™¨ï¼Œä½œç”¨åŸŸä»¥åŠå®ƒä»¬åˆ†åˆ«çš„ä½œç”¨ã€‚</li>\n<li>ä½œç”¨åŸŸå‚ä¸ç¼–è¯‘å™¨å’Œå¼•æ“çš„å·¥ä½œï¼ŒååŠ©ç¼–è¯‘å™¨å’Œå¼•æ“å­˜å‚¨å’ŒæŸ¥æ‰¾å˜é‡</li>\n</ul>\n<h3 id=\"13-ä½œç”¨åŸŸåµŒå¥—\">1.3 ä½œç”¨åŸŸåµŒå¥—</h3>\n<ul>\n<li>éå†åµŒå¥—ä½œç”¨åŸŸé“¾çš„è§„åˆ™ï¼šå¼•æ“ä»å½“å‰çš„æ‰§è¡Œä½œç”¨åŸŸå¼€å§‹æŸ¥æ‰¾å˜é‡ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œ\nå°±å‘ä¸Šä¸€çº§ç»§ç»­æŸ¥æ‰¾ã€‚å½“æŠµè¾¾æœ€å¤–å±‚çš„å…¨å±€ä½œç”¨åŸŸæ—¶ï¼Œæ— è®ºæ‰¾åˆ°è¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹éƒ½\nä¼šåœæ­¢ã€‚</li>\n</ul>\n<h3 id=\"14-å¼‚å¸¸\">1.4 å¼‚å¸¸</h3>\n<p>åœ¨æ™®é€šæ¨¡å¼ä¸‹ï¼Œæ‰§è¡Œ LHS æŸ¥è¯¢ï¼Œå¦‚æœç›´åˆ°é¡¶å±‚ä½œç”¨åŸŸéƒ½æ— æ³•æ‰¾åˆ°æ‰€éœ€çš„å˜é‡ï¼Œä¼šåœ¨é¡¶å±‚ä½œç”¨åŸŸï¼Œéšå¼çš„åˆ›å»ºä¸€ä¸ªã€‚æ‰§è¡Œ RHS æŸ¥è¯¢ï¼Œåœ¨æ‰€æœ‰çš„åµŒå¥—ä½œç”¨ä¸­ï¼Œæ— æ³•æ‰¾åˆ°éœ€è¦çš„å˜é‡ï¼Œå¼•æ“ä¼šæŠ›å‡º ReferenceError å¼‚å¸¸ã€‚\nåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ˆ'use strict'ï¼‰ï¼Œæ‰§è¡Œ LHS æŸ¥è¯¢ï¼Œå¦‚æœç›´åˆ°é¡¶å±‚ä½œç”¨åŸŸéƒ½æ— æ³•æ‰¾åˆ°æ‰€éœ€çš„å˜é‡ï¼Œä¸ä¼šåœ¨é¡¶å±‚ä½œç”¨åŸŸéšå¼çš„åˆ›å»ºä¸€ä¸ªï¼Œå¼•æ“ä¼šæŠ›å‡º ReferenceError å¼‚å¸¸ï¼Œå› ä¸ºä¸¥æ ¼æ¨¡å¼ä¸å…è®¸éšå¼åˆ›å»ºå˜é‡ã€‚</p>\n<hr>\n<h2 id=\"ç¬¬äºŒç« -è¯æ³•ä½œç”¨åŸŸ\">ç¬¬äºŒç«  è¯æ³•ä½œç”¨åŸŸ</h2>\n<p>ä½œç”¨åŸŸå…±æœ‰ä¸¤ç§ä¸»è¦çš„å·¥ä½œæ¨¡å‹ï¼Œç¬¬ä¸€ç§æœ€ä¸ºæ™®éï¼Œè¢«å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€æ‰€é‡‡ç”¨çš„è¯æ³•ä½œç”¨åŸŸã€‚å¦å¤–ä¸€ç§å«åšåŠ¨æ€ä½œç”¨åŸŸï¼Œä»æœ‰ä¸€äº›ç¼–ç¨‹è¯­è¨€åœ¨ä½¿ç”¨ã€‚JavaScriptæ‰€é‡‡ç”¨çš„æ¨¡å‹æ˜¯è¯æ³•ä½œç”¨åŸŸã€‚\nä¸¾ä¸ªä¾‹å­è¯´æ˜åŠ¨æ€ä½œç”¨åŸŸå’Œè¯æ³•ä½œç”¨åŸŸçš„åŒºåˆ«ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>ä¸Šè¾¹çš„ä»£ç  js ä¼šè¾“å‡º 2ï¼Œå› ä¸º foo å‡½æ•°çš„ RHS æŸ¥æ‰¾å˜é‡æ˜¯é€šè¿‡å…¨å±€çš„ä½œç”¨åŸŸè¿›è¡ŒæŸ¥æ‰¾çš„\nå¦‚æœ js æ˜¯åŠ¨æ€è¯­è¨€ï¼Œé‚£ä¹ˆç»“æœå°±ä¼šè¾“å‡º 3ï¼ŒåŠ¨æ€ä½œç”¨åŸŸä¸å…³å¿ƒå‡½æ•°æ˜¯åœ¨ä½•å¤„å£°æ˜çš„ï¼Œåªå…³å¿ƒåœ¨ä½•å¤„è°ƒç”¨ã€‚</p>\n<h3 id=\"21-è¯æ³•é˜¶æ®µ\">2.1 è¯æ³•é˜¶æ®µ</h3>\n<p>åœ¨ä¹‹å‰çš„<a href=\"###1.1%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86\">1.1ç¼–è¯‘åŸç†</a>ä¸­æåˆ°ç¼–è¯‘å™¨å·¥ä½œçš„ä¸‰ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªæ˜¯è¯æ³•åˆ†æï¼Œå¤§éƒ¨åˆ†æ ‡å‡†ç¼–è¯‘å™¨çš„ç¬¬ä¸€ä¸ªå·¥ä½œé˜¶æ®µå«åšè¯æ³•åŒ–ã€‚\n<strong>ç®€å•çš„æ¥è¯´ï¼Œè¯æ³•ä½œç”¨åŸŸå°±æ˜¯å®šä¹‰åœ¨è¯æ³•é˜¶æ®µçš„ä½œç”¨åŸŸã€‚æ¢å¥è¯æ¥è¯´ï¼Œè¯æ³•ä½œç”¨åŸŸæ˜¯ç”±ä½ åœ¨å†™ä»£ç æ—¶å°†å˜é‡å’Œå—ä½œç”¨åŸŸå†™åœ¨å“ªé‡Œæ¥å†³å®šçš„ï¼Œç”±æ­¤ï¼Œå½“è¯æ³•åˆ†æå™¨å¤„ç†ä»£ç æ—¶ï¼Œä¼šä¿æŒä½œç”¨åŸŸä¸å˜</strong></p>\n<h3 id=\"22-è¯æ³•æ¬ºéª—\">2.2 è¯æ³•æ¬ºéª—</h3>\n<p>åˆšæ‰æ‰€è¯´ï¼Œè¯æ³•ä½œç”¨åŸŸå®Œå…¨ç”±å†™ä»£ç æœŸé—´å‡½æ•°æ‰€å£°æ˜çš„ä½ç½®æ¥å®šä¹‰ï¼Œæ€æ ·æ‰èƒ½åœ¨è¿è¡Œæ—¶æ¥â€œä¿®æ”¹â€ï¼ˆæ¬ºéª—ï¼‰ï¼Œè¯æ³•ä½œç”¨åŸŸï¼Ÿ</p>\n<p>JavaScript ä¸­æœ‰ä¸¤ç§æ–¹å¼ï¼ševal å’Œ with</p>\n<h4 id=\"221-eval\">2.2.1 eval</h4>\n<p>eval å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºå‚æ•°ï¼Œå¹¶ä¸”å°†å…¶ä¸­å†…å®¹ä½œä¸ºå¥½åƒåœ¨ä¹¦å†™æ—¶å°±åœ¨å½“å‰ä½ç½®çš„ä»£ç æ¥æ‰§è¡Œã€‚è¯·çœ‹ä¸‹é¢ä¾‹å­ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"var a = 3\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 3</span>\n</code></pre></div>\n<p>eval å¸¸ç”¨æ¥åŠ¨æ€åˆ›å»ºä»£ç ï¼Œä½†æ˜¯ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸­ï¼Œeval(...) åœ¨è¿è¡Œæ—¶æœ‰å…¶è‡ªå·±çš„ä½œç”¨åŸŸï¼Œæ„å‘³ç€æ— æ³•ä¿®æ”¹æ‰€åœ¨åœ°ä½œç”¨åŸŸã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ReferenceError: a is not defined</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"var a = 3\"</span><span class=\"token punctuation\">)</span> \n</code></pre></div>\n<p>setTimeout(...) å’Œ setInterval(...) çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²çš„ä»£ç å¯ä»¥è§£é‡Šæˆæ­£ç¡®çš„ä»£ç æ‰§è¡Œã€‚è¿™äº›åŠŸèƒ½å·²ç»è¿‡æ—¶ï¼Œä¸è¦ä½¿ç”¨å®ƒã€‚</p>\n<p>new Function(...) å‡½æ•°æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥æ¥æ”¶ä»£ç å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å°†å…¶è½¬åŒ–æˆåŠ¨æ€ä»£ç ã€‚è¿™ç§åšæ³•æ¯”eval(...)ç•¥å¾®å®‰å…¨ï¼Œä½†æ˜¯ï¼Œä¹Ÿè¦å°½é‡é¿å…ä½¿ç”¨ã€‚</p>\n<h4 id=\"with\">with</h4>\n<p>é€šå¸¸è¢«å½“ä½œé‡å¤å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§çš„å¿«æ·æ–¹å¼ï¼Œå¯ä»¥ä¸éœ€è¦é‡å¤å¼•ç”¨å¯¹è±¡æœ¬èº«ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  b<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  c<span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">}</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span> <span class=\"token operator\">=</span> <span class=\"token number\">5</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token property-access\">c</span> <span class=\"token operator\">=</span> <span class=\"token number\">6</span>\n\n<span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  a <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n  b <span class=\"token operator\">=</span> <span class=\"token number\">5</span>\n  c <span class=\"token operator\">=</span> <span class=\"token number\">6</span>\n  d <span class=\"token operator\">=</span> <span class=\"token number\">7</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 7</span>\n</code></pre></div>\n<p>with å¯ä»¥å°†ä¸€ä¸ªæ²¡æœ‰æˆ–è€…å¤šä¸ªå±æ€§çš„å¯¹è±¡å¤„ç†ä¸ºä¸€ä¸ªå®Œå…¨éš”ç¦»çš„è¯æ³•ä½œç”¨åŸŸã€‚å®é™…ä¸Šï¼Œæ˜¯æ ¹æ®ä½ ä¼ é€’ç»™å®ƒçš„å¯¹è±¡å‡­ç©ºåˆ›é€ ä¸€ä¸ªæ–°çš„è¯æ³•ä½œç”¨åŸŸã€‚æ¯”å¦‚ï¼Œä½ ä¼ é€’ obj ç»™ withï¼Œå®é™…ä¸Šï¼Œwith ä»¥ obj ä½œä¸ºå½“å‰ä½œç”¨åŸŸï¼Œåœ¨ obj ä¸­æ²¡æœ‰æ‰¾åˆ° d ï¼Œæ‰€ä»¥ï¼Œåœ¨ä¸Šå±‚ä½œç”¨åŸŸä¸­æ‰¾ï¼Œä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±åˆ›å»ºäº† d å˜é‡ã€‚</p>\n<hr>\n<h2 id=\"ç¬¬ä¸‰ç« -å‡½æ•°ä½œç”¨åŸŸå’Œå—ä½œç”¨åŸŸ\">ç¬¬ä¸‰ç«  å‡½æ•°ä½œç”¨åŸŸå’Œå—ä½œç”¨åŸŸ</h2>\n<p>JavaScriptæ˜¯å¦‚ä½•å½¢æˆä½œç”¨åŸŸæ°”æ³¡ï¼Ÿ</p>\n<p>ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œå¦ä¸€ç§æ˜¯å—ä½œç”¨åŸŸã€‚</p>\n<h3 id=\"å‡½æ•°ä½œç”¨åŸŸ\">å‡½æ•°ä½œç”¨åŸŸ</h3>\n<p>æ¯æ¬¡åˆ›å»ºä¸€ä¸ªå‡½æ•°å°±å¯ä»¥ä¸ºå…¶è‡ªèº«åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸæ°”æ³¡ã€‚</p>\n<h3 id=\"å—ä½œç”¨åŸŸ\">å—ä½œç”¨åŸŸ</h3>\n<p>é€šè¿‡ with try/catch let const ç­‰å…³é”®å­—å½¢æˆçš„å—çº§ä½œç”¨åŸŸã€‚\nå…¶ä¸­try/catch ä¸­çš„ catch åˆ†å¥ä¼šåˆ›å»ºå—ä½œç”¨åŸŸï¼Œå…¶ä¸­å£°æ˜çš„å˜é‡åªèƒ½åœ¨catchå†…éƒ¨æœ‰æ•ˆã€‚</p>\n<hr>\n<h2 id=\"ç¬¬å››ç« -æå‡\">ç¬¬å››ç«  æå‡</h2>\n<p>å…ˆçœ‹ä¸‹é¢ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ---</span>\na <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> a<span class=\"token punctuation\">;</span>\nconsoel<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n<span class=\"token comment\">// ---</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n</code></pre></div>\n<p>é€šå¸¸æˆ‘ä»¬ç†è§£çš„JavaScriptçš„ä»£ç æ˜¯ä¸€è¡Œä¸€è¡Œä»ä¸Šå¾€ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬çŒœæµ‹ä¸Šè¾¹ä»£ç ä¼šæŠ¥ ReferenceError é”™è¯¯ã€‚ä½†æ˜¯ï¼Œç”±äº JavaScript æ˜¯å…ˆç¼–è¯‘åæ‰§è¡Œï¼Œåœ¨ç¼–è¯‘é˜¶æ®µä¼šæ”¶é›†æ‰€æœ‰çš„å£°æ˜ï¼Œè™½ç„¶ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ a å£°æ˜ä»£ç åœ¨ èµ‹å€¼ä»£ç åé¢ï¼Œä½†æ˜¯ï¼Œç¼–è¯‘å™¨å·²ç»æå‰åœ¨ä½œç”¨åŸŸä¸­å£°æ˜äº† aï¼Œæ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µï¼Œå¯¹ a è¿›è¡Œ RHS æŸ¥è¯¢ï¼Œä¸ä¼šæŠ¥é”™ã€‚è¿™ä¸€ä¸ªç°è±¡å«æå‡ã€‚</p>\n<p>JavaScript ä¸­é™¤äº†ä¸Šè¾¹çš„å˜é‡æå‡ï¼Œè¿˜å­˜åœ¨å‡½æ•°æå‡ï¼Œä¸è¿‡åªé’ˆå¯¹ function å…³é”®å­—å£°æ˜çš„å‡½æ•°ã€‚</p>\n<hr>\n<h2 id=\"ç¬¬äº”ç« -ä½œç”¨åŸŸé—­åŒ…\">ç¬¬äº”ç«  ä½œç”¨åŸŸé—­åŒ…</h2>\n<h3 id=\"é—­åŒ…\">é—­åŒ…</h3>\n<p>é—­åŒ…çš„äº§ç”Ÿï¼Ÿ</p>\n<p>å½“å‡½æ•°è®°ä½å¹¶ä¸”è®¿é—®è¯æ³•ä½œç”¨åŸŸæ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œã€‚</p>\n<p>ä»€ä¹ˆå«é—­åŒ…ï¼Ÿ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">f00</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè§£é‡Šä¸Šè¾¹çš„ä»£ç ï¼Œbar å‡½æ•°åœ¨åˆ›å»ºæ—¶æ˜¯åœ¨ foo å‡½æ•°å†…éƒ¨ï¼Œæ‰€ä»¥ï¼Œbar å‡½æ•°æ‰€é€‚åº”è®¿é—®çš„å˜é‡çš„è§„åˆ™æ—¶ï¼Œå½“å‰ä½œç”¨åŸŸ -> fooä½œç”¨åŸŸ -> fooå¤–å±‚ä½œç”¨åŸŸï¼Œbar å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œæ ¹æ®ä½œç”¨åŸŸåµŒå¥—è§„åˆ™ï¼Œé¦–å…ˆä¼šåœ¨å½“å‰ä½œç”¨åŸŸå¯»æ‰¾ aï¼Œä¸å­˜åœ¨å°±ä¼šå¾€ä¸Šå¯»æ‰¾ï¼Œè€Œ foo ä½œç”¨åŸŸ æ˜¯å¯ä»¥è®¿é—®åˆ° a çš„ã€‚\né‚£ä¹ˆä¸‹è¾¹ä»£ç æˆ‘ä»¬è¯¥å¦‚ä½•è§£é‡Šï¼Ÿ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">return</span> bar\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> baz <span class=\"token operator\">=</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2 é—­åŒ…äº§ç”Ÿçš„æ•ˆæœ</span>\n</code></pre></div>\n<p>å¦‚æœæˆ‘ä»¬ç»§ç»­æŒ‰ç…§ä¸Šè¾¹çš„æ€è·¯å»è§£é‡Šï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºJavaScriptæœ¬èº«å­˜åœ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåœ¨ var baz = foo() æ‰§è¡Œå®Œåï¼Œfoo å‡½æ•°å°±åº”è¯¥ä¼šå›æ”¶ï¼Œæ‰€ä»¥ foo ä¸­å£°æ˜çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡å°±è¯¥é”€æ¯ï¼Œæ˜¾ç„¶baz()æ‰§è¡Œçš„æ—¶å€™æ˜¯æ— æ³•æ‰¾åˆ° a çš„ã€‚é‚£ä¹ˆæ­¤å¤„æœ€ç»ˆç»“æœä¾ç„¶è¾“å‡º 2ï¼Œå¯ä»¥çœ‹å‡º foo åœ¨æ‰§è¡Œæ—¶ç”Ÿæˆçš„ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡æ²¡æœ‰è¢«é”€æ¯ï¼Œé—­åŒ…é˜»æ­¢äº†åƒåœ¾å›æ”¶ã€‚</p>\n<p>ä¸ªäººçš„ç†è§£ï¼š</p>\n<ul>\n<li>\n<p>ä½œç”¨åŸŸ</p>\n<ul>\n<li>åŒæ„ä¹¦ä¸ŠJavaScriptä½¿ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸï¼Œæ‰€ä»¥å†³å®šå˜é‡çš„ä½¿ç”¨èŒƒå›´æ˜¯åœ¨è¯æ³•åˆ†æé˜¶æ®µã€‚</li>\n<li>JavaScriptä½œç”¨åŸŸä»èŒƒå›´æ¥åˆ†ï¼Œåˆ†ä¸ºå…¨å±€ä½œç”¨åŸŸå’Œå±€éƒ¨ä½œç”¨åŸŸï¼Œä»ä¸åŒçš„ç”Ÿæˆæ–¹å¼æ¥åˆ†ï¼Œåˆ†ä¸ºå‡½æ•°ä½œç”¨åŸŸï¼ˆç”±åˆ›å»ºå‡½æ•°å½¢æˆçš„ä½œç”¨åŸŸï¼‰å’Œå—çº§ä½œç”¨åŸŸï¼ˆå½¢æˆå—çº§ä½œç”¨åŸŸçš„å…³é”®å­—å£°æ˜å½¢æˆï¼‰ã€‚</li>\n</ul>\n</li>\n<li>\n<p>é—­åŒ…</p>\n<p>å½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œï¼Œè¿™æ—¶\nå°±äº§ç”Ÿäº†é—­åŒ…ã€‚</p>\n<ul>\n<li>åœ¨å‡½æ•°Aä¸­è¿”å›å‡½æ•°Bï¼Œå‡½æ•°Bå¯¹å‡½æ•°Açš„ä½œç”¨åŸŸå­˜åœ¨å¼•ç”¨ï¼Œæˆ‘ä»¬å°±è¯´å‡½æ•°Aå½¢æˆäº†é—­åŒ…ï¼Œå‡½æ•°Bå°±æ˜¯å‡½æ•°Açš„é—­åŒ…ã€‚</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1 id=\"ç¬¬äºŒéƒ¨åˆ†\">ç¬¬äºŒéƒ¨åˆ†</h1>\n<h2 id=\"ç¬¬ä¸€ç« -å…³äº-this\">ç¬¬ä¸€ç«  å…³äº this</h2>\n<h3 id=\"å¯¹-this-çš„è¯¯è§£\">å¯¹ this çš„è¯¯è§£</h3>\n<ul>\n<li>this æŒ‡å‘å‡½æ•°è‡ªèº«</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"foo: \"</span> <span class=\"token operator\">+</span> num <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// è®°å½• foo è¢«è°ƒç”¨çš„æ¬¡æ•°</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nfoo<span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> i<span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&#x3C;</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span> i <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// foo: 6</span>\n<span class=\"token comment\">// foo: 7</span>\n<span class=\"token comment\">// foo: 8</span>\n<span class=\"token comment\">// foo: 9</span>\n<span class=\"token comment\">// foo è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ï¼Ÿ</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> foo<span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0 -- WTF?</span>\n</code></pre></div>\n<p>foo è°ƒç”¨å®é™…ä¸Šæ˜¯å¢åŠ äº†å…¨å±€çš„ countã€‚</p>\n<p><strong>å°±é’ˆå¯¹ä¸Šé¢çš„ä»£ç ï¼Œå¦‚ä½•å›é¿ä»¥ä¸Šé—®é¢˜ï¼š</strong></p>\n<ul>\n<li>ç¬¬ä¸€ç§</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"foo: \"</span> <span class=\"token operator\">+</span> num <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// è®°å½• foo è¢«è°ƒç”¨çš„æ¬¡æ•°</span>\n  data<span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  count<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> i<span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&#x3C;</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span> i <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// foo: 6</span>\n<span class=\"token comment\">// foo: 7</span>\n<span class=\"token comment\">// foo: 8</span>\n<span class=\"token comment\">// foo: 9</span>\n<span class=\"token comment\">// foo è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ï¼Ÿ</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4</span>\n</code></pre></div>\n<p>åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¥å­˜å‚¨ countï¼Œå›é¿æ‰ this çš„é—®é¢˜ï¼Œç”¨è¯æ³•ä½œç”¨åŸŸæ¥è§£é‡Šã€‚</p>\n<ul>\n<li>ç¬¬äºŒç§</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"foo: \"</span> <span class=\"token operator\">+</span> num <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// è®°å½• foo è¢«è°ƒç”¨çš„æ¬¡æ•°</span>\n  foo<span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  count<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> i<span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&#x3C;</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span> i <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä½¿ç”¨å…·åå‡½æ•°ï¼ŒæŒ‡å®šå‡½æ•°åã€‚</p>\n<ul>\n<li>ç¬¬ä¸‰ç§</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"foo: \"</span> <span class=\"token operator\">+</span> num <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// è®°å½• foo è¢«è°ƒç”¨çš„æ¬¡æ•°</span>\n  <span class=\"token comment\">// æ³¨æ„ï¼Œåœ¨å½“å‰çš„è°ƒç”¨æ–¹å¼ä¸‹ï¼ˆå‚è§ä¸‹æ–¹ä»£ç ï¼‰ï¼Œthis ç¡®å®æŒ‡å‘ foo</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nfoo<span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> i<span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&#x3C;</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ä½¿ç”¨ call(..) å¯ä»¥ç¡®ä¿ this æŒ‡å‘å‡½æ•°å¯¹è±¡ foo æœ¬èº«</span>\n    foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span> foo<span class=\"token punctuation\">,</span> i <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// foo: 6</span>\n<span class=\"token comment\">// foo: 7</span>\n<span class=\"token comment\">// foo: 8</span>\n<span class=\"token comment\">// foo: 9</span>\n<span class=\"token comment\">// foo è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ï¼Ÿ</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> foo<span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4</span>\n</code></pre></div>\n<p>ä½¿ç”¨ call apply bind è¿™ä¸€ç±»ï¼Œå¼ºåˆ¶ç»‘é¡¶ this çš„æŒ‡å‘ã€‚</p>\n<ul>\n<li>this æŒ‡å‘å‡½æ•°ä½œç”¨åŸŸ\nï¼ˆè¯´å®è¯æ²¡çœ‹æ‡‚ä½œè€…ä¸¾çš„ä¾‹å­å’Œå½“å‰çš„ä¸»é¢˜æœ‰å•¥å¹²ç³»ï¼‰</li>\n</ul>\n<h4 id=\"å°ç»“\">å°ç»“</h4>\n<p>this æ—¢ä¸æŒ‡å‘å‡½æ•°è‡ªèº«ä¹Ÿä¸æŒ‡å‘å‡½æ•°çš„è¯æ³•ä½œç”¨åŸŸï¼Œthis å®é™…ä¸Šæ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶å‘ç”Ÿçš„ç»‘å®šï¼Œå®ƒæŒ‡å‘ä»€ä¹ˆå®Œå…¨å–å†³äºå‡½æ•°åœ¨å“ªé‡Œè¢«è°ƒç”¨ã€‚</p>\n<hr>\n<h2 id=\"ç¬¬äºŒç« -å…¨é¢äº†è§£-this\">ç¬¬äºŒç«  å…¨é¢äº†è§£ this</h2>\n<h3 id=\"thisçš„ç»‘å®šè§„åˆ™\">thisçš„ç»‘å®šè§„åˆ™</h3>\n<h4 id=\"é»˜è®¤ç»‘å®š\">é»˜è®¤ç»‘å®š</h4>\n<p>ç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼ˆä½œä¸ºæ™®é€šçš„å‡½æ•°è°ƒç”¨ï¼‰ï¼Œåœ¨éä¸¥æ ¼çš„æ¨¡å¼ä¸‹ï¼Œthis æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthis æ˜¯ undefinedã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>ä¹¦ä¸Šçš„è¯´æ³•æ˜¯ foo æ˜¯ç›´æ¥ä½¿ç”¨ä¸å¸¦ä»»ä½•ä¿®é¥°çš„å‡½æ•°å¼•ç”¨è¿›è¡Œè°ƒç”¨çš„ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨é»˜è®¤ç»‘å®šã€‚</p>\n<h4 id=\"éšå¼ç»‘å®š\">éšå¼ç»‘å®š</h4>\n<p>é€šå¸¸å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠŠå‡½æ•°å½“åšå¯¹è±¡çš„å±æ€§è°ƒç”¨ï¼Œå› æ­¤éšå¼ç»‘å®šè§„åˆ™ä¼šæŠŠ this ç»‘å®šåˆ°è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ã€‚è¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šå¯¹è±¡å±æ€§å¼•ç”¨é“¾ä¸­åªæœ‰æœ€é¡¶å±‚æˆ–è€…è¯´æœ€åä¸€å±‚ä¼šå½±å“è°ƒç”¨ä½ç½®ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  obj2<span class=\"token operator\">:</span> obj2\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj1<span class=\"token punctuation\">.</span><span class=\"token property-access\">obj2</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>æœ€åä¸€å±‚æ˜¯ obj2ï¼Œæ‰€æœ‰è¾“å‡º obj2 çš„ a å±æ€§å€¼ã€‚</p>\n<h4 id=\"this-éšå¼ä¸¢å¤±\">this éšå¼ä¸¢å¤±</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span> <span class=\"token comment\">// å‡½æ•°åˆ«å</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'oops. global'</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// oops, global</span>\n</code></pre></div>\n<p>è™½ç„¶ bar å’Œ obj.foo æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œå®ƒå¼•ç”¨çš„æ˜¯ foo å‡½æ•°æœ¬èº«ï¼Œå› æ­¤ bar() å…¶å®æ˜¯ä¸€ä¸ªä¸å¸¦ä»»ä½•ä¿®é¥°çš„å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤åº”ç”¨äº†é»˜è®¤ç»‘å®š</p>\n<p>ä¸€ç§æ›´å¾®å¦™ã€æ›´å¸¸è§çš„å¹¶ä¸”æ›´åŠ å‡ºä¹æ„æ–™çš„æƒ…å†µå‘ç”Ÿåœ¨ä¼ å…¥å›è°ƒå‡½æ•°æ—¶ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// fn å…¶å®å¼•ç”¨çš„æ—¶ foo</span>\n  <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è°ƒç”¨ä½ç½®</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'oops, global'</span>\n<span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// oops global</span>\n</code></pre></div>\n<p>å‚æ•°ä¼ é€’çš„æ–¹å¼å…¶å®æ˜¯ä¸€ç§éšå¼çš„èµ‹å€¼ï¼Œå› æ­¤ï¼Œfn å…¶å®è¿˜æ˜¯å¯¹ foo å‡½æ•°çš„å¼•ç”¨ï¼Œç»“æœå’Œä¸Šä¸ªä¾‹å­ä¸€æ ·ã€‚</p>\n<p>å¦‚æœæŠŠå‡½æ•°ä¼ å…¥ JavaScript å†…ç½®å‡½æ•°ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'oops, global'</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// oops global</span>\n</code></pre></div>\n<p>ç»“æœæ˜¯ä¸€æ ·çš„ã€‚å› ä¸ºä¼ å‚æ•°çš„æ–¹å¼æ˜¯éšå¼çš„èµ‹å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯æ‰§è¡Œäº† var fn = obj.fooï¼Œç„¶åæ‰§è¡Œäº† fn()ï¼Œæ˜¾ç„¶åˆå’Œä¸Šè¾¹çš„ä¾‹å­æ˜¯ä¸€æ ·çš„ã€‚</p>\n<h4 id=\"æ˜¾ç¤ºç»‘å®š\">æ˜¾ç¤ºç»‘å®š</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span>\nfoo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>ä¹¦ä¸Šè¯´çš„æ˜¾ç¤ºç»‘å®šå°±æ˜¯æŒ‡åˆ©ç”¨å‡½æ•°è‡ªå¸¦çš„ call(...) å’Œ apply(...) æ–¹æ³•ï¼Œå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä»¬ä¼šæŠŠè¿™ä¸ªå¯¹è±¡ç»‘å®šåˆ° thisï¼Œæ¥ç€è°ƒç”¨å‡½æ•°æ—¶æŒ‡å®šè¿™ä¸ª thisã€‚</p>\n<ol>\n<li>ç¡¬ç»‘å®š</li>\n</ol>\n<p>ä½†æ˜¯ï¼Œcall å’Œ apply è§£å†³äº†æˆ‘ä»¬ä¸Šè¾¹è¯´çš„éšå¼ä¸¢å¤±çš„é—®é¢˜å—ï¼Ÿ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'oops global'</span>\ndoFoo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// oops global</span>\n</code></pre></div>\n<p>æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ç”¨ setTimeout è¿™ä¸€ç±»å†…ç½®å‡½æ•°ï¼Œå› ä¸ºä¼šæŠ¥éæ³•è°ƒç”¨çš„é”™è¯¯ã€‚\næœ€ç»ˆç»“æœæ¥çœ‹ï¼Œæ²¡æœ‰è§£å†³ï¼Œé‚£æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œè™½ç„¶æˆ‘ä»¬åˆ©ç”¨callç»‘å®šäº†è°ƒç”¨å‡½æ•° doFoo çš„ this æŒ‡å‘ objï¼Œä½†æ˜¯ï¼ŒæŒ‰ç…§å‡½æ•°æ—¶èµ‹å€¼ä¼ å‚çš„è§„åˆ™ï¼Œå‡è®¾ var fn = obj.fooï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ doFoo ä¸­å®é™…æ˜¯ fn() è¿™æ ·è°ƒç”¨å‡½æ•°çš„ï¼Œè§£é‡Šè¿˜æ˜¯å’Œä¸Šè¾¹ä¸€æ ·ï¼Œæ˜¯ä¸å¸¦ä»»ä½•ä¿®é¥°çš„å‡½æ•°å¼•ç”¨è°ƒç”¨ã€‚æˆ‘ä»¬è¿™ä¸ªæ—¶å€™å°±ä¼šæƒ³åˆ°ï¼Œæ˜¯ä¸æ˜¯åªè¦å†è°ƒç”¨ foo çš„æ—¶å€™æ”¹å˜ fn() çš„ this æŒ‡å‘å°±å¯ä»¥äº†ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  fn<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// å¼ºåˆ¶ç»‘å®š obj è°ƒç”¨</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'oops global'</span>\n<span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>çœ‹æ¥æˆ‘ä»¬çš„çŒœæƒ³æ²¡æœ‰é”™ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¹¦ä¸Šçš„å†™æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">bar</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'oops global'</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>bar<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>ä¹¦ä¸Šçš„å†™æ³•æ›´åŠ ç›´æ¥ï¼Œæ— è®ºä¹‹åæ€ä¹ˆè°ƒç”¨ bar éƒ½ä¼š æ‰‹åŠ¨åœ¨ obj ä¸Šè°ƒç”¨ fooï¼Œè¿™ç§ç»‘å®šæ˜¯ä¸€ç§æ˜¾ç¤ºçš„å¼ºåˆ¶ç»‘å®šï¼Œç§°ä¹‹ä¸ºç¡¬ç»‘å®šã€‚</p>\n<p>ç¡¬ç»‘å®šçš„å…¸å‹åœºæ™¯å°±æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…è£¹å‡½æ•°ï¼Œä¼ å…¥æ‰€æœ‰çš„å‚æ•°å¹¶ä¸”è¿”å›æ¥æ”¶åˆ°çš„æ‰€æœ‰å€¼ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// foo å°±æ˜¯åŒ…è£¹å‡½æ•°</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">something</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">,</span> something<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">+</span> something\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">bar</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// foo å°±æ˜¯åŒ…è£¹å‡½æ•°</span>\n  <span class=\"token keyword control-flow\">return</span> foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2 3</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 5</span>\n</code></pre></div>\n<p>å¦å¤–ä¸€ç§æ˜¯åˆ›å»ºä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡å¦‚æœè¦åˆ›é€ ä¸€ä¸ª bar å‡½æ•°æ¥è¿›è¡Œå°è£…ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj<span class=\"token punctuation\">,</span> fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> fn<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">something</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">,</span> something<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">+</span> something\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> foo<span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2 3</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 5</span>\n</code></pre></div>\n<p>æ²¡é”™è¿™å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ bind å‡½æ•°çš„åŠŸèƒ½ï¼Œå› ä¸ºç¡¬ç»‘å®šéå¸¸å¸¸ç”¨ï¼Œæ‰€ä»¥ï¼Œåœ¨ ES5 ä¸­æä¾›äº†å†…ç½®çš„æ–¹æ³• Function.prototype.bind æ–¹æ³•ã€‚\n2. API è°ƒç”¨çš„'ä¸Šä¸‹æ–‡'</p>\n<p>JavaScriptçš„è®¸å¤šåº“å’Œå†…ç½®å‡½æ•°éƒ½æä¾›äº†ä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œé€šå¸¸ç§°ä¸ºä¸Šä¸‹æ–‡ï¼Œæ•ˆæœå’Œbindä¸€æ ·ï¼Œæ¯”å¦‚ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">4</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 4 4 4</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 4 4 4</span>\n</code></pre></div>\n<p>å‰æè¿™ä¸ª foo ä¸èƒ½æ˜¯ es6 çš„ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™ä¸èƒ½ç»‘å®š this</p>\n<h4 id=\"new-æ“ä½œç¬¦ç»‘å®š\">new æ“ä½œç¬¦ç»‘å®š</h4>\n<p>ä½¿ç”¨ new æ¥è°ƒç”¨å‡½æ•°ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š</p>\n<ul>\n<li>åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡</li>\n<li>è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«æ‰§è¡ŒåŸå‹é“¾æ¥</li>\n<li>è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«ç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„ this</li>\n<li>å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆ new è¡¨è¾¾å¼ä¸­çš„å‡½æ•°ä¼šè°ƒç”¨è‡ªåŠ¨è¿”å›çš„è¿™ä¸ªæ–°å¯¹è±¡</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> bar<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<h3 id=\"å››ç§ç»‘å®šçš„ä¼˜å…ˆçº§\">å››ç§ç»‘å®šçš„ä¼˜å…ˆçº§</h3>\n<ol>\n<li>éšå¼ç»‘å®šå’Œæ˜¾ç¤ºç»‘å®š</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\nobj1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\nobj2<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 3</span>\n\nobj1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj2<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 3</span>\nobj2<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj1<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>æ˜¾ç¤ºç»‘å®š > éšå¼ç»‘å®š</p>\n<ol start=\"2\">\n<li>éšå¼ç»‘å®šå’Œ new ç»‘å®š</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">something</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">=</span> something\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n\nobj1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>obj1<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">obj1<span class=\"token punctuation\">.</span>foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>obj1<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>bar<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 4</span>\n</code></pre></div>\n<p>å¯ä»¥çœ‹å‡º new ç»‘å®š > éšå¼ç»‘å®š</p>\n<ol start=\"3\">\n<li>new ç»‘å®šä¸æ˜¾ç¤ºç»‘å®š</li>\n</ol>\n<p>ä¸€èˆ¬çš„æ˜¾ç¤ºç»‘å®šæ— æ³•å’Œ new æ¯”è¾ƒï¼Œå› ä¸ºæ— æ³•é€šè¿‡ new foo.call(obj)ï¼Œä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡ç¡¬ç»‘å®šè¿›è¡Œæµ‹è¯•ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">something</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">=</span> something\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bind</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>bar<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>ç»“æœæ˜¯ new ç»‘å®š > ç¡¬ç»‘å®šï¼Œæˆ‘ä»¬æ‹¿ä¸Šè¾¹ç¡¬ç»‘å®šé‚£ä¸€èŠ‚å†™çš„ bind æ¥çœ‹ä¸‹</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">something</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">=</span> something\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj<span class=\"token punctuation\">,</span> fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> fn<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> foo<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> baz <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">bar</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>baz<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>æ˜¾ç„¶æ— æ³•æ”¹å˜ this çš„æŒ‡å‘ï¼Œæ‰€ä»¥ï¼ŒJavaScript å†…ç½®çš„ bind åœ¨å†…éƒ¨è‚¯å®šè¿˜æœ‰å…¶ä»–çš„å®ç°ã€‚</p>\n<p>å› ä¸º bind æ˜¯åœ¨ es5 æ‰åŠ å…¥ JavaScriptå†…ç½®è¯­æ³•ï¼Œæ‰€ä»¥ï¼Œæœ‰äº›æµè§ˆå™¨è¿˜éœ€è¦åšå…¼å®¹æ€§å¤„ç†ï¼Œä¸‹è¾¹æ˜¯ mdn ä¸Šä¸€ç§ bind çš„ Pollyfill å®ç°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">bind</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">bind</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">oThis</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> <span class=\"token keyword\">this</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// closest thing possible to the ECMAScript 5</span>\n      <span class=\"token comment\">// internal IsCallable function</span>\n      <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Function.prototype.bind - what is trying to be bound is not callable'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> aArgs   <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        fToBind <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">fNOP</span>    <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">fBound</span>  <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// this instanceof fNOP === trueæ—¶,è¯´æ˜è¿”å›çš„fBoundè¢«å½“åšnewçš„æ„é€ å‡½æ•°è°ƒç”¨</span>\n          <span class=\"token keyword control-flow\">return</span> fToBind<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">fNOP</span>\n                 <span class=\"token operator\">?</span> <span class=\"token keyword\">this</span>\n                 <span class=\"token operator\">:</span> oThis<span class=\"token punctuation\">,</span>\n                 <span class=\"token comment\">// è·å–è°ƒç”¨æ—¶(fBound)çš„ä¼ å‚.bind è¿”å›çš„å‡½æ•°å…¥å‚å¾€å¾€æ˜¯è¿™ä¹ˆä¼ é€’çš„</span>\n                 aArgs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">concat</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// ç»´æŠ¤åŸå‹å…³ç³»</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Function.prototype doesn't have a prototype property</span>\n      fNOP<span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">;</span> \n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// ä¸‹è¡Œçš„ä»£ç ä½¿fBound.prototypeæ˜¯fNOPçš„å®ä¾‹,å› æ­¤</span>\n    <span class=\"token comment\">// è¿”å›çš„fBoundè‹¥ä½œä¸ºnewçš„æ„é€ å‡½æ•°,newç”Ÿæˆçš„æ–°å¯¹è±¡ä½œä¸ºthisä¼ å…¥fBound,æ–°å¯¹è±¡çš„__proto__å°±æ˜¯fNOPçš„å®ä¾‹</span>\n    fBound<span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">fNOP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">return</span> fBound<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>é’ˆå¯¹ä¸Šè¾¹çš„åˆ¤æ–­ä½¿ç”¨å“ªä¸ª this çš„å†™æ³•ç›®å‰è¿˜ä¸ç†è§£ï¼Œä¼°è®¡å¾—ç­‰çœ‹å®ŒåŸå‹é‚£å—å†…å®¹ã€‚</p>\n<h4 id=\"å¦‚ä½•åˆ¤æ–­-this\">å¦‚ä½•åˆ¤æ–­ this</h4>\n<ol>\n<li>å‡½æ•°æ˜¯å¦åœ¨ new ä¸­è°ƒç”¨ï¼ˆ new ç»‘å®šï¼‰ï¼Ÿå¦‚æœæ˜¯çš„è¯ this ç»‘å®šçš„æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚\nvar bar = new foo()</li>\n<li>å‡½æ•°æ˜¯å¦é€šè¿‡ call ã€ apply ï¼ˆæ˜¾å¼ç»‘å®šï¼‰æˆ–è€…ç¡¬ç»‘å®šè°ƒç”¨ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œ this ç»‘å®šçš„æ˜¯æŒ‡å®šçš„å¯¹è±¡ã€‚\nvar bar = foo.call(obj2)</li>\n<li>å‡½æ•°æ˜¯å¦åœ¨æŸä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ä¸­è°ƒç”¨ï¼ˆéšå¼ç»‘å®šï¼‰ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œ this ç»‘å®šçš„æ˜¯é‚£ä¸ªä¸Š\nä¸‹æ–‡å¯¹è±¡ã€‚\nvar bar = obj1.foo()</li>\n<li>å¦‚æœéƒ½ä¸æ˜¯çš„è¯ï¼Œä½¿ç”¨é»˜è®¤ç»‘å®šã€‚å¦‚æœåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå°±ç»‘å®šåˆ° undefined ï¼Œå¦åˆ™ç»‘å®šåˆ°\nå…¨å±€å¯¹è±¡ã€‚\nvar bar = foo()</li>\n</ol>\n<h3 id=\"ç»‘å®šä¾‹å¤–\">ç»‘å®šä¾‹å¤–</h3>\n<h4 id=\"è¢«å¿½ç•¥çš„-this\">è¢«å¿½ç•¥çš„ this</h4>\n<p>åœ¨æŸäº›æƒ…å†µä¸‹è¿›è¡Œæ˜¾ç¤ºç»‘å®šå°† this æŒ‡å®šä¸º nullï¼Œå¦‚æœè°ƒç”¨çš„å‡½æ•°ç¡®å®ä¸å…³å¿ƒ this æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨åˆ° thisï¼Œé‚£ä¹ˆæœ‰å¯èƒ½é€ æˆå†…éƒ¨é”™è¯¯ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ç¬¬ä¸‰æ–¹çš„åº“ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´è®¸å¤šéš¾ä»¥åˆ†æå’Œè¿½è¸ªçš„ bugã€‚</p>\n<h4 id=\"æ›´åŠ å®‰å…¨çš„-this\">æ›´åŠ å®‰å…¨çš„ this</h4>\n<p>DMZ ç©ºçš„éå§”æ‰˜å¯¹è±¡ï¼Œè¿™ä¸ªæ¦‚å¿µç›®å‰è¿˜æ²¡ç†è§£~~~</p>\n<h4 id=\"é—´æ¥å¼•ç”¨\">é—´æ¥å¼•ç”¨</h4>\n<p>å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ æœ‰å¯èƒ½ï¼ˆæœ‰æ„æˆ–è€…æ— æ„åœ°ï¼‰åˆ›å»ºä¸€ä¸ªå‡½æ•°çš„â€œé—´æ¥å¼•ç”¨â€ï¼Œåœ¨è¿™\nç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šåº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚\né—´æ¥å¼•ç”¨æœ€å®¹æ˜“åœ¨èµ‹å€¼æ—¶å‘ç”Ÿï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> a<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> foo<span class=\"token operator\">:</span> foo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> a<span class=\"token operator\">:</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\no<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>\n<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>èµ‹å€¼è¡¨è¾¾å¼ p.foo = o.foo çš„è¿”å›å€¼æ˜¯ç›®æ ‡å‡½æ•°çš„å¼•ç”¨ï¼Œå› æ­¤è°ƒç”¨ä½ç½®æ˜¯ foo() è€Œä¸æ˜¯\np.foo() æˆ–è€… o.foo() ã€‚æ ¹æ®æˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ï¼Œè¿™é‡Œä¼šåº”ç”¨é»˜è®¤ç»‘å®šã€‚</p>\n<h4 id=\"è½¯ç»‘å®š\">è½¯ç»‘å®š</h4>\n<p>å°±æ˜¯æŒ‡ç»™é»˜è®¤ç»‘å®šæŒ‡å®šä¸€ä¸ªå…¨å±€å¯¹è±¡å’Œ undefined ä»¥å¤–çš„å€¼ï¼Œé‚£å°±å¯ä»¥å®ç°å’Œç¡¬ç»‘å®šç›¸åŒçš„æ•ˆæœï¼ŒåŒæ—¶ä¿ç•™éšå¼ç»‘å®šæˆ–è€…æ˜¾ç¤ºç»‘å®šä¿®æ”¹ this çš„èƒ½åŠ›ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">softBind</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">softBind</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> fn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n    <span class=\"token keyword\">var</span> curried <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">bound</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> fn<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span> <span class=\"token operator\">===</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span> <span class=\"token operator\">||</span> global<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> obj<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        curried<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">concat</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span>curried<span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    bound<span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">return</span> bound\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"this-è¯æ³•\">this è¯æ³•</h3>\n<p>ä¸Šè¿°çš„å››ç§è§„åˆ™é€‚åˆæ‰€æœ‰çš„æ­£å¸¸å‡½æ•°ï¼Œä½†æ˜¯ï¼Œes6 çš„ç®­å¤´å‡½æ•°ä¸é€‚ç”¨ this çš„å››ç§è§„åˆ™ï¼Œè€Œæ˜¯æ ¹æ®å¤–å±‚ï¼ˆå‡½æ•°æˆ–è€…å…¨å±€çš„ä½œç”¨åŸŸæ¥å†³å®šï¼‰</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//this ç»§æ‰¿è‡ª foo()</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">3</span>\n  <span class=\"token number\">100</span> \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span> obj1 <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç®­å¤´å‡½æ•°å·²ç»æ•è· this ä¸º obj1ï¼Œç®­å¤´å‡½æ•°çš„thisç»‘å®šæ— æ³•è¢«æ”¹å˜</span>\nbar<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span> obj2 <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2, ä¸æ˜¯ 3 ï¼</span>\n</code></pre></div>\n<hr>\n<h2 id=\"ç¬¬ä¸‰ç« -å¯¹è±¡\">ç¬¬ä¸‰ç«  å¯¹è±¡</h2>\n<h3 id=\"è¯­æ³•\">è¯­æ³•</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ç¬¬ä¸€ç§</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ç¬¬äºŒç§</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h3 id=\"ç±»å‹\">ç±»å‹</h3>\n<p>JavaScriptä¸»è¦æœ‰å…­ç§ç±»å‹</p>\n<ul>\n<li>string</li>\n<li>number</li>\n<li>boolean</li>\n<li>null</li>\n<li>undefined</li>\n<li>object</li>\n</ul>\n<p>ç®€å•åŸºæœ¬ç±»å‹ï¼ˆ string ã€ boolean ã€ number ã€ null å’Œ undefined ï¼‰æœ¬èº«å¹¶ä¸æ˜¯å¯¹è±¡ã€‚</p>\n<p>null æœ‰æ—¶ä¼šè¢«å½“ä½œä¸€ç§å¯¹è±¡ç±»å‹ï¼Œä½†æ˜¯è¿™å…¶å®åªæ˜¯è¯­è¨€æœ¬èº«çš„ä¸€ä¸ª bugï¼Œå³å¯¹ null æ‰§è¡Œ\ntypeof null æ—¶ä¼šè¿”å›å­—ç¬¦ä¸² \"object\" ã€‚ 1 å®é™…ä¸Šï¼Œ null æœ¬èº«æ˜¯åŸºæœ¬ç±»å‹ã€‚\næœ‰ä¸€ç§å¸¸è§çš„é”™è¯¯è¯´æ³•æ˜¯â€œJavaScript ä¸­ä¸‡ç‰©çš†æ˜¯å¯¹è±¡â€ï¼Œè¿™æ˜¾ç„¶æ˜¯é”™è¯¯çš„ã€‚</p>\n<p>å®é™…ä¸Šï¼ŒJavaScript ä¸­æœ‰è®¸å¤šç‰¹æ®Šçš„å¯¹è±¡å­ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºå¤æ‚åŸºæœ¬ç±»å‹ã€‚\nå‡½æ•°å°±æ˜¯å¯¹è±¡çš„ä¸€ä¸ªå­ç±»å‹ï¼ˆä»æŠ€æœ¯è§’åº¦æ¥è¯´å°±æ˜¯â€œå¯è°ƒç”¨çš„å¯¹è±¡â€ï¼‰ã€‚JavaScript ä¸­çš„å‡½\næ•°æ˜¯â€œä¸€ç­‰å…¬æ°‘â€ï¼Œå› ä¸ºå®ƒä»¬æœ¬è´¨ä¸Šå’Œæ™®é€šçš„å¯¹è±¡ä¸€æ ·ï¼ˆåªæ˜¯å¯ä»¥è°ƒç”¨ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥åƒæ“ä½œ\nå…¶ä»–å¯¹è±¡ä¸€æ ·æ“ä½œå‡½æ•°ï¼ˆæ¯”å¦‚å½“ä½œå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼‰ã€‚</p>\n<p>æ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡çš„ä¸€ç§ç±»å‹ï¼Œå…·å¤‡ä¸€äº›é¢å¤–çš„è¡Œä¸ºã€‚æ•°ç»„ä¸­å†…å®¹çš„ç»„ç»‡æ–¹å¼æ¯”ä¸€èˆ¬çš„å¯¹è±¡è¦\nç¨å¾®å¤æ‚ä¸€äº›ã€‚</p>\n<h3 id=\"å†…ç½®å¯¹è±¡\">å†…ç½®å¯¹è±¡</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">String</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Number</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Boolean</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Object</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Function</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Array</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Date</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">RegExp</span>\n<span class=\"token operator\">*</span> <span class=\"token known-class-name class-name\">Error</span>\n</code></pre></div>\n<p>åœ¨JavaScriptä¸­ä»–ä»¬åªæ˜¯ä¸€äº›å†…ç½®å‡½æ•°ï¼Œå¯ä»¥å½“åšæ„é€ å‡½æ•°æ¥ä½¿ç”¨ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> strPrimitive <span class=\"token operator\">=</span> <span class=\"token string\">\"I am a string\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> strPrimitive<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 13</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> strPrimitive<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">charAt</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"m\"</span>\n</code></pre></div>\n<p>javascriptå¼•æ“ä¼šè‡ªåŠ¨å°†å­—é¢é‡è½¬æ¢æˆStringå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®å±æ€§å’Œæ–¹æ³•ã€‚åŒæ ·é€‚ç”¨äºæ•°å€¼å­—é¢é‡ã€‚</p>\n<h3 id=\"å†…å®¹\">å†…å®¹</h3>\n<p>è·å–å±æ€§å€¼çš„æ–¹æ³•æœ‰ä¸¤ç§</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// å±æ€§è®¿é—®</span>\n<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span>\n<span class=\"token comment\">// é”®è®¿é—®</span>\n<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span>\n</code></pre></div>\n<h4 id=\"å¯å°±ç®—å±æ€§å\">å¯å°±ç®—å±æ€§å</h4>\n<p>ES6 å¢åŠ äº†å¯è®¡ç®—å±æ€§åï¼Œå¯ä»¥åœ¨æ–‡å­—å½¢å¼ä¸­ä½¿ç”¨ [] åŒ…è£¹ä¸€ä¸ªè¡¨è¾¾å¼æ¥å½“ä½œå±æ€§å</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> prefix <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">[</span>prefix <span class=\"token operator\">+</span> <span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">[</span>prefix <span class=\"token operator\">+</span> <span class=\"token string\">\"baz\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">\"world\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">[</span><span class=\"token string\">\"foobar\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// hello</span>\nmyObject<span class=\"token punctuation\">[</span><span class=\"token string\">\"foobaz\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// world</span>\n</code></pre></div>\n<h4 id=\"å¤åˆ¶å¯¹è±¡\">å¤åˆ¶å¯¹è±¡</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">anotherFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*..*/</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> anotherObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  c<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> anotherArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  b<span class=\"token operator\">:</span> anotherObject<span class=\"token punctuation\">,</span> <span class=\"token comment\">// å¼•ç”¨ï¼Œä¸æ˜¯å¤æœ¬ï¼</span>\n  c<span class=\"token operator\">:</span> anotherArray<span class=\"token punctuation\">,</span> <span class=\"token comment\">// å¦ä¸€ä¸ªå¼•ç”¨ï¼</span>\n  d<span class=\"token operator\">:</span> anotherFunction\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nanotherArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span> anotherObject<span class=\"token punctuation\">,</span> myObject <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// æµ…å¤åˆ¶</span>\n<span class=\"token keyword\">var</span> newObj <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">assign</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> myObject <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æ·±å¤åˆ¶è¿˜éœ€è¦æ³¨æ„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p>\n<h4 id=\"å±æ€§æè¿°ç¬¦\">å±æ€§æè¿°ç¬¦</h4>\n<p>ä» ES5 å¼€å§‹ï¼Œæ‰€æœ‰çš„å±æ€§éƒ½å…·å¤‡äº†å±æ€§æè¿°ç¬¦</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span> myObject<span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// {</span>\n<span class=\"token comment\">// value: 2,</span>\n<span class=\"token comment\">// writable: true,</span>\n<span class=\"token comment\">// enumerable: true,</span>\n<span class=\"token comment\">// configurable: true</span>\n<span class=\"token comment\">// }</span>\n</code></pre></div>\n<p>é€šè¿‡ Object.getOwnPropertyDescriptor(...) å¯ä»¥è·å–å±æ€§çš„æè¿°å¯¹è±¡ï¼ŒåŒ…å« valueï¼ˆå±æ€§å€¼ï¼‰ï¼Œwritableï¼ˆå¯å†™çš„ï¼‰ï¼Œenumerableï¼ˆå¯æšä¸¾ï¼‰ï¼Œconfigurableï¼ˆå¯é…ç½®ï¼‰</p>\n<p>åœ¨åˆ›å»ºæ™®é€šå±æ€§æ—¶ï¼Œå±æ€§æè¿°ç¬¦ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œå¯ä»¥é€šè¿‡ Object.defineProperty(...)é’ˆå¯¹ä¸Šè¾¹çš„å‡ ä¸ªå€¼æ¥è¿›è¡Œè®¾ç½®ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span> myObject<span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  value<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  writable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<ol>\n<li>writable</li>\n</ol>\n<p>æ§åˆ¶å±æ€§å€¼æ˜¯å¦èƒ½è¢«å†™å…¥ï¼Œè®¾ç½®ä¸º false æ—¶ï¼Œå°†æ— æ³•å¯¹å±æ€§è¿›è¡Œèµ‹å€¼æ“ä½œã€‚</p>\n<ol start=\"2\">\n<li>configurable</li>\n</ol>\n<p>æ§åˆ¶å±æ€§å€¼æ˜¯å¦å¯ä»¥è¢«é…ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºå¯é…ç½®çš„å±æ€§å€¼ï¼Œå°†å…¶configurableè®¾ç½®ä¸ºfalseï¼Œé‚£ä¹ˆæ— æ³•å†æ¬¡ä½¿ç”¨ Object.defineProperty(...)æ¥å°†configurableè®¾ç½®ä¸º trueï¼ŒæŠŠ configurable ä¿®æ”¹æˆ\nfalse æ˜¯å•å‘æ“ä½œï¼Œæ— æ³•æ’¤é”€ï¼</p>\n<blockquote>\n<p>è¦æ³¨æ„æœ‰ä¸€ä¸ªå°å°çš„ä¾‹å¤–ï¼šå³ä¾¿å±æ€§æ˜¯ configurable:false ï¼Œ æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥\næŠŠ writable çš„çŠ¶æ€ç”± true æ”¹ä¸º false ï¼Œä½†æ˜¯æ— æ³•ç”± false æ”¹ä¸º true ã€‚</p>\n</blockquote>\n<p>é™¤äº†æ— æ³•ä¿®æ”¹ï¼Œ configurable:false è¿˜ä¼šç¦æ­¢åˆ é™¤è¿™ä¸ªå±æ€§</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n<span class=\"token keyword\">delete</span> myObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span> myObject<span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  value<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  writable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n<span class=\"token keyword\">delete</span> myObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ delete åªç”¨æ¥ç›´æ¥åˆ é™¤å¯¹è±¡çš„ï¼ˆå¯åˆ é™¤ï¼‰å±æ€§ã€‚å¦‚æœå¯¹è±¡çš„æŸä¸ªå±æ€§æ˜¯æŸä¸ª\nå¯¹è±¡ / å‡½æ•°çš„æœ€åä¸€ä¸ªå¼•ç”¨è€…ï¼Œå¯¹è¿™ä¸ªå±æ€§æ‰§è¡Œ delete æ“ä½œä¹‹åï¼Œè¿™ä¸ªæœªå¼•ç”¨çš„å¯¹è±¡ / å‡½æ•°å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶ã€‚ä½†æ˜¯ï¼Œä¸è¦æŠŠ delete çœ‹ä½œä¸€ä¸ªé‡Šæ”¾å†…å­˜çš„å·¥å…·ï¼ˆå°±åƒ C/C++ ä¸­é‚£\næ ·ï¼‰ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªåˆ é™¤å¯¹è±¡å±æ€§çš„æ“ä½œï¼Œä»…æ­¤è€Œå·²ã€‚</p>\n<ol start=\"3\">\n<li>Enumerable</li>\n</ol>\n<p>è¿™ä¸ªæè¿°ç¬¦æ§åˆ¶çš„æ˜¯å±æ€§æ˜¯å¦ä¼šå‡ºç°åœ¨å¯¹è±¡çš„å±æ€§æšä¸¾ä¸­ï¼Œæ¯”å¦‚è¯´\nfor..in å¾ªç¯ã€‚å¦‚æœæŠŠ enumerable è®¾ç½®æˆ false ï¼Œè¿™ä¸ªå±æ€§å°±ä¸ä¼šå‡ºç°åœ¨æšä¸¾ä¸­ï¼Œè™½ç„¶ä»\nç„¶å¯ä»¥æ­£å¸¸è®¿é—®å®ƒã€‚ç›¸å¯¹åœ°ï¼Œè®¾ç½®æˆ true å°±ä¼šè®©å®ƒå‡ºç°åœ¨æšä¸¾ä¸­ã€‚</p>\n<h4 id=\"ä¸å˜æ€§\">ä¸å˜æ€§</h4>\n<p>æœ‰æ—¶å€™ä½ ä¼šå¸Œæœ›å±æ€§æˆ–è€…å¯¹è±¡æ˜¯ä¸å¯æ”¹å˜ï¼ˆæ— è®ºæœ‰æ„è¿˜æ˜¯æ— æ„ï¼‰çš„ï¼Œåœ¨ ES5 ä¸­å¯ä»¥é€šè¿‡å¾ˆ\nå¤šç§æ–¹æ³•æ¥å®ç°ã€‚</p>\n<p>å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„æ–¹æ³•åˆ›å»ºçš„éƒ½æ˜¯æµ…ä¸å˜å½¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åªä¼šå½±å“ç›®æ ‡å¯¹è±¡å’Œ\nå®ƒçš„ç›´æ¥å±æ€§ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å¼•ç”¨äº†å…¶ä»–å¯¹è±¡ï¼ˆæ•°ç»„ã€å¯¹è±¡ã€å‡½æ•°ï¼Œç­‰ï¼‰ï¼Œå…¶ä»–å¯¹è±¡çš„å†…\nå®¹ä¸å—å½±å“ï¼Œä»ç„¶æ˜¯å¯å˜çš„ï¼š</p>\n<ol>\n<li>å¯¹è±¡å¸¸é‡\nç»“åˆ writable:false å’Œ configurable:false å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªçœŸæ­£çš„å¸¸é‡å±æ€§ï¼ˆä¸å¯ä¿®æ”¹ã€\né‡å®šä¹‰æˆ–è€…åˆ é™¤ï¼‰ï¼š</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>a<span class=\"token operator\">:</span> <span class=\"token number\">123</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>b<span class=\"token operator\">:</span> obj1<span class=\"token punctuation\">}</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span>obj2<span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>writable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nobj1<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">=</span> <span class=\"token number\">456</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>obj2<span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 456</span>\n</code></pre></div>\n<p>æ— æ³•ç›´æ¥é€šè¿‡ obj2.b = ... å†™å…¥ï¼Œä½†æ˜¯ï¼Œå¯ä»¥æ”¹å˜ obj2.b çš„å¼•ç”¨å¯¹è±¡</p>\n<ol start=\"2\">\n<li>ç¦æ­¢æ‰©å±•</li>\n</ol>\n<p>å¦‚æœä½ æƒ³ç¦æ­¢ä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°å±æ€§å¹¶ä¸”ä¿ç•™å·²æœ‰å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ Object.prevent\nExtensions(..) ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">preventExtensions</span><span class=\"token punctuation\">(</span> myObject <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span>\n</code></pre></div>\n<p>åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåˆ›å»ºå±æ€§ b ä¼šé™é»˜å¤±è´¥ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå°†ä¼šæŠ›å‡º TypeError é”™è¯¯ã€‚</p>\n<ol start=\"3\">\n<li>å¯†å°</li>\n</ol>\n<p>Object.seal(..) ä¼šåˆ›å»ºä¸€ä¸ªâ€œå¯†å°â€çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•å®é™…ä¸Šä¼šåœ¨ä¸€ä¸ªç°æœ‰å¯¹è±¡ä¸Šè°ƒç”¨\nObject.preventExtensions(..) å¹¶æŠŠæ‰€æœ‰ç°æœ‰å±æ€§æ ‡è®°ä¸º configurable:false ã€‚</p>\n<p>æ‰€ä»¥ï¼Œå¯†å°ä¹‹åä¸ä»…ä¸èƒ½æ·»åŠ æ–°å±æ€§ï¼Œä¹Ÿä¸èƒ½é‡æ–°é…ç½®æˆ–è€…åˆ é™¤ä»»ä½•ç°æœ‰å±æ€§ï¼ˆè™½ç„¶å¯ä»¥\nä¿®æ”¹å±æ€§çš„å€¼ï¼‰ã€‚</p>\n<ol start=\"4\">\n<li>å†»ç»“</li>\n</ol>\n<p>Object.freeze(..) ä¼šåˆ›å»ºä¸€ä¸ªå†»ç»“å¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•å®é™…ä¸Šä¼šåœ¨ä¸€ä¸ªç°æœ‰å¯¹è±¡ä¸Šè°ƒç”¨\nObject.seal(..) å¹¶æŠŠæ‰€æœ‰â€œæ•°æ®è®¿é—®â€å±æ€§æ ‡è®°ä¸º writable:false ï¼Œè¿™æ ·å°±æ— æ³•ä¿®æ”¹å®ƒä»¬\nçš„å€¼ã€‚</p>\n<p>è¿™ä¸ªæ–¹æ³•æ˜¯ä½ å¯ä»¥åº”ç”¨åœ¨å¯¹è±¡ä¸Šçš„çº§åˆ«æœ€é«˜çš„ä¸å¯å˜æ€§ï¼Œå®ƒä¼šç¦æ­¢å¯¹äºå¯¹è±¡æœ¬èº«åŠå…¶ä»»æ„\nç›´æ¥å±æ€§çš„ä¿®æ”¹ï¼ˆä¸è¿‡å°±åƒæˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ï¼Œè¿™ä¸ªå¯¹è±¡å¼•ç”¨çš„å…¶ä»–å¯¹è±¡æ˜¯ä¸å—å½±å“çš„ï¼‰ã€‚\nä½ å¯ä»¥â€œæ·±åº¦å†»ç»“â€ä¸€ä¸ªå¯¹è±¡ï¼Œå…·ä½“æ–¹æ³•ä¸ºï¼Œé¦–å…ˆåœ¨è¿™ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ Object.freeze(..) ï¼Œ\nç„¶åéå†å®ƒå¼•ç”¨çš„æ‰€æœ‰å¯¹è±¡å¹¶åœ¨è¿™äº›å¯¹è±¡ä¸Šè°ƒç”¨ Object.freeze(..) ã€‚ä½†æ˜¯ä¸€å®šè¦å°å¿ƒï¼Œå› \nä¸ºè¿™æ ·åšæœ‰å¯èƒ½ä¼šåœ¨æ— æ„ä¸­å†»ç»“å…¶ä»–ï¼ˆå…±äº«ï¼‰å¯¹è±¡ã€‚</p>\n<h3 id=\"getter-å’Œ-setter\">getter å’Œ setter</h3>\n<p>åœ¨ ES5 ä¸­å¯ä»¥ä½¿ç”¨ getter å’Œ setter éƒ¨åˆ†æ”¹å†™é»˜è®¤æ“ä½œï¼Œä½†æ˜¯åªèƒ½åº”ç”¨åœ¨å•ä¸ªå±æ€§ä¸Šï¼Œæ— æ³•\nåº”ç”¨åœ¨æ•´ä¸ªå¯¹è±¡ä¸Šã€‚getter æ˜¯ä¸€ä¸ªéšè—å‡½æ•°ï¼Œä¼šåœ¨è·å–å±æ€§å€¼æ—¶è°ƒç”¨ã€‚setter ä¹Ÿæ˜¯ä¸€ä¸ªéšè—\nå‡½æ•°ï¼Œä¼šåœ¨è®¾ç½®å±æ€§å€¼æ—¶è°ƒç”¨ã€‚</p>\n<p>å½“ä½ ç»™ä¸€ä¸ªå±æ€§å®šä¹‰ getterã€setter æˆ–è€…ä¸¤è€…éƒ½æœ‰æ—¶ï¼Œè¿™ä¸ªå±æ€§ä¼šè¢«å®šä¹‰ä¸ºâ€œè®¿é—®æè¿°\nç¬¦â€ï¼ˆå’Œâ€œæ•°æ®æè¿°ç¬¦â€ç›¸å¯¹ï¼‰ã€‚å¯¹äºè®¿é—®æè¿°ç¬¦æ¥è¯´ï¼ŒJavaScript ä¼šå¿½ç•¥å®ƒä»¬çš„ value å’Œ\nwritable ç‰¹æ€§ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…³å¿ƒ set å’Œ get ï¼ˆè¿˜æœ‰ configurable å’Œ enumerable ï¼‰ç‰¹æ€§ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ç»™ a å®šä¹‰ä¸€ä¸ª getter</span>\n  <span class=\"token keyword\">get</span> <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span>\nmyObject<span class=\"token punctuation\">,</span> <span class=\"token comment\">// ç›®æ ‡å¯¹è±¡</span>\n<span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// å±æ€§å</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token comment\">// æè¿°ç¬¦</span>\n    <span class=\"token comment\">// ç»™ b è®¾ç½®ä¸€ä¸ª getter</span>\n    <span class=\"token function-variable function\">get</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ç¡®ä¿ b ä¼šå‡ºç°åœ¨å¯¹è±¡çš„å±æ€§åˆ—è¡¨ä¸­</span>\n    enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4</span>\n</code></pre></div>\n<h3 id=\"å­˜åœ¨æ€§\">å­˜åœ¨æ€§</h3>\n<p>é€šè¿‡ obj.key è®¿é—®å±æ€§çš„è¿”å›å€¼å¯èƒ½æ˜¯ undefinedï¼Œä½†æ˜¯è¿™ä¸ªå€¼å¯èƒ½æ˜¯å¯¹è±¡ä¸­å±æ€§å€¼ä¸º undefinedï¼Œæˆ–è€…ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\na<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span> <span class=\"token keyword\">in</span> myObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">(</span><span class=\"token string\">\"b\"</span> <span class=\"token keyword\">in</span> myObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasOwnProperty</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"a\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasOwnProperty</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"b\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n</code></pre></div>\n<p>in æ“ä½œç¬¦ä¼šæ£€æŸ¥å±æ€§æ˜¯å¦åœ¨å¯¹è±¡åŠå…¶ [[Prototype]] åŸå‹é“¾ä¸­ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œ\nhasOwnProperty(..) åªä¼šæ£€æŸ¥å±æ€§æ˜¯å¦åœ¨ myObject å¯¹è±¡ä¸­ï¼Œä¸ä¼šæ£€æŸ¥ [[Prototype]] é“¾</p>\n<p>ä½†æ˜¯å¦‚æœæ˜¯é’ˆå¯¹Object.create(null) çš„å¯¹è±¡ï¼Œæ˜¯æ— æ³•è°ƒç”¨ hasOwnProperty çš„ï¼Œå¯ä»¥é€šè¿‡</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasOwnProperty</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>myObject<span class=\"token punctuation\">,</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span> \n</code></pre></div>\n<p>å®ƒå€Ÿç”¨åŸºç¡€çš„ hasOwnProperty(..) æ–¹æ³•å¹¶æŠŠå®ƒæ˜¾å¼ç»‘å®šåˆ° myObject ä¸Š</p>\n<p>in æ“ä½œç¬¦å’Œ hasOwnProperty æ— è®ºå±æ€§æ˜¯å¦å¯æšä¸¾éƒ½å¯ä»¥æ‰¾åˆ°ï¼Œé‚£ä¹ˆå¦‚ä½•åŒºåˆ†å±æ€§æ˜¯ä¸æ˜¯å¯æšä¸¾å‘¢ï¼Ÿ</p>\n<ul>\n<li>for ... in ä¸ä¼šéå†ä¸å¯æšä¸¾çš„å±æ€§</li>\n<li>propertyIsEnumerable(...) ä¼šæ£€æŸ¥ç»™å®šçš„å±æ€§åæ˜¯å¦ç›´æ¥å­˜åœ¨äºå¯¹è±¡ä¸­ï¼ˆè€Œä¸æ˜¯åœ¨åŸå‹é“¾ä¸Šï¼‰å¹¶ä¸”æ»¡è¶³ enumerable:true ã€‚</li>\n</ul>\n<p>Object.keys(..) ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼Œ Object.getOwnPropertyNames(..)ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å±æ€§ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦å¯æšä¸¾ã€‚</p>\n<p>in å’Œ hasOwnProperty(..) çš„åŒºåˆ«åœ¨äºæ˜¯å¦æŸ¥æ‰¾ [[Prototype]] é“¾ï¼Œç„¶è€Œï¼ŒObject.keys(..)å’Œ Object.getOwnPropertyNames(..) éƒ½åªä¼šæŸ¥æ‰¾å¯¹è±¡ç›´æ¥åŒ…å«çš„å±æ€§ã€‚</p>\n<hr>\n<h2 id=\"ç¬¬å››ç« -æ··åˆå¯¹è±¡ç±»\">ç¬¬å››ç«  æ··åˆå¯¹è±¡ç±»</h2>\n<h3 id=\"ç±»ç†è®º\">ç±»ç†è®º</h3>\n<p>ç±»/ç»§æ‰¿æè¿°äº†ä¸€ç§ä»£ç çš„ç»„ç»‡ç»“æ„å½¢å¼---ä¸€ç§åœ¨è½¯ä»¶ä¸­å¯¹çœŸå®ä¸–ç•Œé—®é¢˜é¢†åŸŸçš„å»ºæ¨¡æ–¹æ³•ã€‚</p>\n<p>ç±»çš„å¦ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯å¤šæ€ï¼Œè¿™ä¸ªæ¦‚å¿µæ˜¯è¯´çˆ¶ç±»çš„é€šç”¨è¡Œä¸ºå¯ä»¥è¢«å­ç±»ç”¨æ›´ç‰¹æ®Šçš„è¡Œä¸ºé‡\nå†™ã€‚å®é™…ä¸Šï¼Œç›¸å¯¹å¤šæ€æ€§å…è®¸æˆ‘ä»¬ä»é‡å†™è¡Œä¸ºä¸­å¼•ç”¨åŸºç¡€è¡Œä¸ºã€‚</p>\n<h4 id=\"ç±»è®¾è®¡æ¨¡å¼\">ç±»è®¾è®¡æ¨¡å¼</h4>\n<p>ç±»æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼</p>\n<h4 id=\"javascriptä¸­çš„ç±»\">JavaScriptä¸­çš„ç±»</h4>\n<p>ç”±äºç±»æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨ä¸€äº›æ–¹æ³•ï¼ˆæœ¬ç« ä¹‹åä¼šä»‹ç»ï¼‰è¿‘ä¼¼å®ç°ç±»çš„åŠŸèƒ½ã€‚\nä¸ºäº†æ»¡è¶³å¯¹äºç±»è®¾è®¡æ¨¡å¼çš„æœ€æ™®ééœ€æ±‚ï¼ŒJavaScript æä¾›äº†ä¸€äº›è¿‘ä¼¼ç±»çš„è¯­æ³•ã€‚å…¶ä»–è¯­è¨€ä¸­çš„ç±»å’Œ JavaScript\nä¸­çš„â€œç±»â€å¹¶ä¸ä¸€æ ·ã€‚</p>\n<h4 id=\"ç±»çš„ç»§æ‰¿\">ç±»çš„ç»§æ‰¿</h4>\n<p>å¤šæ€å¹¶ä¸è¡¨ç¤ºå­ç±»å’Œçˆ¶ç±»æœ‰å…³è”ï¼Œå­ç±»å¾—åˆ°çš„åªæ˜¯çˆ¶ç±»çš„ä¸€ä»½å‰¯æœ¬ã€‚ç±»çš„ç»§æ‰¿å…¶å®å°±æ˜¯\nå¤åˆ¶ã€‚</p>\n<h4 id=\"æ··å…¥\">æ··å…¥</h4>\n<p>åœ¨ç»§æ‰¿æˆ–è€…å®ä¾‹åŒ–æ—¶ï¼ŒJavaScript çš„å¯¹è±¡æœºåˆ¶å¹¶ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œå¤åˆ¶è¡Œä¸ºã€‚ç®€å•æ¥è¯´ï¼Œ\nJavaScript ä¸­åªæœ‰å¯¹è±¡ï¼Œå¹¶ä¸å­˜åœ¨å¯ä»¥è¢«å®ä¾‹åŒ–çš„â€œç±»â€ã€‚ä¸€ä¸ªå¯¹è±¡å¹¶ä¸ä¼šè¢«å¤åˆ¶åˆ°å…¶ä»–å¯¹\nè±¡ï¼Œå®ƒä»¬ä¼šè¢«å…³è”èµ·æ¥ï¼ˆå‚è§ç¬¬ 5 ç« ï¼‰ã€‚</p>\n<p>ç”±äºåœ¨å…¶ä»–è¯­è¨€ä¸­ç±»è¡¨ç°å‡ºæ¥çš„éƒ½æ˜¯å¤åˆ¶è¡Œä¸ºï¼Œå› æ­¤ JavaScript å¼€å‘è€…ä¹Ÿæƒ³å‡ºäº†ä¸€ä¸ªæ–¹æ³•æ¥\næ¨¡æ‹Ÿç±»çš„å¤åˆ¶è¡Œä¸ºï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æ··å…¥ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šçœ‹åˆ°ä¸¤ç§ç±»å‹çš„æ··å…¥ï¼šæ˜¾å¼å’Œéšå¼ã€‚</p>\n<h4 id=\"æ˜¾ç¤ºæ··å…¥\">æ˜¾ç¤ºæ··å…¥</h4>\n<p>ç”±äº JavaScript ä¸ä¼šè‡ªåŠ¨å®ç° Vehicle\nåˆ° Car çš„å¤åˆ¶è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®ç°å¤åˆ¶åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨è®¸å¤šåº“å’Œæ¡†æ¶ä¸­è¢«ç§°ä¸º\nextend(..) ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£æˆ‘ä»¬ç§°ä¹‹ä¸º mixin(..) ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">mixin</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">sourceObj<span class=\"token punctuation\">,</span> targetObju</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> key <span class=\"token keyword\">in</span> sourceObj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>key <span class=\"token keyword\">in</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      targetObj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sourceObj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä½†æ˜¯ä¸Šè¾¹è¿™ä¸€ç±»å†™æ³•å¤åˆ¶çš„åªæ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥ï¼Œå¦‚æœ target ä¸­çš„å¼•ç”¨æ”¹å˜å¯èƒ½ä¼šå¼•èµ·sourceObjä¸­çš„æ”¹å˜ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// å¦ä¸€ç§æ··å…¥å‡½æ•°ï¼Œå¯èƒ½æœ‰é‡å†™é£é™©</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">mixin</span><span class=\"token punctuation\">(</span> <span class=\"token parameter\">sourceObj<span class=\"token punctuation\">,</span> targetObj</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> key <span class=\"token keyword\">in</span> sourceObj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  targetObj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sourceObj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">return</span> targetObj<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> <span class=\"token maybe-class-name\">Vehicle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡å¹¶æŠŠ Vehicle çš„å†…å®¹å¤åˆ¶è¿›å»</span>\n<span class=\"token keyword\">var</span> <span class=\"token maybe-class-name\">Car</span> <span class=\"token operator\">=</span> <span class=\"token function\">mixin</span><span class=\"token punctuation\">(</span> <span class=\"token maybe-class-name\">Vehicle</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ç„¶åæŠŠæ–°å†…å®¹å¤åˆ¶åˆ° Car ä¸­</span>\n<span class=\"token function\">mixin</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">{</span>\n  wheels<span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">drive</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Car</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>ä¸Šè¾¹è¿™ç±»å†™æ³•å¯ä»¥ä¸è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åŒçš„å±æ€§ã€‚ä½†æ˜¯ï¼Œè¿˜æ˜¯å­˜åœ¨å’Œä¸Šä¸€ä¸ªå†™æ³•åŒæ ·çš„é—®é¢˜ï¼Œ</p>\n<h4 id=\"å¯„ç”Ÿç»§æ‰¿\">å¯„ç”Ÿç»§æ‰¿</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// â€œä¼ ç»Ÿçš„ JavaScript ç±»â€Vehicle</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Vehicle</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">engines</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Vehicle</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">ignition</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Turning on my engine.\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">Vehicle</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">drive</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">ignition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Steering and moving forward!\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// â€œå¯„ç”Ÿç±»â€ Car</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Car</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// é¦–å…ˆï¼Œcar æ˜¯ä¸€ä¸ª Vehicle</span>\n  <span class=\"token keyword\">var</span> car <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vehicle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// æ¥ç€æˆ‘ä»¬å¯¹ car è¿›è¡Œå®šåˆ¶</span>\n  car<span class=\"token punctuation\">.</span><span class=\"token property-access\">wheels</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ä¿å­˜åˆ° Vehicle::drive() çš„ç‰¹æ®Šå¼•ç”¨</span>\n  <span class=\"token keyword\">var</span> vehDrive <span class=\"token operator\">=</span> car<span class=\"token punctuation\">.</span><span class=\"token property-access\">drive</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// é‡å†™ Vehicle::drive()</span>\n  car<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">drive</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  vehDrive<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"Rolling on all \"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">wheels</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" wheels!\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> car<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> myCar <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyCar<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">drive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>åœ¨ Car ä¸­ç›´æ¥å®ä¾‹åŒ– Vehicleï¼Œæ·»åŠ è¦†ç›–å®ä¾‹çš„å±æ€§å¹¶ä¸”è¿”å›ï¼Œä¹‹åå†å¤–è¾¹å®ä¾‹åŒ– Car çš„æ—¶å€™æ— éœ€ new è°ƒç”¨ã€‚</p>\n<h4 id=\"éšå¼æ··å…¥\">éšå¼æ··å…¥</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token maybe-class-name\">Something</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">cool</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">greeting</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token maybe-class-name\">Something</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cool</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token maybe-class-name\">Something</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">greeting</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Hello World\"</span>\n<span class=\"token maybe-class-name\">Something</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\n<span class=\"token keyword\">var</span> <span class=\"token maybe-class-name\">Another</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">cool</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// éšå¼æŠŠ Something æ··å…¥ Another</span>\n    <span class=\"token maybe-class-name\">Something</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cool</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token maybe-class-name\">Another</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cool</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token maybe-class-name\">Another</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">greeting</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Hello World\"</span>\n<span class=\"token maybe-class-name\">Another</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">count</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1 ï¼ˆcount ä¸æ˜¯å…±äº«çŠ¶æ€ï¼‰</span>\n</code></pre></div>\n<hr>\n<h2 id=\"ç¬¬äº”ç« åŸå‹\">ç¬¬äº”ç« åŸå‹</h2>\n<h3 id=\"prototype\">[[prototype]]</h3>\n<p>javaScript ä¸­çš„å¯¹è±¡æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ [[Prototype]] å†…ç½®å±æ€§ï¼Œå…¶å®å°±æ˜¯å¯¹äºå…¶ä»–å¯¹è±¡çš„å¼•\nç”¨ã€‚å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡åœ¨åˆ›å»ºæ—¶ [[Prototype]] å±æ€§éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªéç©ºçš„å€¼ã€‚</p>\n<h4 id=\"prototype-ä½œç”¨\">[[prototype]] ä½œç”¨</h4>\n<p>å½“ä½ è¯•å›¾è®¿é—®å¯¹è±¡å±æ€§æ—¶å€™ï¼Œä¼šè§¦å‘ [[get]] æ“ä½œã€‚æ¯”å¦‚ myObject.a ã€‚å¯¹äºé»˜è®¤çš„ [[Get]] æ“ä½œæ¥è¯´ï¼Œç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥å¯¹è±¡æœ¬èº«æ˜¯å¦æœ‰è¿™ä¸ªå±æ€§ï¼Œå¦‚æœæœ‰çš„è¯å°±ä½¿ç”¨å®ƒã€‚</p>\n<p>å¯¹äºé»˜è®¤çš„ [[Get]] æ“ä½œæ¥è¯´ï¼Œå¦‚æœæ— æ³•åœ¨å¯¹è±¡æœ¬èº«æ‰¾åˆ°éœ€è¦çš„å±æ€§ï¼Œå°±ä¼šç»§ç»­è®¿é—®å¯¹è±¡\nçš„ [[Prototype]] é“¾</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> anotherObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªå…³è”åˆ° anotherObject çš„å¯¹è±¡</span>\n<span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span> anotherObject <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>Object.create(...) ä¼šåˆ›å»ºä¸€ä¸ª\nå¯¹è±¡å¹¶æŠŠè¿™ä¸ªå¯¹è±¡çš„ [[Prototype]] å…³è”åˆ°æŒ‡å®šçš„å¯¹è±¡ã€‚</p>\n<p>for..in å¾ªç¯å¯ä»¥ç”¨æ¥éå†å¯¹è±¡çš„å¯æšä¸¾å±æ€§åˆ—è¡¨ï¼ˆåŒ…æ‹¬ [[Prototype]] é“¾ï¼‰</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> anotherObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªå…³è”åˆ° anotherObject çš„å¯¹è±¡</span>\n<span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span> anotherObject <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> k <span class=\"token keyword\">in</span> myObject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"found: \"</span> <span class=\"token operator\">+</span> k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// found: a</span>\n<span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span> <span class=\"token keyword\">in</span> myObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<h4 id=\"prototype-å°½å¤´\">[[prototype]] å°½å¤´</h4>\n<p>æ‰€æœ‰æ™®é€šçš„ [[Prototype]] é“¾æœ€ç»ˆéƒ½ä¼šæŒ‡å‘å†…ç½®çš„ Object.prototype</p>\n<h4 id=\"å±æ€§è®¾ç½®å’Œå±è”½\">å±æ€§è®¾ç½®å’Œå±è”½</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">myObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ol>\n<li>\n<p>å¦‚æœ myObject å¯¹è±¡ä¸­åŒ…å«åä¸º foo çš„æ™®é€šæ•°æ®è®¿é—®å±æ€§ï¼Œè¿™æ¡èµ‹å€¼è¯­å¥åªä¼šä¿®æ”¹å·²æœ‰çš„å±\næ€§å€¼ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœ foo ä¸æ˜¯ç›´æ¥å­˜åœ¨äº myObject ä¸­ï¼Œ [[Prototype]] é“¾å°±ä¼šè¢«éå†ï¼Œç±»ä¼¼ [[Get]] æ“ä½œã€‚å¦‚æœåŸå‹é“¾ä¸Šæ‰¾ä¸åˆ° foo ï¼Œ foo å°±ä¼šè¢«ç›´æ¥æ·»åŠ åˆ° myObject ä¸Šã€‚</p>\n</li>\n<li>\n<p>ç„¶è€Œï¼Œå¦‚æœ foo å­˜åœ¨äºåŸå‹é“¾ä¸Šå±‚ï¼Œèµ‹å€¼è¯­å¥ myObject.foo = \"bar\" çš„è¡Œä¸ºå°±ä¼šæœ‰äº›ä¸åŒï¼ˆè€Œä¸”å¯èƒ½å¾ˆå‡ºäººæ„æ–™ï¼‰ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœå±æ€§å foo æ—¢å‡ºç°åœ¨ myObject ä¸­ä¹Ÿå‡ºç°åœ¨ myObject çš„ [[Prototype]] é“¾ä¸Šå±‚ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿå±è”½ã€‚ myObject ä¸­åŒ…å«çš„ foo å±æ€§ä¼šå±è”½åŸå‹é“¾ä¸Šå±‚çš„æ‰€æœ‰ foo å±æ€§ï¼Œå› ä¸ºmyObject.foo æ€»æ˜¯ä¼šé€‰æ‹©åŸå‹é“¾ä¸­æœ€åº•å±‚çš„ foo å±æ€§ã€‚</p>\n</li>\n</ol>\n<p>ä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹å¦‚æœ foo ä¸ç›´æ¥å­˜åœ¨äº myObject ä¸­è€Œæ˜¯å­˜åŸå‹åœ¨äºåŸå‹é“¾ä¸Šå±‚æ—¶ myObject.foo = \"bar\" ä¼šå‡ºç°çš„ä¸‰ç§æƒ…å†µ:</p>\n<ol>\n<li>å¦‚æœåœ¨ [[Prototype]] é“¾ä¸Šå±‚å­˜åœ¨åä¸º foo çš„æ™®é€šæ•°æ®è®¿é—®å±æ€§ï¼ˆå‚è§ç¬¬ 3 ç« ï¼‰å¹¶ä¸”æ²¡æœ‰è¢«æ ‡è®°ä¸ºåªè¯»ï¼ˆ writable:false ï¼‰ï¼Œé‚£å°±ä¼šç›´æ¥åœ¨ myObject ä¸­æ·»åŠ ä¸€ä¸ªåä¸º foo çš„æ–°å±æ€§ï¼Œå®ƒæ˜¯å±è”½å±æ€§ã€‚</li>\n<li>å¦‚æœåœ¨ [[Prototype]] é“¾ä¸Šå±‚å­˜åœ¨ foo ï¼Œä½†æ˜¯å®ƒè¢«æ ‡è®°ä¸ºåªè¯»ï¼ˆ writable:false ï¼‰ï¼Œé‚£ä¹ˆæ— æ³•ä¿®æ”¹å·²æœ‰å±æ€§æˆ–è€…åœ¨ myObject ä¸Šåˆ›å»ºå±è”½å±æ€§ã€‚å¦‚æœè¿è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä»£ç ä¼š\næŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚å¦åˆ™ï¼Œè¿™æ¡èµ‹å€¼è¯­å¥ä¼šè¢«å¿½ç•¥ã€‚æ€»ä¹‹ï¼Œä¸ä¼šå‘ç”Ÿå±è”½ã€‚</li>\n<li>å¦‚æœåœ¨ [[Prototype]] é“¾ä¸Šå±‚å­˜åœ¨ foo å¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ª setterï¼ˆå‚è§ç¬¬ 3 ç« ï¼‰ï¼Œé‚£å°±ä¸€å®šä¼šè°ƒç”¨è¿™ä¸ª setterã€‚ foo ä¸ä¼šè¢«æ·»åŠ åˆ°ï¼ˆæˆ–è€…è¯´å±è”½äºï¼‰ myObject ï¼Œä¹Ÿä¸ä¼šé‡æ–°å®šä¹‰ foo è¿™ä¸ª setterã€‚</li>\n</ol>\n<h4 id=\"ç±»å‡½æ•°\">ç±»å‡½æ•°</h4>\n<p>å¤šå¹´ä»¥æ¥ï¼ŒJavaScript ä¸­æœ‰ä¸€ç§å¥‡æ€ªçš„è¡Œä¸ºä¸€ç›´åœ¨è¢«æ— è€»åœ°æ»¥ç”¨ï¼Œé‚£å°±æ˜¯æ¨¡ä»¿ç±»ã€‚æˆ‘ä»¬ä¼š\nä»”ç»†åˆ†æè¿™ç§æ–¹æ³•ã€‚\nè¿™ç§å¥‡æ€ªçš„â€œç±»ä¼¼ç±»â€çš„è¡Œä¸ºåˆ©ç”¨äº†å‡½æ•°çš„ä¸€ç§ç‰¹æ®Šç‰¹æ€§ï¼šæ‰€æœ‰çš„å‡½æ•°é»˜è®¤éƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ª\nåä¸º prototype çš„å…¬æœ‰å¹¶ä¸”ä¸å¯æšä¸¾ï¼ˆå‚è§ç¬¬ 3 ç« ï¼‰çš„å±æ€§ï¼Œå®ƒä¼šæŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Foo</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { }</span>\n</code></pre></div>\n<p>è¿™ä¸ªå¯¹è±¡é€šå¸¸è¢«ç§°ä¸º Foo çš„åŸå‹ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡åä¸º Foo.prototype çš„å±æ€§å¼•ç”¨æ¥è®¿é—®å®ƒã€‚</p>\n<p>è¿™ä¸ªå¯¹è±¡åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>æœ€ç›´æ¥çš„è§£é‡Šå°±æ˜¯ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯åœ¨è°ƒç”¨ new Foo() ï¼ˆå‚è§ç¬¬ 2 ç« ï¼‰æ—¶åˆ›å»ºçš„ï¼Œæœ€åä¼šè¢«\nï¼ˆæœ‰ç‚¹æ­¦æ–­åœ°ï¼‰å…³è”åˆ°è¿™ä¸ªâ€œFoo ç‚¹ prototypeâ€å¯¹è±¡ä¸Šã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Foo</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// è·å– a çš„åŸå‹</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getPrototypeOf</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// Foo.prototype æ˜¯ a çš„åŸå‹</span>\n<span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isPrototypeOf</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>new Foo() ä¼šç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º a ï¼‰ï¼Œè¿™ä¸ªæ–°å¯¹è±¡çš„å†…éƒ¨é“¾æ¥ [[Prototype]] å…³è”çš„æ˜¯ Foo.prototype å¯¹è±¡ã€‚</p>\n<p>æœ€åæˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªå¯¹è±¡ï¼Œå®ƒä»¬ä¹‹é—´äº’ç›¸å…³è”ï¼Œå°±æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œå®\né™…ä¸Šæˆ‘ä»¬å¹¶æ²¡æœ‰ä»â€œç±»â€ä¸­å¤åˆ¶ä»»ä½•è¡Œä¸ºåˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œåªæ˜¯è®©ä¸¤ä¸ªå¯¹è±¡äº’ç›¸å…³è”ã€‚</p>\n<p>å®é™…ä¸Šï¼Œç»å¤§å¤šæ•° JavaScript å¼€å‘è€…ä¸çŸ¥é“çš„ç§˜å¯†æ˜¯ï¼Œ new Foo() è¿™ä¸ªå‡½æ•°è°ƒç”¨å®é™…ä¸Šå¹¶æ²¡æœ‰ç›´æ¥åˆ›å»ºå…³è”ï¼Œè¿™ä¸ªå…³è”åªæ˜¯ä¸€ä¸ªæ„å¤–çš„å‰¯ä½œç”¨ã€‚ new Foo() åªæ˜¯é—´æ¥å®Œæˆäº†æˆ‘ä»¬çš„ç›®\næ ‡ï¼šä¸€ä¸ªå…³è”åˆ°å…¶ä»–å¯¹è±¡çš„æ–°å¯¹è±¡ã€‚</p>\n<p>é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´ç›´æ¥çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿå½“ç„¶ï¼åŠŸè‡£å°±æ˜¯ Object.create(..) ï¼Œä¸è¿‡æˆ‘ä»¬\nç°åœ¨æš‚æ—¶ä¸ä»‹ç»å®ƒã€‚</p>\n<p>ç»§æ‰¿æ„å‘³ç€å¤åˆ¶æ“ä½œï¼ŒJavaScriptï¼ˆé»˜è®¤ï¼‰å¹¶ä¸ä¼šå¤åˆ¶å¯¹è±¡å±æ€§ã€‚ç›¸åï¼ŒJavaScript ä¼šåœ¨ä¸¤\nä¸ªå¯¹è±¡ä¹‹é—´åˆ›å»ºä¸€ä¸ªå…³è”ï¼Œè¿™æ ·ä¸€ä¸ªå¯¹è±¡å°±å¯ä»¥é€šè¿‡å§”æ‰˜è®¿é—®å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å’Œå‡½æ•°ã€‚\nå§”æ‰˜ï¼ˆå‚è§ç¬¬ 6 ç« ï¼‰è¿™ä¸ªæœ¯è¯­å¯ä»¥æ›´åŠ å‡†ç¡®åœ°æè¿° JavaScript ä¸­å¯¹è±¡çš„å…³è”æœºåˆ¶ã€‚</p>\n<h3 id=\"æ„é€ å‡½æ•°\">æ„é€ å‡½æ•°</h3>\n<p>åˆ°åº•æ˜¯ä»€ä¹ˆè®©æˆ‘ä»¬è®¤ä¸º Foo æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Ÿ</p>\n<p>ä¸€ä¸ªåŸå› æ˜¯æˆ‘ä»¬çœ‹åˆ°äº† new å…³é”®å­—ï¼Œåœ¨é¢å‘ç±»çš„è¯­è¨€ä¸­æ„é€ ç±»å®ä¾‹æ—¶ä¹Ÿä¼šç”¨åˆ°å®ƒã€‚å¦\nä¸€ä¸ªåŸå› æ˜¯ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬æ‰§è¡Œäº†ç±»çš„æ„é€ å‡½æ•°æ–¹æ³•ï¼Œ Foo() çš„è°ƒç”¨æ–¹å¼å¾ˆåƒåˆå§‹åŒ–ç±»æ—¶ç±»\næ„é€ å‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚</p>\n<p>é™¤äº†ä»¤äººè¿·æƒ‘çš„â€œæ„é€ å‡½æ•°â€è¯­ä¹‰å¤–ï¼Œ Foo.prototype è¿˜æœ‰å¦ä¸€ä¸ªç»æ‹›ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Foo</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">constructor</span> <span class=\"token operator\">===</span> <span class=\"token maybe-class-name\">Foo</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token property-access\">constructor</span> <span class=\"token operator\">===</span> <span class=\"token maybe-class-name\">Foo</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>Foo.prototype é»˜è®¤ï¼ˆåœ¨ä»£ç ä¸­ç¬¬ä¸€è¡Œå£°æ˜æ—¶ï¼ï¼‰æœ‰ä¸€ä¸ªå…¬æœ‰å¹¶ä¸”ä¸å¯æšä¸¾ï¼ˆå‚è§ç¬¬ 3 ç« ï¼‰\nçš„å±æ€§ .constructor ï¼Œè¿™ä¸ªå±æ€§å¼•ç”¨çš„æ˜¯å¯¹è±¡å…³è”çš„å‡½æ•°ï¼ˆæœ¬ä¾‹ä¸­æ˜¯ Foo ï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬\nå¯ä»¥çœ‹åˆ°é€šè¿‡â€œæ„é€ å‡½æ•°â€è°ƒç”¨ new Foo() åˆ›å»ºçš„å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ª .constructor å±æ€§ï¼ŒæŒ‡å‘\nâ€œåˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„å‡½æ•°â€ã€‚</p>\n<ol>\n<li>æ„é€ å‡½æ•°è¿˜æ˜¯è°ƒç”¨</li>\n</ol>\n<p>ä¸Šä¸€æ®µä»£ç å¾ˆå®¹æ˜“è®©äººè®¤ä¸º Foo æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨ new æ¥è°ƒç”¨å®ƒå¹¶ä¸”çœ‹åˆ°å®ƒ\nâ€œæ„é€ â€äº†ä¸€ä¸ªå¯¹è±¡ã€‚</p>\n<p>å®é™…ä¸Šï¼Œ Foo å’Œä½ ç¨‹åºä¸­çš„å…¶ä»–å‡½æ•°æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚å‡½æ•°æœ¬èº«å¹¶ä¸æ˜¯æ„é€ å‡½æ•°ï¼Œç„¶è€Œï¼Œå½“\nä½ åœ¨æ™®é€šçš„å‡½æ•°è°ƒç”¨å‰é¢åŠ ä¸Š new å…³é”®å­—ä¹‹åï¼Œå°±ä¼šæŠŠè¿™ä¸ªå‡½æ•°è°ƒç”¨å˜æˆä¸€ä¸ªâ€œæ„é€ å‡½æ•°\nè°ƒç”¨â€ã€‚å®é™…ä¸Šï¼Œ new ä¼šåŠ«æŒæ‰€æœ‰æ™®é€šå‡½æ•°å¹¶ç”¨æ„é€ å¯¹è±¡çš„å½¢å¼æ¥è°ƒç”¨å®ƒã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">NothingSpecial</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Don't mind me!\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NothingSpecial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// \"Don't mind me!\"</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// {}</span>\n</code></pre></div>\n<p>NothingSpecial åªæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨ new è°ƒç”¨æ—¶ï¼Œå®ƒå°±ä¼šæ„é€ ä¸€ä¸ªå¯¹è±¡å¹¶èµ‹å€¼\nç»™ a ï¼Œè¿™çœ‹èµ·æ¥åƒæ˜¯ new çš„ä¸€ä¸ªå‰¯ä½œç”¨ï¼ˆæ— è®ºå¦‚ä½•éƒ½ä¼šæ„é€ ä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚è¿™ä¸ªè°ƒç”¨æ˜¯ä¸€ä¸ªæ„\né€ å‡½æ•°è°ƒç”¨ï¼Œä½†æ˜¯ NothingSpecial æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</p>\n<p>æ¢å¥è¯è¯´ï¼Œåœ¨ JavaScript ä¸­å¯¹äºâ€œæ„é€ å‡½æ•°â€æœ€å‡†ç¡®çš„è§£é‡Šæ˜¯ï¼Œæ‰€æœ‰å¸¦ new çš„å‡½æ•°è°ƒç”¨ã€‚\nå‡½æ•°ä¸æ˜¯æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å½“ä¸”ä»…å½“ä½¿ç”¨ new æ—¶ï¼Œå‡½æ•°è°ƒç”¨ä¼šå˜æˆâ€œæ„é€ å‡½æ•°è°ƒç”¨â€ã€‚</p>\n<p>ä¹‹å‰è®¨è®º .constructor å±æ€§æ—¶æˆ‘ä»¬è¯´è¿‡ï¼Œçœ‹èµ·æ¥ a.constructor === Foo ä¸ºçœŸæ„å‘³ç€ a ç¡®å®æœ‰ä¸€ä¸ªæŒ‡å‘ Foo çš„ .constructor å±æ€§ï¼Œä½†æ˜¯äº‹å®ä¸æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆä¸å¹¸çš„è¯¯è§£ã€‚å®é™…ä¸Šï¼Œ .constructor å¼•ç”¨åŒæ ·è¢«å§”æ‰˜ç»™äº† Foo.prototype ï¼Œè€ŒFoo.prototype.constructor é»˜è®¤æŒ‡å‘ Foo ã€‚</p>\n<p>æŠŠ .constructor å±æ€§æŒ‡å‘ Foo çœ‹ä½œæ˜¯ a å¯¹è±¡ç”± Fooâ€œæ„é€ â€éå¸¸å®¹æ˜“ç†è§£ï¼Œä½†è¿™åªä¸è¿‡\næ˜¯ä¸€ç§è™šå‡çš„å®‰å…¨æ„Ÿã€‚ a.constructor åªæ˜¯é€šè¿‡é»˜è®¤çš„ [[Prototype]] å§”æ‰˜æŒ‡å‘ Foo ï¼Œè¿™å’Œâ€œæ„é€ â€æ¯«æ— å…³ç³»ã€‚</p>\n<p>ä¸¾ä¾‹æ¥è¯´ï¼Œ Foo.prototype çš„ .constructor å±æ€§åªæ˜¯ Foo å‡½æ•°åœ¨å£°æ˜æ—¶çš„é»˜è®¤å±æ€§ã€‚å¦‚æœ\nä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡å¹¶æ›¿æ¢äº†å‡½æ•°é»˜è®¤çš„ .prototype å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆæ–°å¯¹è±¡å¹¶ä¸ä¼šè‡ªåŠ¨è·\nå¾— .constructor å±æ€§ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Foo</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* .. */</span> <span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* .. */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªæ–°åŸå‹å¯¹è±¡</span>\n<span class=\"token keyword\">var</span> a1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\na1<span class=\"token punctuation\">.</span><span class=\"token property-access\">constructor</span> <span class=\"token operator\">===</span> <span class=\"token maybe-class-name\">Foo</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false!</span>\na1<span class=\"token punctuation\">.</span><span class=\"token property-access\">constructor</span> <span class=\"token operator\">===</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true!</span>\n</code></pre></div>\n<p>a1 å¹¶æ²¡æœ‰ .constructor å±æ€§ï¼Œæ‰€ä»¥å®ƒä¼šå§”æ‰˜ [[Prototype]] é“¾ä¸Šçš„ Foo.prototype ã€‚ä½†æ˜¯è¿™ä¸ªå¯¹è±¡ä¹Ÿæ²¡æœ‰ .constructor å±æ€§ï¼ˆä¸è¿‡é»˜è®¤çš„ Foo.prototype å¯¹è±¡æœ‰è¿™\nä¸ªå±æ€§ï¼ï¼‰ï¼Œæ‰€ä»¥å®ƒä¼šç»§ç»­å§”æ‰˜ï¼Œè¿™æ¬¡ä¼šå§”æ‰˜ç»™å§”æ‰˜é“¾é¡¶ç«¯çš„ Object.prototype ã€‚è¿™ä¸ªå¯¹è±¡\næœ‰ .constructor å±æ€§ï¼ŒæŒ‡å‘å†…ç½®çš„ Object(..) å‡½æ•°ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Foo</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* .. */</span> <span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* .. */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªæ–°åŸå‹å¯¹è±¡</span>\n<span class=\"token comment\">// éœ€è¦åœ¨ Foo.prototype ä¸Šâ€œä¿®å¤â€ä¸¢å¤±çš„ .constructor å±æ€§</span>\n<span class=\"token comment\">// æ–°å¯¹è±¡å±æ€§èµ·åˆ° Foo.prototype çš„ä½œç”¨</span>\n<span class=\"token comment\">// å…³äº defineProperty(..)ï¼Œå‚è§ç¬¬ 3 ç« </span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"constructor\"</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  writable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  value<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Foo</span> <span class=\"token comment\">// è®© .constructor æŒ‡å‘ Foo</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>.constructor å¹¶ä¸æ˜¯ä¸€ä¸ªä¸å¯å˜å±æ€§ã€‚å®ƒæ˜¯ä¸å¯æšä¸¾ï¼ˆå‚è§ä¸Šé¢çš„ä»£ç ï¼‰çš„ï¼Œä½†æ˜¯å®ƒçš„å€¼\næ˜¯å¯å†™çš„ï¼ˆå¯ä»¥è¢«ä¿®æ”¹ï¼‰ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥ç»™ä»»æ„ [[Prototype]] é“¾ä¸­çš„ä»»æ„å¯¹è±¡æ·»åŠ ä¸€ä¸ªå\nä¸º constructor çš„å±æ€§æˆ–è€…å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä½ å¯ä»¥ä»»æ„å¯¹å…¶èµ‹å€¼ã€‚</p>\n<p>a1.constructor æ˜¯ä¸€ä¸ªéå¸¸ä¸å¯é å¹¶ä¸”ä¸å®‰å…¨çš„å¼•ç”¨ã€‚é€šå¸¸æ¥è¯´è¦å°½é‡é¿å…ä½¿ç”¨è¿™äº›å¼•ç”¨ã€‚</p>\n<h3 id=\"åŸå‹ç»§æ‰¿\">åŸå‹ç»§æ‰¿</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Foo</span></span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">myName</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Bar</span></span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span>label</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token maybe-class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> name <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">label</span> <span class=\"token operator\">=</span> label<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Bar.prototype å¯¹è±¡å¹¶å…³è”åˆ° Foo.prototype</span>\n<span class=\"token class-name\">Bar</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// æ³¨æ„ï¼ç°åœ¨æ²¡æœ‰ Bar.prototype.constructor äº†</span>\n<span class=\"token comment\">// å¦‚æœä½ éœ€è¦è¿™ä¸ªå±æ€§çš„è¯å¯èƒ½éœ€è¦æ‰‹åŠ¨ä¿®å¤ä¸€ä¸‹å®ƒ</span>\n<span class=\"token class-name\">Bar</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">myLabel</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">label</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bar</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"obj a\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">myName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"a\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">myLabel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"obj a\"</span>\n</code></pre></div>\n<p>è¿™æ®µä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯è¯­å¥ Bar.prototype = Object.create( Foo.prototype ) ã€‚è°ƒç”¨Object.create(..) ä¼šå‡­ç©ºåˆ›å»ºä¸€ä¸ªâ€œæ–°â€å¯¹è±¡å¹¶æŠŠæ–°å¯¹è±¡å†…éƒ¨çš„ [[Prototype]] å…³è”åˆ°ä½ æŒ‡å®šçš„å¯¹è±¡ï¼ˆæœ¬ä¾‹ä¸­æ˜¯ Foo.prototype ï¼‰ã€‚</p>\n<p>å£°æ˜ function Bar() { .. } æ—¶ï¼Œå’Œå…¶ä»–å‡½æ•°ä¸€æ ·ï¼Œ Bar ä¼šæœ‰ä¸€ä¸ª .prototype å…³è”åˆ°é»˜è®¤çš„\nå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ Foo.prototype ã€‚å› æ­¤æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠ\nå®ƒå…³è”åˆ°æˆ‘ä»¬å¸Œæœ›çš„å¯¹è±¡ä¸Šï¼Œç›´æ¥æŠŠåŸå§‹çš„å…³è”å¯¹è±¡æŠ›å¼ƒæ‰ã€‚\næ³¨æ„ï¼Œä¸‹é¢è¿™ä¸¤ç§æ–¹å¼æ˜¯å¸¸è§çš„é”™è¯¯åšæ³•ï¼Œå®é™…ä¸Šå®ƒä»¬éƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// å’Œä½ æƒ³è¦çš„æœºåˆ¶ä¸ä¸€æ ·ï¼</span>\n<span class=\"token class-name\">Bar</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// åŸºæœ¬ä¸Šæ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½†æ˜¯å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ :(</span>\n<span class=\"token class-name\">Bar</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Bar.prototype = Foo.prototype å¹¶ä¸ä¼šåˆ›å»ºä¸€ä¸ªå…³è”åˆ° Bar.prototype çš„æ–°å¯¹è±¡ï¼Œå®ƒåª\næ˜¯è®© Bar.prototype ç›´æ¥å¼•ç”¨ Foo.prototype å¯¹è±¡ã€‚å› æ­¤å½“ä½ æ‰§è¡Œç±»ä¼¼ Bar.prototype.\nmyLabel = ... çš„èµ‹å€¼è¯­å¥æ—¶ä¼šç›´æ¥ä¿®æ”¹ Foo.prototype å¯¹è±¡æœ¬èº«ã€‚æ˜¾ç„¶è¿™ä¸æ˜¯ä½ æƒ³è¦çš„ç»“æœï¼Œå¦åˆ™ä½ æ ¹æœ¬ä¸éœ€è¦ Bar å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨ Foo å°±å¯ä»¥äº†ï¼Œè¿™æ ·ä»£ç ä¹Ÿä¼šæ›´ç®€å•ä¸€äº›ã€‚</p>\n<p>Bar.prototype = new Foo() çš„ç¡®ä¼šåˆ›å»ºä¸€ä¸ªå…³è”åˆ° Bar.prototype çš„æ–°å¯¹è±¡ã€‚ä½†æ˜¯å®ƒä½¿ç”¨äº† Foo(..) çš„â€œæ„é€ å‡½æ•°è°ƒç”¨â€ï¼Œå¦‚æœå‡½æ•° Foo æœ‰ä¸€äº›å‰¯ä½œç”¨ï¼ˆæ¯”å¦‚å†™æ—¥å¿—ã€ä¿®æ”¹çŠ¶æ€ã€æ³¨å†Œåˆ°å…¶ä»–å¯¹è±¡ã€ç»™ this æ·»åŠ æ•°æ®å±æ€§ï¼Œç­‰ç­‰ï¼‰çš„è¯ï¼Œå°±ä¼šå½±å“åˆ° Bar() çš„â€œåä»£â€ï¼Œåæœ\nä¸å ªè®¾æƒ³ã€‚</p>\n<p>å› æ­¤ï¼Œè¦åˆ›å»ºä¸€ä¸ªåˆé€‚çš„å…³è”å¯¹è±¡ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ Object.create(..) è€Œä¸æ˜¯ä½¿ç”¨å…·æœ‰å‰¯\nä½œç”¨çš„ Foo(..) ã€‚è¿™æ ·åšå”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ç„¶åæŠŠæ—§å¯¹è±¡æŠ›å¼ƒæ‰ï¼Œä¸èƒ½\nç›´æ¥ä¿®æ”¹å·²æœ‰çš„é»˜è®¤å¯¹è±¡ã€‚</p>\n<p>å¦‚æœèƒ½æœ‰ä¸€ä¸ªæ ‡å‡†å¹¶ä¸”å¯é çš„æ–¹æ³•æ¥ä¿®æ”¹å¯¹è±¡çš„ [[Prototype]] å…³è”å°±å¥½äº†ã€‚åœ¨ ES6 ä¹‹å‰ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡è®¾ç½® .<strong>proto</strong> å±æ€§æ¥å®ç°ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¹¶ä¸æ˜¯æ ‡å‡†å¹¶ä¸”æ— æ³•å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ã€‚ES6 æ·»åŠ äº†è¾…åŠ©å‡½æ•° Object.setPrototypeOf(..) ï¼Œå¯ä»¥ç”¨æ ‡å‡†å¹¶ä¸”å¯é çš„æ–¹æ³•æ¥ä¿®æ”¹å…³è”ã€‚</p>\n<p>æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ä¸¤ç§æŠŠ Bar.prototype å…³è”åˆ° Foo.prototype çš„æ–¹æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ES6 ä¹‹å‰éœ€è¦æŠ›å¼ƒé»˜è®¤çš„ Bar.prototype</span>\n<span class=\"token maybe-class-name\">Bar</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">ptototype</span> <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ES6 å¼€å§‹å¯ä»¥ç›´æ¥ä¿®æ”¹ç°æœ‰çš„ Bar.prototype</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setPrototypeOf</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">Bar</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"æ£€æŸ¥ç±»å…³ç³»\">æ£€æŸ¥ç±»å…³ç³»</h4>\n<p>æ£€æŸ¥ä¸€ä¸ªå®ä¾‹ï¼ˆJavaScript ä¸­çš„å¯¹è±¡ï¼‰çš„ç»§æ‰¿ç¥–å…ˆï¼ˆJavaScript ä¸­çš„å§”æ‰˜å…³è”ï¼‰é€šå¸¸è¢«ç§°ä¸ºå†…çœï¼ˆæˆ–è€…åå°„ï¼‰ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">Foo</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Foo</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">blah</span> <span class=\"token operator\">=</span> <span class=\"token spread operator\">...</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\na <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Foo</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-JS\"><code class=\"language-JS\">function isRelatedTo(o1, o2) {\nfunction F(){}\n  F.prototype = o2;\n  return o1 instanceof F;\n}\nvar a = {};\nvar b = Object.create( a );\nisRelatedTo( b, a ); // true</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-JS\"><code class=\"language-JS\">Foo.prototype.isPrototypeOf( a )</code></pre></div>\n<p>ä¸Šè¾¹ä¸¤æ®µä»£ç æ•ˆæœä¸€æ ·ï¼Œç¬¬äºŒç§æ–¹æ³•ä¸­å¹¶ä¸éœ€è¦é—´æ¥å¼•ç”¨å‡½æ•°ï¼ˆ Foo ï¼‰ï¼Œå®ƒçš„ .prototype å±æ€§ä¼šè¢«è‡ªåŠ¨è®¿é—®ã€‚æ¢å¥è¯è¯´ï¼Œè¯­è¨€å†…ç½®çš„ isPrototypeOf(..) å‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„ isRelatedTo(..) å‡½æ•°ã€‚</p>\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è·å–ä¸€ä¸ªå¯¹è±¡çš„ [[Prototype]] é“¾ã€‚åœ¨ ES5 ä¸­ï¼Œæ ‡å‡†çš„æ–¹æ³•æ˜¯ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">Object.getPrototypeOf( a );</code></pre></div>\n<p>å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼Œè¿™ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦å’Œæˆ‘ä»¬æƒ³çš„ä¸€æ ·ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">Object.getPrototypeOf( a ) === Foo.prototype; // true</code></pre></div>\n<p>ç»å¤§å¤šæ•°ï¼ˆä¸æ˜¯æ‰€æœ‰ï¼ï¼‰æµè§ˆå™¨ä¹Ÿæ”¯æŒä¸€ç§éæ ‡å‡†çš„æ–¹æ³•æ¥è®¿é—®å†…éƒ¨ [[Prototype]] å±æ€§ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">a.__proto__ === Foo.prototype; // true</code></pre></div>\n<p>è¿™ä¸ªå¥‡æ€ªçš„ .<strong>proto</strong> ï¼ˆåœ¨ ES6 ä¹‹å‰å¹¶ä¸æ˜¯æ ‡å‡†ï¼ï¼‰å±æ€§â€œç¥å¥‡åœ°â€å¼•ç”¨äº†å†…éƒ¨çš„\n[[Prototype]] å¯¹è±¡ï¼Œå¦‚æœä½ æƒ³ç›´æ¥æŸ¥æ‰¾ï¼ˆç”šè‡³å¯ä»¥é€šè¿‡ .<strong>proto</strong>.<strong>ptoto</strong>... æ¥éå†ï¼‰åŸå‹é“¾çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•éå¸¸æœ‰ç”¨ã€‚</p>\n<p>.<strong>proto</strong> çš„å®ç°å¤§è‡´ä¸Šæ˜¯è¿™æ ·çš„ï¼ˆå¯¹è±¡å±æ€§çš„å®šä¹‰å‚è§ç¬¬ 3 ç« ï¼‰ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"__proto__\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">get</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getPrototypeOf</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">set</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ES6 ä¸­çš„ setPrototypeOf(..)</span>\n    <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setPrototypeOf</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> o <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> o<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3 id=\"å¯¹è±¡å…³è”\">å¯¹è±¡å…³è”</h3>\n<p>[[Prototype]] æœºåˆ¶å°±æ˜¯å­˜åœ¨äºå¯¹è±¡ä¸­çš„ä¸€ä¸ªå†…éƒ¨é“¾æ¥ï¼Œå®ƒä¼šå¼•ç”¨å…¶ä»–å¯¹è±¡ã€‚</p>\n<p>é€šå¸¸æ¥è¯´ï¼Œè¿™ä¸ªé“¾æ¥çš„ä½œç”¨æ˜¯ï¼šå¦‚æœåœ¨å¯¹è±¡ä¸Šæ²¡æœ‰æ‰¾åˆ°éœ€è¦çš„å±æ€§æˆ–è€…æ–¹æ³•å¼•ç”¨ï¼Œå¼•æ“å°±\nä¼šç»§ç»­åœ¨ [[Prototype]] å…³è”çš„å¯¹è±¡ä¸Šè¿›è¡ŒæŸ¥æ‰¾ã€‚</p>\n<h3 id=\"åˆ›å»ºå…³è”\">åˆ›å»ºå…³è”</h3>\n<p>é‚£ [[Prototype]] æœºåˆ¶çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆ JavaScript å¼€å‘è€…è´¹è¿™ä¹ˆå¤§çš„åŠ›æ°”ï¼ˆæ¨¡æ‹Ÿç±»ï¼‰åœ¨ä»£ç ä¸­åˆ›å»ºè¿™äº›å…³è”å‘¢ï¼Ÿ</p>\n<p>Object.create(..) ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼ˆ bar ï¼‰å¹¶æŠŠå®ƒå…³è”åˆ°æˆ‘ä»¬æŒ‡å®šçš„å¯¹è±¡ï¼ˆ foo ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å……åˆ†å‘æŒ¥ [[Prototype]] æœºåˆ¶çš„å¨åŠ›ï¼ˆå§”æ‰˜ï¼‰å¹¶ä¸”é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼ˆæ¯”å¦‚ä½¿ç”¨ new çš„æ„é€ å‡½æ•°è°ƒç”¨ä¼šç”Ÿæˆ .prototype å’Œ .constructor å¼•ç”¨ï¼‰ã€‚</p>\n<p>Object.create(null) ä¼š åˆ› å»º ä¸€ ä¸ª æ‹¥ æœ‰ ç©ºï¼ˆ æˆ– è€… è¯´ null ï¼‰ [[Prototype]]\né“¾æ¥çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ— æ³•è¿›è¡Œå§”æ‰˜ã€‚ç”±äºè¿™ä¸ªå¯¹è±¡æ²¡æœ‰åŸå‹é“¾ï¼Œæ‰€ä»¥\ninstanceof æ“ä½œç¬¦ï¼ˆä¹‹å‰è§£é‡Šè¿‡ï¼‰æ— æ³•è¿›è¡Œåˆ¤æ–­ï¼Œå› æ­¤æ€»æ˜¯ä¼šè¿”å› false ã€‚\nè¿™äº›ç‰¹æ®Šçš„ç©º [[Prototype]] å¯¹è±¡é€šå¸¸è¢«ç§°ä½œâ€œå­—å…¸â€ï¼Œå®ƒä»¬å®Œå…¨ä¸ä¼šå—åˆ°åŸ\nå‹é“¾çš„å¹²æ‰°ï¼Œå› æ­¤éå¸¸é€‚åˆç”¨æ¥å­˜å‚¨æ•°æ®ã€‚</p>\n<p>æˆ‘ä»¬å¹¶ä¸éœ€è¦ç±»æ¥åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œåªéœ€è¦é€šè¿‡å§”æ‰˜æ¥å…³è”å¯¹è±¡å°±è¶³å¤Ÿäº†ã€‚è€Œ\nObject.create(..) ä¸åŒ…å«ä»»ä½•â€œç±»çš„è¯¡è®¡â€ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å®Œç¾åœ°åˆ›å»ºæˆ‘ä»¬æƒ³è¦çš„å…³è”å…³ç³»ã€‚</p>\n<p>Object.create(..) æ˜¯åœ¨ ES5 ä¸­æ–°å¢çš„å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ ES5 ä¹‹å‰çš„ç¯å¢ƒä¸­ï¼ˆæ¯”å¦‚æ—§ IEï¼‰å¦‚\næœè¦æ”¯æŒè¿™ä¸ªåŠŸèƒ½çš„è¯å°±éœ€è¦ä½¿ç”¨ä¸€æ®µç®€å•çš„ polyfill ä»£ç ï¼Œå®ƒéƒ¨åˆ†å®ç°äº† Object.\ncreate(..) çš„åŠŸèƒ½ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">create</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">create</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">o</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">function</span> <span class=\"token constant\">F</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">F</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span> <span class=\"token operator\">=</span> o<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">F</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ ‡å‡† ES5 ä¸­å†…ç½®çš„ Object.create(..) å‡½æ•°è¿˜æä¾›äº†ä¸€ç³»åˆ—é™„åŠ åŠŸèƒ½ï¼Œä½†æ˜¯ ES5 ä¹‹å‰çš„ç‰ˆæœ¬ä¸æ”¯æŒè¿™äº›åŠŸèƒ½ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> anotherObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span><span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> myObject <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span> anotherObject<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  b<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  writable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  value<span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  c<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  writable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  value<span class=\"token operator\">:</span> <span class=\"token number\">4</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasOwnProperty</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"a\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasOwnProperty</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"b\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">hasOwnProperty</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"c\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>\nmyObject<span class=\"token punctuation\">.</span><span class=\"token property-access\">c</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 4</span>\n</code></pre></div>\n<hr>\n<h2 id=\"ç¬¬å…­ç« -è¡Œä¸ºå§”æ‰˜\">ç¬¬å…­ç«  è¡Œä¸ºå§”æ‰˜</h2>\n<h3 id=\"é¢å‘å§”æ‰˜çš„è®¾è®¡\">é¢å‘å§”æ‰˜çš„è®¾è®¡</h3>\n<h4 id=\"ç±»ç†è®º-1\">ç±»ç†è®º</h4>\n<p>ç±»çš„è®¾è®¡æ–¹å¼å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š å®šä¹‰ä¸€ä¸ªçˆ¶ç±»ï¼Œå°†é€šç”¨çš„è¡Œä¸ºéƒ½å®šä¹‰åœ¨çˆ¶ç±»ä¸­ï¼Œç„¶åç”¨å­ç±»å»ç»§æ‰¿çˆ¶ç±»ï¼Œå¹¶ä¸”åœ¨å­ç±»ä¸­è¿›è¡Œç‰¹æ®Šè¡Œä¸ºçš„å¤„ç†ï¼Œç±»çš„è®¾è®¡æ¨¡å¼é¼“åŠ±åœ¨ç»§æ‰¿çš„æ—¶å€™è¿›è¡Œé‡å†™ã€‚</p>\n<h4 id=\"å§”æ‰˜çš„ç†è®º\">å§”æ‰˜çš„ç†è®º</h4>\n<p>ä¸éœ€è¦å°†é€šç”¨çš„è¡Œä¸ºå†…å®¹æ”¾åˆ°ä¸€èµ·ï¼Œå¯ä»¥åˆ†åˆ«åœ¨æ”¾ä¸¤ä¸ªå¯¹è±¡ä¸­ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥è¿›è¡Œå§”æ‰˜ã€‚</p>\n<h4 id=\"äº’ç›¸å§”æ‰˜\">äº’ç›¸å§”æ‰˜</h4>\n<p>å¦‚æœä½ å¼•ç”¨äº†ä¸€ä¸ªä¸¤è¾¹éƒ½ä¸å­˜åœ¨çš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œé‚£å°±ä¼šåœ¨ [[Prototype]] é“¾ä¸Šäº§ç”Ÿä¸€ä¸ªæ— é™é€’å½’çš„å¾ªç¯ã€‚</p>\n<p>ä½†æ˜¯å¦‚æœæ‰€æœ‰çš„å¼•ç”¨éƒ½è¢«ä¸¥æ ¼é™åˆ¶çš„è¯ï¼Œ B æ˜¯å¯ä»¥å§”æ‰˜ A çš„ï¼Œåä¹‹äº¦ç„¶ã€‚å› æ­¤ï¼Œäº’ç›¸å§”æ‰˜\nç†è®ºä¸Šæ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>\n<p>è¡Œä¸ºå§”æ‰˜è®¤ä¸ºå¯¹è±¡ä¹‹é—´æ˜¯å…„å¼Ÿå…³ç³»ï¼Œäº’ç›¸å§”æ‰˜ï¼Œè€Œä¸æ˜¯çˆ¶ç±»å’Œå­ç±»çš„å…³ç³»ã€‚JavaScript çš„\n[[Prototype]] æœºåˆ¶æœ¬è´¨ä¸Šå°±æ˜¯è¡Œä¸ºå§”æ‰˜æœºåˆ¶ã€‚</p>\n",
    "frontmatter": {
      "title": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šç¯‡",
      "img": "https://placem.at/places?h=140",
      "date": "2017-09-16"
    },
    "toc": "<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86\">ç¬¬ä¸€éƒ¨åˆ†</a></p>\n<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F\">ç¬¬ä¸€ç«  ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ</a></p>\n<ul>\n<li><a href=\"#11-%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%EF%BC%9A\">1.1 ç¼–è¯‘åŸç†ï¼š</a></li>\n<li><a href=\"#12-%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%9A%84%E7%90%86%E8%A7%A3\">1.2 ä½œç”¨åŸŸçš„ç†è§£</a></li>\n<li><a href=\"#13-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%B5%8C%E5%A5%97\">1.3 ä½œç”¨åŸŸåµŒå¥—</a></li>\n<li><a href=\"#14-%E5%BC%82%E5%B8%B8\">1.4 å¼‚å¸¸</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F\">ç¬¬äºŒç«  è¯æ³•ä½œç”¨åŸŸ</a></p>\n<ul>\n<li><a href=\"#21-%E8%AF%8D%E6%B3%95%E9%98%B6%E6%AE%B5\">2.1 è¯æ³•é˜¶æ®µ</a></li>\n<li><a href=\"#22-%E8%AF%8D%E6%B3%95%E6%AC%BA%E9%AA%97\">2.2 è¯æ³•æ¬ºéª—</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E5%9D%97%E4%BD%9C%E7%94%A8%E5%9F%9F\">ç¬¬ä¸‰ç«  å‡½æ•°ä½œç”¨åŸŸå’Œå—ä½œç”¨åŸŸ</a></p>\n<ul>\n<li><a href=\"#%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F\">å‡½æ•°ä½œç”¨åŸŸ</a></li>\n<li><a href=\"#%E5%9D%97%E4%BD%9C%E7%94%A8%E5%9F%9F\">å—ä½œç”¨åŸŸ</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%8F%90%E5%8D%87\">ç¬¬å››ç«  æå‡</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%97%AD%E5%8C%85\">ç¬¬äº”ç«  ä½œç”¨åŸŸé—­åŒ…</a></p>\n<ul>\n<li><a href=\"#%E9%97%AD%E5%8C%85\">é—­åŒ…</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86\">ç¬¬äºŒéƒ¨åˆ†</a></p>\n<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%85%B3%E4%BA%8E-this\">ç¬¬ä¸€ç«  å…³äº this</a></p>\n<ul>\n<li><a href=\"#%E5%AF%B9-this-%E7%9A%84%E8%AF%AF%E8%A7%A3\">å¯¹ this çš„è¯¯è§£</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%85%A8%E9%9D%A2%E4%BA%86%E8%A7%A3-this\">ç¬¬äºŒç«  å…¨é¢äº†è§£ this</a></p>\n<ul>\n<li><a href=\"#this%E7%9A%84%E7%BB%91%E5%AE%9A%E8%A7%84%E5%88%99\">thisçš„ç»‘å®šè§„åˆ™</a></li>\n<li><a href=\"#%E5%9B%9B%E7%A7%8D%E7%BB%91%E5%AE%9A%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7\">å››ç§ç»‘å®šçš„ä¼˜å…ˆçº§</a></li>\n<li><a href=\"#%E7%BB%91%E5%AE%9A%E4%BE%8B%E5%A4%96\">ç»‘å®šä¾‹å¤–</a></li>\n<li><a href=\"#this-%E8%AF%8D%E6%B3%95\">this è¯æ³•</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%AF%B9%E8%B1%A1\">ç¬¬ä¸‰ç«  å¯¹è±¡</a></p>\n<ul>\n<li><a href=\"#%E8%AF%AD%E6%B3%95\">è¯­æ³•</a></li>\n<li><a href=\"#%E7%B1%BB%E5%9E%8B\">ç±»å‹</a></li>\n<li><a href=\"#%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1\">å†…ç½®å¯¹è±¡</a></li>\n<li><a href=\"#%E5%86%85%E5%AE%B9\">å†…å®¹</a></li>\n<li><a href=\"#getter-%E5%92%8C-setter\">getter å’Œ setter</a></li>\n<li><a href=\"#%E5%AD%98%E5%9C%A8%E6%80%A7\">å­˜åœ¨æ€§</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%B7%B7%E5%90%88%E5%AF%B9%E8%B1%A1%E7%B1%BB\">ç¬¬å››ç«  æ··åˆå¯¹è±¡ç±»</a></p>\n<ul>\n<li><a href=\"#%E7%B1%BB%E7%90%86%E8%AE%BA\">ç±»ç†è®º</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%94%E7%AB%A0%E5%8E%9F%E5%9E%8B\">ç¬¬äº”ç« åŸå‹</a></p>\n<ul>\n<li><a href=\"#prototype\">[[prototype]]</a></li>\n<li><a href=\"#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0\">æ„é€ å‡½æ•°</a></li>\n<li><a href=\"#%E5%8E%9F%E5%9E%8B%E7%BB%A7%E6%89%BF\">åŸå‹ç»§æ‰¿</a></li>\n<li><a href=\"#%E5%AF%B9%E8%B1%A1%E5%85%B3%E8%81%94\">å¯¹è±¡å…³è”</a></li>\n<li><a href=\"#%E5%88%9B%E5%BB%BA%E5%85%B3%E8%81%94\">åˆ›å»ºå…³è”</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E8%A1%8C%E4%B8%BA%E5%A7%94%E6%89%98\">ç¬¬å…­ç«  è¡Œä¸ºå§”æ‰˜</a></p>\n<ul>\n<li><a href=\"#%E9%9D%A2%E5%90%91%E5%A7%94%E6%89%98%E7%9A%84%E8%AE%BE%E8%AE%A1\">é¢å‘å§”æ‰˜çš„è®¾è®¡</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
    "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šç¯‡",
    "id": "c34d6ff7671cf4ca397b709b871b1f32",
    "prev": {
      "name": "ç§»åŠ¨ç«¯é€‚é…çš„ä¸€äº›æ¦‚å¿µ",
      "id": "2958ee3836ab74361ac191f4a1a02f7c"
    },
    "next": {
      "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸‹ç¯‡",
      "id": "a99a03fe768754b82f7e545b55d5f3de"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸‹ç¯‡.md",
      "/home/zepang/WorkSpace/blog/posts/ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸‹ç¯‡.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¬¬ä¸€éƒ¨åˆ†\">ç¬¬ä¸€éƒ¨åˆ†</h1>\n<h2 id=\"ç¬¬ä¸€ç« æ·±å…¥ç¼–ç¨‹\">ç¬¬ä¸€ç« æ·±å…¥ç¼–ç¨‹</h2>\n<h3 id=\"å®è·µ\">å®è·µ</h3>\n<p>æŒæ¡å¼€å‘è€…å·¥å…·ç»ˆç«¯ï¼š<a href=\"http://blog.teamtreehouse.com/mastering-developer-tools-console\">http://blog.teamtreehouse.com/mastering-developer-tools-console</a></p>\n<p>ç¬¬ä¸€ç« è®²ä¸€äº›åŸºæœ¬çš„JavaScriptç¼–ç¨‹è¯­æ³•æ§åˆ¶è¯­å¥ç­‰è¿™äº›å†…å®¹ï¼Œæ¯”è¾ƒåŸºç¡€è·³è¿‡</p>\n<hr>\n<h3 id=\"ç¬¬äºŒç« æ·±å…¥javascript\">ç¬¬äºŒç« æ·±å…¥JavaScript</h3>\n<p>éœ€è¦äº†è§£çš„ä¸¤ä¸ªæœ¯è¯­ï¼š</p>\n<ul>\n<li>polyfilling</li>\n</ul>\n<p>å•è¯\"polyfill\"ï¼Œç”¨äºè¡¨ç¤ºæ ¹æ®æ–°ç‰¹æ€§çš„å®šä¹‰ï¼Œåˆ›å»ºä¸€æ®µä¸ä¹‹ç­‰ä»·ä½†èƒ½å¤Ÿåœ¨æ—§çš„JavaScriptç¯å¢ƒä¸­æ‰§è¡Œçš„ä»£ç ã€‚</p>\n<p>ES5-Shimï¼ˆ<a href=\"https://github.com/es-shims/es5-shim\">https://github.com/es-shims/es5-shim</a>ï¼‰å’Œ ES6-Shimï¼ˆ<a href=\"https://github.com/es-shims/es6-shim\">https://github.com/es-shims/es6-shim</a>ï¼‰</p>\n<ul>\n<li>transpiling</li>\n</ul>\n<p>ç”± transforming å’Œ compiling ç»„åˆè€Œæˆçš„æœ¯è¯­ï¼Œå› ä¸ºè¯­è¨€ä¸­æ–°å¢çš„è¯­æ³•æ— æ³•é€šè¿‡ pollyfilling æ¥è§£å†³å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦å·¥å…·è®²æ–°çš„è¯­æ³•è½¬æ¢æˆæ—§çš„è¯­æ³•ã€‚</p>\n<ul>\n<li>\n<p>Babel ï¼ˆhttps://babeljs.io/ï¼Œä» 6 åˆ° 5ï¼‰\nä» ES6+ ç¼–è¯‘è½¬æ¢åˆ° ES5</p>\n</li>\n<li>\n<p>Traceur ï¼ˆhttps://github.com/google/traceur-compilerï¼‰\nå°† ES6ã€ES7 åŠåç»­ç‰ˆæœ¬è½¬æ¢åˆ° ES5</p>\n</li>\n</ul>\n<hr>\n<h1 id=\"ç¬¬äºŒéƒ¨åˆ†-es6ä»¥åŠæ›´æ–°çš„ç‰ˆæœ¬\">ç¬¬äºŒéƒ¨åˆ† ES6ä»¥åŠæ›´æ–°çš„ç‰ˆæœ¬</h1>\n<h2 id=\"ç¬¬ä¸€ç« -esç°åœ¨ä¸æœªæ¥\">ç¬¬ä¸€ç«  ES?ç°åœ¨ä¸æœªæ¥</h2>\n<h3 id=\"ç‰ˆæœ¬\">ç‰ˆæœ¬</h3>\n<p>JavaScriptçš„å®˜æ–¹åç§°æ˜¯â€œECMAScriptâ€ï¼Œæœ€æ—©çš„JavaScriptç‰ˆæœ¬æ˜¯ES1å’ŒES2ï¼Œå®ƒä»¬ä¸æ€ä¹ˆè¢«äººæ‰€çŸ¥ï¼Œå®ç°ä¹Ÿå¾ˆå°‘ã€‚ç¬¬ä¸€ä¸ªæµè¡Œèµ·æ¥çš„JavaScriptç‰ˆæœ¬æ˜¯ES3ï¼Œå®ƒæˆä¸ºæµè§ˆå™¨ IE6-8 å’Œæ—©å‰çš„æ—§ç‰ˆ Android 2.x ç§»åŠ¨æµè§ˆå™¨çš„JavaScript æ ‡å‡†ã€‚å‡ºäºæŸäº›æ”¿æ²»åŸå› ï¼Œå€’éœ‰çš„ ES4 ä»æ¥æ²¡æœ‰æˆå½¢ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšè®¨è®ºã€‚</p>\n<p>2009 å¹´ï¼ŒES5 æ­£å¼å‘å¸ƒï¼ˆç„¶åæ˜¯ 2011 å¹´çš„ ES5.1ï¼‰ï¼Œåœ¨å½“ä»£æµè§ˆå™¨ï¼ˆåŒ…æ‹¬ Firefoxã€Chromeã€Operaã€Safari ä»¥åŠè®¸å¤šå…¶ä»–ç±»å‹ï¼‰çš„è¿›åŒ–å’Œçˆ†å‘ä¸­æˆä¸º JavaScript å¹¿æ³›ä½¿ç”¨çš„æ ‡å‡†ã€‚</p>\n<p>ä¸‹ä¸€ä¸ª JavaScript ç‰ˆæœ¬ï¼ˆå‘å¸ƒæ—¥æœŸä» 2013 å¹´æ‹–åˆ° 2014 å¹´ï¼Œç„¶ååˆåˆ° 2015 å¹´ï¼‰æ ‡ç­¾ï¼Œä¹‹å‰çš„å…±è¯†æ˜¾ç„¶æ˜¯ ES6ã€‚</p>\n<p>ä½†æ˜¯ï¼Œåœ¨ ES6 è§„èŒƒå‘å±•åæœŸï¼Œ å‡ºç°äº†è¿™æ ·çš„æ–¹æ¡ˆï¼šæœ‰äººå»ºè®®æœªæ¥çš„ç‰ˆæœ¬åº”è¯¥æ”¹æˆåŸºäºå¹´\nä»½ï¼Œæ¯”å¦‚ ES2016ï¼ˆä¹Ÿå°±æ˜¯ ES7ï¼‰æ¥æ ‡ç¤ºåœ¨ 2016 å¹´ç»“æŸä¹‹å‰æ•²å®šçš„ä»»ä½•ç‰ˆæœ¬çš„è§„èŒƒã€‚å°½ç®¡\næœ‰å¼‚è®®ï¼Œä½†æ¯”èµ·åæ¥æå‡ºçš„æ–¹æ¡ˆ ES2015ï¼Œå¾ˆå¯èƒ½ä¿æŒç»Ÿæ²»åœ°ä½çš„ç‰ˆæœ¬å‘½åä»æ˜¯ ES6ã€‚è€Œ\nES2016 å¯èƒ½ä¼šé‡‡ç”¨æ–°çš„åŸºäºå¹´ä»½çš„å‘½åæ–¹æ¡ˆã€‚</p>\n<h2 id=\"ç¬¬äºŒç« è¯­æ³•\">ç¬¬äºŒç« è¯­æ³•</h2>\n<h3 id=\"å¯¹è±¡å­—é¢é‡æ‹“å±•\">å¯¹è±¡å­—é¢é‡æ‹“å±•</h3>\n<h4 id=\"ç®€æ´å±æ€§\">ç®€æ´å±æ€§</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// es5 </span>\n<span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">x</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// es6</span>\n<span class=\"token keyword\">let</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">x</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ç®€æ´çš„å±æ€§å®é™…ä¸Šæ˜¯ç­‰ä»·äºæœªå‘½åå‡½æ•°ã€‚å¦‚æœå‡ºç°ä¸‹è¾¹çš„æƒ…å†µä¼šæŠ¥é”™</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">runSomething</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">o</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">radom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">radom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> o<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">something</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">runSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">something</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token function\">something</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">></span> y<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">something</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">return</span> y <span class=\"token operator\">-</span>x\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>å¦‚æœæ›´æ¢æˆES6çš„é—´æ¥å†™æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">runSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">something</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">></span> y<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">something</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä¼šæŠ¥é”™ï¼Œæ‰¾ä¸åˆ° something</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">return</span> y <span class=\"token operator\">-</span>x\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>æœ‰äººå–œæ¬¢ç”¨ä¸‹è¾¹çš„å†™æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">runSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">something</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">></span> y<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">something</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä¼šæŠ¥é”™ï¼Œæ‰¾ä¸åˆ° something</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">return</span> y <span class=\"token operator\">-</span>x\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œthisä¼šè¢«éšå¼ç»‘å®šï¼Œæ¯”å¦‚ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handle<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>æ‰€ä»¥è¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚</p>\n<h3 id=\"è®¾å®š-prototype\">è®¾å®š prototype</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> o1<span class=\"token punctuation\">.</span><span class=\"token property-access\">__proto__</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ç°åœ¨ ES6 å·²ç»æœ‰äº†æ–°çš„å·¥å…·å‡½æ•°æ¥è®¾ç½®</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> o1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> o2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setPrototypeOf</span><span class=\"token punctuation\">(</span>o1<span class=\"token punctuation\">,</span> o2<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h3 id=\"super-å¯¹è±¡\">super å¯¹è±¡</h3>\n<p>é€šå¸¸æŠŠ super çœ‹ä½œå’Œç±»ç›¸å…³çš„å±æ€§ï¼Œä½†æ˜¯å› ä¸ºJavaScriptçš„ç±»æ˜¯åŸå‹çš„ç±»ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„æœ¬è´¨ï¼Œæ‰€ä»¥ super å¯¹äºæ™®é€šå¯¹è±¡çš„ç®€æ´æ–¹æ³•ä¸€æ ·æœ‰æ•ˆã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> o1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"o1:foo\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> o2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"o2:foo\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setPrototypeOf</span><span class=\"token punctuation\">(</span> o2<span class=\"token punctuation\">,</span> o1 <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\no2<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// o1:foo</span>\n          <span class=\"token comment\">// o2:foo</span>\n</code></pre></div>\n<p>åŸºæœ¬ä¸Šè¿™é‡Œçš„ super å°±æ˜¯ Object.getPrototypeOf(o2)</p>\n<p>super åªå…è®¸åœ¨ç®€æ´æ–¹æ³•ä¸­å‡ºç°ï¼Œè€Œä¸å…è®¸åœ¨æ™®é€šå‡½æ•°è¡¨è¾¾å¼å±æ€§ä¸­å‡º\nç°ã€‚ä¹Ÿåªå…è®¸ä»¥ super.XXX çš„å½¢å¼ï¼ˆç”¨äºå±æ€§ / æ–¹æ³•è®¿é—®ï¼‰å‡ºç°ï¼Œè€Œä¸èƒ½ä»¥\nsuper() çš„å½¢å¼å‡ºç°ã€‚</p>\n<h3 id=\"æ ‡ç­¾æ¨¡æ¿å­—é¢é‡\">æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">string<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>values</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> desc <span class=\"token operator\">=</span> <span class=\"token string\">'awesome'</span>\nfoo<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Everything is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>desc<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">!!</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token comment\">// ['Everything is', '!!']</span>\n<span class=\"token comment\">// ['awesome']</span>\n</code></pre></div>\n<p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåä¸º strings ï¼Œæ˜¯ä¸€ä¸ªç”±æ‰€æœ‰æ™®é€šå­—ç¬¦ä¸²ï¼ˆæ’å…¥è¡¨è¾¾å¼ä¹‹é—´çš„éƒ¨åˆ†ï¼‰ç»„æˆçš„\næ•°ç»„ã€‚å¾—åˆ°çš„ strings æ•°ç»„ä¸­æœ‰ä¸¤ä¸ªå€¼ï¼š \"Everything is\" å’Œ \"!!\" ã€‚</p>\n<p>æœ¬è´¨ä¸Šè¯´ï¼Œè¿™æ˜¯ä¸€ç±»ä¸éœ€è¦ ( .. ) çš„ç‰¹æ®Šå‡½æ•°è°ƒç”¨ã€‚æ ‡ç­¾ï¼ˆtagï¼‰éƒ¨åˆ†ï¼Œå³ <code>..</code> å­—ç¬¦ä¸²å­—\né¢é‡ä¹‹å‰çš„ foo è¿™ä¸€éƒ¨åˆ† , æ˜¯ä¸€ä¸ªè¦è°ƒç”¨çš„å‡½æ•°å€¼ã€‚å®é™…ä¸Šï¼Œå®ƒå¯ä»¥æ˜¯ä»»æ„ç»“æœä¸ºå‡½æ•°çš„\nè¡¨è¾¾å¼ï¼Œç”šè‡³å¯ä»¥æ˜¯ä¸€ä¸ªç»“æœä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°è°ƒç”¨ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">string<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>values</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> desc <span class=\"token operator\">=</span> <span class=\"token string\">'awesome'</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Everything is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>desc<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">!!</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token comment\">// ['Everything is', '!!']</span>\n<span class=\"token comment\">// ['awesome']</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">tag</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">strings<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>values</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> strings<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reduce</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">s<span class=\"token punctuation\">,</span>v<span class=\"token punctuation\">,</span>idx</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> s <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>idx <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> values<span class=\"token punctuation\">[</span>idx<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> v<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> desc <span class=\"token operator\">=</span> <span class=\"token string\">\"awesome\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> tag<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Everything is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>desc<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> text <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Everything is awesome!</span>\n</code></pre></div>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œå°†æ•°å­—æ ¼å¼åŒ–ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">dollabillsyall</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">strings<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>values</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> strings<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s<span class=\"token punctuation\">,</span>v<span class=\"token punctuation\">,</span>idx</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>idx <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> values<span class=\"token punctuation\">[</span>idx <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        s <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">$</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>values<span class=\"token punctuation\">[</span>idx <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n        s <span class=\"token operator\">+=</span> values<span class=\"token punctuation\">[</span>idx <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> s <span class=\"token operator\">+</span> v\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> amt1 <span class=\"token operator\">=</span> <span class=\"token number\">11.99</span><span class=\"token punctuation\">,</span>\n    amt2 <span class=\"token operator\">=</span> amt1 <span class=\"token operator\">*</span> <span class=\"token number\">1.08</span><span class=\"token punctuation\">,</span>\n    name <span class=\"token operator\">=</span> <span class=\"token string\">\"Kyle\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> dollabillsyall\n<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Thanks for your purchase, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">! Your</span>\n<span class=\"token string\">product cost was </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>amt1<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, which with tax</span>\n<span class=\"token string\">comes out to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>amt2<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> text <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Thanks for your purchase, Kyle! Your</span>\n<span class=\"token comment\">// product cost was $11.99, which with tax</span>\n<span class=\"token comment\">// comes out to $12.95.</span>\n</code></pre></div>\n<h4 id=\"åŸå§‹ï¼ˆrawï¼‰å­—ç¬¦ä¸²\">åŸå§‹ï¼ˆrawï¼‰å­—ç¬¦ä¸²</h4>\n<p>åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæ ‡ç­¾å‡½æ•°æ”¶åˆ°ä¸€ä¸ªåä¸ºstringsçš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ä½†æ˜¯è¿˜åŒ…æ‹¬äº†ä¸€äº›é¢å¤–çš„æ•°æ®ï¼šæ‰€æœ‰å­—ç¬¦ä¸²çš„åŸå§‹æœªå¤„ç†ç‰ˆæœ¬ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·é€šè¿‡ .raw å±æ€§è®¿é—®è¿™\näº›åŸå§‹å­—ç¬¦ä¸²å€¼ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">showraw</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">strings<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>values</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> strings <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> strings<span class=\"token punctuation\">.</span><span class=\"token property-access\">raw</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nshowraw<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello\\nWorld</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// [ \"Hello</span>\n<span class=\"token comment\">// World\" ]</span>\n<span class=\"token comment\">// [ \"Hello\\nWorld\" ]</span>\n</code></pre></div>\n<h3 id=\"ç®­å¤´å‡½æ•°\">ç®­å¤´å‡½æ•°</h3>\n<p>é™¤äº†è¯æ³• this ï¼Œç®­å¤´å‡½æ•°è¿˜æœ‰è¯æ³• arguments â€”â€”å®ƒä»¬æ²¡æœ‰è‡ªå·±çš„ arguments æ•°ç»„ï¼Œè€Œæ˜¯ç»§æ‰¿è‡ªçˆ¶å±‚â€”â€”è¯æ³• super å’Œ new.target ä¹Ÿæ˜¯ä¸€æ ·ï¼ˆå‚è§ 3.4 èŠ‚ï¼‰ã€‚</p>\n<h3 id=\"for--of\">for ... of</h3>\n<p>ES6 åœ¨æŠŠ JavaScript ä¸­æˆ‘ä»¬ç†Ÿæ‚‰çš„ for å’Œ for..in å¾ªç¯ç»„åˆèµ·æ¥çš„åŸºç¡€ä¸Šï¼Œåˆæ–°å¢äº†ä¸€ä¸ª\nfor..of å¾ªç¯ï¼Œåœ¨è¿­ä»£å™¨äº§ç”Ÿçš„ä¸€ç³»åˆ—å€¼ä¸Šå¾ªç¯ã€‚\nfor..of å¾ªç¯çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ª iterableï¼Œæˆ–è€…è¯´å®ƒå¿…é¡»æ˜¯å¯ä»¥è½¬æ¢ / å°ç®±åˆ°ä¸€ä¸ª iterable å¯¹è±¡\nçš„å€¼ï¼ˆå‚è§æœ¬ç³»åˆ—ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptï¼ˆä¸­å·ï¼‰ã€‹ç¬¬ä¸€éƒ¨åˆ†ï¼‰ã€‚iterable å°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿäº§\nç”Ÿè¿­ä»£å™¨ä¾›å¾ªç¯ä½¿ç”¨çš„å¯¹è±¡ã€‚</p>\n<p>è¿™é‡Œæ˜¯ ES6 çš„ä½†æ˜¯ä¸ç”¨ for..of çš„ç­‰ä»·ä»£ç ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å±•ç¤ºå¦‚ä½•æ‰‹åŠ¨åœ¨è¿­ä»£å™¨ä¸Šè¿­ä»£</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"e\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> val<span class=\"token punctuation\">,</span> ret<span class=\"token punctuation\">,</span> it <span class=\"token operator\">=</span> a<span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">(</span>ret <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>ret<span class=\"token punctuation\">.</span><span class=\"token property-access\">done</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nval <span class=\"token operator\">=</span> ret<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">;</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> val <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// \"a\" \"b\" \"c\" \"d\" \"e\"</span>\n</code></pre></div>\n<hr>\n<h2 id=\"ä»£ç ç»„ç»‡\">ä»£ç ç»„ç»‡</h2>\n<p>ç¼–å†™ JavaScript ä»£ç æ˜¯ä¸€å›äº‹ï¼Œè€Œåˆç†ç»„ç»‡ä»£ç åˆ™æ˜¯å¦ä¸€å›äº‹ã€‚åˆ©ç”¨é€šç”¨æ¨¡å¼æ¥ç»„ç»‡å’Œå¤ç”¨ä»£ç æ˜¾è‘—æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç†è§£æ€§ã€‚ç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯ä»£ç æ€ä¹ˆå†™éƒ½èƒ½å®ç°çš„åŠŸèƒ½ï¼Œä½†æ˜¯é€šè¿‡æ¨¡å¼æ¥å†™çš„è¯ï¼Œå¯è¯»æ€§ä¼šæ¯”è¾ƒå¥½ã€‚</p>\n<p>ES6 æä¾›äº†å‡ ä¸ªé‡è¦çš„ç‰¹æ€§ã€‚</p>\n<ul>\n<li>è¿­ä»£å™¨</li>\n<li>ç”Ÿæˆå™¨</li>\n<li>æ¨¡å—</li>\n<li>ç±»</li>\n</ul>\n<h3 id=\"è¿­ä»£å™¨\">è¿­ä»£å™¨</h3>\n<h4 id=\"è¿­ä»£å™¨çš„æ¥å£\">è¿­ä»£å™¨çš„æ¥å£</h4>\n<p>ES6 ç¬¬ 25.1.1.2 èŠ‚ï¼ˆhttps://people.mozilla.org/~jorendorff/es6-draft.html#sec-iterator-interfaceï¼‰è¯¦ç»†è§£é‡Šäº† Iterator æ¥å£ï¼ŒåŒ…æ‹¬å¦‚ä¸‹è¦æ±‚ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token maybe-class-name\">Iterator</span> <span class=\"token punctuation\">[</span>required<span class=\"token punctuation\">]</span> \n        <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>method<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> å–å¾—ä¸‹ä¸€ä¸ªIteratorResult\n</code></pre></div>\n<p>æœ‰äº›è¿­ä»£å™¨è¿˜æ‰©å±•æ”¯æŒä¸¤ä¸ªå¯é€‰æˆå‘˜ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token maybe-class-name\">Iterator</span> <span class=\"token punctuation\">[</span>optional<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>method<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> åœæ­¢è¿­ä»£å™¨å¹¶è¿”å›IteratorResult\n        <span class=\"token keyword control-flow\">throw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>method<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> æŠ¥é”™å¹¶è¿”å›IteratorResult\n</code></pre></div>\n<p>IteratorResult æ¥å£æŒ‡å®šå¦‚ä¸‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token maybe-class-name\">IteratorResult</span>\n      value <span class=\"token punctuation\">{</span>property<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> å½“å‰è¿­ä»£å€¼æˆ–è€…æœ€ç»ˆè¿”å›å€¼ï¼ˆå¦‚æœ<span class=\"token keyword nil\">undefined</span>ä¸ºå¯é€‰çš„ï¼‰\n      done <span class=\"token punctuation\">{</span>property<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> å¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºå®ŒæˆçŠ¶æ€\n</code></pre></div>\n<blockquote>\n<p>æˆ‘æŠŠè¿™äº›æ¥å£ç§°ä¸ºéšå¼çš„ï¼Œå¹¶ä¸æ˜¯å› ä¸ºå®ƒä»¬æ²¡æœ‰åœ¨è§„èŒƒä¸­æ˜¾å¼è¯´æ˜â€”â€”å®ƒä»¬æœ‰è¯´æ˜ï¼â€”â€”è€Œæ˜¯å› ä¸ºå®ƒä»¬æ²¡æœ‰æš´éœ²ä¸ºä»£ç å¯ä»¥è®¿é—®çš„ç›´æ¥å¯¹è±¡ã€‚åœ¨ ES6ä¸­ï¼ŒJavaScript ä¸æ”¯æŒä»»ä½•â€œæ¥å£â€çš„æ¦‚å¿µï¼Œæ‰€ä»¥ä½ è‡ªå·±çš„ä»£ç ç¬¦åˆè§„èŒƒåªæ˜¯å•çº¯çš„æƒ¯ç”¨æ³•ã€‚ç„¶è€Œï¼Œåœ¨ JavaScript æœŸæœ›è¿­ä»£å™¨çš„ä½ç½® ( æ¯”å¦‚ for..of å¾ªç¯ ) æ‰€æä¾›çš„ä¸œè¥¿å¿…é¡»ç¬¦åˆè¿™äº›æ¥å£ï¼Œå¦åˆ™ä»£ç ä¼šå¤±è´¥ã€‚</p>\n</blockquote>\n<p>è¿˜æœ‰ä¸€ä¸ª Iterable æ¥å£ï¼Œç”¨æ¥è¡¨è¿°å¿…éœ€èƒ½å¤Ÿæä¾›ç”Ÿæˆå™¨çš„å¯¹è±¡ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token maybe-class-name\">Iterable</span>\n      @@<span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>method<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> äº§ç”Ÿä¸€ä¸ª <span class=\"token maybe-class-name\">Iterator</span>\n</code></pre></div>\n<h4 id=\"nextè¿­ä»£\">next()è¿­ä»£</h4>\n<p>è°ƒç”¨æ•°ç»„å’Œå­—ç¬¦ä¸²çš„[Symbol.iterator]æ–¹æ³•å¯ä»¥ç”Ÿæˆè¿­ä»£å™¨</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: 1, done: false }</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: 2, done: false }</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: 3, done: false }</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: undefined, done: true }</span>\n\n<span class=\"token keyword\">var</span> greeting <span class=\"token operator\">=</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> greeting<span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: \"h\", done: false }</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: \"e\", done: false }</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n</code></pre></div>\n<p>ES6 è¿˜åŒ…æ‹¬å‡ ä¸ªæ–°çš„ç§°ä¸ºé›†åˆçš„æ•°æ®ç»“æ„ï¼Œè¿™äº›é›†åˆä¸ä»…æœ¬èº«æ˜¯iterableï¼Œè¿˜æä¾›äº†APIæ–¹æ³•æ¥äº§ç”Ÿè¿­ä»£å™¨ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> m <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nm<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nm<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">{</span> cool<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello world\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> it1 <span class=\"token operator\">=</span> m<span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> it2 <span class=\"token operator\">=</span> m<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nit1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: [ \"foo\", 42 ], done: false }</span>\nit2<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { value: [ \"foo\", 42 ], done: false }</span>\n<span class=\"token spread operator\">...</span>\n</code></pre></div>\n<h4 id=\"è¿­ä»£å™¨å¾ªç¯\">è¿­ä»£å™¨å¾ªç¯</h4>\n<p>ES6 çš„ for..of å¾ªç¯ç›´æ¥æ¶ˆè€—ä¸€ä¸ªç¬¦åˆè§„èŒƒçš„ iterablï¼Œ\nå¦‚æœä¸€ä¸ªè¿­ä»£å™¨ä¹Ÿæ˜¯ä¸€ä¸ª iterableï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ç›´æ¥ç”¨äº for ... of çš„å¾ªç¯ã€‚ä½ å¯ä»¥é€šè¿‡ä¸ºè¿­ä»£\nå™¨æä¾›ä¸€ä¸ª Symbol.iterator æ–¹æ³•ç®€å•è¿”å›è¿™ä¸ªè¿­ä»£å™¨æœ¬èº«ä½¿å®ƒæˆä¸º iterableï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ä½¿è¿­ä»£å™¨itæˆä¸ºiterable</span>\n  <span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nit<span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> it<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> v <span class=\"token keyword\">of</span> it<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> v <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>è¦å½»åº•ç†è§£è¿™æ ·çš„å¾ªç¯å¦‚ä½•å·¥ä½œï¼Œå¯ä»¥å›é¡¾ä¸€ä¸‹ç¬¬ 2 ç«  for..of å¾ªç¯çš„ç­‰ä»· for å½¢å¼ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> v<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>res<span class=\"token punctuation\">.</span><span class=\"token property-access\">done</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  v <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">;</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> v <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å¯ä»¥çœ‹åˆ°æ¯æ¬¡è¿­ä»£ä¹‹å‰éƒ½è°ƒç”¨äº† it.next() ï¼Œç„¶åæŸ¥çœ‹ä¸€ä¸‹ res.done ã€‚å¦‚æœ res.done ä¸º true ï¼Œè¡¨è¾¾å¼æ±‚å€¼ä¸º false ï¼Œè¿­ä»£å°±ä¸ä¼šå‘ç”Ÿã€‚</p>\n<p>å›å¿†ä¸€ä¸‹ï¼Œå‰é¢æˆ‘ä»¬å»ºè®®è¿­ä»£å™¨ä¸€èˆ¬ä¸åº”ä¸æœ€ç»ˆé¢„æœŸçš„å€¼ä¸€èµ·è¿”å› done: true ã€‚ç°åœ¨èƒ½æ˜\nç™½å…¶ä¸­çš„åŸå› äº†å§ã€‚\nå¦‚æœè¿­ä»£å™¨è¿”å› { done: true, value: 42 } ï¼Œ for..of å¾ªç¯ä¼šå®Œå…¨ä¸¢å¼ƒå€¼ 42 ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±è¢«ä¸¢å¤±äº†ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼Œå‡å®šä½ çš„è¿­ä»£å™¨å¯èƒ½ä¼šé€šè¿‡ for..of å¾ªç¯æˆ–è€…æ‰‹åŠ¨çš„ç­‰ä»·for å½¢å¼æ¨¡å¼æ¶ˆè€—ï¼Œé‚£ä¹ˆä½ åº”è¯¥ç­‰è¿”å›æ‰€æœ‰çš„ç›¸å…³è¿­ä»£å€¼ä¹‹åï¼Œå†è¿”å› done: true æ¥æ ‡æ˜è¿­ä»£å®Œæ¯•ã€‚</p>\n<h4 id=\"è‡ªå®šä¹‰è¿­ä»£å™¨\">è‡ªå®šä¹‰è¿­ä»£å™¨</h4>\n<p>æ¥ä¸‹æ¥è€ƒè™‘ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå®ƒçš„è®¾è®¡æ„å›¾æ˜¯ç”¨æ¥åœ¨ä¸€ç³»åˆ—ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼‰åŠ¨ä½œä¸Šè¿è¡Œï¼Œä¸€æ¬¡ä¸€ä¸ªæ¡ç›®</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> task <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token keyword\">var</span> steps <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">actions</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">next</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token spread operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>steps<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> steps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span>args<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> value<span class=\"token operator\">:</span> res<span class=\"token punctuation\">,</span> done<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> done<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">tasks<span class=\"token punctuation\">.</span><span class=\"token property-access\">actions</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">step1</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"step 1:\"</span><span class=\"token punctuation\">,</span> x <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> x <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">step2</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span>y</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"step 2:\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> x <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>y <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">step3</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">,</span>z</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"step 3:\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> z <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">*</span> y<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> z<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> tasks<span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// step 1: 10</span>\n<span class=\"token comment\">// { value: 20, done: false }</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// step 2: 20 50</span>\n<span class=\"token comment\">// { value: 120, done: false }</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">120</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// step 3: 20 50 120</span>\n<span class=\"token comment\">// { value: 1120, done: false }</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { done: true }</span>\n</code></pre></div>\n<p>å®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨æ¥è¿›è¡Œå•ä¸ªæ•°æ®ä¸Šçš„æ“ä½œ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span>\n    <span class=\"token class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">,</span> \n    <span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">,</span> \n    <span class=\"token punctuation\">{</span>\n      writable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      configurable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      enumerable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">value</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token function\">iterator</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> i<span class=\"token punctuation\">,</span> inc<span class=\"token punctuation\">,</span> done <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> top <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// æ­£å‘è¿˜æ˜¯åå‘è¿­ä»£ï¼Ÿ</span>\n        inc <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>top <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function\">next</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>done<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                i <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n              <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>top <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                i <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">min</span><span class=\"token punctuation\">(</span>top<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> inc<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                i <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">max</span><span class=\"token punctuation\">(</span>top<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> inc<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span>\n\n              <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> top<span class=\"token punctuation\">)</span> done <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> value<span class=\"token operator\">:</span> i<span class=\"token punctuation\">,</span> done<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> done<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"è¿­ä»£å™¨æ¶ˆè€—\">è¿­ä»£å™¨æ¶ˆè€—</h4>\n<ul>\n<li>ç¬¬ä¸€ç§æ˜¯åˆ©ç”¨for...ofä¸€ä¸ªä¸€ä¸ªæ¶ˆè€—</li>\n<li>ç¬¬äºŒç§æ˜¯åˆ©ç”¨spreadè¿ç®—ç¬¦ä¸€æ¬¡æ€§æ¶ˆè€—</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> a<span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> <span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span>w<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> it\nite<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// {value: undefined, done: true}</span>\nw <span class=\"token comment\">// [1, 2, 3, 4]</span>\n</code></pre></div>\n<h3 id=\"ç”Ÿæˆå™¨\">ç”Ÿæˆå™¨</h3>\n<h4 id=\"è¯­æ³•\">è¯­æ³•</h4>\n<h4 id=\"yield\">yield</h4>\n<ul>\n<li>æ™®é€šçš„yieldè¯­æ³•æ˜¯æš‚åœç¬¦å·ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥æƒ³è±¡returnçš„æœºåˆ¶ï¼Œä½†æ˜¯ä¸ä¼šç»ˆæ­¢ã€‚</li>\n<li>yield å§”æ‰˜ï¼Œè¯­æ³•å’Œæ™®é€šçš„yieldå·®ä¸å¤šï¼Œä½†æ˜¯æœºåˆ¶ä¸ä¸€æ ·ã€‚å¯¹äºyield...è¡¨è¾¾å¼ï¼Œå®Œæˆå€¼æ¥è‡ªäºç”¨it.next()æ¢å¤ç”Ÿæˆå™¨çš„å€¼ï¼Œè€Œå¯¹äºyield *...è¡¨è¾¾å¼ï¼Œå®Œæˆå€¼æ¥è‡ªäºåŒ—å§”æ‰˜çš„è¿­ä»£å™¨çš„è¿”å›å€¼ã€‚</li>\n</ul>\n<p>yield *å¯ä»¥é€’å½’è°ƒç”¨ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    x <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">return</span> x <span class=\"token operator\">*</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// {value: 24, done: true}</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">nexzt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// {value: undefined, done: true}</span>\n</code></pre></div>\n<p>å¯ä»¥çœ‹å‡ºå®Œå…¨æ²¡æœ‰æš‚åœã€‚</p>\n<h4 id=\"æå‰å®Œæˆ\">æå‰å®Œæˆ</h4>\n<h4 id=\"é”™è¯¯å¤„ç†\">é”™è¯¯å¤„ç†</h4>\n<h4 id=\"transpile-ç”Ÿæˆå™¨\">Transpile ç”Ÿæˆå™¨</h4>\n<h4 id=\"ç”Ÿæˆå™¨ä½¿ç”¨åœºæ™¯\">ç”Ÿæˆå™¨ä½¿ç”¨åœºæ™¯</h4>\n<h3 id=\"æ¨¡å—\">æ¨¡å—</h3>\n<h3 id=\"ç±»\">ç±»</h3>\n",
    "frontmatter": {
      "title": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸‹ç¯‡",
      "img": "https://placem.at/places?h=140",
      "date": "2018-02-14"
    },
    "toc": "<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86\">ç¬¬ä¸€éƒ¨åˆ†</a></p>\n<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E7%AB%A0%E6%B7%B1%E5%85%A5%E7%BC%96%E7%A8%8B\">ç¬¬ä¸€ç« æ·±å…¥ç¼–ç¨‹</a></p>\n<ul>\n<li><a href=\"#%E5%AE%9E%E8%B7%B5\">å®è·µ</a></li>\n<li><a href=\"#%E7%AC%AC%E4%BA%8C%E7%AB%A0%E6%B7%B1%E5%85%A5javascript\">ç¬¬äºŒç« æ·±å…¥JavaScript</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-es6%E4%BB%A5%E5%8F%8A%E6%9B%B4%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC\">ç¬¬äºŒéƒ¨åˆ† ES6ä»¥åŠæ›´æ–°çš„ç‰ˆæœ¬</a></p>\n<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E7%AB%A0-es%E7%8E%B0%E5%9C%A8%E4%B8%8E%E6%9C%AA%E6%9D%A5\">ç¬¬ä¸€ç«  ES?ç°åœ¨ä¸æœªæ¥</a></p>\n<ul>\n<li><a href=\"#%E7%89%88%E6%9C%AC\">ç‰ˆæœ¬</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%8C%E7%AB%A0%E8%AF%AD%E6%B3%95\">ç¬¬äºŒç« è¯­æ³•</a></p>\n<ul>\n<li><a href=\"#%E5%AF%B9%E8%B1%A1%E5%AD%97%E9%9D%A2%E9%87%8F%E6%8B%93%E5%B1%95\">å¯¹è±¡å­—é¢é‡æ‹“å±•</a></li>\n<li><a href=\"#%E8%AE%BE%E5%AE%9A-prototype\">è®¾å®š prototype</a></li>\n<li><a href=\"#super-%E5%AF%B9%E8%B1%A1\">super å¯¹è±¡</a></li>\n<li><a href=\"#%E6%A0%87%E7%AD%BE%E6%A8%A1%E6%9D%BF%E5%AD%97%E9%9D%A2%E9%87%8F\">æ ‡ç­¾æ¨¡æ¿å­—é¢é‡</a></li>\n<li><a href=\"#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0\">ç®­å¤´å‡½æ•°</a></li>\n<li><a href=\"#for--of\">for ... of</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87\">ä»£ç ç»„ç»‡</a></p>\n<ul>\n<li><a href=\"#%E8%BF%AD%E4%BB%A3%E5%99%A8\">è¿­ä»£å™¨</a></li>\n<li><a href=\"#%E7%94%9F%E6%88%90%E5%99%A8\">ç”Ÿæˆå™¨</a></li>\n<li><a href=\"#%E6%A8%A1%E5%9D%97\">æ¨¡å—</a></li>\n<li><a href=\"#%E7%B1%BB\">ç±»</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
    "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸‹ç¯‡",
    "id": "a99a03fe768754b82f7e545b55d5f3de",
    "prev": {
      "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šç¯‡",
      "id": "c34d6ff7671cf4ca397b709b871b1f32"
    },
    "next": {
      "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸­ç¯‡",
      "id": "8d1f79b5c05b29fa2dc83d23d583f1ce"
    }
  },
  {
    "data": {},
    "messages": [],
    "history": [
      "/home/zepang/WorkSpace/blog/posts/ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸­ç¯‡.md",
      "/home/zepang/WorkSpace/blog/posts/ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸­ç¯‡.html"
    ],
    "cwd": "/home/zepang/WorkSpace/blog",
    "contents": "<h1 id=\"ç¬¬ä¸€éƒ¨åˆ†-ç±»å‹å’Œè¯­æ³•\">ç¬¬ä¸€éƒ¨åˆ† ç±»å‹å’Œè¯­æ³•</h1>\n<h2 id=\"ç¬¬ä¸€ç« -ç±»å‹\">ç¬¬ä¸€ç«  ç±»å‹</h2>\n<p>è¦æ­£ç¡®åˆç†åœ°è¿›è¡Œç±»å‹è½¬æ¢ï¼ˆå‚è§ç¬¬ 4 ç« ï¼‰ï¼Œæˆ‘ä»¬å¿…é¡»æŒæ¡ JavaScript ä¸­çš„å„ä¸ªç±»å‹åŠå…¶å†…åœ¨è¡Œä¸ºã€‚å‡ ä¹æ‰€æœ‰çš„ JavaScript ç¨‹åºéƒ½ä¼šæ¶‰åŠæŸç§å½¢å¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¤„ç†è¿™äº›æƒ…å†µæ—¶\næˆ‘ä»¬éœ€è¦æœ‰å……åˆ†çš„æŠŠæ¡å’Œè‡ªä¿¡ã€‚</p>\n<h3 id=\"å†…ç½®ç±»å‹\">å†…ç½®ç±»å‹</h3>\n<p>ä¸Šå·ç¬¬äºŒéƒ¨åˆ†å¯¹è±¡ä¸€ç« æåˆ°JavaScriptçš„ç±»å‹æœ‰6ç§ï¼Œç„¶è€Œè¿™é‡Œæåˆ°äº†7ç§ï¼š</p>\n<ul>\n<li>ç©ºå€¼(null)</li>\n<li>æœªå®šä¹‰(undefined)</li>\n<li>å¸ƒå°”å€¼(boolean)</li>\n<li>æ•°å­—(number)</li>\n<li>å­—ç¬¦ä¸²(string)</li>\n<li>å¯¹è±¡(object)</li>\n<li>ç¬¦å·(symbol, ES6 æ–°å¢)</li>\n</ul>\n<blockquote>\n<p>é™¤å¯¹è±¡ä¹‹å¤–ï¼Œå…¶ä»–ç»Ÿç§°ä¸ºâ€œåŸºæœ¬ç±»å‹â€ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ typeof è¿ç®—ç¬¦æ¥æŸ¥çœ‹å€¼çš„ç±»å‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">typeof</span> <span class=\"token keyword nil\">undefined</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token boolean\">true</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"boolean\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token number\">42</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"number\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token string\">\"42\"</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token punctuation\">{</span> life<span class=\"token operator\">:</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// ES6ä¸­æ–°åŠ å…¥çš„ç±»å‹</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"symbol\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>ä»¥ä¸Š6ç§ç±»å‹éƒ½æœ‰ç›¸åº”çš„å­—ç¬¦ä¸²å€¼ä¸ä¹‹ç›¸å‘¼åº”ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ null</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">typeof</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span>\n</code></pre></div>\n<p>æ­£ç¡®çš„è¿”å›ç»“æœåº”è¯¥æ˜¯ \"null\" ï¼Œä½†è¿™ä¸ª bug ç”±æ¥å·²ä¹…ï¼Œåœ¨ JavaScript ä¸­å·²ç»å­˜åœ¨äº†å°†è¿‘\näºŒåå¹´ï¼Œä¹Ÿè®¸æ°¸è¿œä¹Ÿä¸ä¼šä¿®å¤ï¼Œå› ä¸ºè¿™ç‰µæ¶‰åˆ°å¤ªå¤šçš„ Web ç³»ç»Ÿï¼Œâ€œä¿®å¤â€å®ƒä¼šäº§ç”Ÿæ›´å¤šçš„\nbugï¼Œä»¤è®¸å¤šç³»ç»Ÿæ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>\n<p>æˆ‘ä»¬éœ€è¦å¤åˆæ¡ä»¶æ¥æ£€æµ‹ nullï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword null nil\">null</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">typeof</span> <span class=\"token keyword\">function</span> <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">/* .. */</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"function\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>function ï¼ˆå‡½æ•°ï¼‰ä¹Ÿæ˜¯ JavaScript çš„ä¸€ä¸ªå†…ç½®ç±»å‹ã€‚ç„¶è€ŒæŸ¥é˜…è§„èŒƒå°±ä¼šçŸ¥é“ï¼Œ\nå®ƒå®é™…ä¸Šæ˜¯ object çš„ä¸€ä¸ªâ€œå­ç±»å‹â€ã€‚å…·ä½“æ¥è¯´ï¼Œå‡½æ•°æ˜¯â€œå¯è°ƒç”¨å¯¹è±¡â€ï¼Œå®ƒæœ‰ä¸€ä¸ªå†…éƒ¨å±\næ€§ [[Call]] ï¼Œè¯¥å±æ€§ä½¿å…¶å¯ä»¥è¢«è°ƒç”¨ã€‚</p>\n<p>å‡½æ•°ä¸ä»…æ˜¯å¯¹è±¡ï¼Œè¿˜å¯ä»¥æ‹¥æœ‰å±æ€§ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token charclass class-name\">.</span><span class=\"token charclass class-name\">.</span><span class=\"token charclass class-name\">.</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">}</span>\nfoo<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<p>å‡½æ•°çš„ length å±æ€§å€¼æ˜¯å…¶å‚æ•°çš„ä¸ªæ•°</p>\n<p>è®©æˆ‘ä»¬çœ‹çœ‹æ•°ç»„ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">typeof</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span> <span class=\"token comment\">//true</span>\n</code></pre></div>\n<p>æ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡ã€‚ç¡®åˆ‡åœ°è¯´ï¼Œå®ƒä¹Ÿæ˜¯ object çš„ä¸€ä¸ªâ€œå­ç±»å‹â€ï¼ˆå‚è§ç¬¬ 3 ç« ï¼‰ï¼Œæ•°ç»„çš„\nå…ƒç´ æŒ‰æ•°å­—é¡ºåºæ¥è¿›è¡Œç´¢å¼•ï¼ˆè€Œéæ™®é€šåƒå¯¹è±¡é‚£æ ·é€šè¿‡å­—ç¬¦ä¸²é”®å€¼ï¼‰ï¼Œå…¶ length å±æ€§æ˜¯å…ƒ\nç´ çš„ä¸ªæ•°ã€‚</p>\n<h3 id=\"å€¼å’Œç±»å‹\">å€¼å’Œç±»å‹</h3>\n<p><strong>JavaScript çš„å˜é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œåªæœ‰å€¼æ‰æœ‰ã€‚å˜é‡å¯ä»¥æŒæœ‰ä»»ä½•ç±»å‹çš„å€¼ã€‚</strong></p>\n<p>æ¢ä¸ªè§’åº¦æ¥ç†è§£å°±æ˜¯ï¼ŒJavaScript ä¸åšâ€œç±»å‹å¼ºåˆ¶â€ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯­è¨€å¼•æ“ä¸è¦æ±‚å˜é‡æ€»æ˜¯\næŒæœ‰ä¸å…¶åˆå§‹å€¼åŒç±»å‹çš„å€¼ã€‚ä¸€ä¸ªå˜é‡å¯ä»¥ç°åœ¨è¢«èµ‹å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹å€¼ï¼Œéšååˆè¢«èµ‹å€¼ä¸º\næ•°å­—ç±»å‹å€¼ã€‚</p>\n<h3 id=\"undefined-å’Œ-undeclared\">undefined å’Œ undeclared</h3>\n<p>å˜é‡åœ¨æœªæŒæœ‰å€¼çš„æ—¶å€™æ˜¯ undefinedã€‚</p>\n<p>åœ¨ä½œç”¨åŸŸä¸­æœªå£°æ˜å˜é‡æ—¶æœª undeclared</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a<span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// ReferenceError: b is not defined</span>\n</code></pre></div>\n<p>é€šå¸¸å˜é‡åœ¨æœªå®šä¹‰çš„æƒ…å†µä¸‹ä½¿ç”¨ä¼šæŠ¥ is not defined çš„é”™è¯¯ï¼Œä½†æ˜¯æœ‰æ—¶å€™å´ä¸æ˜¯ï¼Œä½†æ˜¯ typeof çš„å¤„ç†æ–¹å¼å´ä¸æ˜¯è¿™æ ·ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">typeof</span> a <span class=\"token comment\">// undefined</span>\n<span class=\"token keyword\">typeof</span> b <span class=\"token comment\">// undefined</span>\n</code></pre></div>\n<p>å¯¹äº undeclaredï¼ˆæˆ–è€… not definedï¼‰å˜é‡ï¼Œ typeof ç…§æ ·è¿”å› \"undefined\" ã€‚è¯·æ³¨æ„è™½ç„¶ b æ˜¯\nä¸€ä¸ª undeclared å˜é‡ï¼Œä½† typeof b å¹¶æ²¡æœ‰æŠ¥é”™ã€‚è¿™æ˜¯å› ä¸º typeof æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å®‰å…¨é˜²èŒƒæœºåˆ¶ã€‚</p>\n<p>ä¹‹å‰åœ¨ä¸Šå·ä¸­ä¹Ÿæåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹è±¡å–å€¼çš„æ—¶å€™æœ‰å¯èƒ½è¿”å› undefinedï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¸èƒ½æ ¹æ® undefined æ¥åˆ¤æ–­ï¼Œå¯¹è±¡æ˜¯å› ä¸ºä¸å­˜åœ¨è¿™ä¸ªå±æ€§è¿˜æ˜¯å¯¹è±¡å±æ€§å€¼ä¸º undefined.</p>\n<h4 id=\"typeof-undeclared\">typeOf Undeclared</h4>\n<p>typeOf è¿™ç§é˜²èŒƒæœºåˆ¶åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ååˆ†æœ‰ä½œç”¨çš„ï¼Œæ¯”å¦‚åˆ¤æ–­å…¨å±€çš„å˜é‡æ˜¯å¦å­˜åœ¨ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// è¿™æ ·åˆ¤æ–­ä¼šæŠ¥é”™ï¼Œä¼šä¸­æ–­ä»£ç </span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">DEBUG</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ä½†æ˜¯æ¢æˆ typeOf æ¥åˆ¤æ–­æ˜¯å®‰å…¨çš„ï¼Œä¸å­˜åœ¨çš„æ—¶å€™åªä¼šæŠ›å‡ºä¸€ä¸ª undefined </span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>typeOf <span class=\"token constant\">DEBUG</span> <span class=\"token operator\">!==</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œå¯ä»¥ä¸é€šè¿‡ typeOf:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token constant\">DEBUG</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ..</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">atob</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ..</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å› ä¸ºè®¿é—®å±æ€§ï¼Œå°±ç®—ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ä¹Ÿä¼šè¿”å› undefined</p>\n<hr>\n<h2 id=\"å€¼\">å€¼</h2>\n<h3 id=\"æ•°ç»„\">æ•°ç»„</h3>\n<p>å’Œå…¶ä»–å¼ºç±»å‹è¯­è¨€ä¸åŒï¼Œåœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å¯ä»¥å®¹çº³ä»»ä½•ç±»å‹çš„å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€\næ•°å­—ã€å¯¹è±¡ï¼ˆ object ï¼‰ï¼Œç”šè‡³æ˜¯å…¶ä»–æ•°ç»„ï¼ˆå¤šç»´æ•°ç»„å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°çš„ï¼‰</p>\n<p>å¯¹æ•°ç»„å£°æ˜åå³å¯å‘å…¶ä¸­åŠ å…¥å€¼ï¼Œä¸éœ€è¦é¢„å…ˆè®¾å®šå¤§å°</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span>\na<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>\n</code></pre></div>\n<p>ä½¿ç”¨ delete è¿ç®—ç¬¦å¯ä»¥å°†å•å…ƒä»æ•°ç»„ä¸­åˆ é™¤ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œå•å…ƒåˆ é™¤åï¼Œæ•°\nç»„çš„ length å±æ€§å¹¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ç¬¬ 5 ç« å°†è¯¦ç»†ä»‹ç» delete è¿ç®—ç¬¦ã€‚</p>\n<p>æ•°ç»„æ˜¯é€šè¿‡æ•°å­—è¿›è¡Œç´¢å¼•ï¼Œä½†æ˜¯æ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åŒ…å«å­—ç¬¦ä¸²é”®å€¼å’Œå±æ€§</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\narr<span class=\"token punctuation\">[</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\narr<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token comment\">// 0</span>\narr<span class=\"token punctuation\">[</span><span class=\"token string\">'12'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\narr<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token comment\">// 13</span>\narr <span class=\"token comment\">// [empty X 12, 2, foo: 2]</span>\n</code></pre></div>\n<p>ç”¨å­—ç¬¦ä¸²é”®å€¼å¯¹å­˜å‚¨ï¼Œæ•°ç»„çš„ length ä¸ä¼šäº§ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­—ç¬¦ä¸²å¦‚æœè¢«å¼ºåˆ¶è½¬æ¢æˆåè¿›åˆ¶çš„è¯ï¼Œå®ƒä¼šè¢«å½“æˆæ•°å­—ç´¢å¼•æ¥å¤„ç†ï¼Œæ‰€ä»¥ä¸Šè¾¹çš„ arr['12']å°±è¢«å½“åˆäº† arr[12]ï¼Œæ‰€ä»¥ï¼Œæ•°ç»„çš„length å˜åŒ–ä¸º13</p>\n<h3 id=\"ç±»æ•°ç»„\">ç±»æ•°ç»„</h3>\n<p>ä¾‹å¦‚ä¸€äº› dom æŸ¥è¯¢ä¼šè¿”å› dom å…ƒç´ åˆ—è¡¨ï¼Œæˆ–è€…æ˜¯ arguments å¯¹è±¡è®¿é—®å‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œå®ƒä»¬ä¸æ˜¯æ­£åœ¨æ„ä¹‰ä¸Šçš„æ•°ç»„ï¼Œä½†æ˜¯ä¸æ•°ç»„ååˆ†ç±»ä¼¼ã€‚é€šè¿‡å·¥å…·å‡½æ•°å¯ä»¥å°†è¿™äº›ç±»æ•°ç»„è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ã€‚</p>\n<p>å·¥å…·å‡½æ•° slice ç»å¸¸è¢«ç”¨äºè¿™ç±»è½¬æ¢ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> arr <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span>\n  arr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>'bam<span class=\"token punctuation\">)</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'baz'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ['bar', 'baz', 'bam']</span>\n</code></pre></div>\n<p>ç”¨ ES6 ä¸­çš„å†…ç½®å·¥å…·å‡½æ•° Array.from(..) ä¹Ÿèƒ½å®ç°åŒæ ·çš„åŠŸèƒ½ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> arr <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span> arguments <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<blockquote>\n<p>Array.from(..) æœ‰ä¸€äº›éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå°†åœ¨æœ¬ç³»åˆ—çš„ã€Šä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸‹å·ï¼‰ã€‹çš„â€œES6 &#x26; Beyondâ€éƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚</p>\n</blockquote>\n<h3 id=\"å­—ç¬¦ä¸²\">å­—ç¬¦ä¸²</h3>\n<p>å­—ç¬¦ä¸²ç»å¸¸è¢«å½“æˆå­—ç¬¦æ•°ç»„ã€‚å­—ç¬¦ä¸²çš„å†…éƒ¨å®ç°ç©¶ç«Ÿæœ‰æ²¡æœ‰ä½¿ç”¨æ•°ç»„å¹¶ä¸å¥½è¯´ï¼Œä½†\nJavaScript ä¸­çš„å­—ç¬¦ä¸²å’Œå­—ç¬¦æ•°ç»„å¹¶ä¸æ˜¯ä¸€å›äº‹ï¼Œæœ€å¤šåªæ˜¯çœ‹ä¸Šå»ç›¸ä¼¼è€Œå·²ã€‚</p>\n<p>å­—ç¬¦ä¸²å’Œæ•°ç»„çš„ç¡®å¾ˆç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ç±»æ•°ç»„ï¼Œéƒ½æœ‰ length å±æ€§ä»¥åŠ indexOf(..) ï¼ˆä» ES5\nå¼€å§‹æ•°ç»„æ”¯æŒæ­¤æ–¹æ³•ï¼‰å’Œ concat(..) æ–¹æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"f\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"o\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"o\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\na<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>\nb<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>\n\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"o\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\nb<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"o\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">concat</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"bar\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"foobar\"</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> b<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">concat</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [\"f\",\"o\",\"o\",\"b\",\"a\",\"r\"]</span>\na <span class=\"token operator\">===</span> c<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\nb <span class=\"token operator\">===</span> d<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"foo\"</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// [\"f\",\"o\",\"o\"]</span>\n</code></pre></div>\n<p>ä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬éƒ½æ˜¯â€œå­—ç¬¦æ•°ç»„â€ï¼Œæ¯”å¦‚ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">a<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"O\"</span><span class=\"token punctuation\">;</span>\nb<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"O\"</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"foo\"</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// [\"f\",\"O\",\"o\"]</span>\n</code></pre></div>\n<p>JavaScript ä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯æ•°ç»„æ˜¯å¯å˜çš„ã€‚</p>\n<p>å­—ç¬¦ä¸²ä¸å¯å˜æ˜¯æŒ‡å­—ç¬¦ä¸²çš„æˆå‘˜å‡½æ•°ä¸ä¼šæ”¹å˜å­—ç¬¦ä¸²çš„åŸå§‹å€¼ï¼Œè€Œæ˜¯åˆ›å»ºå¹¶ä¸”è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚è€Œæ•°ç»„çš„æˆå‘˜å‡½æ•°éƒ½æ˜¯åœ¨å…¶åŸå§‹å€¼è¿›è¡Œæ“ä½œçš„ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">c <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\na <span class=\"token operator\">===</span> c<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"foo\"</span>\nc<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"FOO\"</span>\nb<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"!\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// [\"f\",\"O\",\"o\",\"!\"]</span>\n</code></pre></div>\n<p>è®¸å¤šæ•°ç»„å‡½æ•°ç”¨æ¥å¤„ç†å­—ç¬¦ä¸²å¾ˆæ–¹ä¾¿ã€‚è™½ç„¶å­—ç¬¦ä¸²æ²¡æœ‰è¿™äº›å‡½æ•°ï¼Œä½†å¯ä»¥é€šè¿‡â€œå€Ÿç”¨â€æ•°\nç»„çš„éå˜æ›´æ–¹æ³•æ¥å¤„ç†å­—ç¬¦ä¸²ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">a<span class=\"token punctuation\">.</span><span class=\"token property-access\">join</span> <span class=\"token comment\">// undefined</span>\na<span class=\"token punctuation\">.</span><span class=\"token property-access\">map</span> <span class=\"token comment\">// undefined</span>\n\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// f-o-o</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> v<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// F.O.O</span>\n</code></pre></div>\n<p>æ•°ç»„æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•° reverse()ï¼Œè¿™ä¸ªå‡½æ•°ç›®å‰æ— æ³•å€Ÿç”¨ï¼Œæƒ³è¦è¿›è¡Œå­—ç¬¦ä¸²çš„åè½¬ï¼Œå¯ä»¥å…ˆå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h3 id=\"æ•°å­—\">æ•°å­—</h3>\n<p>JavaScript åªæœ‰ä¸€ç§æ•°å­—ç±»å‹ï¼šnumberï¼ˆæ•°å­—ï¼‰ï¼ŒåŒ…æ‹¬â€œæ•´æ•°â€å’Œå¸¦å°æ•°çš„åè¿›åˆ¶æ•°ã€‚â€œæ•´æ•°â€ä¹‹æ‰€ä»¥åŠ å¼•å·æ˜¯å› ä¸ºå’Œå…¶ä»–è¯­è¨€ä¸åŒï¼ŒJavaScript æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„æ•´æ•°ï¼Œè¿™ä¹Ÿæ˜¯\nå®ƒä¸€ç›´ä»¥æ¥ä¸ºäººè¯Ÿç—…çš„åœ°æ–¹ã€‚è¿™ç§æƒ…å†µåœ¨å°†æ¥æˆ–è®¸ä¼šæœ‰æ‰€æ”¹è§‚ï¼Œä½†ç›®å‰åªæœ‰æ•°å­—ç±»å‹ã€‚\nJavaScript ä¸­çš„â€œæ•´æ•°â€å°±æ˜¯æ²¡æœ‰å°æ•°çš„åè¿›åˆ¶æ•°ã€‚</p>\n<h4 id=\"æ•°å­—çš„è¯­æ³•\">æ•°å­—çš„è¯­æ³•</h4>\n<p>JavaScript ä¸­çš„æ•°å­—å¸¸é‡ä¸€èˆ¬ç”¨åè¿›åˆ¶æ¥è¡¨ç¤ºã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">42.3</span>\n</code></pre></div>\n<p>æ•°å­—å‰é¢çš„ 0 å’Œ å°æ•°ç‚¹åå°æ•°éƒ¨åˆ†åé¢çš„ 0 å¯ä»¥å»æ‰</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0.32</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">.32</span>\n\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">43.0</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">43</span>\n</code></pre></div>\n<p>ç‰¹åˆ«å¤§å’Œç‰¹åˆ«å°çš„æ•°å­—é»˜è®¤ç”¨æŒ‡æ•°æ ¼å¼æ˜¾ç¤ºï¼Œä¸ toExponential() å‡½æ•°çš„è¾“å‡ºç»“æœç›¸åŒã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">5E10</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 50000000000</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toExponential</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"5e+10\"</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> a <span class=\"token operator\">*</span> a<span class=\"token punctuation\">;</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2.5e+21</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> a<span class=\"token punctuation\">;</span>\nc<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2e-11</span>\n</code></pre></div>\n<p>tofixed(..) æ–¹æ³•å¯æŒ‡å®šå°æ•°éƒ¨åˆ†çš„æ˜¾ç¤ºä½æ•°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42.59</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"43\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.6\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.59\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.590\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.5900\"</span>\n</code></pre></div>\n<p>toPrecision(..) æ–¹æ³•ç”¨æ¥æŒ‡å®šæœ‰æ•ˆæ•°ä½çš„æ˜¾ç¤ºä½æ•°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42.59</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPrecision</span><span class=\"token punctuation\">(</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"4e+1\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPrecision</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"43\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPrecision</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.6\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPrecision</span><span class=\"token punctuation\">(</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.59\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPrecision</span><span class=\"token punctuation\">(</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.590\"</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPrecision</span><span class=\"token punctuation\">(</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.5900\"</span>\n</code></pre></div>\n<p>ä¸Šé¢çš„æ–¹æ³•ä¸ä»…é€‚ç”¨äºæ•°å­—å˜é‡ï¼Œä¹Ÿé€‚ç”¨äºæ•°å­—å¸¸é‡ã€‚ä¸è¿‡å¯¹äº . è¿ç®—ç¬¦éœ€è¦ç»™äºˆç‰¹åˆ«æ³¨\næ„ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­—å­—ç¬¦ï¼Œä¼šè¢«ä¼˜å…ˆè¯†åˆ«ä¸ºæ•°å­—å¸¸é‡çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åæ‰æ˜¯å¯¹è±¡å±\næ€§è®¿é—®è¿ç®—ç¬¦ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// æ— æ•ˆè¯­æ³•ï¼š</span>\n<span class=\"token number\">42.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// SyntaxError</span>\n<span class=\"token comment\">// ä¸‹é¢çš„è¯­æ³•éƒ½æœ‰æ•ˆï¼š</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.000\"</span>\n<span class=\"token number\">0.42</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"0.420\"</span>\n<span class=\"token number\">42.</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toFixed</span><span class=\"token punctuation\">(</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42.000\"</span>\n</code></pre></div>\n<p>42.tofixed(3) æ˜¯æ— æ•ˆè¯­æ³•ï¼Œå› ä¸º . è¢«è§†ä¸ºå¸¸é‡ 42. çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚å‰æ‰€è¿°ï¼‰ï¼Œæ‰€ä»¥æ²¡æœ‰ . å±æ€§è®¿é—®è¿ç®—ç¬¦æ¥è°ƒç”¨ tofixed æ–¹æ³•ã€‚\n42..tofixed(3) åˆ™æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºç¬¬ä¸€ä¸ª . è¢«è§†ä¸º number çš„ä¸€éƒ¨åˆ†ï¼Œç¬¬äºŒä¸ª . æ˜¯å±æ€§è®¿é—®è¿ç®—ç¬¦ã€‚åªæ˜¯è¿™æ ·çœ‹ç€å¥‡æ€ªï¼Œå®é™…æƒ…å†µä¸­ä¹Ÿå¾ˆå°‘è§ã€‚åœ¨åŸºæœ¬ç±»å‹å€¼ä¸Šç›´æ¥è°ƒç”¨çš„æ–¹æ³•å¹¶ä¸\nå¤šè§ï¼Œä¸è¿‡è¿™å¹¶ä¸ä»£è¡¨ä¸å¥½æˆ–ä¸å¯¹ã€‚</p>\n<h4 id=\"è¾ƒå°çš„æ•°å€¼\">è¾ƒå°çš„æ•°å€¼</h4>\n<p>äºŒè¿›åˆ¶æµ®ç‚¹æ•°æœ€å¤§çš„é—®é¢˜ï¼ˆä¸ä»… JavaScriptï¼Œæ‰€æœ‰éµå¾ª IEEE 754 è§„èŒƒçš„è¯­è¨€éƒ½æ˜¯å¦‚æ­¤ï¼‰ï¼Œæ˜¯ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token number\">0.1</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.2</span> <span class=\"token operator\">===</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n</code></pre></div>\n<p>ä»æ•°å­¦è§’åº¦æ¥è¯´ï¼Œä¸Šé¢çš„æ¡ä»¶åˆ¤æ–­åº”è¯¥ä¸º true ï¼Œå¯ç»“æœä¸ºä»€ä¹ˆæ˜¯ false å‘¢ï¼Ÿ\nç®€å•æ¥è¯´ï¼ŒäºŒè¿›åˆ¶æµ®ç‚¹æ•°ä¸­çš„ 0.1 å’Œ 0.2 å¹¶ä¸æ˜¯ååˆ†ç²¾ç¡®ï¼Œå®ƒä»¬ç›¸åŠ çš„ç»“æœå¹¶éåˆšå¥½ç­‰äº\n0.3 ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒæ¥è¿‘çš„æ•°å­— 0.30000000000000004 ï¼Œæ‰€ä»¥æ¡ä»¶åˆ¤æ–­ç»“æœä¸º false ã€‚</p>\n<p>é‚£ä¹ˆåº”è¯¥æ€æ ·æ¥åˆ¤æ–­ 0.1 + 0.2 å’Œ 0.3 æ˜¯å¦ç›¸ç­‰å‘¢ï¼Ÿ\næœ€å¸¸è§çš„æ–¹æ³•æ˜¯è®¾ç½®ä¸€ä¸ªè¯¯å·®èŒƒå›´å€¼ï¼Œé€šå¸¸ç§°ä¸ºâ€œæœºå™¨ç²¾åº¦â€ï¼ˆmachine epsilonï¼‰ï¼Œå¯¹\nJavaScript çš„æ•°å­—æ¥è¯´ï¼Œè¿™ä¸ªå€¼é€šå¸¸æ˜¯ 2^-52 (2.220446049250313e-16) ã€‚</p>\n<p>ä» ES6 å¼€å§‹ï¼Œè¿™ä¸ªå€¼å°±å®šä¹‰åœ¨Number.EPSILONä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨ polyfill:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EPSILON</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EPSILON</span> <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">52</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">numbersCloseEnoughToEqual</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n1<span class=\"token punctuation\">,</span>n2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">abs</span><span class=\"token punctuation\">(</span> n1 <span class=\"token operator\">-</span> n2 <span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x3C;</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EPSILON</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0.1</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">numbersCloseEnoughToEqual</span><span class=\"token punctuation\">(</span> a<span class=\"token punctuation\">,</span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">numbersCloseEnoughToEqual</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0.0000001</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0000002</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n</code></pre></div>\n<p>èƒ½å¤Ÿå‘ˆç°çš„æœ€å¤§æµ®ç‚¹æ•°å¤§çº¦æ˜¯ 1.798e+308 ï¼ˆè¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„æ•°å­—ï¼‰ï¼Œå®ƒå®šä¹‰åœ¨ Number.\nMAX_VALUE ä¸­ã€‚æœ€å°æµ®ç‚¹æ•°å®šä¹‰åœ¨ Number.MIN_VALUE ä¸­ï¼Œå¤§çº¦æ˜¯ 5e-324 ï¼Œå®ƒä¸æ˜¯è´Ÿæ•°ï¼Œä½†æ— é™æ¥è¿‘äº 0 ï¼</p>\n<h4 id=\"æ•´æ•°çš„å®‰å…¨èŒƒå›´\">æ•´æ•°çš„å®‰å…¨èŒƒå›´</h4>\n<p>èƒ½å¤Ÿè¢«â€œå®‰å…¨â€å‘ˆç°çš„æœ€å¤§æ•´æ•°æ˜¯ 2^53 - 1 ï¼Œå³ 9007199254740991 ï¼Œåœ¨ ES6 ä¸­è¢«å®šä¹‰ä¸º\nNumber.MAX_SAFE_INTEGER ã€‚æœ€å°æ•´æ•°æ˜¯ -9007199254740991 ï¼Œåœ¨ ES6 ä¸­è¢«å®šä¹‰ä¸º Number.MIN_SAFE_INTEGER ã€‚</p>\n<p>æœ‰æ—¶ JavaScript ç¨‹åºéœ€è¦å¤„ç†ä¸€äº›æ¯”è¾ƒå¤§çš„æ•°å­—ï¼Œå¦‚æ•°æ®åº“ä¸­çš„ 64 ä½ ID ç­‰ã€‚ç”±äº\nJavaScript çš„æ•°å­—ç±»å‹æ— æ³•ç²¾ç¡®å‘ˆç° 64 ä½æ•°å€¼ï¼Œæ‰€ä»¥å¿…é¡»å°†å®ƒä»¬ä¿å­˜ï¼ˆè½¬æ¢ï¼‰ä¸ºå­—ç¬¦ä¸²ã€‚\nå¥½åœ¨å¤§æ•°å€¼æ“ä½œå¹¶ä¸å¸¸è§ï¼ˆå®ƒä»¬çš„æ¯”è¾ƒæ“ä½œå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥å®ç°ï¼‰ã€‚å¦‚æœç¡®å®éœ€è¦å¯¹å¤§\næ•°å€¼è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œç›®å‰è¿˜æ˜¯éœ€è¦å€ŸåŠ©ç›¸å…³çš„å·¥å…·åº“ã€‚å°†æ¥ JavaScript ä¹Ÿè®¸ä¼šåŠ å…¥å¯¹å¤§æ•°\nå€¼çš„æ”¯æŒã€‚</p>\n<h4 id=\"æ•´æ•°æ£€æµ‹\">æ•´æ•°æ£€æµ‹</h4>\n<p>è¦æ£€æµ‹ä¸€ä¸ªæ•°å­—æ˜¯å¦ä¸ºæ•´æ•°ï¼Œå¯ä»¥ä½¿ç”¨ ES6 çš„ Number.isInterger(...)</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isInteger</span><span class=\"token punctuation\">(</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isInteger</span><span class=\"token punctuation\">(</span> <span class=\"token number\">42.000</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isInteger</span><span class=\"token punctuation\">(</span> <span class=\"token number\">42.3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n</code></pre></div>\n<p>ä¹Ÿå¯ä»¥ä¸º ES6 ä¹‹å‰çš„ç‰ˆæœ¬ polyfill  Number.isInteger(..) æ–¹æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">isInteger</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">isInteger</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">typeof</span> num <span class=\"token operator\">==</span> <span class=\"token string\">\"number\"</span> <span class=\"token operator\">&#x26;&#x26;</span> num <span class=\"token operator\">%</span> <span class=\"token number\">1</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>è¦æ£€æµ‹ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯å®‰å…¨çš„æ•´æ•°ï¼Œå¯ä»¥ä½¿ç”¨ ES6 ä¸­çš„ Number.isSafeInteger(..) æ–¹æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isSafeInteger</span><span class=\"token punctuation\">(</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_SAFE_INTEGER</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isSafeInteger</span><span class=\"token punctuation\">(</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pow</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">53</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isSafeInteger</span><span class=\"token punctuation\">(</span> <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pow</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">53</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>å¯ä»¥ä¸º ES6 ä¹‹å‰çš„ç‰ˆæœ¬ polyfill  Number.isSafeInteger(..) æ–¹æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">isSafeInteger</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">isSafeInteger</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isInteger</span><span class=\"token punctuation\">(</span> num <span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span>\n    <span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">abs</span><span class=\"token punctuation\">(</span> num <span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x3C;=</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_SAFE_INTEGER</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"ç‰¹æ®Šæ•°å€¼\">ç‰¹æ®Šæ•°å€¼</h3>\n<p>JavaScriptçš„æ•°æ®ç±»å‹ä¸­æœ‰å‡ ä¸ªç‰¹æ®Šçš„å€¼éœ€è¦å¼€å‘äººå‘˜ç‰¹åˆ«æ³¨æ„å’Œå°å¿ƒä½¿ç”¨</p>\n<h4 id=\"ä¸æ˜¯å€¼çš„å€¼\">ä¸æ˜¯å€¼çš„å€¼</h4>\n<p>undefined ç±»å‹åªæœ‰ä¸€ä¸ªå€¼ï¼Œå³ undefinedã€‚nullç±»å‹ä¹Ÿåªæœ‰ä¸€ä¸ªå€¼ï¼Œå³ nullã€‚å®ƒä»¬çš„åç§°æ—¢æ˜¯ç±»å‹ä¹Ÿæ˜¯å€¼ã€‚</p>\n<p>undefined å’Œ null é€šå¸¸è¢«ç”¨æ¥è¡¨ç¤ºâ€œç©ºçš„â€æˆ–è€…â€œä¸æ˜¯å€¼â€çš„å€¼ï¼ŒäºŒè€…ä¹‹é—´æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ï¼š</p>\n<ul>\n<li>null æŒ‡ç©ºå€¼</li>\n<li>undefined æŒ‡æ²¡æœ‰å€¼</li>\n</ul>\n<p>æˆ–è€…</p>\n<ul>\n<li>undefined æŒ‡ä»æ²¡æœ‰èµ‹è¿‡å€¼</li>\n<li>null æŒ‡æ›¾èµ‹è¿‡å€¼ï¼Œä½†æ˜¯ç›®å‰æ²¡æœ‰å€¼</li>\n</ul>\n<p>null æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å…³é”®å­—ï¼Œä¸æ˜¯æ ‡è¯†ç¬¦ï¼Œæˆ‘ä»¬ä¸èƒ½å°†å…¶å½“ä½œå˜é‡æ¥ä½¿ç”¨å’Œèµ‹å€¼ï¼Œç„¶è€Œï¼Œundefined å´æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå¯ä»¥è¢«å½“ä½œå˜é‡æ¥ä½¿ç”¨å’Œèµ‹å€¼</p>\n<h4 id=\"undefined\">undefined</h4>\n<p>éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¨å±€çš„æ ‡è¯†ç¬¦ undefined èµ‹å€¼ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword nil\">undefined</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword nil\">undefined</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token comment\">// TypeError</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h4 id=\"void-è¿ç®—ç¬¦\">void è¿ç®—ç¬¦</h4>\n<p>undefined æ˜¯ä¸€ä¸ªå†…ç½®æ ‡è¯†ç¬¦ï¼ˆé™¤éè¢«é‡æ–°å®šä¹‰ï¼Œè§å‰é¢çš„ä»‹ç»ï¼‰å®ƒçš„å€¼ä¸º undefinedï¼Œé€šè¿‡ void è¿ç®—ç¬¦å³å¯å¾—åˆ°è¯¥å€¼ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>vaid a<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined 42</span>\n</code></pre></div>\n<p>æŒ‰ç…§æƒ¯ä¾‹æˆ‘ä»¬ä½¿ç”¨ void 0 æ¥è·å¾— undefined ã€‚void 0 void 1 å’Œ undefined ä¹‹é—´å¹¶æ²¡æœ‰å®è´¨çš„åŒºåˆ«</p>\n<p>æ­¤å¤–ï¼Œvoid è¿˜å¯ä¸è®©è¡¨è¾¾å¼è¿”å›ä»»ä½•ç»“æœ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token constant\">APP</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">ready</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>doSomething<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">var</span> result \n  <span class=\"token keyword control-flow\">return</span> result\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>doSomething<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</span>\n</code></pre></div>\n<p>å¾ˆå¤šçš„å¼€å‘äººå‘˜å–œæ¬¢åˆ†å¼€æ“ä½œï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token constant\">APP</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">ready</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>doSomething<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> \n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"ç‰¹æ®Šçš„æ•°å­—\">ç‰¹æ®Šçš„æ•°å­—</h4>\n<p>å¦‚æœæ•°å­¦è¿ç®—ç¬¦çš„æ“ä½œæ•°ä¸æ˜¯æ•°å­—ç±»å‹ï¼Œå°±æ— æ³•è¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­—ï¼Œè¿™ç§æƒ…å†µä¸‹è¿”å›å€¼ä¸º NaN</p>\n<p>NaN æŒ‡â€œä¸æ˜¯ä¸€ä¸ªæ•°å­—â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç†è§£ä¸ºâ€œæ— æ•ˆçš„æ•°å€¼â€â€œå¤±è´¥çš„æ•°å€¼â€â€œåæ•°å€¼â€</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">/</span> <span class=\"token string\">'foo'</span> <span class=\"token comment\">// NaN</span>\n<span class=\"token keyword\">typeof</span> <span class=\"token number\">NaN</span> <span class=\"token comment\">// number</span>\n</code></pre></div>\n<p>æ¢å¥è¯æ¥è¯´ï¼Œâ€œä¸æ˜¯æ•°å­—çš„æ•°å­—ï¼šä»ç„¶æ˜¯æ•°å­—ç±»å‹ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">/</span> <span class=\"token string\">'foo'</span> <span class=\"token comment\">// NaN</span>\na <span class=\"token operator\">===</span> <span class=\"token number\">NaN</span> <span class=\"token comment\">// false</span>\n<span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>NaN æ˜¯ä¸€ä¸ªç‰¹æ®Šå€¼ï¼Œä»–æ˜¯JavaScriptä¸­å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«çš„å€¼ã€‚æˆ‘ä»¬é€šå¸¸é€šè¿‡ä¸€ä¸ªå…¨å±€å‡½æ•° isNaN(...) æ¥åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯ä¸æ˜¯ NaNã€‚</p>\n<p>ç„¶è€Œï¼ŒisNaN(...)æœ‰ä¸€ä¸ªä¸¥é‡çš„ç¼ºé™·ï¼Œä¸Šè¾¹æˆ‘ä»¬è¯´äº† NaN çš„ç±»å‹è¿˜æ˜¯ä¸€ä¸ªæ•°å­—ç±»å‹ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> b  <span class=\"token operator\">=</span> <span class=\"token string\">'foo'</span>\n<span class=\"token function\">isNaN</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>æ˜¾ç„¶ b æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ä¸æ˜¯ä¸€ä¸ªæ•°å­—ç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½æ˜¯NaNï¼Œè¿™ä¸ªbugè‡ªJavaScriptæ¥ä¸€ç›´å­˜åœ¨ã€‚</p>\n<p>ä» ES6 å¼€å§‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å…·å‡½æ•° Number.isNaN(...)ã€‚åœ¨ ES6 ä¹‹å‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„ polyfillï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">isNaN</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">isNaN</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">typeof</span> n <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isNaN</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ NaN æ˜¯JavaScriptä¸­å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«çš„ç‰¹ç‚¹æ¥å†™è¿™ä¸ª polyfill:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">isNaN</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">isNaN</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> n <span class=\"token operator\">!</span> <span class=\"token operator\">==</span> n\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"æ— ç©·æ•°\">æ— ç©·æ•°</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">0</span> <span class=\"token comment\">//Infinity</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">0</span> <span class=\"token comment\">// -Infinity</span>\n</code></pre></div>\n<p>Infinity å³ Number.POSITIVE_INFINITY\n-Infinity å³ Number.NAGATIVE_INFINITY</p>\n<h4 id=\"é›¶å€¼\">é›¶å€¼</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token operator\">/</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span> <span class=\"token comment\">// -0</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token operator\">*</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span> <span class=\"token comment\">// -0</span>\n</code></pre></div>\n<p>javaScript ä¸­çš„é™¤æ³•å’Œä¹˜æ³•ä¼šå¾—åˆ° -0ï¼Œä½†æ˜¯åŠ æ³•å’Œå‡æ³•ä¸ä¼šå¾—åˆ° -0.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '0'</span>\na <span class=\"token operator\">+</span> <span class=\"token string\">''</span> <span class=\"token comment\">// '0'</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// '0'</span>\n</code></pre></div>\n<p>æˆ‘ä»¬å°† -0 è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¯ä»¥å¾—åˆ°å­—ç¬¦ä¸² '0'</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">+</span> <span class=\"token string\">'-0'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//-0</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-0'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// -0</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-0'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// -0</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">-</span><span class=\"token number\">0</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token comment\">//true</span>\n<span class=\"token operator\">-</span><span class=\"token number\">0</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token comment\">//false</span>\n</code></pre></div>\n<p>å¦‚ä½•åŒºåˆ† 0 å’Œ -0</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">isNegZero</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  n <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span>n <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">Infinity</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"ç‰¹æ®Šç­‰å¼\">ç‰¹æ®Šç­‰å¼</h4>\n<p>å¦‚å‰é¢æ‰€è¿°ï¼ŒNaN å’Œ -0 åœ¨ç›¸ç­‰æ¯”è¾ƒçš„æ—¶å€™æ¯”è¾ƒç‰¹åˆ«ï¼Œæ‰€ä»¥ï¼Œéœ€è¦å€ŸåŠ© Number.isNaN(...)æˆ–è€…æ˜¯isNegZero(...) è¿™æ ·çš„å·¥å…·å‡½æ•°æ¥æ¯”è¾ƒã€‚</p>\n<p>ES6 ä¸­åŠ å…¥äº†ä¸€ä¸ªæ–°çš„æ–¹æ³• Object.is(...) æ¥åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç»å¯¹ç›¸ç­‰ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">/</span> <span class=\"token string\">'foo'</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">0</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">is</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token number\">NaN</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">is</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">is</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>å¯¹äº ES6 ä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒObject.is(...) æœ‰ä¸€ä¸ªç®€å•çš„polyfill:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">is</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">is</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">v1<span class=\"token punctuation\">,</span> v2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦æ˜¯ -0</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>v1 <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">&#x26;&#x26;</span> v2 <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> v1 <span class=\"token operator\">===</span><span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> v2\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// åˆ¤æ–­æ˜¯å¦æ˜¯NaN</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>v1 <span class=\"token operator\">!==</span> v2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> v2 <span class=\"token operator\">!==</span> v2\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> v1 <span class=\"token operator\">===</span> v2\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<blockquote>\n<p>èƒ½ä½¿ç”¨ == å’Œ === å°±ä¸è¦ä½¿ç”¨ Object.is(...) å› ä¸ºå‰è€…çš„æ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p>\n</blockquote>\n<h3 id=\"å€¼å’Œå¼•ç”¨\">å€¼å’Œå¼•ç”¨</h3>\n<p>JavaScriptå¯¹å€¼å’Œå¼•ç”¨çš„èµ‹å€¼/èˆ¹ä½“åœ¨è¯­æ³•ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œå®Œå…¨æ ¹æ®å€¼çš„ç±»å‹æ¥å†³å®šã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> a <span class=\"token comment\">// b æ˜¯ a çš„å‰¯æœ¬</span>\nb<span class=\"token operator\">++</span>\na <span class=\"token comment\">// 2</span>\nb <span class=\"token comment\">// 3</span>\n\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> c\nd<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\nc <span class=\"token comment\">// [1,2,3,4]</span>\nd <span class=\"token comment\">// [1,2,3,4]</span>\n</code></pre></div>\n<p><strong>ç®€å•å€¼ï¼ˆå³æ˜¯æ ‡é‡åŸºæœ¬ç±»å‹å€¼ï¼‰æ€»æ˜¯é€šè¿‡å€¼å¤åˆ¶çš„æ–¹å¼æ¥èµ‹å€¼/ä¼ é€’ï¼ŒåŒ…æ‹¬null, undefined,å­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼å’ŒES6ä¸­symbol</strong></p>\n<p><strong>å¤åˆå€¼---å¯¹è±¡ï¼ˆåŒ…æ‹¬ç»„è£…å’Œå°è£…å¯¹è±¡ï¼‰å’Œå‡½æ•°ï¼Œåˆ™æ€»é€šè¿‡å¼•ç”¨æ‰¶æ¤çš„æ–¹å¼æ¥èµ‹å€¼/ä¼ é€’</strong></p>\n<p>ç”±äºå¼•ç”¨æŒ‡å‘çš„æ˜¯å€¼æœ¬èº«è€Œå¹¶éå˜é‡ï¼Œæ‰€ä»¥ä¸€ä¸ªå¼•ç”¨æ— æ³•æ›´æ”¹å¦ä¸€ä¸ªå¼•ç”¨çš„æŒ‡å‘ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> a\na <span class=\"token comment\">// [1,2,3]</span>\nb <span class=\"token comment\">// [1,2,3]</span>\n\nb <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span>\na <span class=\"token comment\">// [1,2,3]</span>\nb <span class=\"token comment\">// [4,5,6]</span>\n</code></pre></div>\n<p>å‡½æ•°å‚æ•°å°±ç»å¸¸è®©äººäº§ç”Ÿè¿™æ ·çš„å›°æƒ‘ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n  x <span class=\"token comment\">// [1,2,3,4]</span>\n\n  x <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span>\n  x<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span>\n  x <span class=\"token comment\">// [4,5,6,7]</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\na <span class=\"token comment\">// [1,2,3,4] è€Œä¸æ˜¯ [4,5,6,7]</span>\n</code></pre></div>\n<blockquote>\n<p>æˆ‘ä»¬æ— æ³•å†³å®šä½¿ç”¨å€¼å¤åˆ¶è¿˜æ˜¯å¼•ç”¨å¤åˆ¶ï¼Œä¸€åˆ‡ç”±å€¼çš„ç±»å‹æ¥å†³å®šã€‚</p>\n</blockquote>\n<p>å¦‚æœé€šè¿‡å€¼èµ‹å€¼çš„æ–¹å¼æ¥ä¼ é€’å¤åˆå€¼ï¼Œå°±éœ€è¦ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤æœ¬ã€‚</p>\n<p>å¦‚ï¼š foo(a.slice())ï¼Œslice(...)èƒ½è¿”å›å½“å‰æ•°ç»„çš„ä¸€ä¸ªæµ…å¤æœ¬ã€‚</p>\n<p>ç›¸åçš„å¦‚æœè¦å°†æ ‡é‡çš„åŸºæœ¬ç±»å‹å€¼ä¼ é€’åˆ°å‡½æ•°å†…å¹¶è¿›è¡Œæ›´æ”¹ï¼Œå°±éœ€è¦å°†è¯¥å€¼å°è£…åˆ°ä¸€ä¸ªå¤åˆå€¼ä¸­ï¼Œç„¶åé€šè¿‡å¼•ç”¨å¤åˆ¶çš„æ–¹å¼è¿›è¡Œä¼ é€’ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">wrapper</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  wrapper<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token operator\">=</span> <span class=\"token number\">42</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> \nobj<span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>é‚£æ˜¯ä¸æ˜¯éœ€è¦ä¼ é€’æŒ‡å‘æ ‡é‡çš„åŸºæœ¬ç±»å‹å€¼çš„å¼•ç”¨ï¼Œå°±å¯ä»¥å°†å…¶é£è½¬å‘Šå¯¹åº”çš„å¯¹è±¡ä¸­ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  x <span class=\"token operator\">=</span> x <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n  x <span class=\"token comment\">//3</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Number</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ˜¯ 2ï¼Œä¸æ˜¯ 3</span>\n</code></pre></div>\n<p>åŸå› æ˜¯æ ‡é‡åŸºæœ¬ç±»å‹å€¼æ˜¯ä¸å¯å˜çš„ã€‚</p>\n<hr>\n<h2 id=\"åŸç”Ÿå‡½æ•°\">åŸç”Ÿå‡½æ•°</h2>\n<p>å¸¸ç”¨çš„åŸç”Ÿå‡½æ•°ï¼š</p>\n<ul>\n<li>String()</li>\n<li>Number()</li>\n<li>Boolean()</li>\n<li>Array()</li>\n<li>Object()</li>\n<li>Function()</li>\n<li>RegExp()</li>\n<li>Date()</li>\n<li>Error()</li>\n<li>Symbol() ---- ES6 æ–°åŠ å…¥</li>\n</ul>\n<p>åŸç”Ÿå‡½æ•°å¯ä»¥å½“ä½œæ„é€ å‡½æ•°æ¥ä½¿ç”¨ï¼Œä½†æ˜¯å…¶æ„é€ å‡ºæ¥çš„å¯¹è±¡å¯èƒ½ä¼šå’Œæˆ‘ä»¬è®¾æƒ³çš„æ‰€æœ‰å‡ºå…¥ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">typeof</span> a <span class=\"token comment\">// object</span>\na <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">String</span> <span class=\"token comment\">// true</span>\n<span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">//[object, String]</span>\n</code></pre></div>\n<p>typeof åœ¨è¿™é‡Œè¿”å›çš„æ˜¯å¯¹è±¡çš„å­ç±»å‹</p>\n<h3 id=\"å†…éƒ¨å±æ€§\">å†…éƒ¨å±æ€§</h3>\n<p>æ‰€æœ‰ typeof è¿”å›å€¼ä¸º\"object\"çš„å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªå†…éƒ¨å±æ€§ï¼Œè¿™ä¸ªå±æ€§æˆ‘ä»¬æ— æ³•è®¿é—®ï¼Œä¸€èˆ¬é€šè¿‡Object.prototype.toString(...)æ¥æŸ¥çœ‹ã€‚</p>\n<h3 id=\"å°è£…å¯¹è±¡åŒ…è£…\">å°è£…å¯¹è±¡åŒ…è£…</h3>\n<p>å°è£…å¯¹è±¡æ‰®æ¼”ç€ååˆ†é‡è¦çš„è§’è‰²ã€‚ç”±äºåŸºæœ¬ç±»å‹å€¼æ²¡æœ‰.length å’Œ .toString() è¿™æ ·çš„å±æ€§å’Œæ–¹æ³•ï¼Œéœ€è¦é€šè¿‡é£è½¬å¯¹è±¡æ‰èƒ½è®¿é—®ï¼Œæ­¤æ—¶ JavaScriptè‡ªåŠ¨ä¸ºåŸºæœ¬ç±»å‹å€¼åŒ…è£…ä¸€ä¸ªå°è£…å¯¹è±¡ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'atbc'</span>\na<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token comment\">// 3</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'ABC'</span>\n</code></pre></div>\n<h4 id=\"å°è£…å¯¹è±¡é‡Šç–‘\">å°è£…å¯¹è±¡é‡Šç–‘</h4>\n<p>ä½¿ç”¨å°è£…å¯¹è±¡æ—¶æœ‰äº›åœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„</p>\n<p>æ¯”å¦‚Boolean:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>a<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Oops'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ‰§è¡Œä¸åˆ°è¿™é‡Œ</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æƒ³è¦è‡ªè¡Œå°è£…åŸºæœ¬ç±»å‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨Object(...) å‡½æ•°</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'abc'</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">typeof</span> a <span class=\"token comment\">// string</span>\n<span class=\"token keyword\">typeof</span> b <span class=\"token comment\">// object</span>\n<span class=\"token keyword\">typeof</span> c <span class=\"token comment\">// object</span>\n\nb <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">String</span> <span class=\"token comment\">// true</span>\nc <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">String</span> <span class=\"token comment\">// true</span>\n\n<span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// '[object String]'</span>\n<span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token comment\">// '[object String]'</span>\n</code></pre></div>\n<p><strong>ä¸€èˆ¬ä¸æ¨èä¸–ç•Œä½¿ç”¨å°è£…å¯¹è±¡</strong></p>\n<h3 id=\"æ‹†å°\">æ‹†å°</h3>\n<p>å¦‚æœéœ€è¦å¾—åˆ°å°è£…ä¸­çš„åŸºæœ¬ç±»å‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨ valueOf() å‡½æ•°</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Number</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'abc'</span>\nb<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 42</span>\nc<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>åœ¨éœ€è¦ç”¨åˆ°å°è£…å¯¹è±¡çš„åŸºæœ¬ç±»å‹å€¼çš„åœ°æ–¹ä¼šå‘ç”Ÿéšå¼æ‹†å°ï¼Œå³å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚åœ¨ç¬¬å››ç« å½“ä¸­ä¼šä»‹ç»ã€‚</p>\n<h3 id=\"å°†åŸç”Ÿå‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°\">å°†åŸç”Ÿå‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°</h3>\n<p>å…³äºæ•°ç»„ï¼ˆArrayï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ã€å‡½æ•°ï¼ˆfunctionï¼‰å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬é€šå¸¸å–œæ¬¢ä»¥å¸¸é‡çš„å½¢å¼æ¥åˆ›å»ºå®ƒä»¬ï¼Œæ•ˆæœå®é™…ä¸Šå’Œä½¿ç”¨æ„é€ å‡½æ•°æ˜¯ä¸€æ ·çš„ï¼Œé™¤éååˆ†å¿…è¦ï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨æ„é€ å‡½æ•°ã€‚</p>\n<h4 id=\"array\">Array(...)</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\na <span class=\"token comment\">// [1,2,3]</span>\nb <span class=\"token comment\">// [1,2,3]</span>\n</code></pre></div>\n<p>æ„é€ å‡½æ•°Array(...)ä¸è¦æ±‚å¿…é¡» new å…³é”®å­—ï¼Œä¸å¸¦æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è¡¥ä¸Šã€‚</p>\n<p>Array æ„é€ å‡½æ•°åªå¸¦ä¸€ä¸ªæ•°å­—å‚æ•°æ—¶ï¼Œè¯¥å‚æ•°ä¼šè¢«è®¤ä¸ºæ•°ç»„çš„é•¿åº¦æ¥å¤„ç†ï¼Œè€Œéåªå……å½“æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚</p>\n<h4 id=\"objectã€function-ã€å’Œ-regexp\">Object(...)ã€Function(...) ã€å’Œ RegExp(...)</h4>\n<h4 id=\"date-å’Œ-errro\">Date(...) å’Œ Errro(...)</h4>\n<p>ç›¸å¯¹äºå…¶ä»–çš„åŸç”Ÿæ„é€ å‡½æ•°ï¼ŒDate(...)å’ŒError(...)çš„ç”¨å¤„è¦å¤§å¾ˆå¤šï¼Œå› ä¸ºæ²¡æœ‰å¯¹åº”çš„å¸¸é‡å½¢å¼æ¥ä½œä¸ºå®ƒä»¬çš„ä»£æ›¿ã€‚</p>\n<p>åˆ›å»ºæ—¥æœŸå¯¹è±¡å¿…é¡»ä½¿ç”¨ new Date(...)ã€‚Date(...)å¯ä»¥å¸¦å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šæ—¥æœŸå’Œæ—¶é—´ï¼Œè€Œä¸å¸¦å‚æ•°çš„è¯åˆ™ä½¿ç”¨å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p>\n<p>Date(...)ä¸»è¦ç”¨æ¥è·å¾—å½“å‰çš„Unixæ—¶é—´æˆ³ï¼ˆä»1970å¹´1æœˆ1æ—¥å¼€å§‹è®¡ç®—ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚è¯¥å€¼å¯ä»¥é€šè¿‡æ—¥æœŸå¯¹è±¡çš„getTime()æ¥è·å¾—ã€‚</p>\n<p>ä» ES5 å¼€å§‹å¼•å…¥ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼ŒDate.now()ã€‚å¯¹äºES5ä¹‹å‰çš„ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">now</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Date</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">now</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ„é€ å‡½æ•° Error(...)å¸¦ä¸å¸¦ new å…³é”®å­—éƒ½å¯ä»¥</p>\n<p>é”™è¯¯å¯¹è±¡åªè¦æ˜¯ä¸ºäº†è·å¾—å½“å‰è¿è¡Œæ ˆä¸Šä¸‹æ–‡ã€‚æ ˆä¸Šä¸‹æ–‡ä¿¡æ¯åŒ…æ‹¬å‡½æ•°è°ƒç”¨æ ˆä¿¡æ¯å’Œäº§ç”Ÿçš„é”™è¯¯ä»£ç è¡Œå·ï¼Œä»¥ä¾¿è°ƒå¼ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x wasn't provided\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>é€šå¸¸é”™è¯¯å¯¹è±¡è‡³å°‘åŒ…å«ä¸€ä¸ªmessageå±æ€§ã€‚</p>\n<p>é™¤äº† Error(...)ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›é’ˆå¯¹ç‰¹å®šé”™è¯¯ç±»å‹çš„åŸç”Ÿæ„é€ å‡½æ•°ï¼Œå¦‚ï¼š\nEvalError(...)ã€RangeError(...)ã€ReferenceError(...)ã€SyntaxError(...)\nã€TypeError(...)å’ŒURIError(...)ã€‚è¿™äº›æ„é€ å‡½æ•°å¾ˆå°‘ä½¿ç”¨ï¼Œå®ƒä»¬åœ¨ç¨‹åºå‘ç”Ÿå¼‚å¸¸æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p>\n<h4 id=\"symbol\">Symbol(...)</h4>\n<p>ES6 ä¸­æ–°åŠ å…¥çš„æœ‰ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹---ç¬¦å·ã€‚ç¬¦å·å±æ€§å…·æœ‰å”¯ä¸€æ€§çš„ç‰¹æ®Šæ€§ï¼ˆå¹¶éç»å¯¹ï¼‰ï¼Œç”¨å®ƒæ¥å‘½åå¯¹è±¡å±æ€§ä¸å®¹æ˜“å¯¼è‡´é‡åã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> mysym <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my own symbo'</span><span class=\"token punctuation\">)</span>\nmysym <span class=\"token comment\">// Symbol(my own symbol)</span>\nmysym<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'Symbol(my own symbol)'</span>\n<span class=\"token keyword\">typeof</span> mysm <span class=\"token comment\">// symbol</span>\n\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\na<span class=\"token punctuation\">[</span>mysym<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'foobar'</span>\n\n<span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getOwnPropertySymbols</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// [Symbol(my own symbol)]</span>\n</code></pre></div>\n<p>Object.getOwnPropertySymbos(...)å¯ä»¥å…¬å¼€è·å¾—å¯¹è±¡ä¸­çš„æ‰€æœ‰ç¬¦å·ã€‚ç¬¦å·é€šå¸¸ç”¨åŸŸç§æœ‰å±æ€§ã€‚</p>\n<hr>\n<h2 id=\"ç¬¬å››ç« -å¼ºåˆ¶ç±»å‹è½¬æ¢\">ç¬¬å››ç«  å¼ºåˆ¶ç±»å‹è½¬æ¢</h2>\n<h3 id=\"å€¼ç±»å‹è½¬æ¢\">å€¼ç±»å‹è½¬æ¢</h3>\n<p>å°†å€¼ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹é€šå¸¸ç§°ä¸ºç±»å‹è½¬æ¢ï¼Œè¿™æ˜¯æ˜¾ç¤ºçš„æƒ…å†µï¼Œéšå¼çš„æƒ…å†µç§°ä¸ºå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p>\n<h3 id=\"æŠ½è±¡å€¼æ“ä½œ\">æŠ½è±¡å€¼æ“ä½œ</h3>\n<p>ä»‹ç»éšå¼å’Œæ˜¾ç¤ºå¼ºåˆ¶ç±»å‹è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŒæ¡å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”å€¼ä¹‹é—´çš„ç±»å‹è½¬æ¢çš„è§„åˆ™ã€‚</p>\n<h4 id=\"tostring\">toString()</h4>\n<ul>\n<li>åŸºæœ¬å€¼ç±»å‹çš„å­—ç¬¦ä¸²è½¬æ¢è§„åˆ™ä¸ºï¼šnull è½¬æ¢ä¸º \"null\",undefinedè½¬æ¢ä¸º\"undefined\",trueè½¬æ¢ä¸º\"true\",æ•°å­—çš„å­—ç¬¦ä¸²éµå¾ªé€šç”¨è§„åˆ™ï¼Œä¸è¿‡ç¬¬2ç« ä¸­è®²è¿‡çš„é‚£äº›æå°å’Œæå¤§çš„æ•°å­—ä½¿ç”¨æŒ‡æ•°å½¢å¼ï¼š</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1.07</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"1.07e21\"</span>\n</code></pre></div>\n<ul>\n<li>\n<p>å¯¹äºæ™®é€šå¯¹è±¡æ¥è®²ï¼Œé™¤éè‡ªè¡Œå®šä¹‰ï¼Œå¦åˆ™toString()(Object.prototype.toString())è¿”å›å†…éƒ¨å±æ€§[[Class]]çš„å€¼ã€‚\nç„¶è€Œæˆ‘ä»¬åœ¨å‰é¢è®²è¿‡ï¼Œå¦‚æœå¯¹è±¡ç”±ä¸­çº§çš„toString()æ–¹æ³•ï¼Œå­—ç¬¦ä¸²åŒ–æ—¶å°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•å¹¶ä¸”ä½¿ç”¨å…¶è¿”å›å€¼ã€‚</p>\n</li>\n<li>\n<p>æ•°ç»„çš„é»˜è®¤toString() æ–¹æ³•ç»è¿‡äº†é‡æ–°å®šä¹‰ï¼Œå°†æ‰€æœ‰çš„å•å…ƒå­—ç¬¦ä¸²åŒ–åå†ç”¨\",\"è¿æ¥èµ·æ¥ï¼š</p>\n</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\na<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '1,2,3'</span>\n</code></pre></div>\n<h5 id=\"jsonå­—ç¬¦ä¸²åŒ–\">JSONå­—ç¬¦ä¸²åŒ–</h5>\n<p>å·¥å…·å‡½æ•°JSON.stringify(...)åœ¨å°†JSONå¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²æ—¶ä¹Ÿç”¨åˆ°äº†ToString</p>\n<blockquote>\n<p>è¯·æ³¨æ„ï¼ŒJSONå­—ç¬¦ä¸²åŒ–å¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä»¥ä¸ºå…¶ä¸­ä¹Ÿæ¶‰åŠåˆ°ToStringçš„ç›¸å…³è§„åˆ™ã€‚</p>\n</blockquote>\n<ul>\n<li>å¯¹äºå¤§å¤šæ•°ç®€å•å€¼ï¼ŒJSONå­—ç¬¦ä¸²åŒ–å’ŒtoString()çš„æ•ˆæœåŸºæœ¬ç›¸åŒï¼Œåªä¸è¿‡åºåˆ—åŒ–çš„ç»“æœæ€»æ˜¯å­—ç¬¦ä¸²ï¼š</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// '42'</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token string\">'42'</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// '42'</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// 'null'</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'true'</span>\n</code></pre></div>\n<p>æ‰€æœ‰çš„å®‰å…¨çš„JSONå€¼éƒ½å¯ä»¥ä½¿ç”¨JSON.stringify(...)å­—ç¬¦ä¸²åŒ–ã€‚å®‰å…¨å€¼æ˜¯æŒ‡å¯ä»¥å‘ˆç°ä¸ºæœ‰æ•ˆJSONçš„å€¼ã€‚</p>\n<p>å“ªäº›æ˜¯ä¸å®‰å…¨çš„å€¼ï¼šundefinedã€functionã€symbolå’ŒåŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ç¬¦åˆJSONç»“æ„æ ‡å‡†ã€‚</p>\n<p>JSON.stringify(...) åœ¨å¯¹è±¡ä¸­é‡åˆ°undefinedã€functionå’Œsymbolæ—¶ä¼šè‡ªåŠ¨å°†å…¶å¿½ç•¥ï¼Œåœ¨æ•°ç»„ä¸­ä¼šè¿”å›nullï¼ˆä»¥ä¿è¯å•å…ƒä½ç½®ä¸å˜ï¼‰</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"[1, null, null, 4]\"</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span> a<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">b</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"{\"a\": 2}\"</span>\n</code></pre></div>\n<p>å¯¹åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡æ‰§è¡ŒJSON.stringify(...)ä¼šæŠ¥é”™</p>\n<p>å¦‚æœå¯¹è±¡ä¸­å®šä¹‰äº†toJSON()æ–¹æ³•ï¼ŒJSONå­—ç¬¦ä¸²åŒ–æ—¶ä¼šé¦–å…ˆè°ƒç”¨è¯¥æ–¹æ³•ï¼Œç„¶åç”¨å®ƒçš„è¿”å›å€¼æ¥åºåˆ—åŒ–ã€‚</p>\n<p>å¦‚æœè¦å¯¹å«éæ³•JSONå€¼çš„å¯¹è±¡åšå­—ç¬¦ä¸²åŒ–ï¼Œæˆ–è€…å¯¹è±¡ä¸­çš„æŸäº›å€¼æ— æ³•è¢«åºåˆ—åŒ–ï¼Œå°±éœ€è¦å®šä¹‰JSON()æ–¹æ³•æ¥è¿”å›ä¸€ä¸ªå®‰å…¨çš„JSONå€¼ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  b<span class=\"token operator\">:</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span>\n  c<span class=\"token operator\">:</span> o<span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">d</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// åœ¨aä¸­åˆ›å»ºä¸€ä¸ªå¾ªç¯å¼•ç”¨</span>\no<span class=\"token punctuation\">.</span><span class=\"token property-access\">e</span> <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// å¾ªç¯å¼•ç”¨åœ¨è¿™é‡Œä¼šäº§ç”Ÿé”™è¯¯</span>\n<span class=\"token comment\">// JSON.stringify( a );</span>\n<span class=\"token comment\">// è‡ªå®šä¹‰çš„JSONåºåˆ—åŒ–</span>\na<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">toJSON</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// åºåˆ—åŒ–ä»…åŒ…å«b</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> b<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">b</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"{\"b\":42}\"</span>\n</code></pre></div>\n<p>å¾ˆå¤šäººè¯¯è®¤ä¸ºtoJSONè¿”å›çš„æ˜¯JSONå­—ç¬¦ä¸²åŒ–åçš„å€¼ï¼Œå…¶å®ä¸æ˜¯ï¼ŒtoJSON()çš„è¿”å›å€¼åº”è¯¥æ˜¯ä¸€ä¸ªé€‚å½“çš„å€¼ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œç„¶åå†ç”¨JSON.stringify(...)è¿›è¡Œæ ¼å¼åŒ–ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥å‘JSON.stringify(...)ä¸­ä¼ é€’ä¸€ä¸ªå¯é€‰æ‹©å‚æ•°replacerï¼Œä»–å¯ä»¥æ˜¯æ•°ç»„æˆ–è€…å‡½æ•°ï¼Œç”¨æ¥æŒ‡å®šå¯¹è±¡åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå“ªäº›å±æ€§åº”è¯¥è¢«å¤„ç†å“ªäº›åº”è¯¥è¢«æ’é™¤ã€‚</p>\n<ul>\n<li>å¦‚æœreplaceræ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«è¦è¢«å¤„ç†çš„å¯¹è±¡å±æ€§åç§°ã€‚</li>\n<li>å¦‚æœreplaceræ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šå¯¹å¯¹è±¡æœ¬èº«è°ƒç”¨ä¸€æ¬¡ï¼Œç„¶åå¯¹å¯¹è±¡ä¸­çš„æ¯ä¸ªå±æ€§å„è°ƒç”¨ä¸€æ¬¡ï¼Œæ¯æ¬¡ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œé”®å’Œå€¼ã€‚å¦‚æœè¦å¿½ç•¥æŸä¸ªé”®å°±è¿”å› undefined ï¼Œå¦åˆ™è¿”å›æŒ‡å®šçš„å€¼ã€‚</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  b<span class=\"token operator\">:</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span>\n  c<span class=\"token operator\">:</span> <span class=\"token string\">\"42\"</span><span class=\"token punctuation\">,</span>\n  d<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span> a<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"c\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"{\"b\":42,\"c\":\"42\"}\"</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">k<span class=\"token punctuation\">,</span>v</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>k <span class=\"token operator\">!==</span> <span class=\"token string\">\"c\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span> v<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// \"{\"b\":42,\"d\":[1,2,3]}\"</span>\n</code></pre></div>\n<p>è¯·è®°ä½ï¼Œ JSON.stringify(..) å¹¶ä¸æ˜¯å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚åœ¨è¿™é‡Œä»‹ç»æ˜¯å› ä¸ºå®ƒæ¶‰åŠ ToString å¼º\nåˆ¶ç±»å‹è½¬æ¢ï¼Œå…·ä½“è¡¨ç°åœ¨ä»¥ä¸‹ä¸¤ç‚¹ã€‚</p>\n<p>(1) å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼å’Œ null çš„ JSON.stringify(..) è§„åˆ™ä¸ ToString åŸºæœ¬ç›¸åŒã€‚</p>\n<p>(2) å¦‚æœä¼ é€’ç»™ JSON.stringify(..) çš„å¯¹è±¡ä¸­å®šä¹‰äº† toJSON() æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šåœ¨å­—ç¬¦\nä¸²åŒ–å‰è°ƒç”¨ï¼Œä»¥ä¾¿å°†å¯¹è±¡è½¬æ¢ä¸ºå®‰å…¨çš„ JSON å€¼ã€‚</p>\n<h4 id=\"tonumber\">ToNumber</h4>\n<p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å°†éæ•°å­—å€¼å½“ä½œæ•°å­—æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚æ•°å­¦è¿ç®—ã€‚ä¸ºæ­¤ ES5 è§„èŒƒåœ¨ 9.3 èŠ‚å®šä¹‰äº†\næŠ½è±¡æ“ä½œ ToNumber ã€‚</p>\n<p>å…¶ä¸­ true è½¬æ¢ä¸º 1 ï¼Œ false è½¬æ¢ä¸º 0 ã€‚ undefined è½¬æ¢ä¸º NaN ï¼Œ null è½¬æ¢ä¸º 0 ã€‚</p>\n<p>å¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰ä¼šé¦–å…ˆè¢«è½¬æ¢ä¸ºç›¸åº”çš„åŸºæœ¬ç±»å‹å€¼ï¼Œå¦‚æœè¿”å›çš„æ˜¯éæ•°å­—çš„åŸºæœ¬ç±»å‹å€¼ï¼Œåˆ™å†éµå¾ªä»¥ä¸Šè§„åˆ™å°†å…¶å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—ã€‚</p>\n<p>ä¸ºäº†å°†å€¼è½¬æ¢ä¸ºç›¸åº”çš„åŸºæœ¬ç±»å‹å€¼ï¼ŒæŠ½è±¡æ“ä½œtoPrimitiveä¼šé¦–å…ˆæ£€æŸ¥è¯¥å€¼æ˜¯å¦æœ‰valueOf(...)æ–¹æ³•ã€‚å¦‚æœæœ‰å¹¶ä¸”è¿”å›åŸºæœ¬ç±»å‹å€¼ï¼Œå°±ç”¨è¯¥å€¼è¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Œå¦‚æœæ²¡æœ‰å°±æ˜¯ç”¨toString(...)çš„è¿”å›å€¼æ¥è¿›è¡Œå¼ºåˆ¶çš„ç±»å‹è½¬æ¢ã€‚</p>\n<p>å¦‚æœ valueOf() å’Œ toString() å‡ä¸è¿”å›åŸºæœ¬ç±»å‹å€¼ï¼Œä¼šäº§ç”Ÿ TypeError é”™è¯¯ã€‚</p>\n<p>ä» ES5 å¼€å§‹ï¼Œä½¿ç”¨ Object.create(null) åˆ›å»ºçš„å¯¹è±¡ [[Prototype]] å±æ€§ä¸º null ï¼Œå¹¶ä¸”æ²¡\næœ‰ valueOf() å’Œ toString() æ–¹æ³•ï¼Œå› æ­¤æ— æ³•è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">valueOf</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">\"42\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">toString</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">\"42\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  c<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">toString</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> c <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"abc\"</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// NaN</span>\n</code></pre></div>\n<h4 id=\"toboolean\">ToBoolean</h4>\n<h5 id=\"å‡å€¼\">å‡å€¼</h5>\n<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å…¶ä»–å€¼æ˜¯å¦‚ä½•è¢«å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼çš„ã€‚</p>\n<p>JavaScript ä¸­çš„å€¼å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š</p>\n<p>(1) å¯ä»¥è¢«å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º false çš„å€¼</p>\n<p>(2) å…¶ä»–ï¼ˆè¢«å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º true çš„å€¼ï¼‰</p>\n<p>ä»¥ä¸‹è¿™äº›æ˜¯å‡å€¼ï¼š</p>\n<ul>\n<li>undefined</li>\n<li>null</li>\n<li>false</li>\n<li>+0 -0å’ŒNaN</li>\n<li>''</li>\n</ul>\n<p>å‡å€¼çš„å¸ƒå°”å¼ºåˆ¶ç±»å‹è½¬æ¢ç»“æœä¸º false ã€‚</p>\n<p>ä»é€»è¾‘ä¸Šè¯´ï¼Œå‡å€¼åˆ—è¡¨ä»¥å¤–çš„éƒ½åº”è¯¥æ˜¯çœŸå€¼ï¼ˆtruthyï¼‰ã€‚ä½† JavaScript è§„èŒƒå¯¹æ­¤å¹¶æ²¡æœ‰æ˜ç¡®\nå®šä¹‰ï¼Œåªæ˜¯ç»™å‡ºäº†ä¸€äº›ç¤ºä¾‹ï¼Œä¾‹å¦‚è§„å®šæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯çœŸå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå‡å€¼åˆ—è¡¨ä»¥\nå¤–çš„å€¼éƒ½æ˜¯çœŸå€¼ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">(</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Number</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> a <span class=\"token operator\">&#x26;&#x26;</span> b <span class=\"token operator\">&#x26;&#x26;</span> c <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nd<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<h5 id=\"çœŸå€¼\">çœŸå€¼</h5>\n<p>ä¸åœ¨å‡å€¼åˆ—è¡¨çš„å€¼å«çœŸå€¼ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token string\">\"''\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> a <span class=\"token operator\">&#x26;&#x26;</span> b <span class=\"token operator\">&#x26;&#x26;</span> c <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nd<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç©ºæ•°ç»„â€”â€”æ˜¯çœŸå€¼è¿˜æ˜¯å‡å€¼ï¼Ÿ</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç©ºå¯¹è±¡â€”â€”æ˜¯çœŸå€¼è¿˜æ˜¯å‡å€¼ï¼Ÿ</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">c</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç©ºå‡½æ•°â€”â€”æ˜¯çœŸå€¼è¿˜æ˜¯å‡å€¼ï¼Ÿ</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> a <span class=\"token operator\">&#x26;&#x26;</span> b <span class=\"token operator\">&#x26;&#x26;</span> c <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nd<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<h3 id=\"æ˜¾ç¤ºå¼ºåˆ¶ç±»å‹è½¬æ¢\">æ˜¾ç¤ºå¼ºåˆ¶ç±»å‹è½¬æ¢</h3>\n<h4 id=\"å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„æ˜¾ç¤ºè½¬æ¢\">å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„æ˜¾ç¤ºè½¬æ¢</h4>\n<p>å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„è½¬æ¢æ˜¯é€šè¿‡String(...)å’ŒNumber(...)è¿™ä¸¤ä¸ªå†…å»ºå‡½æ•°æ¥å®ç°çš„ã€‚</p>\n<p>è¯·æ³¨æ„å®ƒä»¬å‰é¢æ²¡æœ‰ new å…³é”®å­—ï¼Œå¹¶ä¸åˆ›å»ºå°è£…å¯¹è±¡ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token string\">\"3.14\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> c <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42\"</span>\nd<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3.14</span>\n</code></pre></div>\n<p>String(..) éµå¾ªå‰é¢è®²è¿‡çš„ ToString è§„åˆ™ï¼Œå°†å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²åŸºæœ¬ç±»å‹ã€‚ Number(..) éµå¾ª\nå‰é¢è®²è¿‡çš„ ToNumber è§„åˆ™ï¼Œå°†å€¼è½¬æ¢ä¸ºæ•°å­—åŸºæœ¬ç±»å‹ã€‚</p>\n<p>é™¤äº†String(...)å’ŒNumber(...)ï¼Œè¿˜æœ‰å…¶ä»–å¯ä»¥å®ç°å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´æ˜¾ç¤ºè½¬æ¢çš„æ–¹æ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token string\">\"3.14\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token operator\">+</span>c<span class=\"token punctuation\">;</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"42\"</span>\nd<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3.14</span>\n</code></pre></div>\n<p>a.toString() æ˜¯æ˜¾å¼çš„ï¼ˆâ€œtoStringâ€æ„ä¸ºâ€œto a stringâ€ï¼‰ï¼Œä¸è¿‡å…¶ä¸­æ¶‰åŠéšå¼è½¬æ¢ã€‚å› ä¸º\ntoString() å¯¹ 42 è¿™æ ·çš„åŸºæœ¬ç±»å‹å€¼ä¸é€‚ç”¨ï¼Œæ‰€ä»¥ JavaScript å¼•æ“ä¼šè‡ªåŠ¨ä¸º 42 åˆ›å»ºä¸€ä¸ªå°\nè£…å¯¹è±¡ï¼ˆå‚è§ç¬¬ 3 ç« ï¼‰ï¼Œç„¶åå¯¹è¯¥å¯¹è±¡è°ƒç”¨ toString() ã€‚è¿™é‡Œæ˜¾å¼è½¬æ¢ä¸­å«æœ‰éšå¼è½¬æ¢</p>\n<p>ä¸Šä¾‹ä¸­ +c æ˜¯ + è¿ç®—ç¬¦çš„ä¸€å…ƒï¼ˆunaryï¼‰å½¢å¼ï¼ˆå³åªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼‰ã€‚ + è¿ç®—ç¬¦æ˜¾å¼åœ°å°† c è½¬\næ¢ä¸ºæ•°å­—ï¼Œè€Œéæ•°å­—åŠ æ³•è¿ç®—ï¼ˆä¹Ÿä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè§ä¸‹ï¼‰ã€‚</p>\n<p>d = +c(d =+ c) å’Œ d += cæœ‰å¤©å£¤ä¹‹åˆ«ã€‚</p>\n<ol>\n<li>æ—¥æœŸæ˜¾ç¤ºè½¬æ¢ä¸ºæ•°å­—</li>\n</ol>\n<p>ä¸€å…ƒè¿ç®—ç¬¦+çš„å¦ä¸€ä¸ªç”¨é€”æ˜¯å°†æ—¥æœŸï¼ˆDateï¼‰å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—ç±»å‹ã€‚è¿”å›ç»“æœä¸ºUnixçš„æ—¶é—´æˆ³ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Mon, 18 Aug 2014 08:53:06 CDT\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span>d<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1408369986000</span>\n<span class=\"token comment\">// é€šå¸¸ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥è·å–å½“å‰çš„æ—¶é—´æˆ³</span>\n<span class=\"token keyword\">var</span> timestamp <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>å¥‡ç‰¹çš„~è¿ç®—ç¬¦</li>\n</ol>\n<p>ä¸€ä¸ªå¸¸è¢«äººå¿½è§†çš„åœ°æ–¹æ˜¯ ~ è¿ç®—ç¬¦ï¼ˆå³å­—ä½æ“ä½œâ€œéâ€ï¼‰ç›¸å…³çš„å¼ºåˆ¶ç±»å‹è½¬æ¢</p>\n<p>~x å¤§è‡´ç­‰åŒäº -(x + 1)ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">~</span><span class=\"token number\">42</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// -(42+1) ==> -43</span>\n</code></pre></div>\n<p>åœ¨ -(x+1) ä¸­å”¯ä¸€èƒ½å¤Ÿå¾—åˆ° 0 ï¼ˆæˆ–è€…ä¸¥æ ¼è¯´æ˜¯ -0 ï¼‰çš„ x å€¼æ˜¯ -1 ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ x ä¸º -1 æ—¶ï¼Œ ~å’Œä¸€äº›æ•°å­—å€¼åœ¨ä¸€èµ·ä¼šè¿”å›å‡å€¼ 0 ï¼Œå…¶ä»–æƒ…å†µåˆ™è¿”å›çœŸå€¼ã€‚</p>\n<p>-1æ˜¯ä¸€ä¸ªå“¨ä½å€¼ï¼Œé€šå¸¸åœ¨å„ä¸ªè¯­è¨€ä¸­éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚</p>\n<p>æ¯”å¦‚JavaScriptä¸­çš„indexOf(...)å‡½æ•°ã€‚indexOf(..) ä¸ä»…èƒ½å¤Ÿå¾—åˆ°å­å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œè¿˜å¯ä»¥ç”¨æ¥æ£€æŸ¥å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„å­å­—ç¬¦ä¸²ï¼Œç›¸å½“äºä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"lo\"</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// æ‰¾åˆ°åŒ¹é…ï¼</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"lo\"</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// æ‰¾åˆ°åŒ¹é…ï¼</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"ol\"</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"ol\"</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>>= 0 å’Œ == -1 è¿™æ ·çš„å†™æ³•ä¸æ˜¯å¾ˆå¥½ï¼Œç§°ä¸ºâ€œæŠ½è±¡æ¸—æ¼â€ï¼Œæ„æ€æ˜¯åœ¨ä»£ç ä¸­æš´éœ²äº†åº•å±‚çš„å®ç°ç»†èŠ‚ï¼Œè¿™é‡Œæ˜¯æŒ‡ç”¨ -1 ä½œä¸ºå¤±è´¥æ—¶çš„è¿”å›å€¼ï¼Œè¿™äº›ç»†èŠ‚åº”è¯¥è¢«å±è”½æ‰ã€‚</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">~</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"lo\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// -4 &#x3C;-- çœŸå€¼!</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"lo\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// æ‰¾åˆ°åŒ¹é…ï¼</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">~</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"ol\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0 &#x3C;-- å‡å€¼!</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">~</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"ol\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token operator\">~</span>a<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">indexOf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"ol\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// true</span>\n<span class=\"token comment\">// æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å¦‚æœ indexOf(..) è¿”å› -1 ï¼Œ ~ å°†å…¶è½¬æ¢ä¸ºå‡å€¼ 0 ï¼Œå…¶ä»–æƒ…å†µä¸€å¾‹è½¬æ¢ä¸ºçœŸå€¼ã€‚</p>\n<ol start=\"3\">\n<li>å­—ä½æˆªé™¤\nä¸€äº›å¼€å‘äººå‘˜ä½¿ç”¨ ~~ æ¥æˆªé™¤æ•°å­—å€¼çš„å°æ•°éƒ¨åˆ†ï¼Œä»¥ä¸ºè¿™å’Œ Math.floor(..) çš„æ•ˆæœä¸€æ ·ï¼Œ\nå®é™…ä¸Šå¹¶éå¦‚æ­¤ã€‚</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token known-class-name class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">floor</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">-</span><span class=\"token number\">49.6</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// -50</span>\n<span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">-</span><span class=\"token number\">49.6</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// -49</span>\n</code></pre></div>\n<h4 id=\"æ˜¾ç¤ºçš„è§£ææ•°å­—å­—ç¬¦ä¸²\">æ˜¾ç¤ºçš„è§£ææ•°å­—å­—ç¬¦ä¸²</h4>\n<p>è§£æå­—ç¬¦ä¸²ä¸­çš„æ•°å­—å’Œå¼ºåˆ¶è½¬æ¢å­—ç¬¦ä¸²ä¸ºæ•°å­—è¿”å›çš„ç»“æœéƒ½æ˜¯æ•°å­—ï¼Œä½†æ˜¯è§£æå’Œè½¬æ¢ä¸¤è€…ä¹‹é—´è¿˜æ˜¯æœ‰å·®åˆ«çš„ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"42\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token string\">\"42px\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n<span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n<span class=\"token known-class-name class-name\">Number</span><span class=\"token punctuation\">(</span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// NaN</span>\n<span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>è§£æå…è®¸å­—ç¬¦ä¸²ä¸­å«æœ‰éæ•°å­—å­—ç¬¦ä¸²ï¼Œè§£ææŒ‰ç…§ä»å·¦è‡³å³çš„é¡ºåºï¼Œå¦‚æœé‡åˆ°éæ•°å­—å­—ç¬¦ä¸²å°±ä¼šåœæ­¢ã€‚è€Œè½¬æ¢ä¸å…è®¸åŒ…å«éæ•°å­—å­—ç¬¦ä¸²ï¼Œå¦åˆ™è¿”å›NaNã€‚</p>\n<blockquote>\n<p>è§£æå­—ç¬¦ä¸²ä¸­çš„æµ®ç‚¹æ•°å¯ä»¥ä½¿ç”¨ parseFloat(..) å‡½æ•°ã€‚</p>\n</blockquote>\n<p>å¦‚ä½•è§£é‡Šä¸‹é¢çš„è¿”å›ç»“æœï¼Ÿ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">19</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 18</span>\n</code></pre></div>\n<p>parseInt(..) å…ˆå°†å‚æ•°å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²å†è¿›è¡Œè§£æï¼ˆtoString()ï¼‰ï¼Œ1/0 = Infinityï¼Œæ‰€ä»¥ä¸Šè¾¹ç­‰åŒäºparseInt('Infinity', 19)ï¼Œ19è¿›åˆ¶çš„è¡¨ç¤º 123456789ABCDEFGHIJï¼ŒparseIntè§£æåˆ°nçš„æ—¶å€™å‘ç°æ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥åªèƒ½åˆ°Iï¼Œè€ŒIåœ¨19è¿›åˆ¶ä¸­è¡¨ç¤º18ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç»“æœæ˜¯18ã€‚</p>\n<p>æ­¤å¤–è¿˜æœ‰ä¸€äº›çœ‹èµ·æ¥å¥‡æ€ªä½†å®é™…ä¸Šè§£é‡Šå¾—é€šçš„ä¾‹å­ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0.000008</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0 (\"0\" æ¥è‡ªäº \"0.000008\")</span>\n<span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0.0000008</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 8 (\"8\" æ¥è‡ªäº \"8e-7\")</span>\n<span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 250 (\"fa\" æ¥è‡ªäº \"false\")</span>\n<span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> parseInt<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 15 (\"f\" æ¥è‡ªäº \"function..\")</span>\n<span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"0x10\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 16</span>\n<span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"103\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre></div>\n<h4 id=\"æ˜¾ç¤ºçš„è½¬æ¢ä¸ºå¸ƒå°”å€¼\">æ˜¾ç¤ºçš„è½¬æ¢ä¸ºå¸ƒå°”å€¼</h4>\n<p>ä¸å‰é¢çš„ String(..) å’Œ Number(..) ä¸€æ ·ï¼Œ Boolean(..) ï¼ˆä¸å¸¦ new ï¼‰æ˜¯æ˜¾å¼çš„ ToBoolean å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> e <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> f <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> g<span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> c <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> d <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> e <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> f <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token known-class-name class-name\">Boolean</span><span class=\"token punctuation\">(</span> g <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n</code></pre></div>\n<p>å’Œå‰é¢è®²è¿‡çš„ + ç±»ä¼¼ï¼Œä¸€å…ƒè¿ç®—ç¬¦ ! æ˜¾å¼åœ°å°†å€¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚ä½†æ˜¯å®ƒåŒæ—¶è¿˜å°†\nçœŸå€¼åè½¬ä¸ºå‡å€¼ï¼ˆæˆ–è€…å°†å‡å€¼åè½¬ä¸ºçœŸå€¼ï¼‰ã€‚æ‰€ä»¥æ˜¾å¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼æœ€å¸¸ç”¨çš„æ–¹\næ³•æ˜¯ !! ï¼Œå› ä¸ºç¬¬äºŒä¸ª ! ä¼šå°†ç»“æœåè½¬å›åŸå€¼ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> e <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> f <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> g<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">!</span>a<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">!</span>b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">!</span>c<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">!</span>d<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">!</span>e<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">!</span>f<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token operator\">!</span><span class=\"token operator\">!</span>g<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n</code></pre></div>\n<p>æ˜¾å¼ ToBoolean çš„å¦å¤–ä¸€ä¸ªç”¨å¤„ï¼Œæ˜¯åœ¨ JSON åºåˆ—åŒ–è¿‡ç¨‹ä¸­å°†å€¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º true æˆ–\nfalse ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">/*..*/</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">/*..*/</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"[1,null,2,null]\"</span>\n<span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span>val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> val <span class=\"token operator\">==</span> <span class=\"token string\">\"function\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// å‡½æ•°çš„ToBooleanå¼ºåˆ¶ç±»å‹è½¬æ¢</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>val<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> val<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// \"[1,true,2,true]\"</span>\n</code></pre></div>\n<h3 id=\"éšå¼å¼ºåˆ¶è½¬æ¢\">éšå¼å¼ºåˆ¶è½¬æ¢</h3>\n<h4 id=\"å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„éšå¼å¼ºåˆ¶è½¬æ¢\">å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„éšå¼å¼ºåˆ¶è½¬æ¢</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"42\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\na <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"420\"</span>\nc <span class=\"token operator\">+</span> d<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>å› ä¸ºæŸä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªæ“ä½œæ•°éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ + æ‰§è¡Œçš„æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œã€‚</p>\n<h4 id=\"å¸ƒå°”å€¼åˆ°æ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢\">å¸ƒå°”å€¼åˆ°æ•°å­—çš„éšå¼å¼ºåˆ¶è½¬æ¢</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">onlyOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> arguments<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// è·³è¿‡å‡å€¼ï¼Œå’Œå¤„ç†0ä¸€æ ·ï¼Œä½†æ˜¯é¿å…äº†NaN</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      sum <span class=\"token operator\">+=</span> arguments<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">return</span> sum <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼\">éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼</h4>\n<p>ç›¸å¯¹å¸ƒå°”å€¼ï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²æ“ä½œä¸­çš„éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢è¿˜ç®—æ¯”è¾ƒæ˜æ˜¾ã€‚ä¸‹é¢çš„æƒ…å†µä¼šå‘ç”Ÿ\nå¸ƒå°”å€¼éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p>\n<p>(1)  if (..) è¯­å¥ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼ã€‚</p>\n<p>(2)  for ( .. ; .. ; .. ) è¯­å¥ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼ï¼ˆç¬¬äºŒä¸ªï¼‰ã€‚</p>\n<p>(3)  while (..) å’Œ do..while(..) å¾ªç¯ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼ã€‚</p>\n<p>(4)  ? : ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼ã€‚</p>\n<p>(5) é€»è¾‘è¿ç®—ç¬¦ || ï¼ˆé€»è¾‘æˆ–ï¼‰å’Œ &#x26;&#x26; ï¼ˆé€»è¾‘ä¸ï¼‰å·¦è¾¹çš„æ“ä½œæ•°ï¼ˆä½œä¸ºæ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼ï¼‰ã€‚</p>\n<h3 id=\"-å’Œ-\">|| å’Œ &#x26;&#x26;</h3>\n<p>é€»è¾‘è¿ç®—ç¬¦ || ï¼ˆæˆ–ï¼‰å’Œ &#x26;&#x26; ï¼ˆä¸ï¼‰åº”è¯¥å¹¶ä¸é™Œç”Ÿï¼Œä¹Ÿè®¸æ­£å› ä¸ºå¦‚æ­¤æœ‰äººè§‰å¾—å®ƒä»¬åœ¨\nJavaScript ä¸­çš„è¡¨ç°ä¹Ÿå’Œåœ¨å…¶ä»–è¯­è¨€ä¸­ä¸€æ ·</p>\n<p>è¿™é‡Œé¢æœ‰ä¸€äº›éå¸¸é‡è¦ä½†å´ä¸å¤ªä¸ºäººæ‰€çŸ¥çš„ç»†å¾®å·®åˆ«ã€‚</p>\n<p>æˆ‘å…¶å®ä¸å¤ªèµåŒå°†å®ƒä»¬ç§°ä¸ºâ€œé€»è¾‘è¿ç®—ç¬¦â€ï¼Œå› ä¸ºè¿™ä¸å¤ªå‡†ç¡®ã€‚ç§°å®ƒä»¬ä¸ºâ€œé€‰æ‹©å™¨è¿ç®—ç¬¦â€ï¼ˆselector operatorsï¼‰æˆ–è€…â€œæ“ä½œæ•°é€‰æ‹©å™¨è¿ç®—ç¬¦â€ï¼ˆoperand selector operatorsï¼‰æ›´æ°å½“äº›ã€‚</p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå’Œå…¶ä»–è¯­è¨€ä¸åŒï¼Œåœ¨ JavaScript ä¸­å®ƒä»¬è¿”å›çš„å¹¶ä¸æ˜¯å¸ƒå°”å€¼ã€‚</p>\n<p>å®ƒä»¬çš„è¿”å›å€¼æ˜¯ä¸¤ä¸ªæ“ä½œæ•°ä¸­çš„ä¸€ä¸ªï¼ˆä¸”ä»…ä¸€ä¸ªï¼‰ã€‚å³é€‰æ‹©ä¸¤ä¸ªæ“ä½œæ•°ä¸­çš„ä¸€ä¸ªï¼Œç„¶åè¿”å›å®ƒçš„å€¼ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token string\">\"abc\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span>\na <span class=\"token operator\">||</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\na <span class=\"token operator\">&#x26;&#x26;</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"abc\"</span>\nc <span class=\"token operator\">||</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"abc\"</span>\nc <span class=\"token operator\">&#x26;&#x26;</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// null</span>\n</code></pre></div>\n<p>å¯¹äº || æ¥è¯´ï¼Œå¦‚æœæ¡ä»¶åˆ¤æ–­ç»“æœä¸º true å°±è¿”å›ç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼ˆ a å’Œ c ï¼‰çš„å€¼ï¼Œå¦‚æœä¸º\nfalse å°±è¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°ï¼ˆ b ï¼‰çš„å€¼ã€‚\n&#x26;&#x26; åˆ™ç›¸åï¼Œå¦‚æœæ¡ä»¶åˆ¤æ–­ç»“æœä¸º true å°±è¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°ï¼ˆ b ï¼‰çš„å€¼ï¼Œå¦‚æœä¸º false å°±è¿”\nå›ç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼ˆ a å’Œ c ï¼‰çš„å€¼ã€‚</p>\n<h4 id=\"ç¬¦å·çš„å¼ºåˆ¶ç±»å‹è½¬æ¢\">ç¬¦å·çš„å¼ºåˆ¶ç±»å‹è½¬æ¢</h4>\n<p>ES6 å¼•å…¥äº†ç¬¦å·ç±»å‹ï¼Œä½†æ˜¯å®ƒçš„å¼ºåˆ¶è½¬æ¢æœ‰ä¸ªå‘ï¼Œè¿™é‡Œæœ‰å¿…è¦æä¸€ä¸‹ï¼šES6 å…è®¸ä»ç¬¦å·åˆ°å­—ç¬¦ä¸²çš„æ˜¾ç¤ºå¼ºåˆ¶è½¬æ¢ï¼Œç„¶è€Œï¼Œéšå¼å¼ºåˆ¶è½¬æ¢ä¼šå‘ç”Ÿé”™è¯¯ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> s1 <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cool'</span><span class=\"token punctuation\">)</span>\n<span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">(</span>s1<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'Symbol(cool)'</span>\n\n<span class=\"token keyword\">var</span> s2 <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cool'</span><span class=\"token punctuation\">)</span>\ns2 <span class=\"token operator\">+</span> <span class=\"token string\">''</span> <span class=\"token comment\">// TypeError</span>\n</code></pre></div>\n<h3 id=\"å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰\">å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰</h3>\n<p>å®½æ¾ç›¸ç­‰ï¼ˆ==ï¼‰å’Œä¸¥æ ¼ç›¸ç­‰ï¼ˆ===ï¼‰éƒ½ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚ä½†æ˜¯ä»–ä»¬ä¸¤æœ‰ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«ã€‚\nå¸¸è§çš„è¯¯åŒºæ˜¯â€==æ£€æŸ¥å€¼æ˜¯å¦ç›¸ç­‰ï¼Œ===æ£€æŸ¥å€¼å’Œç±»å‹æ˜¯å¦æƒ³ç­‰â€œã€‚è¿™ç§è§£é‡Šä¸å¤Ÿæ­£ç¡®ã€‚</p>\n<p>æ­£ç¡®çš„è§£é‡Šï¼šâ€==å…è®¸ç›¸ç­‰æ¯”è¾ƒä¸­è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè€Œ===ä¸å…è®¸â€œ</p>\n<h4 id=\"ç›¸ç­‰æ¯”è¾ƒæ“ä½œçš„æ€§èƒ½\">ç›¸ç­‰æ¯”è¾ƒæ“ä½œçš„æ€§èƒ½</h4>\n<p>æ ¹æ®ç¬¬ä¸€ç§è§£é‡Šï¼ˆä¸å‡†ç¡®çš„ç‰ˆæœ¬ï¼‰ï¼Œ === ä¼¼ä¹æ¯” == åšçš„äº‹æƒ…æ›´å¤šï¼Œå› ä¸ºå®ƒè¿˜è¦æ£€æŸ¥å€¼çš„ç±»å‹ã€‚</p>\n<p>ç¬¬äºŒç§è§£é‡Šä¸­ == çš„å·¥ä½œé‡æ›´å¤§ä¸€äº›ï¼Œå› ä¸ºå¦‚æœå€¼çš„ç±»å‹ä¸åŒè¿˜éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚\næœ‰äººè§‰å¾— == ä¼šæ¯” === æ…¢ï¼Œå®é™…ä¸Šè™½ç„¶å¼ºåˆ¶ç±»å‹è½¬æ¢ç¡®å®è¦å¤šèŠ±ç‚¹æ—¶é—´ï¼Œä½†ä»…ä»…æ˜¯å¾®ç§’çº§\nï¼ˆç™¾ä¸‡åˆ†ä¹‹ä¸€ç§’ï¼‰çš„å·®åˆ«è€Œå·²ã€‚</p>\n<p>å¦‚æœè¿›è¡Œæ¯”è¾ƒçš„ä¸¤ä¸ªå€¼ç±»å‹ç›¸åŒï¼Œåˆ™ == å’Œ === ä½¿ç”¨ç›¸åŒçš„ç®—æ³•ï¼Œæ‰€ä»¥é™¤äº† JavaScript å¼•æ“\nå®ç°ä¸Šçš„ç»†å¾®å·®åˆ«ä¹‹å¤–ï¼Œå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚</p>\n<p>å¦‚æœä¸¤ä¸ªå€¼çš„ç±»å‹ä¸åŒï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘æœ‰æ²¡æœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢çš„å¿…è¦ï¼Œæœ‰å°±ç”¨ == ï¼Œæ²¡æœ‰å°±ç”¨\n=== ï¼Œä¸ç”¨åœ¨ä¹æ€§èƒ½ã€‚</p>\n<h3 id=\"æŠ½è±¡ç›¸ç­‰\">æŠ½è±¡ç›¸ç­‰</h3>\n<ul>\n<li>\n<p>å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„ç›¸ç­‰çš„æ¯”è¾ƒ</p>\n<ul>\n<li>å¦‚æœtype(x)æ˜¯æ•°å­—ï¼Œtype(y)æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› x == toNumber(y)çš„ç»“æœ</li>\n<li>å¦‚æœtype(x)æ˜¯å­—ç¬¦ä¸²ï¼Œtype(y)æ˜¯æ•°å­—ï¼Œåˆ™è¿”å› toNumber(x) == yçš„ç»“æœ</li>\n</ul>\n</li>\n<li>\n<p>å…¶ä»–ç±»å‹å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒ</p>\n<ul>\n<li>å¦‚æœ Type(x) æ˜¯å¸ƒå°”ç±»å‹ï¼Œåˆ™è¿”å› ToNumber(x) == y çš„ç»“æœ</li>\n<li>å¦‚æœ Type(y) æ˜¯å¸ƒå°”ç±»å‹ï¼Œåˆ™è¿”å› x == ToNumber(y) çš„ç»“æœ</li>\n</ul>\n</li>\n<li>\n<p>null å’Œ undefined ä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒ</p>\n<ul>\n<li>å¦‚æœ x ä¸º null ï¼Œ y ä¸º undefined ï¼Œåˆ™ç»“æœä¸º true</li>\n<li>å¦‚æœ x ä¸º undefined ï¼Œ y ä¸º null ï¼Œåˆ™ç»“æœä¸º true</li>\n</ul>\n</li>\n<li>\n<p>å¯¹è±¡å’Œéå¯¹è±¡ä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒ</p>\n<ul>\n<li>å¦‚æœ Type(x) æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œ Type(y) æ˜¯å¯¹è±¡ï¼Œåˆ™è¿”å› x == ToPrimitive(y)\nçš„ç»“æœ</li>\n<li>å¦‚æœ Type(x) æ˜¯å¯¹è±¡ï¼Œ Type(y) æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œåˆ™è¿”å› ToPromitive(x) == y\nçš„ç»“æœ</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"æ¯”è¾ƒå°‘è§çš„æƒ…å†µ\">æ¯”è¾ƒå°‘è§çš„æƒ…å†µ</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"0\"</span> <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token string\">\"0\"</span> <span class=\"token operator\">==</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token string\">\"0\"</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true -- æ™•ï¼</span>\n<span class=\"token string\">\"0\"</span> <span class=\"token operator\">==</span> <span class=\"token number\">NaN</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token string\">\"0\"</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token string\">\"0\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">==</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">==</span> <span class=\"token number\">NaN</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true -- æ™•ï¼</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true -- æ™•ï¼</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true -- æ™•ï¼</span>\n<span class=\"token boolean\">false</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token string\">\"\"</span> <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token string\">\"\"</span> <span class=\"token operator\">==</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token string\">\"\"</span> <span class=\"token operator\">==</span> <span class=\"token number\">NaN</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token string\">\"\"</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true -- æ™•ï¼</span>\n<span class=\"token string\">\"\"</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true -- æ™•ï¼</span>\n<span class=\"token string\">\"\"</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token number\">0</span> <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token number\">0</span> <span class=\"token operator\">==</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token number\">0</span> <span class=\"token operator\">==</span> <span class=\"token number\">NaN</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token number\">0</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true -- æ™•ï¼</span>\n<span class=\"token number\">0</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n</code></pre></div>\n<h4 id=\"æŠ½è±¡å…³ç³»æ¯”è¾ƒ\">æŠ½è±¡å…³ç³»æ¯”è¾ƒ</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> b<span class=\"token operator\">:</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> b<span class=\"token operator\">:</span> <span class=\"token number\">43</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\na <span class=\"token operator\">&#x3C;</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\na <span class=\"token operator\">==</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\na <span class=\"token operator\">></span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\na <span class=\"token operator\">&#x3C;=</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\na <span class=\"token operator\">>=</span> b<span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<hr>\n<h2 id=\"ç¬¬äº”ç« -è¯­æ³•\">ç¬¬äº”ç«  è¯­æ³•</h2>\n<h3 id=\"è¯­å¥å’Œè¡¨è¾¾å¼\">è¯­å¥å’Œè¡¨è¾¾å¼</h3>\n<h4 id=\"ä»£ç å—\">ä»£ç å—</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"[object Object]\"</span>\n<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 0</span>\n</code></pre></div>\n<p>ç¬¬ä¸€è¡Œä»£ç ä¸­ï¼Œ {} å‡ºç°åœ¨ + è¿ç®—ç¬¦è¡¨è¾¾å¼ä¸­ï¼Œå› æ­¤å®ƒè¢«å½“ä½œä¸€ä¸ªå€¼ï¼ˆç©ºå¯¹è±¡ï¼‰æ¥å¤„ç†ã€‚ç¬¬\n4 ç« è®²è¿‡ [] ä¼šè¢«å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º \"\" ï¼Œè€Œ {} ä¼šè¢«å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º \"[object Object]\" ã€‚</p>\n<p>ä½†åœ¨ç¬¬äºŒè¡Œä»£ç ä¸­ï¼Œ {} è¢«å½“ä½œä¸€ä¸ªç‹¬ç«‹çš„ç©ºä»£ç å—ï¼ˆä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼‰ã€‚ä»£ç å—ç»“å°¾ä¸éœ€\nè¦åˆ†å·ï¼Œæ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨è¯­æ³•ä¸Šçš„é—®é¢˜ã€‚æœ€å + [] å°† [] æ˜¾å¼å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆå‚è§ç¬¬ 4 ç« ï¼‰\nä¸º 0 ã€‚</p>\n<h3 id=\"è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§\">è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> a<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> a <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 43</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 43</span>\n\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> a<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 43</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§æ¯” = (ç­‰å·) ä½ï¼Œå¯ä»¥è®¤ä¸º (b = a++)ï¼Œa</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token boolean\">true</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">false</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// false</span>\n<span class=\"token boolean\">true</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\n</code></pre></div>\n<p>&#x26;&#x26; å…ˆæ‰§è¡Œï¼Œç„¶åæ˜¯ || ã€‚</p>\n<p>mdn ä¸Šçš„è¿ç®—ç¬¦ä¼˜å…ˆçº§åˆ—è¡¨</p>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence\">https://developer.mozilla.org/en-\nUS/docs/Web/JavaScript/Reference/Operators/Operator_Precedence</a></p>\n<h3 id=\"è‡ªåŠ¨åˆ†å·\">è‡ªåŠ¨åˆ†å·</h3>\n<p>æœ‰æ—¶JavaScriptä¼šä¸ºä»£ç è¡Œè¡¥ä¸Šç¼ºå¤±çš„åˆ†å·ï¼Œå³è‡ªåŠ¨åˆ†å·æ’å…¥ï¼ˆAutomatic Semicolon Insertion, ASIï¼‰</p>\n<p><strong>è¯·æ³¨æ„ï¼ŒASI åªåœ¨æ¢è¡Œç¬¦å¤„èµ·ä½œç”¨ï¼Œè€Œä¸ä¼šåœ¨ä»£ç è¡Œçš„ä¸­é—´æ’å…¥åˆ†å·ã€‚</strong></p>\n<p>ES5-Shimï¼ˆhttps://github.com/es-shims/es5-shimï¼‰æ˜¯ä¸€ä¸ªå®Œæ•´çš„ shim/polyfill\né›†åˆï¼Œèƒ½å¤Ÿä¸ºä½ çš„é¡¹ç›®æä¾› ES5 åŸºæœ¬è§„èŒƒæ”¯æŒã€‚åŒæ ·ï¼ŒES6-Shimï¼ˆhttps://\ngithub.com/es-shims/es6-shimï¼‰æä¾›äº†å¯¹ ES6 åŸºæœ¬è§„èŒƒçš„æ”¯æŒã€‚è™½ç„¶æˆ‘ä»¬å¯\nä»¥é€šè¿‡ shim/polyfill æ¥å¡«è¡¥æ–°çš„ APIï¼Œä½†æ˜¯æ— æ³•å¡«è¡¥æ–°çš„è¯­æ³•ã€‚å¯ä»¥ä½¿ç”¨\nTraceurï¼ˆhttps://github.com/google/traceur-compiler/wiki/GettingStartedï¼‰ è¿™ æ ·çš„å·¥å…·æ¥å®ç°æ–°æ—§è¯­æ³•ä¹‹é—´çš„è½¬æ¢ã€‚</p>\n<hr>\n<h1 id=\"ç¬¬äºŒéƒ¨åˆ†-å¼‚æ­¥ä¸æ€§èƒ½\">ç¬¬äºŒéƒ¨åˆ† å¼‚æ­¥ä¸æ€§èƒ½</h1>\n<h2 id=\"ç¨‹åºä¸­ç°åœ¨è¿è¡Œçš„éƒ¨åˆ†å’Œå°†æ¥è¿è¡Œçš„éƒ¨åˆ†ä¹‹é—´çš„å…³ç³»å°±æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒã€‚\">ç¨‹åºä¸­ç°åœ¨è¿è¡Œçš„éƒ¨åˆ†å’Œå°†æ¥è¿è¡Œçš„éƒ¨åˆ†ä¹‹é—´çš„å…³ç³»å°±æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒã€‚</h2>\n<h2 id=\"ç¬¬ä¸€ç« -ç°åœ¨ä¸å°†æ¥\">ç¬¬ä¸€ç«  ç°åœ¨ä¸å°†æ¥</h2>\n<h3 id=\"åˆ†å—çš„ç¨‹åº\">åˆ†å—çš„ç¨‹åº</h3>\n<p>å¯ä»¥æŠŠjsç¨‹åºå†™åœ¨å•ä¸ªjsæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªç¨‹åºå‡ ä¹æ˜¯ç”±å‡ ä¸ªå—ç»„æˆçš„ã€‚è¿™äº›å—ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ˜¯ç°åœ¨æ‰§è¡Œçš„ï¼Œå…¶ä½™çš„åˆ™ä¼šåœ¨å°†æ¥æ‰§è¡Œã€‚æœ€å¸¸è§çš„å¿«å•ä½æ˜¯å‡½æ•°ã€‚</p>\n<p>å¤§å¤šæ•°æ–°æ‰‹JavaScriptç¨‹åºå‘˜éƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼šç¨‹åºä¸­å°†æ¥æ‰§è¡Œçš„éƒ¨åˆ†å¹¶ä¸ä¸€å®šåœ¨ç°åœ¨æ‰§è¡Œéƒ¨åˆ†æ‰§è¡Œä¹‹åç«‹å³è¿è¡Œã€‚æ¢å¥è¯æ¥è¯´ï¼Œç°åœ¨æ— æ³•å®Œæˆçš„ä»»åŠ¡å°†ä¼šå¼‚æ­¥å®Œæˆï¼Œå¹¶ä¸ä¼šå‡ºç°äººä»¬æœ¬èƒ½è®¤ä¸ºä¼šå‡ºç°çš„æˆ–è€…å¸Œæœ›å‡ºç°çš„é˜»å¡è¡Œä¸ºã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ajax(..)æ˜¯æŸä¸ªåº“ä¸­æä¾›çš„æŸä¸ªAjaxå‡½æ•°</span>\n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.1\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> data <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// å•Šå“¦ï¼dataé€šå¸¸ä¸ä¼šåŒ…å«Ajaxç»“æœ</span>\n</code></pre></div>\n<p>ä»ç°åœ¨åˆ°å°†æ¥çš„ç­‰å¾…ï¼Œæœ€ç®€å•çš„æ–¹æ³•ï¼ˆä½†ç»å¯¹ä¸æ˜¯å”¯ä¸€ï¼Œç”šè‡³ä¹Ÿä¸æ˜¯æœ€å¥½çš„ï¼‰æ˜¯ä½¿ç”¨ä¸€ä¸ªé€šå¸¸ç§°ä¸ºå›è°ƒå‡½æ•°çš„å‡½æ•°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ajax(..)æ˜¯æŸä¸ªåº“ä¸­æä¾›çš„æŸä¸ªAjaxå‡½æ•°</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myCallbackFunction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> data <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è€¶ï¼è¿™é‡Œå¾—åˆ°äº†ä¸€äº›æ•°æ®ï¼</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<blockquote>\n<p>å¯èƒ½ä½ å·²ç»å¬è¯´è¿‡ï¼Œå¯ä»¥å‘é€åŒæ­¥ Ajax è¯·æ±‚ã€‚å°½ç®¡æŠ€æœ¯ä¸Šè¯´æ˜¯è¿™æ ·ï¼Œä½†æ˜¯ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºå®ƒä¼šé”å®šæµè§ˆå™¨ UIï¼ˆæŒ‰é’®ã€èœå•ã€æ»šåŠ¨æ¡ç­‰ï¼‰ï¼Œå¹¶é˜»å¡æ‰€æœ‰çš„ç”¨æˆ·äº¤äº’ã€‚è¿™æ˜¯ä¸€ä¸ªå¯æ€•çš„æƒ³æ³•ï¼Œä¸€å®šè¦é¿å…ã€‚</p>\n</blockquote>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token number\">21</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">later</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  answer <span class=\"token operator\">=</span> answer <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Meaning of life:\"</span><span class=\"token punctuation\">,</span> answer <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> answer <span class=\"token operator\">=</span> <span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span> later<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Meaning of life: 42</span>\n</code></pre></div>\n<p>è¿™ä¸ªç¨‹åºæœ‰ä¸¤ä¸ªå—ï¼šç°åœ¨æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œä»¥åŠå°†æ¥æ‰§è¡Œçš„éƒ¨åˆ†ã€‚è¿™ä¸¤å—çš„å†…å®¹å¾ˆæ˜æ˜¾ï¼Œä½†è¿™\né‡Œæˆ‘ä»¬è¿˜æ˜¯è¦æ˜ç¡®æŒ‡å‡ºæ¥ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ç°åœ¨</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token number\">21</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">later</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> answer <span class=\"token operator\">=</span> <span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span> later<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// å°†æ¥</span>\nanswer <span class=\"token operator\">=</span> answer <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Meaning of life:\"</span><span class=\"token punctuation\">,</span> answer <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>ä»»ä½•æ—¶å€™ï¼Œåªè¦æŠŠä¸€æ®µä»£ç åŒ…è£…æˆä¸€ä¸ªå‡½æ•°ï¼Œå¹¶æŒ‡å®šå®ƒåœ¨å“åº”æŸä¸ªäº‹ä»¶ï¼ˆå®šæ—¶å™¨ã€é¼ æ ‡ç‚¹å‡»ã€Ajax å“åº”ç­‰ï¼‰æ—¶æ‰§è¡Œï¼Œä½ å°±æ˜¯åœ¨ä»£ç ä¸­åˆ›å»ºäº†ä¸€ä¸ªå°†æ¥æ‰§è¡Œçš„å—ï¼Œä¹Ÿç”±æ­¤åœ¨è¿™ä¸ªç¨‹åº\nä¸­å¼•å…¥äº†å¼‚æ­¥æœºåˆ¶ã€‚</p>\n<h3 id=\"äº‹ä»¶å¾ªç¯\">äº‹ä»¶å¾ªç¯</h3>\n<p>å°½ç®¡ä½ æ˜¾ç„¶èƒ½å¤Ÿç¼–å†™å¼‚æ­¥ JavaScript ä»£ç \nï¼ˆå°±åƒå‰é¢æˆ‘ä»¬çœ‹åˆ°çš„å®šæ—¶ä»£ç ï¼‰ï¼Œä½†ç›´åˆ°æœ€è¿‘ï¼ˆES6ï¼‰ï¼ŒJavaScript æ‰çœŸæ­£å†…å»ºæœ‰ç›´æ¥çš„å¼‚\næ­¥æ¦‚å¿µã€‚</p>\n<p>JavaScript å¼•æ“æœ¬èº«æ‰€åšçš„åªä¸è¿‡æ˜¯åœ¨éœ€è¦çš„æ—¶å€™ï¼Œåœ¨ç»™å®šçš„ä»»æ„æ—¶åˆ»æ‰§è¡Œç¨‹åºä¸­çš„å•ä¸ªä»£ç å—ã€‚</p>\n<p>JavaScript å¼•æ“å¹¶ä¸æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå®ƒè¿è¡Œåœ¨å®¿ä¸»ç¯å¢ƒä¸­ï¼Œå¯¹å¤šæ•°å¼€å‘è€…æ¥è¯´é€šå¸¸å°±æ˜¯\nWeb æµè§ˆå™¨ã€‚ç»è¿‡æœ€è¿‘å‡ å¹´ï¼ˆä¸ä»…äºæ­¤ï¼‰çš„å‘å±•ï¼ŒJavaScript å·²ç»è¶…å‡ºäº†æµè§ˆå™¨çš„èŒƒå›´ï¼Œ\nè¿›å…¥äº†å…¶ä»–ç¯å¢ƒï¼Œæ¯”å¦‚é€šè¿‡åƒ Node.js è¿™æ ·çš„å·¥å…·è¿›å…¥æœåŠ¡å™¨é¢†åŸŸã€‚å®é™…ä¸Šï¼ŒJavaScript ç°\nå¦‚ä»Šå·²ç»åµŒå…¥åˆ°äº†ä»æœºå™¨äººåˆ°ç”µç¯æ³¡ç­‰å„ç§å„æ ·çš„è®¾å¤‡ä¸­ã€‚</p>\n<p>ä½†æ˜¯ï¼Œæ‰€æœ‰è¿™äº›ç¯å¢ƒéƒ½æœ‰ä¸€ä¸ªå…±åŒâ€œç‚¹â€ï¼ˆthreadï¼Œä¹ŸæŒ‡çº¿ç¨‹ã€‚ä¸è®ºçœŸå‡ä¸å¦ï¼Œè¿™éƒ½ä¸ç®—ä¸€\nä¸ªå¾ˆç²¾å¦™çš„å¼‚æ­¥ç¬‘è¯ï¼‰ï¼Œå³å®ƒä»¬éƒ½æä¾›äº†ä¸€ç§æœºåˆ¶æ¥å¤„ç†ç¨‹åºä¸­å¤šä¸ªå—çš„æ‰§è¡Œï¼Œä¸”æ‰§è¡Œæ¯\nå—æ—¶è°ƒç”¨ JavaScript å¼•æ“ï¼Œè¿™ç§æœºåˆ¶è¢«ç§°ä¸ºäº‹ä»¶å¾ªç¯ã€‚</p>\n<p>è¯å¥è¯è¯´ï¼šJavaScriptå¼•æ“æœ¬èº«æ²¡æœ‰æ—¶é—´çš„æ¦‚å¿µï¼Œåªæ˜¯ä¸€ä¸ªæŒ‰éœ€æ‰§è¡ŒJavaScriptä»»æ„ä»£ç ç‰‡æ®µçš„ç¯å¢ƒã€‚â€œäº‹ä»¶â€ï¼ˆJavaScriptä»£ç æ‰§è¡Œï¼‰è°ƒåº¦æ€»æ˜¯ç”±åŒ…å«å®ƒçš„ç¯å¢ƒè¿›è¡Œã€‚</p>\n<p><strong>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯ï¼Ÿï¼Ÿ</strong></p>\n<p>å…ˆé€šè¿‡ä¸€æ®µä¼ªä»£ç äº†è§£ä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µ:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// eventLoopæ˜¯ä¸€ä¸ªç”¨ä½œé˜Ÿåˆ—çš„æ•°ç»„</span>\n<span class=\"token comment\">// ï¼ˆå…ˆè¿›ï¼Œå…ˆå‡ºï¼‰</span>\n<span class=\"token keyword\">var</span> eventLoop <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> event<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// â€œæ°¸è¿œâ€æ‰§è¡Œ</span>\n<span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ä¸€æ¬¡tick</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>eventLoop<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ‹¿åˆ°é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªäº‹ä»¶</span>\n    event <span class=\"token operator\">=</span> eventLoop<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ç°åœ¨ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">event</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reportError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ªç”¨ while å¾ªç¯å®ç°çš„æŒç»­è¿è¡Œçš„å¾ªç¯ï¼Œå¾ªç¯çš„æ¯ä¸€è½®ç§°ä¸ºä¸€ä¸ª tickã€‚\nå¯¹æ¯ä¸ª tick è€Œè¨€ï¼Œå¦‚æœåœ¨é˜Ÿåˆ—ä¸­æœ‰ç­‰å¾…äº‹ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šä»é˜Ÿåˆ—ä¸­æ‘˜ä¸‹ä¸€ä¸ªäº‹ä»¶å¹¶æ‰§è¡Œã€‚è¿™\näº›äº‹ä»¶å°±æ˜¯ä½ çš„å›è°ƒå‡½æ•°ã€‚</p>\n<p>ä¸€å®šè¦æ¸…æ¥šï¼Œ setTimeout(..) å¹¶ æ²¡æœ‰æŠŠä½ çš„å›è°ƒå‡½æ•°æŒ‚åœ¨äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸­ã€‚å®ƒæ‰€åšçš„æ˜¯è®¾\nå®šä¸€ä¸ªå®šæ—¶å™¨ã€‚å½“å®šæ—¶å™¨åˆ°æ—¶åï¼Œç¯å¢ƒä¼šæŠŠä½ çš„å›è°ƒå‡½æ•°æ”¾åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œè¿™æ ·ï¼Œåœ¨æœªæ¥\næŸä¸ªæ—¶åˆ»çš„ tick ä¼šæ‘˜ä¸‹å¹¶æ‰§è¡Œè¿™ä¸ªå›è°ƒã€‚</p>\n<p>å¦‚æœè¿™æ—¶å€™äº‹ä»¶å¾ªç¯ä¸­å·²ç»æœ‰ 20 ä¸ªé¡¹ç›®äº†ä¼šæ€æ ·å‘¢ï¼Ÿä½ çš„å›è°ƒå°±ä¼šç­‰å¾…ã€‚å®ƒå¾—æ’åœ¨\nå…¶ä»–é¡¹ç›®åé¢â€”â€”é€šå¸¸æ²¡æœ‰æŠ¢å å¼çš„æ–¹å¼æ”¯æŒç›´æ¥å°†å…¶æ’åˆ°é˜Ÿé¦–ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆ\nsetTimeout(..) å®šæ—¶å™¨çš„ç²¾åº¦å¯èƒ½ä¸é«˜ã€‚å¤§ä½“è¯´æ¥ï¼Œåªèƒ½ç¡®ä¿ä½ çš„å›è°ƒå‡½æ•°ä¸ä¼šåœ¨æŒ‡å®šçš„\næ—¶é—´é—´éš”ä¹‹å‰è¿è¡Œï¼Œä½†å¯èƒ½ä¼šåœ¨é‚£ä¸ªæ—¶åˆ»è¿è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨é‚£ä¹‹åè¿è¡Œï¼Œè¦æ ¹æ®äº‹ä»¶é˜Ÿåˆ—çš„\nçŠ¶æ€è€Œå®šã€‚</p>\n<p>æ‰€ä»¥æ¢å¥è¯æ¥è¯´ï¼Œç¨‹åºé€šå¸¸åˆ†æˆäº†å¾ˆå¤šçš„å°å—ï¼Œåœ¨äº‹ä»¶é˜Ÿåˆ—ä¸­ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ‰§è¡Œï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå’Œä½ ç¨‹åºä¸ç›´æ¥ç›¸å…³çš„å…¶ä»–äº‹ä»¶ä¹Ÿå¯èƒ½æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>\n<h3 id=\"å¹¶è¡Œçº¿ç¨‹\">å¹¶è¡Œçº¿ç¨‹</h3>\n<p>å¼‚æ­¥æ˜¯ç°åœ¨å’Œå°†æ¥çš„æ—¶é—´é—´éš™ï¼Œå¹¶è¡Œæ˜¯å…³äºèƒ½å¤ŸåŒæ—¶å‘ç”Ÿçš„äº‹æƒ…ã€‚</p>\n<p>å¹¶è¡Œè®¡ç®—æœ€å¸¸è§çš„å·¥å…·å°±æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ã€‚è¿›ç¨‹å’Œçº¿ç¨‹èƒ½å¤Ÿç‹¬ç«‹è¿è¡Œï¼Œå¹¶å¯èƒ½åŒæ—¶è¿è¡Œï¼šåœ¨ä¸åŒçš„å¤„ç†å™¨ä¸Šï¼Œç”šè‡³ä¸åŒçš„è®¡ç®—æœºä¸Šï¼Œä½†å¤šä¸ªçº¿ç¨‹èƒ½å¤Ÿå…±äº«å•ä¸ªè¿›ç¨‹çš„å†…å­˜ã€‚</p>\n<p>ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ï¼Œäº‹ä»¶å¾ªç¯æŠŠè‡ªèº«çš„å·¥ä½œåˆ†æˆä¸€ä¸ªä¸ªä»»åŠ¡å¹¶é¡ºåºæ‰§è¡Œï¼Œä¸å…è®¸å¯¹å…±äº«å†…å­˜çš„\nå¹¶è¡Œè®¿é—®å’Œä¿®æ”¹ã€‚é€šè¿‡åˆ†ç«‹çº¿ç¨‹ä¸­å½¼æ­¤åˆä½œçš„äº‹ä»¶å¾ªç¯ï¼Œå¹¶è¡Œå’Œé¡ºåºæ‰§è¡Œå¯ä»¥å…±å­˜ã€‚</p>\n<p>å¹¶è¡Œçº¿ç¨‹çš„äº¤æ›¿æ‰§è¡Œå’Œå¼‚æ­¥äº‹ä»¶çš„äº¤æ›¿è°ƒåº¦ï¼Œå…¶ç²’åº¦æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p>\n<p>JavaScript ä»ä¸è·¨çº¿ç¨‹å…±äº«æ•°æ®ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦è€ƒè™‘å¤šçº¿ç¨‹äº¤é”™è¿è¡Œï¼Œå¯èƒ½ä¼šå¾—åˆ°å‡ºä¹æ„æ–™çš„ã€ä¸ç¡®å®šçš„è¡Œä¸ºã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ JavaScript æ€»æ˜¯ç¡®å®šæ€§çš„ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  b <span class=\"token operator\">=</span> b <span class=\"token operator\">*</span> a<span class=\"token punctuation\">;</span>\n  a <span class=\"token operator\">=</span> b <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  b<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n  a <span class=\"token operator\">=</span> <span class=\"token number\">8</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n  b <span class=\"token operator\">=</span> a <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ajax(..)æ˜¯æŸä¸ªåº“ä¸­æä¾›çš„æŸä¸ªAjaxå‡½æ•°</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.1\"</span><span class=\"token punctuation\">,</span> foo <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.2\"</span><span class=\"token punctuation\">,</span> bar <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>å—1æ˜¯åŒæ­¥çš„ï¼Œè€Œå—2ã€å—3æ˜¯å¼‚æ­¥çš„ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// å— 1ï¼š</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// å— 2ï¼ˆ foo() ï¼‰ï¼š</span>\na<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> b <span class=\"token operator\">*</span> a<span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> b <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// å— 3ï¼ˆ bar() ï¼‰ï¼š</span>\nb<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> <span class=\"token number\">8</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> a <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æ‰€ä»¥è¿™æ®µç¨‹åºå¯èƒ½å­˜åœ¨ä¸¤ç§ä¸åŒçš„è¾“å‡ºç»“æœ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">è¾“å‡º <span class=\"token number\">1</span>ï¼š\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// foo()</span>\na<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> b <span class=\"token operator\">*</span> a<span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> b <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// bar()</span>\nb<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> <span class=\"token number\">8</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> a <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 11</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 22</span>\nè¾“å‡º <span class=\"token number\">2</span>ï¼š\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// bar()</span>\nb<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> <span class=\"token number\">8</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> a <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// foo()</span>\na<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\nb <span class=\"token operator\">=</span> b <span class=\"token operator\">*</span> a<span class=\"token punctuation\">;</span>\na <span class=\"token operator\">=</span> b <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\na<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 183</span>\nb<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 180</span>\n</code></pre></div>\n<p>åŒä¸€æ®µä»£ç æœ‰ä¸åŒçš„è¾“å‡ºæ„å‘³ç€è¿˜å­˜åœ¨ä¸ç¡®å®šæ€§ï¼Œä½†æ˜¯è¿™ç§ä¸ç¡®å®šæ€§å®åœ¨å‡½æ•°çš„æ‰§è¡Œé¡ºåºçº§åˆ«ä¸Šçš„ï¼Œè€Œä¸æ˜¯å¤šçº¿ç¨‹ä¸‹çš„è¯­å¥é¡ºåºçš„é—®é¢˜ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸€ç¡®å®šæ€§è¦é«˜äºå¤šçº¿ç¨‹æƒ…å†µã€‚</p>\n<p>åœ¨ JavaScript çš„ç‰¹æ€§ä¸­ï¼Œè¿™ç§å‡½æ•°é¡ºåºçš„ä¸ç¡®å®šæ€§å°±æ˜¯é€šå¸¸æ‰€è¯´çš„ç«æ€æ¡ä»¶ï¼ˆrace\nconditionï¼‰ï¼Œ foo() å’Œ bar() ç›¸äº’ç«äº‰ï¼Œçœ‹è°å…ˆè¿è¡Œã€‚å…·ä½“æ¥è¯´ï¼Œå› ä¸ºæ— æ³•å¯é é¢„æµ‹ a å’Œ bçš„æœ€ç»ˆç»“æœï¼Œæ‰€ä»¥æ‰æ˜¯ç«æ€æ¡ä»¶ã€‚</p>\n<h3 id=\"å¹¶å‘\">å¹¶å‘</h3>\n<p>ç°åœ¨è®©æˆ‘ä»¬æ¥è®¾æƒ³ä¸€ä¸ªå±•ç¤ºçŠ¶æ€æ›´æ–°åˆ—è¡¨ï¼ˆæ¯”å¦‚ç¤¾äº¤ç½‘ç»œæ–°é—»ç§å­ï¼‰çš„ç½‘ç«™ï¼Œå…¶éšç€ç”¨æˆ·\nå‘ä¸‹æ»šåŠ¨åˆ—è¡¨è€Œé€æ¸åŠ è½½æ›´å¤šå†…å®¹ã€‚è¦æ­£ç¡®åœ°å®ç°è¿™ä¸€ç‰¹æ€§ï¼Œéœ€è¦ï¼ˆè‡³å°‘ï¼‰ä¸¤ä¸ªç‹¬ç«‹çš„\nâ€œè¿›ç¨‹â€åŒæ—¶è¿è¡Œï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯åœ¨åŒä¸€æ®µæ—¶é—´å†…ï¼Œå¹¶ä¸éœ€è¦åœ¨åŒä¸€æ—¶åˆ»ï¼‰ã€‚</p>\n<p>è¿™é‡Œçš„â€œè¿›ç¨‹â€ä¹‹æ‰€ä»¥æ‰“ä¸Šå¼•å·ï¼Œæ˜¯å› ä¸ºè¿™å¹¶ä¸æ˜¯è®¡ç®—æœºç§‘å­¦æ„ä¹‰ä¸Šçš„çœŸæ­£\næ“ä½œç³»ç»Ÿçº§è¿›ç¨‹ã€‚è¿™æ˜¯è™šæ‹Ÿè¿›ç¨‹ï¼Œæˆ–è€…ä»»åŠ¡ï¼Œè¡¨ç¤ºä¸€ä¸ªé€»è¾‘ä¸Šç›¸å…³çš„è¿ç®—åº\nåˆ—ã€‚ä¹‹æ‰€ä»¥ä½¿ç”¨â€œè¿›ç¨‹â€è€Œä¸æ˜¯â€œä»»åŠ¡â€ï¼Œæ˜¯å› ä¸ºä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œâ€œè¿›ç¨‹â€çš„\nå®šä¹‰æ›´ç¬¦åˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ„ä¹‰ã€‚</p>\n<h4 id=\"éäº¤äº’\">éäº¤äº’</h4>\n<p>ä¸¤ä¸ªæˆ–å¤šä¸ªâ€œè¿›ç¨‹â€åœ¨åŒä¸€ä¸ªç¨‹åºå†…å¹¶å‘åœ°äº¤æ›¿è¿è¡Œå®ƒä»¬çš„æ­¥éª¤ / äº‹ä»¶æ—¶ï¼Œå¦‚æœè¿™äº›ä»»åŠ¡\nå½¼æ­¤ä¸ç›¸å…³ï¼Œå°±ä¸ä¸€å®šéœ€è¦äº¤äº’ã€‚å¦‚æœè¿›ç¨‹é—´æ²¡æœ‰ç›¸äº’å½±å“çš„è¯ï¼Œä¸ç¡®å®šæ€§æ˜¯å®Œå…¨å¯ä»¥æ¥\nå—çš„ã€‚</p>\n<h4 id=\"äº¤äº’\">äº¤äº’</h4>\n<p>æ›´å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œå¹¶å‘çš„â€œè¿›ç¨‹â€éœ€è¦ç›¸äº’äº¤æµï¼Œé€šè¿‡ä½œç”¨åŸŸæˆ– DOM é—´æ¥äº¤äº’ã€‚æ­£å¦‚å‰\né¢ä»‹ç»çš„ï¼Œå¦‚æœå‡ºç°è¿™æ ·çš„äº¤äº’ï¼Œå°±éœ€è¦å¯¹å®ƒä»¬çš„äº¤äº’è¿›è¡Œåè°ƒä»¥é¿å…ç«æ€çš„å‡ºç°ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  a <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  b <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ajax(..)æ˜¯æŸä¸ªåº“ä¸­çš„æŸä¸ªAjaxå‡½æ•°</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.1\"</span><span class=\"token punctuation\">,</span> foo <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.2\"</span><span class=\"token punctuation\">,</span> bar <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æ‰€è°“äº†åè°ƒå°±æ˜¯ç»™æ‰§è¡Œæ·»åŠ æ¡ä»¶ï¼Œä¹Ÿå«é—¨</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  a <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">&#x26;&#x26;</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  b <span class=\"token operator\">=</span> y <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">&#x26;&#x26;</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> a <span class=\"token operator\">+</span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ajax(..)æ˜¯æŸä¸ªåº“ä¸­çš„æŸä¸ªAjaxå‡½æ•°</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.1\"</span><span class=\"token punctuation\">,</span> foo <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.2\"</span><span class=\"token punctuation\">,</span> bar <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>åŒ…è£¹ baz() è°ƒç”¨çš„æ¡ä»¶åˆ¤æ–­ if (a &#x26;&#x26; b) ä¼ ç»Ÿä¸Šç§°ä¸ºé—¨ï¼ˆgateï¼‰ï¼Œæˆ‘ä»¬è™½ç„¶ä¸èƒ½ç¡®å®š a å’Œ b\nåˆ°è¾¾çš„é¡ºåºï¼Œä½†æ˜¯ä¼šç­‰åˆ°å®ƒä»¬ä¸¤ä¸ªéƒ½å‡†å¤‡å¥½å†è¿›ä¸€æ­¥æ‰“å¼€é—¨ï¼ˆè°ƒç”¨ baz() ï¼‰ã€‚\nå¦ä¸€ç§å¯èƒ½é‡åˆ°çš„å¹¶å‘äº¤äº’æ¡ä»¶æœ‰æ—¶ç§°ä¸ºç«æ€ï¼ˆraceï¼‰ï¼Œä½†æ˜¯æ›´ç²¾ç¡®çš„å«æ³•æ˜¯é—¨é—©ï¼ˆlatchï¼‰ã€‚\nå®ƒçš„ç‰¹æ€§å¯ä»¥æè¿°ä¸ºâ€œåªæœ‰ç¬¬ä¸€åå–èƒœâ€ã€‚åœ¨è¿™é‡Œï¼Œä¸ç¡®å®šæ€§æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºå®ƒæ˜ç¡®\næŒ‡å‡ºäº†è¿™ä¸€ç‚¹æ˜¯å¯ä»¥æ¥å—çš„ï¼šéœ€è¦â€œç«äº‰â€åˆ°ç»ˆç‚¹ï¼Œä¸”åªæœ‰å”¯ä¸€çš„èƒœåˆ©è€…ã€‚</p>\n<h4 id=\"åä½œ\">åä½œ</h4>\n<p>è¿˜æœ‰ä¸€ç§å¹¶å‘åˆä½œæ–¹å¼ï¼Œç§°ä¸ºå¹¶å‘åä½œï¼ˆcooperative concurrencyï¼‰ã€‚è¿™é‡Œçš„é‡ç‚¹ä¸å†æ˜¯é€šè¿‡\nå…±äº«ä½œç”¨åŸŸä¸­çš„å€¼è¿›è¡Œäº¤äº’ï¼ˆå°½ç®¡æ˜¾ç„¶è¿™ä¹Ÿæ˜¯å…è®¸çš„ï¼ï¼‰ã€‚è¿™é‡Œçš„ç›®æ ‡æ˜¯å–åˆ°ä¸€ä¸ªé•¿æœŸè¿\nè¡Œçš„â€œè¿›ç¨‹â€ï¼Œå¹¶å°†å…¶åˆ†å‰²æˆå¤šä¸ªæ­¥éª¤æˆ–å¤šæ‰¹ä»»åŠ¡ï¼Œä½¿å¾—å…¶ä»–å¹¶å‘â€œè¿›ç¨‹â€æœ‰æœºä¼šå°†è‡ªå·±\nçš„è¿ç®—æ’å…¥åˆ°äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸­äº¤æ›¿è¿è¡Œã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// response(..)ä»Ajaxè°ƒç”¨ä¸­å–å¾—ç»“æœæ•°ç»„</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ·»åŠ åˆ°å·²æœ‰çš„resæ•°ç»„</span>\n  res <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">concat</span><span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªæ–°çš„å˜æ¢æ•°ç»„æŠŠæ‰€æœ‰dataå€¼åŠ å€</span>\n    data<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> val <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ajax(..)æ˜¯æŸä¸ªåº“ä¸­æä¾›çš„æŸä¸ªAjaxå‡½æ•°</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.1\"</span><span class=\"token punctuation\">,</span> response <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.2\"</span><span class=\"token punctuation\">,</span> response <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>å¦‚æœ \"http://some.url.1\" é¦–å…ˆå–å¾—ç»“æœï¼Œé‚£ä¹ˆæ•´ä¸ªåˆ—è¡¨ä¼šç«‹åˆ»æ˜ å°„åˆ° res ä¸­ã€‚å¦‚æœè®°å½•\næœ‰å‡ åƒæ¡æˆ–æ›´å°‘ï¼Œè¿™ä¸ç®—ä»€ä¹ˆã€‚ä½†æ˜¯å¦‚æœæœ‰åƒ 1000 ä¸‡æ¡è®°å½•çš„è¯ï¼Œå°±å¯èƒ½éœ€è¦è¿è¡Œç›¸å½“\nä¸€æ®µæ—¶é—´äº†ï¼ˆåœ¨é«˜æ€§èƒ½ç¬”è®°æœ¬ä¸Šéœ€è¦å‡ ç§’é’Ÿï¼Œåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šéœ€è¦æ›´é•¿æ—¶é—´ï¼Œç­‰ç­‰ï¼‰ã€‚\nè¿™æ ·çš„â€œè¿›ç¨‹â€è¿è¡Œæ—¶ï¼Œé¡µé¢ä¸Šçš„å…¶ä»–ä»£ç éƒ½ä¸èƒ½è¿è¡Œï¼ŒåŒ…æ‹¬ä¸èƒ½æœ‰å…¶ä»–çš„ response(..)\nè°ƒç”¨æˆ– UI åˆ·æ–°ï¼Œç”šè‡³æ˜¯åƒæ»šåŠ¨ã€è¾“å…¥ã€æŒ‰é’®ç‚¹å‡»è¿™æ ·çš„ç”¨æˆ·äº‹ä»¶ã€‚è¿™æ˜¯ç›¸å½“ç—›è‹¦çš„ã€‚\næ‰€ä»¥ï¼Œè¦åˆ›å»ºä¸€ä¸ªåä½œæ€§æ›´å¼ºæ›´å‹å¥½ä¸”ä¸ä¼šéœ¸å äº‹ä»¶å¾ªç¯é˜Ÿåˆ—çš„å¹¶å‘ç³»ç»Ÿï¼Œä½ å¯ä»¥å¼‚æ­¥åœ°\næ‰¹å¤„ç†è¿™äº›ç»“æœã€‚æ¯æ¬¡å¤„ç†ä¹‹åè¿”å›äº‹ä»¶å¾ªç¯ï¼Œè®©å…¶ä»–ç­‰å¾…äº‹ä»¶æœ‰æœºä¼šè¿è¡Œã€‚\nå†³ç»åŠæ³•ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// response(..)ä»Ajaxè°ƒç”¨ä¸­å–å¾—ç»“æœæ•°ç»„</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ä¸€æ¬¡å¤„ç†1000ä¸ª</span>\n<span class=\"token keyword\">var</span> chunk <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">splice</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// æ·»åŠ åˆ°å·²æœ‰çš„resç»„</span>\n  res <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">concat</span><span class=\"token punctuation\">(</span>\n  <span class=\"token comment\">// åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„æŠŠchunkä¸­æ‰€æœ‰å€¼åŠ å€</span>\n    chunk<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> val <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// è¿˜æœ‰å‰©ä¸‹çš„éœ€è¦å¤„ç†å—ï¼Ÿ</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// å¼‚æ­¥è°ƒåº¦ä¸‹ä¸€æ¬¡æ‰¹å¤„ç†</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">response</span><span class=\"token punctuation\">(</span> data <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ajax(..)æ˜¯æŸä¸ªåº“ä¸­æä¾›çš„æŸä¸ªAjaxå‡½æ•°</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.1\"</span><span class=\"token punctuation\">,</span> response <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"http://some.url.2\"</span><span class=\"token punctuation\">,</span> response <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>æˆ‘ä»¬æŠŠæ•°æ®é›†åˆæ”¾åœ¨æœ€å¤šåŒ…å« 1000 æ¡é¡¹ç›®çš„å—ä¸­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ç¡®ä¿äº†â€œè¿›ç¨‹â€è¿è¡Œæ—¶\né—´ä¼šå¾ˆçŸ­ï¼Œå³ä½¿è¿™æ„å‘³ç€éœ€è¦æ›´å¤šçš„åç»­â€œè¿›ç¨‹â€ï¼Œå› ä¸ºäº‹ä»¶å¾ªç¯é˜Ÿåˆ—çš„äº¤æ›¿è¿è¡Œä¼šæé«˜\nç«™ç‚¹ /App çš„å“åº”ï¼ˆæ€§èƒ½ï¼‰ã€‚\nå½“ç„¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åè°ƒè¿™äº›â€œè¿›ç¨‹â€çš„é¡ºåºï¼Œæ‰€ä»¥ç»“æœçš„é¡ºåºæ˜¯ä¸å¯é¢„æµ‹çš„ã€‚å¦‚æœéœ€è¦æ’\nåºçš„è¯ï¼Œå°±è¦ä½¿ç”¨å’Œå‰é¢æåˆ°ç±»ä¼¼çš„äº¤äº’æŠ€æœ¯ï¼Œæˆ–è€…æœ¬ä¹¦åé¢ç« èŠ‚å°†è¦ä»‹ç»çš„æŠ€æœ¯ã€‚\nè¿™é‡Œä½¿ç”¨ setTimeout(..0) ï¼ˆhackï¼‰è¿›è¡Œå¼‚æ­¥è°ƒåº¦ï¼ŒåŸºæœ¬ä¸Šå®ƒçš„æ„æ€å°±æ˜¯â€œæŠŠè¿™ä¸ªå‡½æ•°æ’å…¥\nåˆ°å½“å‰äº‹ä»¶å¾ªç¯é˜Ÿåˆ—çš„ç»“å°¾å¤„â€ã€‚</p>\n<blockquote>\n<p>ä¸¥æ ¼è¯´æ¥ï¼ŒsetTimeout(..0) å¹¶ä¸ç›´æ¥æŠŠé¡¹ç›®æ’å…¥åˆ°äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ã€‚å®šæ—¶å™¨ä¼šåœ¨æœ‰æœºä¼šçš„æ—¶å€™æ’å…¥äº‹ä»¶ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸¤ä¸ªè¿ç»­çš„ setTimeout(..0) è°ƒç”¨ä¸èƒ½ä¿è¯ä¼šä¸¥æ ¼æŒ‰ç…§è°ƒç”¨é¡ºåºå¤„ç†ï¼Œæ‰€ä»¥å„ç§æƒ…å†µéƒ½æœ‰å¯èƒ½å‡ºç°ï¼Œæ¯”å¦‚å®šæ—¶å™¨æ¼‚ç§»ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™äº›äº‹ä»¶çš„é¡ºåºå°±ä¸å¯é¢„æµ‹ã€‚åœ¨ Node.js ä¸­ï¼Œç±»ä¼¼çš„æ–¹æ³•æ˜¯ process.nextTick(..)ã€‚å°½ç®¡å®ƒä»¬ä½¿ç”¨æ–¹ä¾¿ï¼ˆé€šå¸¸æ€§èƒ½ä¹Ÿæ›´é«˜ï¼‰ï¼Œä½†å¹¶æ²¡æœ‰ï¼ˆè‡³å°‘åˆ°ç›®å‰ä¸ºæ­¢ï¼‰ç›´æ¥çš„æ–¹æ³•å¯ä»¥é€‚åº”æ‰€æœ‰ç¯å¢ƒæ¥ç¡®ä¿å¼‚æ­¥äº‹ä»¶çš„é¡ºåºã€‚ä¸‹ä¸€å°èŠ‚æˆ‘ä»¬ä¼šæ·±å…¥è®¨è®ºè¿™ä¸ªè¯é¢˜ã€‚</p>\n</blockquote>\n<h3 id=\"ä»»åŠ¡\">ä»»åŠ¡</h3>\n<p>åœ¨ ES6 ä¸­ï¼Œæœ‰ä¸€ä¸ªæ–°çš„æ¦‚å¿µå»ºç«‹åœ¨äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¹‹ä¸Šï¼Œå«ä½œä»»åŠ¡é˜Ÿåˆ—ï¼ˆjob queueï¼‰</p>\n<p>ä»»åŠ¡å’Œ setTimeout(..0) hack çš„æ€è·¯ç±»ä¼¼ï¼Œä½†æ˜¯å…¶å®ç°æ–¹å¼çš„å®šä¹‰æ›´åŠ è‰¯å¥½ï¼Œå¯¹é¡ºåºçš„ä¿\nè¯æ€§æ›´å¼ºï¼šå°½å¯èƒ½æ—©çš„å°†æ¥ã€‚</p>\n<p>è®¾æƒ³ä¸€ä¸ªè°ƒåº¦ä»»åŠ¡ï¼ˆç›´æ¥åœ°ï¼Œä¸è¦ hackï¼‰çš„ APIï¼Œç§°å…¶ä¸º schedule(..) ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"A\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"B\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ç†è®ºä¸Šçš„\"ä»»åŠ¡API\"</span>\n<span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"C\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"D\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//  A C D B</span>\n</code></pre></div>\n<hr>\n<h2 id=\"ç¬¬äºŒç« -å›è°ƒ\">ç¬¬äºŒç«  å›è°ƒ</h2>\n<h3 id=\"continuation\">continuation</h3>\n<h3 id=\"é¡ºåºå¤§è„‘\">é¡ºåºå¤§è„‘</h3>\n<h4 id=\"åµŒå¥—å›è°ƒä¸é“¾å¼å›è°ƒ\">åµŒå¥—å›è°ƒä¸é“¾å¼å›è°ƒ</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://some.url.1'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">response</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>text <span class=\"token operator\">==</span> <span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>text <span class=\"token operator\">==</span> <span class=\"token string\">'world'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>ä¸Šè¾¹çš„è¿™ç§ä»£ç é€šå¸¸ç§°ä¸ºå›è°ƒåœ°ç‹±æˆ–è€…æ¯ç­é‡‘å­—å¡”ã€‚</p>\n<p>ä½†æ˜¯å®é™…ä¸Šå›è°ƒåœ°ç‹±å’ŒåµŒå¥—ä¸ç¼©è¿›æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚å®ƒå¼•èµ·çš„é—®é¢˜æ¯”è¿™äº›ä¸¥é‡çš„å¤šã€‚</p>\n<p>æ„Ÿè§‰å›è°ƒè¿™ä¸€ç« å¤§éƒ¨åˆ†æ˜¯ä»¥æ•…äº‹çš„å½¢å¼åœ¨è®²å›è°ƒçš„ä¸€äº›é—®é¢˜ã€‚ä¸æ˜¯å¾ˆæ‡‚ï¼Œä»¥åå†çœ‹ï¼Œå…ˆè¿‡ã€‚</p>\n<hr>\n<h2 id=\"promise\">Promise</h2>\n<h3 id=\"å…·æœ‰-then-æ–¹æ³•çš„é¸­å­ç±»å‹\">å…·æœ‰ then æ–¹æ³•çš„é¸­å­ç±»å‹</h3>\n<p>å¦‚ä½•ç¡®å®šæŸä¸ªå€¼æ˜¯ä¸æ˜¯çœŸæ­£çš„ Promiseï¼Ÿ</p>\n<p>è¯†åˆ«Promiseå°±æ˜¯å®šä¹‰æŸç§ç§°ä¸º thenable çš„ä¸œè¥¿ï¼Œå°†å…¶å®šä¹‰ä¸ºä»»ä½•å…·æœ‰ then(...) æ–¹æ³•çš„å¯¹è±¡æˆ–è€…å‡½æ•°ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™æ ·çš„å€¼å°±æ˜¯ Promise ä¸€è‡´çš„ thenableã€‚</p>\n<p>æ ¹æ®ä¸€ä¸ªå€¼çš„å½¢æ€ï¼ˆå…·æœ‰å“ªäº›å±æ€§ï¼‰å¯¹è¿™å’Œä¸ªå€¼çš„ç±»å‹åšå‡ºä¸€äº›å‡å®šï¼Œè¿™ç§ç±»å‹æ£€æŸ¥ä¸€èˆ¬ç”¨æœ¯è¯­é¸­å­ç±»å‹æ¥è¡¨ç¤º---â€œå¦‚æœå®ƒçœ‹èµ·æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒä¸€å®šå°±æ˜¯ä¸€æ¡é¸­å­â€ï¼Œäºæ˜¯å¯¹ thenable å€¼çš„é¸­å­ç±»å‹æ£€æµ‹å°±å¤§è‡´ç±»ä¼¼ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">!==</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token punctuation\">(</span>typeor p <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">typeof</span> p <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token keyword\">typeof</span> p<span class=\"token punctuation\">.</span><span class=\"token property-access\">then</span> <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// å‡å®šè¿™æ˜¯ä¸€ä¸ª thenable</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ä¸æ˜¯ thenable</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä½†æ˜¯è¿™ä¸ªé€»è¾‘ä¼šå¸¦æ¥æ›´æ·±å±‚æ¬¡çš„éº»çƒ¦ã€‚</p>\n<p>å‡å¦‚æˆ‘ä»¬æ­£å¥½æœ‰ä¸€ä¸ªå¯¹è±¡å«æœ‰ then æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¼šè¢«å½“ä½œ thenable æˆ–è€… Promiseï¼Œæ¯”å¦‚ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">then</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">then</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> v1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>hello<span class=\"token operator\">:</span> <span class=\"token string\">'world'</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> v2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'world'</span><span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>æŒ‰ç…§ä¸Šè¾¹çš„é¸­å­ç±»å‹æ£€æŸ¥ï¼Œv1,v2éƒ½æ˜¯ thenableã€‚å°¤å…¶æ—¶ä¸€äº›åœ¨ ES6 ä¹‹å‰å°±æœ‰çš„ä¸€äº›éå¸¸è‘—åçš„é Promise åº“æ°å¥½æœ‰ thenable æ–¹æ³•ï¼Œè¦ä¹ˆå°±æ˜¯é‡æ–°å‘½åè‡ªå·±çš„æ–¹æ³•ï¼Œè¦ä¹ˆå°±æ˜¯é™çº§ä¸ Promise ä¸å…¼å®¹ï¼Œå¦åˆ™å®¹æ˜“äº§ç”Ÿæ— æ³•è¿½è¸ªçš„ bugã€‚</p>\n<h3 id=\"promise-çš„ä¿¡ä»»é—®é¢˜\">Promise çš„ä¿¡ä»»é—®é¢˜</h3>\n<h4 id=\"è°ƒç”¨è¿‡æ—©\">è°ƒç”¨è¿‡æ—©</h4>\n<p>ä¸€ä¸ªäººæœ‰æ—¶åŒæ­¥å®Œæˆï¼Œæœ‰æ—¶å¼‚æ­¥å®Œæˆï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç«æ€æ¡ä»¶ï¼ˆä¸ç¡®å®šæ€§ï¼‰ï¼Œæ¯”å¦‚ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">result</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'...'</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ— æ³•ç¡®å®š ajax æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Œresult çš„è¾“å‡ºç»“æœä¹Ÿä¸ä¸€æ ·</span>\na<span class=\"token operator\">++</span>\n</code></pre></div>\n<p>ä½†æ˜¯ï¼ŒPromise ä¸å­˜åœ¨è¿™ç§é—®é¢˜ï¼Œå³ä½¿æ˜¯ç«‹å³å®Œæˆçš„ Promise ä¹Ÿæ— æ³•è¢«åŒæ­¥è§‚å¯Ÿåˆ°ã€‚</p>\n<p>ä¹Ÿå³æ˜¯è¯´ï¼Œå¯¹ä¸€ä¸ª Promise è°ƒç”¨ then(...) çš„æ—¶å€™ï¼Œå³ä½¿è¿™ä¸ª Promise å·²ç»å†³è®®ï¼Œæä¾›ç»™ then çš„å›è°ƒä¹Ÿæ€»æ˜¯ä¼šè¢«å¼‚æ­¥è°ƒç”¨ã€‚ä¸ä¼šå­˜åœ¨ä¸Šè¾¹å¯èƒ½æ˜¯åŒæ­¥è°ƒç”¨çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸éœ€è¦æ’å…¥ setTimout è¿™ä¸€ç±» hack æ¥å¼‚æ­¥è°ƒç”¨ã€‚</p>\n<h4 id=\"è°ƒç”¨è¿‡æ™š\">è°ƒç”¨è¿‡æ™š</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span><span class=\"token punctuation\">{</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\tp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 5s å</span>\n<span class=\"token comment\">// a b c</span>\n<span class=\"token operator\">~</span><span class=\"token operator\">~</span>\n\n<span class=\"token known-class-name class-name\">Promise</span> æ‰€æœ‰é€šè¿‡ <span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span> æ–¹æ³•æ³¨å†Œçš„å›è°ƒéƒ½ä¼šåœ¨ä¸‹ä¸€ä¸ªå¼‚æ­¥æ—¶æœºä¸Šä¾æ¬¡è¢«ç«‹å³è°ƒç”¨ã€‚å›è°ƒä¸­ä»»ä½•ä¸€ä¸ªéƒ½æ— æ³•å½±å“æˆ–è€…å»¶è¯¯å¯¹å…¶å›è°ƒçš„è°ƒç”¨ã€‚\n\n#### <span class=\"token known-class-name class-name\">Promise</span> è°ƒåº¦æŠ€å·§\n\nå¦‚æœä¸¤ä¸ª <span class=\"token known-class-name class-name\">Promise</span> p1 å’Œ p2 éƒ½å·²ç»å†³è®®ï¼Œé‚£ä¹ˆ p1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span> å’Œ p2<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span> æœ€ç»ˆåº”è¯¥ä¼šå…ˆè°ƒç”¨ p1 çš„å›è°ƒï¼Œç„¶å p2 çš„å›è°ƒã€‚ä½†æ˜¯ï¼Œæœ‰äº›å¾®å¦™çš„åœºæ™¯ä¸æ˜¯è¿™æ ·çš„ï¼Œæ¯”å¦‚ï¼š\n<span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span>js\n<span class=\"token keyword\">var</span> p3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p3'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> p1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>p3<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> p2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p2'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\np1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\np2<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// p2 p3</span>\n</code></pre></div>\n<p>ç»“æœä¸æ˜¯p1 çš„å›è°ƒå…ˆè°ƒç”¨ï¼Œè€Œæ˜¯ p2 çš„å›è°ƒã€‚å› ä¸º p1 ä¸æ˜¯ç«‹å³å€¼ï¼Œè€Œæ˜¯ç”¨å¦ä¸€ä¸ª Promise p3 lå†³å®šã€‚</p>\n<h4 id=\"å›è°ƒæœªè°ƒç”¨\">å›è°ƒæœªè°ƒç”¨</h4>\n<p>åªè¦æ³¨å†Œäº†å®Œæˆå›è°ƒå’Œæ‹’ç»å›è°ƒï¼Œé‚£ä¹ˆ Promise åœ¨å†³è®®æ—¶ï¼Œæ€»ä¼šè°ƒç”¨å…¶ä¸­ä¸€ä¸ªã€‚</p>\n<h4 id=\"è°ƒç”¨æ¬¡æ•°è¿‡å¤šæˆ–è€…è¿‡å°‘\">è°ƒç”¨æ¬¡æ•°è¿‡å¤šæˆ–è€…è¿‡å°‘</h4>\n<p>Promise åªèƒ½å†³è®®ä¸€æ¬¡ã€‚</p>\n<h4 id=\"åæ‰é”™è¯¯æˆ–è€…å¼‚å¸¸\">åæ‰é”™è¯¯æˆ–è€…å¼‚å¸¸</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n  <span class=\"token parameter\">error</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ä¼šæ•è·åˆ°é”™è¯¯</span>\n<span class=\"token punctuation\">)</span> \n</code></pre></div>\n<p>åœ¨ Promise çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ–è€…åœ¨æŸ¥çœ‹å…¶å†³è®®ç»“æœè¿‡ç¨‹ä¸­çš„ä»»ä½•æ—¶é—´ç‚¹ä¸Šå‡ºç°ä¸€ä¸ª JavaScript å¼‚å¸¸çš„é”™è¯¯ï¼Œéƒ½ä¼šä½¿è¿™ä¸ª Promise æ‹’ç»ã€‚</p>\n<p>å¦‚æœåœ¨å®Œæˆå›è°ƒä¸­å‡ºç°äº†é”™è¯¯ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n  <span class=\"token parameter\">error</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token comment\">// æ­¤æ—¶æ— æ³•æ•è·åˆ°é”™è¯¯</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>æ­¤æ—¶æ˜¯æ— æ³•æ•è·åˆ°å¼‚å¸¸çš„ï¼Œå› ä¸º Promise.then(...) æœ¬èº«è¿”å›äº†ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥åœ¨ä¸Šä¸€ä¸ªå®Œæˆå›è°ƒä¸­çš„é”™è¯¯åº”è¯¥æ˜¯åœ¨è¿”å›çš„ Promise ä¸­ä¾¦å¬å’Œæ•è·ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n  <span class=\"token parameter\">error</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">error</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è¿™é‡Œå¯ä»¥æ•è·åˆ°å¼‚å¸¸</span>\n</code></pre></div>\n<p>åŸºäºä¸Šé¢å‡ ç‚¹ï¼ŒPromise è¿™ç§æ¨¡å¼é€šè¿‡å¯ä¿¡ä»»çš„è¯­ä¹‰æŠŠå›è°ƒä½œä¸ºå‚æ•°ä¼ é€’ï¼ŒæŠŠå›è°ƒçš„æ§åˆ¶æƒåè½¬å›æ¥ï¼Œä½¿å¾—è¿™ç§è¡Œä¸ºæ›´åŠ å¯é å’Œåˆç†ã€‚</p>\n<h3 id=\"é“¾å¼æµ\">é“¾å¼æµ</h3>\n<h3 id=\"é”™è¯¯å¤„ç†\">é”™è¯¯å¤„ç†</h3>\n<ul>\n<li>å¯¹äºå¤šæ•°çš„å¼€å‘è€…æ¥è¯´ï¼Œé”™è¯¯å¤„ç†çš„æœ€è‡ªç„¶çš„å½¢å¼å°±æ˜¯åŒæ­¥çš„try...catchç»“æ„ï¼Œé—æ†¾çš„æ˜¯å®ƒåªèƒ½æ˜¯åŒæ­¥ï¼Œè€Œæ— æ³•å¤„ç†å¼‚æ­¥ä»£ç æ¨¡å¼ã€‚</li>\n<li>æˆåŠŸå›è°ƒä¸­å‡ºç°çš„é”™è¯¯æ— æ³•è¢«å½“å‰ then ä¸­çš„å¤±è´¥å›è°ƒæ•æ‰ï¼Œåªèƒ½æ˜¯åœ¨ä¸‹ä¸€ä¸ª Promise ä¸­æ•æ‰ã€‚</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fulfilled</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ•°å­—æ²¡æœ‰stringå‡½æ•°ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºé”™è¯¯</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> msg<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">rejected</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ°¸è¿œä¸ä¼šåˆ°è¾¾è¿™é‡Œ</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"ç»æœ›çš„é™·é˜±\">ç»æœ›çš„é™·é˜±</h4>\n<p>ä¸ºäº†é¿å…ä¸¢å¤±è¢«å¿½ç•¥å’Œè¢«æŠ›å¼ƒçš„ Promise é”™è¯¯ï¼Œä¸€äº›å¼€å‘è€…è¡¨ç¤ºï¼ŒPromise çš„æœ€ä½³å®è·µå°±æ˜¯æœ€åæ€»ä»¥ä¸€ä¸ª cache ç»“æŸï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">fulfilled</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// æ•°å­—æ²¡æœ‰stringå‡½æ•°ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºé”™è¯¯</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> msg<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">catch</span><span class=\"token punctuation\">(</span> handleErrors <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸º then(..) ä¼ å…¥æ‹’ç»å¤„ç†å‡½æ•°ï¼Œæ‰€ä»¥é»˜è®¤çš„å¤„ç†å‡½æ•°è¢«æ›¿æ¢æ‰äº†ï¼Œè€Œè¿™ä»…ä»…æ˜¯æŠŠé”™è¯¯ä¼ é€’ç»™äº†é“¾ä¸­çš„ä¸‹ä¸€ä¸ª promiseã€‚å› æ­¤ï¼Œè¿›å…¥ p çš„é”™è¯¯ä»¥åŠ p ä¹‹åè¿›å…¥å…¶å†³è®®ï¼ˆå°±åƒ msg.toLowerCase() ï¼‰çš„é”™è¯¯éƒ½ä¼šä¼ é€’åˆ°æœ€åçš„ handleErrors(..) ã€‚</p>\n<p>é‚£ä¹ˆå¦‚æœ handleErrors æœ¬èº«å‡ºç°é”™è¯¯æ€ä¹ˆåŠï¼Ÿåœ¨å°¾éƒ¨æ·»åŠ ä¸€ä¸ª cache åªèƒ½æ˜¯é™ä½äº†ä¸¢å¤±é”™è¯¯çš„å¯èƒ½æ€§ã€‚</p>\n<h4 id=\"å¤„ç†æœªæ•è·çš„æƒ…å†µ\">å¤„ç†æœªæ•è·çš„æƒ…å†µ</h4>\n<p>è¿™èŠ‚å†…å®¹ä¸æ˜¯å¾ˆæ‡‚ã€‚</p>\n<h3 id=\"promise-æ¨¡å¼\">Promise æ¨¡å¼</h3>\n<h4 id=\"promiseall--\">Promise.all([ .. ])</h4>\n<h4 id=\"promiserace--\">Promise.race([ .. ])</h4>\n<h4 id=\"all-å’Œ-race-çš„å˜ä½“\">all å’Œ race çš„å˜ä½“</h4>\n<ul>\n<li>none</li>\n</ul>\n<p>è¿™ä¸ªæ¨¡å¼ç±»ä¼¼äº all([ .. ]) ï¼Œä¸è¿‡å®Œæˆå’Œæ‹’ç»çš„æƒ…å†µäº’æ¢äº†ã€‚æ‰€æœ‰çš„ Promise éƒ½è¦è¢«æ‹’ç»ï¼Œå³æ‹’ç»è½¬åŒ–ä¸ºå®Œæˆå€¼ï¼Œåä¹‹äº¦ç„¶ã€‚</p>\n<ul>\n<li>any([ .. ])</li>\n</ul>\n<p>è¿™ä¸ªæ¨¡å¼ä¸ all([ .. ]) ç±»ä¼¼ï¼Œä½†æ˜¯ä¼šå¿½ç•¥æ‹’ç»ï¼Œæ‰€ä»¥åªéœ€è¦å®Œæˆä¸€ä¸ªè€Œä¸æ˜¯å…¨éƒ¨ã€‚</p>\n<ul>\n<li>first([ .. ])</li>\n</ul>\n<p>è¿™ä¸ªæ¨¡å¼ç±»ä¼¼äºä¸ any([ .. ]) çš„ç«äº‰ï¼Œå³åªè¦ç¬¬ä¸€ä¸ª Promise å®Œæˆï¼Œå®ƒå°±ä¼šå¿½ç•¥åç»­çš„ä»»ä½•æ‹’ç»å’Œå®Œæˆã€‚</p>\n<ul>\n<li>last([ .. ])</li>\n</ul>\n<p>è¿™ä¸ªæ¨¡å¼ç±»ä¼¼äº first([ .. ]) ï¼Œä½†å´æ˜¯åªæœ‰æœ€åä¸€ä¸ªå®Œæˆèƒœå‡ºã€‚</p>\n<p>æœ‰äº› Promise æŠ½è±¡åº“æä¾›äº†è¿™äº›æ”¯æŒï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ Promiseã€ race([ .. ]) å’Œ all([ .. ])è¿™äº›æœºåˆ¶ï¼Œä½ è‡ªå·±æ¥å®ç°å®ƒä»¬ã€‚\næ¯”å¦‚ first:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// polyfillå®‰å…¨çš„guardæ£€æŸ¥</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">first</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">first</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">prs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// åœ¨æ‰€æœ‰promiseä¸Šå¾ªç¯</span>\n    prs<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">pr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// æŠŠå€¼è§„æ•´åŒ–</span>\n      <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span> pr <span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// ä¸ç®¡å“ªä¸ªæœ€å…ˆå®Œæˆï¼Œå°±å†³è®®ä¸»promise</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span> resolve <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"promise-api-æ¦‚è¿°\">Promise API æ¦‚è¿°</h3>\n<h4 id=\"new-promise-æ„é€ å™¨\">new Promise(..) æ„é€ å™¨</h4>\n<p>æœ‰å¯ç¤ºæ€§çš„æ„é€ å™¨ Promise(..) å¿…é¡»å’Œ new ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸”å¿…é¡»æä¾›ä¸€ä¸ªå‡½æ•°å›è°ƒã€‚è¿™ä¸ªå›è°ƒæ˜¯åŒæ­¥çš„æˆ–ç«‹å³è°ƒç”¨çš„ã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‡½æ•°å›è°ƒï¼Œç”¨ä»¥æ”¯æŒ promise çš„å†³è®®ã€‚é€šå¸¸æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªå‡½æ•°ç§°ä¸º resolve(..) å’Œ reject(..) ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// resolve(..)ç”¨äºå†³è®®/å®Œæˆè¿™ä¸ªpromise</span>\n<span class=\"token comment\">// reject(..)ç”¨äºæ‹’ç»è¿™ä¸ªpromise</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>reject(...) å°±æ˜¯æ‹’ç»è¿™ä¸ª Promiseï¼›ä½† resolve(...) æ—¢å¯èƒ½å®Œæˆè¿™ä¸ª Promise ä¹Ÿå¯èƒ½æ‹’ç»è¿™ä¸ª Promiseï¼Œè¦æ ¹æ®ä¼ å…¥çš„å‚æ•°å†³å®šã€‚å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªé Promise æˆ–è€… é thenable çš„ç«‹å³å€¼ï¼Œè¿™ä¸ª promise å°±ä¼šç”¨è¿™ä¸ªå€¼å®Œæˆã€‚</p>\n<p>å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ª Promise æˆ–è€… thenable è¿™ä¸ªåªå°±ä¼šè¢«é€’å½’å±•å¼€ï¼Œå¹¶ä¸”è¦æ„é€ çš„ Promise å°±ä¼šå–å…¶æœ€ç»ˆçš„å€¼æˆ–è€…çŠ¶æ€ã€‚</p>\n<h4 id=\"promiseresolve-å’Œ-promisereject\">Promise.resolve(..) å’Œ Promise.reject(..)</h4>\n<h4 id=\"then-å’Œ-catch\">then(..) å’Œ catch(..)</h4>\n<h4 id=\"promiseall---å’Œ-promiserace--\">Promise.all([ .. ]) å’Œ Promise.race([ .. ])</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> p1 <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> p2 <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Hello World\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> p3 <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reject</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Oops\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">race</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span>p1<span class=\"token punctuation\">,</span>p2<span class=\"token punctuation\">,</span>p3<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> msg <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span>p1<span class=\"token punctuation\">,</span>p2<span class=\"token punctuation\">,</span>p3<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">catch</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span> err <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Oops\"</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span>p1<span class=\"token punctuation\">,</span>p2<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msgs</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span> msgs <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [42,\"Hello World\"]</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<blockquote>\n<p>å½“å¿ƒï¼è‹¥å‘ Promise.all([ .. ]) ä¼ å…¥ç©ºæ•°ç»„ï¼Œå®ƒä¼šç«‹å³å®Œæˆï¼Œä½† Promise.race([ .. ]) ä¼šæŒ‚ä½ï¼Œä¸”æ°¸è¿œä¸ä¼šå†³è®®ã€‚</p>\n</blockquote>\n<h3 id=\"promise-å±€é™æ€§\">Promise å±€é™æ€§</h3>\n<h4 id=\"é¡ºåºé”™è¯¯å¤„ç†\">é¡ºåºé”™è¯¯å¤„ç†</h4>\n<p>å³ Promise é“¾ä¸­çš„é”™è¯¯å¾ˆå®¹æ˜“è¢«æ— æ„ä¸­é»˜é»˜å¿½ç•¥æ‰ã€‚</p>\n<h4 id=\"å•å†³è®®\">å•å†³è®®</h4>\n<h4 id=\"æƒ¯æ€§\">æƒ¯æ€§</h4>\n<h4 id=\"æ— æ³•å–æ¶ˆçš„-promise\">æ— æ³•å–æ¶ˆçš„ Promise</h4>\n<h4 id=\"promise-æ€§èƒ½\">Promise æ€§èƒ½</h4>\n<hr>\n<h2 id=\"ç¬¬å››ç« -ç”Ÿæˆå™¨\">ç¬¬å››ç«  ç”Ÿæˆå™¨</h2>\n<h3 id=\"æ‰“ç ´å®Œæ•´çš„è¿è¡Œ\">æ‰“ç ´å®Œæ•´çš„è¿è¡Œ</h3>\n<p>åœ¨ç¬¬ 1 ç« ä¸­ï¼Œæˆ‘ä»¬è§£é‡Šäº† JavaScript å¼€å‘è€…åœ¨ä»£ç ä¸­å‡ ä¹æ™®éä¾èµ–çš„ä¸€ä¸ªå‡å®šï¼šä¸€ä¸ªå‡½æ•°\nä¸€æ—¦å¼€å§‹æ‰§è¡Œï¼Œå°±ä¼šè¿è¡Œåˆ°ç»“æŸï¼ŒæœŸé—´ä¸ä¼šæœ‰å…¶ä»–ä»£ç èƒ½å¤Ÿæ‰“æ–­å®ƒå¹¶æ’å…¥å…¶é—´ã€‚</p>\n<p>å¯èƒ½çœ‹èµ·æ¥ä¼¼ä¹æœ‰ç‚¹å¥‡æ€ªï¼Œä¸è¿‡ ES6 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å‡½æ•°ç±»å‹ï¼Œå®ƒå¹¶ä¸ç¬¦åˆè¿™ç§è¿è¡Œåˆ°ç»“\næŸçš„ç‰¹æ€§ã€‚è¿™ç±»æ–°çš„å‡½æ•°è¢«ç§°ä¸ºç”Ÿæˆå™¨ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token operator\">++</span>\n  <span class=\"token keyword control-flow\">yield</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x:\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token operator\">++</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å¾ˆå¯èƒ½ä½ çœ‹åˆ°çš„å…¶ä»–å¤šæ•° JavaScript æ–‡æ¡£å’Œä»£ç ä¸­çš„ç”Ÿæˆå™¨å£°æ˜æ ¼å¼éƒ½æ˜¯function* foo() { .. }ï¼Œè€Œä¸æ˜¯æˆ‘è¿™é‡Œä½¿ç”¨çš„ function <em>foo() { .. }ï¼š\nå”¯ä¸€åŒºåˆ«æ˜¯ * ä½ç½®çš„é£æ ¼ä¸åŒã€‚è¿™ä¸¤ç§å½¢å¼åœ¨åŠŸèƒ½å’Œè¯­æ³•ä¸Šéƒ½æ˜¯ç­‰åŒçš„ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ function</em>foo(){ .. }ï¼ˆæ²¡æœ‰ç©ºæ ¼ï¼‰ä¹Ÿä¸€æ ·ã€‚ä¸¤ç§é£æ ¼ï¼Œå„æœ‰ä¼˜ç¼ºï¼Œä½†æ€»ä½“ä¸Šæˆ‘æ¯”è¾ƒå–œæ¬¢ function *foo.. çš„å½¢å¼ï¼Œå› ä¸ºè¿™æ ·åœ¨ä½¿ç”¨ *foo()æ¥å¼•ç”¨ç”Ÿæˆå™¨çš„æ—¶å€™å°±ä¼šæ¯”è¾ƒä¸€è‡´ã€‚å¦‚æœåªç”¨ foo() çš„å½¢å¼ï¼Œä½ å°±ä¸ä¼šæ¸…æ¥šçŸ¥é“æˆ‘æŒ‡çš„æ˜¯ç”Ÿæˆå™¨è¿˜æ˜¯å¸¸è§„å‡½æ•°ã€‚è¿™å®Œå…¨æ˜¯ä¸€ä¸ªé£æ ¼åå¥½é—®é¢˜ã€‚</p>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦å¦‚ä½•è¿è¡Œå‰é¢çš„ä»£ç ç‰‡æ®µï¼Œä½¿å¾— bar() åœ¨ *foo() å†…éƒ¨çš„ yield å¤„æ‰§è¡Œå‘¢ï¼Ÿ</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// æ„é€ ä¸€ä¸ªè¿­ä»£å™¨itæ¥æ§åˆ¶è¿™ä¸ªç”Ÿæˆå™¨</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// è¿™é‡Œå¯åŠ¨foo()ï¼</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nx<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nx<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// x: 3</span>\n</code></pre></div>\n<ol>\n<li>\n<p>it = foo() å¹¶æ²¡æœ‰æ‰§è¡Œç”Ÿæˆå™¨ *foo()ï¼Œè€Œåªæ˜¯æ„é€ äº†ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆiteratorï¼‰ï¼Œè¿™ä¸ªè¿­ä»£å™¨ä¼šæ§åˆ¶å®ƒçš„æ‰§è¡Œã€‚</p>\n</li>\n<li>\n<p>ç¬¬ä¸€ä¸ª it.next() å¯åŠ¨äº†ç”Ÿæˆå™¨ *foo()ï¼Œå¹¶ä¸”è¿è¡Œäº†ç¬¬ä¸€è¡Œ x++ã€‚</p>\n</li>\n<li>\n<p>*foo() åœ¨ yield è¯­å¥å¤„æš‚åœï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šç¬¬ä¸€ä¸ª it.next() è°ƒç”¨ç»“æŸã€‚æ­¤æ—¶ *foo() ä»\nåœ¨è¿è¡Œå¹¶ä¸”æ˜¯æ´»è·ƒçš„ï¼Œä½†å¤„äºæš‚åœçŠ¶æ€ã€‚</p>\n</li>\n<li>\n<p>æˆ‘ä»¬æŸ¥çœ‹ x çš„å€¼ï¼Œæ­¤æ—¶ä¸º 2 ã€‚</p>\n</li>\n<li>\n<p>æˆ‘ä»¬è°ƒç”¨ bar() ï¼Œå®ƒé€šè¿‡ x++ å†æ¬¡é€’å¢ x ã€‚</p>\n</li>\n<li>\n<p>æˆ‘ä»¬å†æ¬¡æŸ¥çœ‹ x çš„å€¼ï¼Œæ­¤æ—¶ä¸º 3 ã€‚</p>\n</li>\n<li>\n<p>æœ€åçš„ it.next() è°ƒç”¨ä»æš‚åœå¤„æ¢å¤äº†ç”Ÿæˆå™¨ *foo() çš„æ‰§è¡Œï¼Œå¹¶è¿è¡Œ console.log(..)\nè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿ç”¨å½“å‰ x çš„å€¼ 3 ã€‚</p>\n</li>\n</ol>\n<p>ç”Ÿæˆå™¨å°±æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œå¯ä»¥ä¸€æ¬¡æˆ–å¤šæ¬¡å¯åŠ¨å’Œåœæ­¢ï¼Œå¹¶ä¸ä¸€å®šéå¾—è¦å®Œæˆã€‚</p>\n<h4 id=\"è¾“å…¥å’Œè¾“å‡º\">è¾“å…¥å’Œè¾“å‡º</h4>\n<p>ç”Ÿæˆå™¨ä»ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™æ„å‘³ç€å®ƒä»ç„¶æœ‰ä¸€äº›åŸºæœ¬çš„ç‰¹æ€§æ²¡æœ‰æ”¹å˜ã€‚æ¯”å¦‚ï¼Œå®ƒä»ç„¶å¯ä»¥æ¥å—å‚æ•°ï¼ˆå³è¾“å…¥ï¼‰ï¼Œä¹Ÿèƒ½å¤Ÿè¿”å›å€¼ï¼ˆå³è¾“å‡ºï¼‰ã€‚</p>\n<p>ä½†éš¾ä»¥ç†è§£çš„æ˜¯ï¼Œç”Ÿæˆå™¨ *foo(..) å¹¶æ²¡æœ‰åƒæ™®é€šå‡½æ•°ä¸€æ ·å®é™…è¿è¡Œã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼ŒæŠŠå®ƒèµ‹ç»™äº†ä¸€ä¸ªå˜é‡ it ï¼Œç”¨äºæ§åˆ¶ç”Ÿæˆå™¨\n*foo(..) ã€‚ç„¶åè°ƒç”¨ it.next() ï¼ŒæŒ‡ç¤ºç”Ÿæˆå™¨ *foo(..) ä»å½“å‰ä½ç½®å¼€å§‹ç»§ç»­è¿è¡Œï¼Œåœåœ¨ä¸‹\nä¸€ä¸ª yield å¤„æˆ–è€…ç›´åˆ°ç”Ÿæˆå™¨ç»“æŸã€‚</p>\n<p>è¿™ä¸ª next(..) è°ƒç”¨çš„ç»“æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ª value å±æ€§ï¼ŒæŒæœ‰ä» *foo(..) è¿”å›çš„å€¼\nï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œ yield ä¼šå¯¼è‡´ç”Ÿæˆå™¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘é€å‡ºä¸€ä¸ªå€¼ï¼Œè¿™æœ‰ç‚¹ç±»ä¼¼\näºä¸­é—´çš„ return ã€‚</p>\n<p><strong>ç›®å‰è¿˜ä¸æ¸…æ¥šä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸€æ•´ä¸ªé—´æ¥è¿­ä»£å™¨å¯¹è±¡æ¥æ§åˆ¶ç”Ÿæˆå™¨</strong></p>\n<h4 id=\"è¿­ä»£æ¶ˆæ¯ä¼ é€’\">è¿­ä»£æ¶ˆæ¯ä¼ é€’</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword control-flow\">yield</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// å¯åŠ¨foo(..)</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span> <span class=\"token number\">7</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nres<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼Œä½†å³ä½¿å¯¹äºæœ‰ç»éªŒçš„ JavaScript å¼€å‘è€…ä¹Ÿå¾ˆæœ‰è¿·æƒ‘æ€§ï¼šæ ¹æ®\nä½ çš„è§†è§’ä¸åŒï¼Œ yield å’Œ next(..) è°ƒç”¨æœ‰ä¸€ä¸ªä¸åŒ¹é…ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œéœ€è¦çš„ next(..) è°ƒç”¨è¦\næ¯” yield è¯­å¥å¤šä¸€ä¸ªï¼Œå‰é¢çš„ä»£ç ç‰‡æ®µæœ‰ä¸€ä¸ª yield å’Œä¸¤ä¸ª next(..) è°ƒç”¨ã€‚</p>\n<p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªä¸åŒ¹é…ï¼Ÿ</p>\n<p>å› ä¸ºç¬¬ä¸€ä¸ª next(..) æ€»æ˜¯å¯åŠ¨ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¹¶è¿è¡Œåˆ°ç¬¬ä¸€ä¸ª yield å¤„ã€‚ä¸è¿‡ï¼Œæ˜¯ç¬¬äºŒä¸ª\nnext(..) è°ƒç”¨å®Œæˆç¬¬ä¸€ä¸ªè¢«æš‚åœçš„ yield è¡¨è¾¾å¼ï¼Œç¬¬ä¸‰ä¸ª next(..) è°ƒç”¨å®Œæˆç¬¬äºŒä¸ª yieldï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>\n<h4 id=\"ä¸¤ä¸ªé—®é¢˜\">ä¸¤ä¸ªé—®é¢˜</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword control-flow\">yield</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">return</span> y<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>ç¬¬ä¸€ä¸ª yield åŸºæœ¬ä¸Šæ˜¯æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šâ€œè¿™é‡Œæˆ‘åº”è¯¥æ’å…¥ä»€ä¹ˆå€¼ï¼Ÿâ€</p>\n<p>è°æ¥å›ç­”è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç¬¬ä¸€ä¸ª next() å·²ç»è¿è¡Œï¼Œä½¿å¾—ç”Ÿæˆå™¨å¯åŠ¨å¹¶è¿è¡Œåˆ°æ­¤å¤„ï¼Œæ‰€ä»¥æ˜¾\nç„¶å®ƒæ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤å¿…é¡»ç”±ç¬¬äºŒä¸ª next(..) è°ƒç”¨å›ç­”ç¬¬ä¸€ä¸ª yield æå‡ºçš„è¿™ä¸ª\né—®é¢˜ã€‚</p>\n<p>æŠŠè§†è§’è½¬åŒ–ä¸€ä¸‹ï¼šä¸ä»ç”Ÿæˆå™¨çš„è§†è§’çœ‹è¿™ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯ä»è¿­ä»£å™¨çš„è§’åº¦ã€‚</p>\n<p><strong>ä¸ºäº†æ°å½“é˜è¿°è¿™ä¸ªè§†è§’ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£é‡Šä¸€ä¸‹ï¼šæ¶ˆæ¯æ˜¯åŒå‘ä¼ é€’çš„</strong>â€”â€” yield.. ä½œä¸ºä¸€ä¸ª\nè¡¨è¾¾å¼å¯ä»¥å‘å‡ºæ¶ˆæ¯å“åº” next(..) è°ƒç”¨ï¼Œ next(..) ä¹Ÿå¯ä»¥å‘æš‚åœçš„ yield è¡¨è¾¾å¼å‘é€å€¼ã€‚\nè€ƒè™‘ä¸‹é¢è¿™æ®µç¨ç¨è°ƒæ•´è¿‡çš„ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword control-flow\">yield</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &#x3C;-- yieldä¸€ä¸ªå€¼ï¼</span>\n  <span class=\"token keyword control-flow\">return</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç¬¬ä¸€ä¸ªnext()ï¼Œå¹¶ä¸ä¼ å…¥ä»»ä½•ä¸œè¥¿</span>\nres<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Hello\"</span>\nres <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span> <span class=\"token number\">7</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å‘ç­‰å¾…çš„yieldä¼ å…¥7</span>\nres<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>yield .. å’Œ next(..) è¿™ä¸€å¯¹ç»„åˆèµ·æ¥ï¼Œåœ¨ç”Ÿæˆå™¨çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ„æˆäº†ä¸€ä¸ªåŒå‘æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç¬¬ä¸€ä¸ªnext()ï¼Œå¹¶ä¸ä¼ å…¥ä»»ä½•ä¸œè¥¿</span>\nres<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"Hello\"</span>\nres <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span> <span class=\"token number\">7</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å‘ç­‰å¾…çš„yieldä¼ å…¥7</span>\nres<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span>\n</code></pre></div>\n<p>æˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç¬¬ä¸€ä¸ª next() è°ƒç”¨å‘é€å€¼ï¼Œè¿™æ˜¯æœ‰æ„ä¸ºä¹‹ã€‚<strong>åªæœ‰æš‚åœçš„ yieldæ‰èƒ½æ¥å—è¿™æ ·ä¸€ä¸ªé€šè¿‡ next(..) ä¼ é€’çš„å€¼</strong>ï¼Œè€Œåœ¨ç”Ÿæˆå™¨çš„èµ·å§‹å¤„æˆ‘ä»¬è°ƒç”¨\nç¬¬ä¸€ä¸ª next() æ—¶ï¼Œè¿˜æ²¡æœ‰æš‚åœçš„ yield æ¥æ¥å—è¿™æ ·ä¸€ä¸ªå€¼ã€‚è§„èŒƒå’Œæ‰€æœ‰å…¼\nå®¹æµè§ˆå™¨éƒ½ä¼šé»˜é»˜ä¸¢å¼ƒä¼ é€’ç»™ç¬¬ä¸€ä¸ª next() çš„ä»»ä½•ä¸œè¥¿ã€‚ä¼ å€¼è¿‡å»ä»ç„¶ä¸\næ˜¯ä¸€ä¸ªå¥½æ€è·¯ï¼Œå› ä¸ºä½ åˆ›å»ºäº†æ²‰é»˜çš„æ— æ•ˆä»£ç ï¼Œè¿™ä¼šè®©äººè¿·æƒ‘ã€‚å› æ­¤ï¼Œå¯åŠ¨\nç”Ÿæˆå™¨æ—¶ä¸€å®šè¦ç”¨ä¸å¸¦å‚æ•°çš„ next()ã€‚</p>\n<p>*<em>ç¬¬ä¸€ä¸ª next() è°ƒç”¨ï¼ˆæ²¡æœ‰å‚æ•°çš„ï¼‰åŸºæœ¬ä¸Šå°±æ˜¯åœ¨æå‡ºä¸€ä¸ªé—®é¢˜ï¼šâ€œç”Ÿæˆå™¨ <em>foo(..) è¦ç»™æˆ‘çš„ä¸‹ä¸€ä¸ªå€¼æ˜¯ä»€ä¹ˆâ€ã€‚è°æ¥å›ç­”è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç¬¬ä¸€ä¸ª yield \"hello\" è¡¨è¾¾å¼ã€‚</em></em>\nçœ‹è§äº†å—ï¼Ÿè¿™é‡Œæ²¡æœ‰ä¸åŒ¹é…ã€‚</p>\n<p>æ ¹æ®ä½ è®¤ä¸ºæå‡ºé—®é¢˜çš„æ˜¯è°ï¼Œ yield å’Œ next(..) è°ƒç”¨ä¹‹é—´è¦ä¹ˆæœ‰ä¸åŒ¹é…ï¼Œè¦ä¹ˆæ²¡æœ‰ã€‚\nä½†æ˜¯ï¼Œç¨ç­‰ï¼ä¸ yield è¯­å¥çš„æ•°é‡ç›¸æ¯”ï¼Œè¿˜æ˜¯å¤šå‡ºäº†ä¸€ä¸ªé¢å¤–çš„ next() ã€‚<strong>æ‰€ä»¥ï¼Œæœ€åä¸€ä¸ªit.next(7) è°ƒç”¨å†æ¬¡æå‡ºäº†è¿™æ ·çš„é—®é¢˜ï¼šç”Ÿæˆå™¨å°†è¦äº§ç”Ÿçš„ä¸‹ä¸€ä¸ªå€¼æ˜¯ä»€ä¹ˆã€‚ä½†æ˜¯ï¼Œå†æ²¡æœ‰ yield è¯­å¥æ¥å›ç­”è¿™ä¸ªé—®é¢˜äº†ï¼Œæ˜¯ä¸æ˜¯ï¼Ÿé‚£ä¹ˆè°æ¥å›ç­”å‘¢ï¼Ÿreturn è¯­å¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼</strong></p>\n<p><strong>æ‰€ä»¥æ¯ä¸€ä¸ªnext()éƒ½å¯¹åº”ä¸€ä¸ªyieldï¼Œå¦‚æœæœ€åä¸€ä¸ªnext()æ‰¾ä¸åˆ°å¯¹åº”çš„yieldï¼Œå°±ä¼šä½¿ç”¨returnçš„å€¼ï¼Œå¹¶ä¸”å®Œæˆç”Ÿæˆå™¨ã€‚</strong></p>\n<p>å¦‚æœä½ çš„ç”Ÿæˆå™¨ä¸­æ²¡æœ‰ return çš„è¯â€”â€”åœ¨ç”Ÿæˆå™¨ä¸­å’Œåœ¨æ™®é€šå‡½æ•°ä¸­ä¸€æ ·ï¼Œ return å½“ç„¶ä¸\næ˜¯å¿…éœ€çš„â€”â€”æ€»æœ‰ä¸€ä¸ªå‡å®šçš„ / éšå¼çš„ return; ï¼ˆä¹Ÿå°±æ˜¯  return undefined; ï¼‰ï¼Œå®ƒä¼šåœ¨é»˜è®¤æƒ…å†µä¸‹å›ç­”æœ€åçš„ it.next(7) è°ƒç”¨æå‡ºçš„é—®é¢˜ã€‚\nè¿™æ ·çš„æé—®å’Œå›ç­”æ˜¯éå¸¸å¼ºå¤§çš„ï¼šé€šè¿‡ yield å’Œ next(..) å»ºç«‹çš„åŒå‘æ¶ˆæ¯ä¼ é€’ã€‚ä½†<strong>ç›®å‰è¿˜ä¸æ¸…æ¥šè¿™äº›æœºåˆ¶æ˜¯å¦‚ä½•ä¸å¼‚æ­¥æµç¨‹æ§åˆ¶è”ç³»åˆ°ä¸€èµ·çš„</strong>ã€‚ä¼šæ¸…æ¥šçš„ï¼</p>\n<h3 id=\"ç”Ÿæˆå™¨äº§ç”Ÿå€¼\">ç”Ÿæˆå™¨äº§ç”Ÿå€¼</h3>\n<p>è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„æ¥å£ï¼Œç”¨äºä»ä¸€ä¸ªç”Ÿäº§è€…ä¸€æ­¥æ­¥å¾—åˆ°ä¸€ç³»åˆ—å€¼ã€‚JavaScript è¿­ä»£å™¨çš„æ¥å£ï¼Œä¸å¤šæ•°è¯­è¨€ç±»ä¼¼ï¼Œå°±æ˜¯æ¯æ¬¡æƒ³è¦ä»ç”Ÿäº§è€…å¾—åˆ°ä¸‹ä¸€ä¸ªå€¼çš„æ—¶å€™è°ƒç”¨ next() ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> something <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> nextVal\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">next</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>nextVal <span class=\"token operator\">===</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        nextVal <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n        nextVal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> nextVal<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">6</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> value<span class=\"token operator\">:</span> nextVal<span class=\"token punctuation\">,</span> done<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>next()è°ƒç”¨è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§ï¼š done æ˜¯ä¸€ä¸ª boolean å€¼ã€‚æ ‡è¯†è¿­ä»£å™¨çš„å®ŒæˆçŠ¶æ€ï¼Œvalue ä¸­æ”¾ç½®è¿­ä»£å€¼ã€‚</p>\n<p>ES6 è¿˜å¿ƒä¸­äº†ä¸€ä¸ª for ...of å¾ªç¯ï¼Œè¿™æ„å‘³ç€å¯ä»¥é€šè¿‡åŸç”Ÿå¾ªç¯è¯­æ³•è‡ªåŠ¨è¿­ä»£æ ‡å‡†è¿­ä»£å™¨ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> v <span class=\"token keyword\">of</span> something<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// ä¸è¦æ­»å¾ªç¯</span>\n  <span class=\"token keyword control-flow\">if</span><span class=\"token punctuation\">(</span>v <span class=\"token operator\">></span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">break</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>å› ä¸ºæˆ‘ä»¬çš„è¿­ä»£å™¨ something æ€»æ˜¯è¿”å› done:falseï¼Œå› æ­¤è¿™ä¸ª for...of å¾ªç¯å°†æ°¸è¿œçš„è¿è¡Œä¸‹å»ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åœ¨é‡Œé¢æ”¾ä¸€ä¸ª break æ¡ä»¶ã€‚è¿­ä»£å™¨æ°¸ä¸ç»“æŸæ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ï¼Œä½†ä¹Ÿæ˜¯æœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œè¿­ä»£å™¨ä¼šåœ¨æœ‰é™çš„å€¼é›†åˆä¸Šè¿è¡Œï¼Œå¹¶æœ€ç»ˆè¿”å› done: true</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> ret<span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span>ret <span class=\"token operator\">=</span> something<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>ret<span class=\"token punctuation\">.</span><span class=\"token property-access\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// ä¸è¦æ­»å¾ªç¯</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token operator\">></span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">break</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"iterable\">iterable</h4>\n<p>å‰é¢ä¾‹å­ä¸­ something å¯¹è±¡å«åšè¿­ä»£å™¨ï¼Œå› ä¸ºå®ƒçš„æ¥å£ä¸­æœ‰ä¸€ä¸ª next() æ–¹æ³•ã€‚è€Œä¸å…¶ç´§å¯†ç›¸å…³çš„ä¸€ä¸ªæœ¯è¯­æ˜¯ iterableï¼Œå³æŒ‡ä¸€ä¸ªåŒ…å«å¯ä»¥åœ¨å…¶å€¼ä¸Šè¿­ä»£çš„è¿­ä»£å™¨çš„å¯¹è±¡ã€‚æ¯”å¦‚ Array è‡ªå¸¦ Symbol.iterator å±æ€§ä¸”å±æ€§å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</p>\n<p>ä» ES6 å¼€å§‹ï¼Œä»ä¸€ä¸ªiterable ä¸­æå–è¿­ä»£å™¨çš„æ–¹æ³•æ˜¯ï¼š iterable å¿…é¡»æ”¯æŒä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°æ˜¯ä¸“é—¨çš„ ES6 ç¬¦å·è¿”å›å€¼ Symbol.iteratorã€‚è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ç°åœ¨ something çš„å€¼æ—¢æ˜¯ä¸€ä¸ª iterable ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p>\n<h4 id=\"ç”Ÿæˆå™¨è¿­ä»£å™¨\">ç”Ÿæˆå™¨è¿­ä»£å™¨</h4>\n<p>å¯ä»¥æŠŠç”Ÿæˆå™¨çœ‹æˆæ˜¯ä¸€ä¸ªå€¼çš„ç”Ÿäº§è€…ï¼Œæˆ‘ä»¬é€šè¿‡è¿­ä»£å™¨æ¥å£çš„ next æ–¹æ³•è°ƒç”¨ä¸€ä¸ªæå–é™¤ä¸€ä¸ªå€¼ã€‚</p>\n<p>æ‰€ä»¥ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œç”Ÿæˆå™¨å¹¶ä¸æ˜¯ iterableï¼Œå°½ç®¡éå¸¸ç±»ä¼¼ï¼Œå½“å‰æ‰§è¡Œä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªè¿­ä»£å™¨</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>å› æ­¤å¯ä»¥é€šè¿‡ç”Ÿæˆå™¨æ¥å®ç°å‰é¢çš„è¿™ä¸ª something æ— çº¿æ•°å­—åºåˆ—ç”Ÿäº§è€…</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">something</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> nextVal\n\n  <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>nextVal <span class=\"token operator\">===</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      nextVal <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n      nextVal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> nextVal<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">6</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">yield</span> nextVal\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ç°åœ¨å¯ä»¥é€šè¿‡for...ofå¾ªç¯æ¥ä½¿ç”¨æˆ‘ä»¬é›•ç¢è¿‡çš„æ–°çš„ *something() ç”Ÿæˆå™¨ã€‚æ–¹å¼åŸºæœ¬å’Œiterableæ˜¯ä¸€æ ·çš„ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> v <span class=\"token keyword\">of</span> <span class=\"token function\">something</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// ä¸è¦æ­»å¾ªç¯</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>v <span class=\"token operator\">></span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">break</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>\n<p>ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ for (var of something) ? å› ä¸ºè¿™é‡Œçš„ something æ˜¯ç”Ÿæˆå™¨ï¼Œå¹¶ä¸æ˜¯ iterableã€‚æˆ‘ä»¬éœ€è¦è°ƒç”¨ something() æ¥æ„é€ ä¸€ä¸ªç”Ÿäº§è€…ä¾› for ... of å¾ªç¯è¿­ä»£ã€‚</p>\n</li>\n<li>\n<p>something() è°ƒç”¨äº§ç”Ÿä¹Ÿæœ‰ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½†æ˜¯ for ... of å¾ªç¯éœ€è¦çš„æ˜¯ä¸€ä¸ª iterableã€‚ç”Ÿæˆå™¨ä¹Ÿæœ‰ä¸€ä¸ª Symbol.iterator å‡½æ•°ï¼ŒåŸºæœ¬ä¸Šè¿™ä¸ªå‡½æ•°åšçš„å°±æ˜¯return thisï¼Œå’Œæˆ‘ä»¬å‰é¢å®šä¹‰çš„ iterable something ä¸€æ ·ã€‚æ¢å¥è¯ï¼Œ<strong>ç”Ÿæˆå™¨çš„è¿­ä»£å™¨ä¹Ÿæ˜¯ä¸€ä¸ª iterable</strong>ã€‚</p>\n</li>\n</ul>\n<h4 id=\"åœæ­¢ç”Ÿæˆå™¨\">åœæ­¢ç”Ÿæˆå™¨</h4>\n<p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œçœ‹èµ·æ¥ä¼¼ä¹ *something() ç”Ÿæˆå™¨çš„è¿­ä»£å™¨å®ä¾‹åœ¨å¾ªç¯ä¸­çš„ break è°ƒç”¨ä¹‹åå°±æ°¸è¿œç•™åœ¨äº†æŒ‚èµ·çš„çŠ¶æ€ã€‚</p>\n<p>å…¶å®æœ‰ä¸€ä¸ªéšè—çš„ç‰¹æ€§ä¼šå¸®åŠ©ä½ ç®¡ç†æ­¤äº‹ï¼Œfor ... ofå¾ªç¯çš„â€œå¼‚å¸¸ç»“æŸâ€ï¼Œä¹Ÿå°±æ˜¯â€œæå‰ç»ˆæ­¢â€ï¼Œé€šå¸¸ç”± breakã€returnæˆ–è€…æœªæ•è·çš„å¼‚å¸¸å¼•èµ·ï¼Œä¼šå‘ç”Ÿæˆå™¨çš„è¿­ä»£å™¨å‘é€ä¸€ä¸ªä¿¡å·ä½¿å…¶ç»ˆæ­¢ã€‚</p>\n<blockquote>\n<p>ä¸¥æ ¼çš„æ¥è¯´ï¼Œåœ¨å¾ªç¯æ­£å¸¸ç»“æŸä¹‹åï¼Œfor ... of å¾ªç¯ä¹Ÿä¼šå‘è¿­ä»£å™¨å‘é€è¿™ä¸ªä¿¡å·ã€‚å¯¹äºç”Ÿæˆå™¨æ¥è¯´ï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯æ²¡æœ‰æ„ä¹‰çš„æ“ä½œã€‚å› ä¸ºç”Ÿæˆå™¨çš„è¿­ä»£å™¨éœ€è¦å…ˆå®Œæˆ for ... of å¾ªç¯æ‰èƒ½ç»“æŸï¼Œä½†æ˜¯ï¼Œè‡ªå®šä¹‰çš„è¿­ä»£å™¨å¯èƒ½ä¼šéœ€è¦ä» for ... of å¾ªç¯çš„æ¶ˆè´¹è€…é‚£é‡Œæ¥æ”¶è¿™ä¸ªé¢å¤–çš„ä¿¡å·ã€‚</p>\n</blockquote>\n<p>å°½ç®¡ for ... of å¾ªç¯ä¼šè‡ªåŠ¨å‘é€è¿™ä¸ªä¿¡å·ï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šå¸Œæœ›å‘ä¸€ä¸ªè¿­ä»£å™¨æ‰‹å·¥å‘é€è¿™ä¸ªä¿¡å·ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ï¼Œ return(...) å®ç°è¿™ä¸€ç‚¹ã€‚</p>\n<p>å¦‚æœåœ¨ç”Ÿæˆå™¨å†…æœ‰ try ... finally è¯­å¥ï¼Œå®ƒå°†æ€»ä¼šè¿è¡Œï¼Œå³ä½¿ç”Ÿæˆå™¨å·²ç»å¤–éƒ¨ç»“æŸã€‚å¦‚æœéœ€è¦æ¸…ç†èµ„æºçš„è¯ï¼Œè¿™ä¸€ç‚¹éå¸¸çš„æœ‰æœ‰ç”¨ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">something</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> nextVal\n\n    <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>nextVal <span class=\"token operator\">===</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        nextVal <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n        nextVal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> nextVal<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">6</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword control-flow\">yield</span> nextVal\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">finally</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cleaning up'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œfor ... of å¾ªç¯å†… break ä¼šè§¦å‘ finally è¯­å¥ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥åœ¨å¤–éƒ¨é€šè¿‡ return(...) æ‰‹å·¥ç»ˆæ­¢ç”Ÿæˆå™¨è¿™æ ·çš„è¿­ä»£å®ä¾‹ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">something</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> v <span class=\"token keyword\">of</span> it<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>v <span class=\"token operator\">></span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// å®Œæˆç”Ÿæˆå™¨çš„è¿­ä»£å™¨</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">(</span><span class=\"token string\">'helle world'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// ä¸éœ€è¦ break</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>è°ƒç”¨ it.return(...) ä¹‹åï¼Œå®ƒç«‹å³ä¼šç»ˆæ­¢ç”Ÿæˆå™¨ï¼Œè¿™å½“ç„¶ä¼šè¿è¡Œ finally è¯­å¥ã€‚å®ƒè¿˜ä¼šæŠŠè¿”å›çš„ value å€¼è®¾ç½®ä¸ºä¼ äºº return(...) çš„å†…å®¹ï¼Œè¿™ä¹Ÿå°±æ˜¯'hello world'è¢«ä¼ å‡ºå»çš„è¿‡ç¨‹ã€‚ç°åœ¨æˆ‘ä»¬ä¹Ÿä¸éœ€è¦ break è¯­å¥ï¼Œå› ä¸ºç”Ÿæˆå™¨çš„è¿­ä»£å™¨å·²ç»è¢«è®¾ç½®ä¸º done: trueï¼Œæ‰€ä»¥ for ... of å¾ªç¯ä¼šåœ¨ä¸‹ä¸€ä¸ªè¿­ä»£ç»ˆæ­¢ã€‚</p>\n<h3 id=\"å¼‚æ­¥è¿­ä»£ç”Ÿæˆå™¨\">å¼‚æ­¥è¿­ä»£ç”Ÿæˆå™¨</h3>\n<p>ç”Ÿæˆå™¨ä¸å¼‚æ­¥ç¼–ç æ¨¡å¼ä»¥åŠè§£å†³å›è°ƒé—®é¢˜ç­‰ï¼Œæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>\n<p>å›æƒ³ä»¥ä¸‹ä¹‹å‰çš„ä¾‹å­ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://some.url.1/?x='</span><span class=\"token operator\">+</span><span class=\"token string\">' x '</span><span class=\"token operator\">+</span><span class=\"token string\">' &#x26;y='</span> <span class=\"token operator\">+</span> y<span class=\"token punctuation\">,</span> db<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>å¦‚æœæƒ³é€šè¿‡ç”Ÿæˆå™¨æ¥å®ç°ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://some.url.1/?x='</span><span class=\"token operator\">+</span><span class=\"token string\">' x '</span><span class=\"token operator\">+</span><span class=\"token string\">' &#x26;y='</span> <span class=\"token operator\">+</span>  y<span class=\"token punctuation\">,</span> \n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      it<span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">throw</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n      it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">main</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">)</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h4 id=\"åŒæ­¥é”™è¯¯å¤„ç†\">åŒæ­¥é”™è¯¯å¤„ç†</h4>\n<p>ä¹‹å‰æˆ‘ä»¬çŸ¥é“ try catch åªèƒ½æ•è·åˆ°åŒæ­¥ä»£ç çš„é”™è¯¯ï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸Šè¾¹çš„ä»£ç ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">main</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">)</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// è¿™é‡Œå¯ä»¥æ•è·åˆ° è¿­ä»£å™¨æŠ›å‡ºçš„ error</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æˆ‘ä»¬å¯ä»¥å°†å¼‚æ­¥çš„é”™è¯¯æŠ›å…¥ç”Ÿæˆå™¨ä¸­è¿›è¡Œå¤„ç†ã€‚</p>\n<h3 id=\"ç”Ÿæˆå™¨åŠ è¿­ä»£å™¨\">ç”Ÿæˆå™¨åŠ è¿­ä»£å™¨</h3>\n<p><strong>è·å¾— promise å’Œ ç”Ÿæˆå™¨æœ€å¤§æ•ˆç”¨çš„æœ€è‡ªç„¶çš„æ–¹æ³•å°±æ˜¯yieldå‡ºæ¥ä¸€ä¸ªpromiseï¼Œç„¶åé€šè¿‡è¿™ä¸ªpromiseæ¥æ§åˆ¶ç”Ÿæˆå™¨çš„è¿­ä»£ã€‚</strong></p>\n<p>è®©æˆ‘ä»¬å°è¯•æŠŠæ”¯æŒpromiseçš„foo(...)å’Œç”Ÿæˆå™¨*main()æ”¾åœ¨ä¸€èµ·ï¼š</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://some.url.1/?x='</span><span class=\"token operator\">+</span><span class=\"token string\">' x '</span><span class=\"token operator\">+</span><span class=\"token string\">' &#x26;y='</span> <span class=\"token operator\">+</span>  y<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">main</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">)</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> p <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    it<span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">throw</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>è¿™ç§å†™æ³•è§£å†³æ‰äº†ä¹‹å‰çš„å›è°ƒã€‚éšè—äº†if (err) {...}è¿™æ ·çš„ç»†èŠ‚ï¼Œç”±promiseæ¥åˆ†ç¦»å®Œæˆå’Œæ‹’ç»ã€‚</p>\n<h4 id=\"æ”¯æŒpromiseçš„generator-runner\">æ”¯æŒPromiseçš„generator runner</h4>\n<p>å¦‚æœæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å®ç°é‡å¤ï¼ˆå¾ªç¯ï¼‰è¿­ä»£æ§åˆ¶ï¼Œæ¯æ¬¡ä¼šç”Ÿæˆä¸€ä¸ªpromiseï¼Œç­‰å…¶å†³è®®ä¹‹åå†ç»§ç»­ï¼Œé‚£è¯¥å¤šå¥½ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">run</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">gen</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> aggs <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> it\n\n  <span class=\"token comment\">// åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­åˆå§‹åŒ–ç”Ÿæˆå™¨</span>\n  it <span class=\"token operator\">=</span> gen<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// è¿”å›ä¸€ä¸ªpromiseç”¨äºç”Ÿæˆå™¨å®Œæˆ</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">handleNext</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// å¯¹ä¸‹ä¸€ä¸ªyieldå‡ºçš„å€¼è¿è¡Œ</span>\n      <span class=\"token keyword\">var</span> next <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">handleResult</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ç”Ÿæˆå™¨è¿è¡Œå®Œæ¯•</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">.</span><span class=\"token property-access\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> next<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>\n              handleNext<span class=\"token punctuation\">,</span>\n              <span class=\"token keyword\">function</span> <span class=\"token function\">handleError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token keyword control-flow\">throw</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span>handleResult<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"ç”Ÿæˆå™¨ä¸­promiseçš„å¹¶å‘\">ç”Ÿæˆå™¨ä¸­promiseçš„å¹¶å‘</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> r1 <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> r2 <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">var</span> r3 <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span>p1<span class=\"token spread operator\">...</span>p2<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æœ€ç®€å•çš„æ”¹å†™ï¼Œè®©r1ï¼Œr2å¹¶å‘</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> r1 <span class=\"token operator\">=</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> r2 <span class=\"token operator\">=</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">var</span> p1 <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> r1\n  <span class=\"token keyword\">var</span> p2 <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> r2\n\n  <span class=\"token keyword\">var</span> r3 <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span>p1<span class=\"token spread operator\">...</span>p2<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>æ¢æˆ Promise.all([])</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> results <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">var</span> r1 <span class=\"token operator\">=</span> results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">var</span> r2 <span class=\"token operator\">=</span> results<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">var</span> r3 <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token spread operator\">...</span>r1<span class=\"token spread operator\">...</span>r2<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"ç”Ÿæˆå™¨å§”æ‰˜\">ç”Ÿæˆå™¨å§”æ‰˜</h3>\n<p>ä½ å¯èƒ½ä¼šä»ä¸€ä¸ªç”Ÿæˆå™¨è°ƒç”¨å¦ä¸€ä¸ªç”Ÿæˆå™¨</p>\n<p>yield å§”æ‰˜ï¼Œè¯­æ³•æ˜¯ yield *__</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*foo() starting'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">yield</span> <span class=\"token number\">3</span>\n  <span class=\"token keyword control-flow\">yield</span> <span class=\"token number\">4</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*foo() finished'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">yield</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword control-flow\">yield</span> <span class=\"token number\">2</span>\n  <span class=\"token keyword control-flow\">yield</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">yield</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token comment\">// 1</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token comment\">// 2</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token comment\">// *foo() å¯åŠ¨ 3</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token comment\">// 4</span>\nit<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span> <span class=\"token comment\">// *foo() å®Œæˆ 5</span>\n</code></pre></div>\n<h4 id=\"ä¸ºä»€ä¹ˆè¦å§”æ‰˜ï¼Ÿ\">ä¸ºä»€ä¹ˆè¦å§”æ‰˜ï¼Ÿ</h4>\n<p>yield å§”æ‰˜çš„ç›®çš„ä¸»è¦æ˜¯ä»£ç ç»„ç»‡ï¼Œä»¥è¾¾åˆ°ä¸æ™®é€šå‡½æ•°è°ƒç”¨çš„å¯¹ç§°ã€‚</p>\n<h4 id=\"æ¶ˆæ¯å§”æ‰˜\">æ¶ˆæ¯å§”æ‰˜</h4>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inside *foo():'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inside *foo():'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">'d'</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token operator\">*</span><span class=\"token function\">bar</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inside *bar():'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inside *bar():'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token operator\">*</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inside *bar():'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token string\">'e'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">'f'</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> it <span class=\"token operator\">=</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ouside:'</span><span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// outside: a</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ouside:'</span><span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// inside *bar(): 1 outside: b</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ouside:'</span><span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// inside *foo(): 2 outside: c</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ouside:'</span><span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// inside *foo(): 3 inside *bar(): d outside: e</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ouside:'</span><span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">next</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">value</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// inside *bar(): 4 outside: f</span>\n</code></pre></div>\n<p>ä¸€ä¸€å¯¹åº”è§£æï¼š</p>\n<ol>\n<li>\n<p>æ— ä»£ç æ‰§è¡Œï¼Œä»£ç åœåœ¨ console.log('inside *bar():', yield 'a') ç”Ÿæˆå™¨*bar()ç»™å‡º 'a'</p>\n</li>\n<li>\n<p>ä»£ç æ‰§è¡Œ console.log('inside *bar():', yield 'a')ï¼Œyield æ’å…¥ 1ï¼Œä»£ç åœåœ¨console.log('inside *bar():', yield *foo()) å‘ç°ç”¨ yield  å¯¹ *foo()è¿›è¡Œäº†å§”æ‰˜, è¿™ä¸€æ­¥ç›¸å½“äºå¯åŠ¨äº†*foo(), å¹¶åœ¨*foo()ä¸­å°†ä»£ç åœåœ¨console.log('inside *foo():', yield 'b') ç”Ÿæˆå™¨*foo()ç»™å‡º</p>\n</li>\n<li>\n<p>ä»£ç æ‰§è¡Œconsole.log('inside *foo():', yield 'b')ï¼Œyield æ’å…¥2ï¼Œ ä»£ç åœåœ¨ console.log('inside *foo():', yield 'c') ç”Ÿæˆå™¨*foo()ç»™å‡º 'c'</p>\n</li>\n<li>\n<p>ä»£ç æ‰§è¡Œ console.log('inside *foo():', yield 'c')ï¼Œyieldæ’å…¥ 3ï¼Œä»*foo()è¿”å›*bar()ï¼Œå‘ç°ä¹‹å‰çš„ä»£ç åœåœ¨ console.log('inside *bar():', yield *foo()) æ‰€ä»¥æ‰§è¡Œ console.log('inside *bar():', yield *foo())ï¼Œå‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯ console.log('inside *bar():', 'd')ï¼Œç„¶åå°†ä»£ç ä»£ç åœåœ¨ console.log('inside *bar():', yield 'e') å¤„ï¼Œæ‰€ä»¥ç»™å‡º'e'</p>\n</li>\n<li>\n<p>ä»£ç æ‰§è¡Œ console.log('inside *bar():', yield 'e')ï¼Œyieldæ’å…¥ 4ï¼Œæœ€åæ²¡æœ‰yieldè¿”å›ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥é»˜è®¤ä½¿ç”¨ return è¿”å›çš„å€¼ã€‚</p>\n</li>\n</ol>\n<h4 id=\"å¼‚æ­¥å§”æ‰˜\">å¼‚æ­¥å§”æ‰˜</h4>\n<h4 id=\"é€’å½’å§”æ‰˜\">é€’å½’å§”æ‰˜</h4>\n<p>yield å§”æ‰˜è‡ªèº«</p>\n<h3 id=\"es6-ä¹‹å‰çš„ç”Ÿæˆå™¨\">ES6 ä¹‹å‰çš„ç”Ÿæˆå™¨</h3>\n<hr>\n<h2 id=\"ç¨‹åºæ€§èƒ½\">ç¨‹åºæ€§èƒ½</h2>\n<h3 id=\"web-worker\">Web Worker</h3>\n<p>ä» JavaScript ä¸»ç¨‹åºä¸­ï¼Œå¯ä»¥è¿™æ ·å®ä¾‹åŒ–ä¸€ä¸ª Worker</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> w1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://...'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>è¿™ä¸ª URL åº”è¯¥æŒ‡å‘ä¸€ä¸ª JavaScript æ–‡ä»¶çš„ä½ç½®ï¼Œè¿™ä¸ªé—®ä»·å°†è¢«åŠ è½½åˆ°ä¸€ä¸ª Worker ä¸­ï¼Œç„¶åæµè§ˆå™¨å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œè®©è¿™ä¸ªæ–‡ä»¶åœ¨è¿™ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­è¿è¡Œã€‚</p>\n<blockquote>\n<p>é€šè¿‡è¿™æ ·çš„URLåˆ›å»ºçš„Workerç§°ä¸ºä¸“ç”¨Woerkrï¼Œé™¤äº†æä¾›ä¸€ä¸ª æŒ‡å‘å¤–éƒ¨æ–‡ä»¶URL,è¿˜å¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªBlob URL(å¦ä¸€ä¸ªhtml5çš„ç‰¹æ€§)åˆ›å»ºä¸€ä¸ªåœ¨çº¿Workerï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨å•ä½ï¼ˆäºŒè¿›åˆ¶ï¼‰å€¼ä¸­çš„åœ¨çº¿æ–‡ä»¶ã€‚</p>\n</blockquote>\n<p>Worker ä¹‹é—´ä»¥åŠå®ƒä»¬å’Œä¸»ç¨‹åºä¹‹é—´ï¼Œä¸ä¼šå…±äº«ä»»ä½•ä½œç”¨åŸŸæˆ–èµ„æºï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªåŸºæœ¬çš„äº‹ä»¶æ¶ˆæ¯æœºåˆ¶ç›¸äº’è”ç³»ã€‚</p>\n<p>Worker w1 æ˜¯ä¸€ä¸ªäº‹ä»¶çš„ä¾¦å¬è€…å’Œè§¦å‘è€…ï¼Œå¯ä»¥é€šè¿‡è®¢é˜…å®ƒæ¥è·å¾—è¿™ä¸ªWorkerå‘å‡ºçš„äº‹ä»¶ä»¥åŠå‘é€äº‹ä»¶ç»™è¿™ä¸ªWorkerã€‚</p>\n<p>ä¾¦å¬äº‹ä»¶</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">w1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListenner</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">evt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// evt.data</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>å‘é€'message'</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">w1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'...'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>åœ¨è¿™ä¸ª Worker å†…éƒ¨æ”¶å‘æ¶ˆæ¯æ˜¯å®Œå…¨å¯¹ç§°çš„ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">addEventListenner</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">evt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// evt.data</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'...'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>è¦åœ¨åˆ›å»ºçš„ Worker ä¸­ç»ˆæ­¢ Workerï¼Œå¯ä»¥è°ƒç”¨ Worker å¯¹è±¡ä¸Šçš„ terminate()ã€‚çªç„¶ç»ˆæ­¢ Worker çº¿ç¨‹ä¸ä¼šç»™å®ƒä»»ä½•æœºä¼šå®Œæˆå®ƒçš„å·¥ä½œæˆ–è€…æ¸…ç†ä»»ä½•èµ„æºã€‚è¿™å°±ç±»ä¼¼é€šè¿‡å…³é—­æµè§ˆå™¨æ ‡ç­¾é¡µæ¥å…³é—­é¡µé¢ã€‚</p>\n<h4 id=\"worker-ç¯å¢ƒ\">Worker ç¯å¢ƒ</h4>\n<p>åœ¨ Workerå†…éƒ¨æ˜¯æ— æ³•è®¿é—®ä¸»ç¨‹åºçš„ä»»ä½•èµ„æºçš„ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½è®¿é—®å®ƒçš„ä»»ä½•å…¨å±€å˜é‡ï¼Œä¹Ÿä¸èƒ½è®¿é—®é¡µé¢domæˆ–è€…å…¶ä»–èµ„æºã€‚è¿™æ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„çº¿ç¨‹ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå¯ä»¥æ‰§è¡Œç½‘ç»œæ“ä½œï¼ˆAjaxã€WebSocketsï¼‰ä»¥åŠè®¾å®šå®šæ—¶å™¨ï¼Œè¿˜æœ‰å¯ä»¥è®¿é—®å‡ ä¸ªé‡è¦çš„å…¨å±€å˜é‡å’ŒåŠŸèƒ½çš„æœ¬åœ°å‰¯æœ¬ï¼ŒåŒ…æ‹¬navigator,location,JSONå’Œ applicationCache.</p>\n<p>ä½ è¿˜å¯ä»¥é€šè¿‡ importScript(...) å‘ Worker åŠ è½½é¢å¤–çš„ JavaScript è„šæœ¬ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// åœ¨ worker å†…éƒ¨</span>\n<span class=\"token function\">importScript</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'bar.js'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>è¿™äº›è„šæœ¬çš„åŠ è½½æ˜¯åŒæ­¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒimportScript(...)è°ƒç”¨ä¼šé˜»å¡ä½™ä¸‹ Workerçš„æ‰§è¡Œï¼ŒçŸ¥é“æ–‡ä»¶åŠ è½½å’Œæ‰§è¡Œå®Œæˆã€‚</p>\n<p>Web Worker é€šå¸¸ç”¨äºå“ªäº›æ–¹é¢ï¼š</p>\n<ul>\n<li>å¤„ç†å¯†é›†æ•°å­¦è®¡ç®—</li>\n<li>å¤§æ•°æ®é›†æ’åº</li>\n<li>æ•°æ®å¤„ç†ï¼ˆå‹ç¼©ï¼ŒéŸ³é¢‘åˆ†æï¼Œå›¾åƒå¤„ç†ç­‰ï¼‰</li>\n<li>é«˜æµé‡ç½‘ç»œé€šä¿¡</li>\n</ul>\n<h4 id=\"æ•°æ®ä¼ é€’\">æ•°æ®ä¼ é€’</h4>\n<p>ä¸Šé¢æåˆ°çš„è¿™äº›åº”ç”¨å¤§å¤šæ•°æœ‰ä¸€ä¸ªå…±æ€§ï¼Œå°±æ˜¯éœ€è¦åœ¨çº¿ç¨‹ä¹‹é—´é€šè¿‡äº‹ä»¶æœºåˆ¶ä¼ é€’å¤§é‡çš„ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯åŒå‘ã€‚</p>\n<p>åœ¨æ—©æœŸçš„ Worker ä¸­ï¼Œå”¯ä¸€çš„é€‰æ‹©å°±æ˜¯æŠŠæ‰€æœ‰æ•°æ®åºåˆ—åŒ–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ä¸­ã€‚é™¤äº†åŒå‘åºåˆ—åŒ–å¯¼è‡´çš„é€Ÿåº¦æŸå¤±ä¹‹å¤–ï¼Œå¦å¤–ä¸€ä¸ªä¸»è¦çš„è´Ÿé¢å› ç´ æ˜¯æ•°æ®éœ€è¦è¢«å¤åˆ¶ï¼Œè¿™æ„å‘³ç€ä¸¤å€çš„å†…å­˜ä½¿ç”¨ï¼ˆä»¥åŠå¼•èµ·çš„åƒåœ¾æ”¶é›†æ–¹é¢çš„æ³¢åŠ¨ï¼‰</p>\n<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»“æ„åŒ–å…‹éš†ç®—æ³•ï¼ˆmdnä¸Šæœ‰ç›¸å…³çš„è¯´æ˜ï¼‰å¯ä»¥æŠŠå¯¹è±¡èµ‹å€¼åˆ°å¦ä¸€è¾¹ï¼Œè¿™ä¸ªç®—æ³•ä½œéå¸¸é«˜çº§ï¼Œç”šè‡³å¯ä»¥å¤„ç†è¦å¤åˆ¶å¯¹è±¡æœ‰å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼Œä½†æ˜¯å®ƒåªä½œä¸ºAPIçš„ä¸€éƒ¨åˆ†ä¸ä¼šæš´éœ²å‡ºæ¥ï¼Œé€šè¿‡æˆ‘ä»¬é€šè¿‡postMessageå°†æ¶ˆæ¯å‘é€åˆ°å…¶ä»–çš„çª—å£æˆ–è€…Web Workerå°±ä¼šç”¨åˆ°å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åªé€šè¿‡APIæ¥ä½¿ç”¨ï¼Œç›®å‰IE10ä»¥åŠæ›´é«˜çš„ç‰ˆæœ¬ä»¥åŠæ‰€æœ‰çš„å…¶ä»–ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒè¿™ç§æ–¹æ¡ˆã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">structuralClone</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> port1<span class=\"token punctuation\">,</span> port2 <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    port2<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">)</span>\n    port1<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">postMessage</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> clone <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">structuralClone</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>è¿˜æœ‰ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§æ•°æ®é›†ï¼Œå°±æ˜¯ä½¿ç”¨ Transferable å¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™å‘ç”Ÿçš„å¯¹è±¡æ‰€æœ‰æƒçš„è½¬ç§»ï¼Œæ•°æ®æœ¬èº«å¹¶æ²¡æœ‰ç§»åŠ¨ï¼Œä¸€æ—¦ä½ æŠŠå¯¹è±¡ä¼ é€’åˆ°ä¸€ä¸ª Worker ä¸­ï¼Œåœ¨åŸæ¥çš„ä½ç½®ä¸Šï¼Œä»–å°±ä¼šå˜ä¸ºç©ºåè€…ä¸å¯ä»¥è®¿é—®ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä½œç”¨åŸŸå…±äº«å¸¦æ¥çš„æ··ä¹±ã€‚å½“ç„¶ï¼Œæ‰€æœ‰æƒä¼ é€’æ˜¯å¯ä»¥åŒå‘è¿›è¡Œçš„ã€‚</p>\n<p>å¦‚æœä½¿ç”¨ Transferable å¯¹è±¡å…¶å®ä¸éœ€è¦åšä»€ä¹ˆï¼Œä»»ä½•å®ç°äº† Transferable æ¥å£çš„æ•°æ®ç»“æ„å°±ä¼šè‡ªåŠ¨æŒ‰ç…§ç€ç§æ–¹å¼è¿›è¡Œä¼ è¾“ã€‚</p>\n<p>æ¯”å¦‚Uinit8Array:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">.</span><span class=\"token property-access\">butter</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> foo<span class=\"token punctuation\">.</span><span class=\"token property-access\">buffer</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯åŸå§‹ç¼“å†²åŒºï¼Œç¬¬äºŒä¸ªå°±æ˜¯ä¸€ä¸ªè¦ä¼ è¾“çš„å†…å®¹çš„åˆ—è¡¨ã€‚</p>\n<h4 id=\"å…±äº«çš„-worker\">å…±äº«çš„ worker</h4>\n<p>åˆ›å»ºä¸€ä¸ªæ•´ä¸ªç«™ç‚¹æˆ–è€…appçš„æ‰€æœ‰é¡µé¢å®ä¾‹éƒ½å¯ä»¥å…±äº«çš„ä¸­å¿ƒWorkerå°±éå¸¸æœ‰ç”¨ã€‚è¿™ç§ç§°ä¸º SharedWorker:</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> w1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SharedWorker</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://...'</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>å› ä¸ºå…±äº« Worker å¯ä»¥ä¸ç«™ç‚¹çš„å¤šä¸ªç¨‹åºå®åˆ—æˆ–è€…å¤šä¸ªé¡µé¢è¿æ¥ï¼Œæ‰€ä»¥è¿™ä¸ª Worker éœ€è¦é€šè¿‡æŸç§æ–¹å¼æ¥å¾—çŸ¥æ¶ˆæ¯æ¥è‡ªäºå“ªä¸ªç¨‹åºã€‚è¿™ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦å°±æ˜¯ç«¯å£ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">w1<span class=\"token punctuation\">.</span><span class=\"token property-access\">port</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> handleMessage<span class=\"token punctuation\">)</span>\nw1<span class=\"token punctuation\">.</span><span class=\"token property-access\">port</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'something cool'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ç«¯å£å¿…é¡»è¦åˆå§‹åŒ–</span>\nw1<span class=\"token punctuation\">.</span><span class=\"token property-access\">port</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>åœ¨å…±äº« Worker å†…éƒ¨ï¼Œå¿…é¡»è¦å¤„ç†é¢å¤–çš„ä¸€ä¸ªäº‹ä»¶ï¼š \"connect\" ã€‚</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// åœ¨å…±äº«Workerå†…éƒ¨</span>\n<span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"connect\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">evt</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// è¿™ä¸ªè¿æ¥åˆ†é…çš„ç«¯å£</span>\n  <span class=\"token keyword\">var</span> port <span class=\"token operator\">=</span> evt<span class=\"token punctuation\">.</span><span class=\"token property-access\">ports</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  port<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">evt</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ..</span>\n    port<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">postMessage</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ..</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// åˆå§‹åŒ–ç«¯å£è¿æ¥</span>\n  port<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n",
    "frontmatter": {
      "title": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸­ç¯‡",
      "img": "https://placem.at/places?h=140",
      "date": "2017-11-25"
    },
    "toc": "<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E7%B1%BB%E5%9E%8B%E5%92%8C%E8%AF%AD%E6%B3%95\">ç¬¬ä¸€éƒ¨åˆ† ç±»å‹å’Œè¯­æ³•</a></p>\n<ul>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%B1%BB%E5%9E%8B\">ç¬¬ä¸€ç«  ç±»å‹</a></p>\n<ul>\n<li><a href=\"#%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B\">å†…ç½®ç±»å‹</a></li>\n<li><a href=\"#%E5%80%BC%E5%92%8C%E7%B1%BB%E5%9E%8B\">å€¼å’Œç±»å‹</a></li>\n<li><a href=\"#undefined-%E5%92%8C-undeclared\">undefined å’Œ undeclared</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%80%BC\">å€¼</a></p>\n<ul>\n<li><a href=\"#%E6%95%B0%E7%BB%84\">æ•°ç»„</a></li>\n<li><a href=\"#%E7%B1%BB%E6%95%B0%E7%BB%84\">ç±»æ•°ç»„</a></li>\n<li><a href=\"#%E5%AD%97%E7%AC%A6%E4%B8%B2\">å­—ç¬¦ä¸²</a></li>\n<li><a href=\"#%E6%95%B0%E5%AD%97\">æ•°å­—</a></li>\n<li><a href=\"#%E7%89%B9%E6%AE%8A%E6%95%B0%E5%80%BC\">ç‰¹æ®Šæ•°å€¼</a></li>\n<li><a href=\"#%E5%80%BC%E5%92%8C%E5%BC%95%E7%94%A8\">å€¼å’Œå¼•ç”¨</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%8E%9F%E7%94%9F%E5%87%BD%E6%95%B0\">åŸç”Ÿå‡½æ•°</a></p>\n<ul>\n<li><a href=\"#%E5%86%85%E9%83%A8%E5%B1%9E%E6%80%A7\">å†…éƒ¨å±æ€§</a></li>\n<li><a href=\"#%E5%B0%81%E8%A3%85%E5%AF%B9%E8%B1%A1%E5%8C%85%E8%A3%85\">å°è£…å¯¹è±¡åŒ…è£…</a></li>\n<li><a href=\"#%E6%8B%86%E5%B0%81\">æ‹†å°</a></li>\n<li><a href=\"#%E5%B0%86%E5%8E%9F%E7%94%9F%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0\">å°†åŸç”Ÿå‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2\">ç¬¬å››ç«  å¼ºåˆ¶ç±»å‹è½¬æ¢</a></p>\n<ul>\n<li><a href=\"#%E5%80%BC%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2\">å€¼ç±»å‹è½¬æ¢</a></li>\n<li><a href=\"#%E6%8A%BD%E8%B1%A1%E5%80%BC%E6%93%8D%E4%BD%9C\">æŠ½è±¡å€¼æ“ä½œ</a></li>\n<li><a href=\"#%E6%98%BE%E7%A4%BA%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2\">æ˜¾ç¤ºå¼ºåˆ¶ç±»å‹è½¬æ¢</a></li>\n<li><a href=\"#%E9%9A%90%E5%BC%8F%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2\">éšå¼å¼ºåˆ¶è½¬æ¢</a></li>\n<li><a href=\"#-%E5%92%8C-\">|| å’Œ &#x26;&#x26;</a></li>\n<li><a href=\"#%E5%AE%BD%E6%9D%BE%E7%9B%B8%E7%AD%89%E5%92%8C%E4%B8%A5%E6%A0%BC%E7%9B%B8%E7%AD%89\">å®½æ¾ç›¸ç­‰å’Œä¸¥æ ¼ç›¸ç­‰</a></li>\n<li><a href=\"#%E6%8A%BD%E8%B1%A1%E7%9B%B8%E7%AD%89\">æŠ½è±¡ç›¸ç­‰</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E8%AF%AD%E6%B3%95\">ç¬¬äº”ç«  è¯­æ³•</a></p>\n<ul>\n<li><a href=\"#%E8%AF%AD%E5%8F%A5%E5%92%8C%E8%A1%A8%E8%BE%BE%E5%BC%8F\">è¯­å¥å’Œè¡¨è¾¾å¼</a></li>\n<li><a href=\"#%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7\">è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§</a></li>\n<li><a href=\"#%E8%87%AA%E5%8A%A8%E5%88%86%E5%8F%B7\">è‡ªåŠ¨åˆ†å·</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E5%BC%82%E6%AD%A5%E4%B8%8E%E6%80%A7%E8%83%BD\">ç¬¬äºŒéƒ¨åˆ† å¼‚æ­¥ä¸æ€§èƒ½</a></p>\n<ul>\n<li>\n<p><a href=\"#%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%8E%B0%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E9%83%A8%E5%88%86%E5%92%8C%E5%B0%86%E6%9D%A5%E8%BF%90%E8%A1%8C%E7%9A%84%E9%83%A8%E5%88%86%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%E5%B0%B1%E6%98%AF%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E7%9A%84%E6%A0%B8%E5%BF%83%E3%80%82\">ç¨‹åºä¸­ç°åœ¨è¿è¡Œçš„éƒ¨åˆ†å’Œå°†æ¥è¿è¡Œçš„éƒ¨åˆ†ä¹‹é—´çš„å…³ç³»å°±æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒã€‚</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%8E%B0%E5%9C%A8%E4%B8%8E%E5%B0%86%E6%9D%A5\">ç¬¬ä¸€ç«  ç°åœ¨ä¸å°†æ¥</a></p>\n<ul>\n<li><a href=\"#%E5%88%86%E5%9D%97%E7%9A%84%E7%A8%8B%E5%BA%8F\">åˆ†å—çš„ç¨‹åº</a></li>\n<li><a href=\"#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF\">äº‹ä»¶å¾ªç¯</a></li>\n<li><a href=\"#%E5%B9%B6%E8%A1%8C%E7%BA%BF%E7%A8%8B\">å¹¶è¡Œçº¿ç¨‹</a></li>\n<li><a href=\"#%E5%B9%B6%E5%8F%91\">å¹¶å‘</a></li>\n<li><a href=\"#%E4%BB%BB%E5%8A%A1\">ä»»åŠ¡</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%9B%9E%E8%B0%83\">ç¬¬äºŒç«  å›è°ƒ</a></p>\n<ul>\n<li><a href=\"#continuation\">continuation</a></li>\n<li><a href=\"#%E9%A1%BA%E5%BA%8F%E5%A4%A7%E8%84%91\">é¡ºåºå¤§è„‘</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#promise\">Promise</a></p>\n<ul>\n<li><a href=\"#%E5%85%B7%E6%9C%89-then-%E6%96%B9%E6%B3%95%E7%9A%84%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B\">å…·æœ‰ then æ–¹æ³•çš„é¸­å­ç±»å‹</a></li>\n<li><a href=\"#promise-%E7%9A%84%E4%BF%A1%E4%BB%BB%E9%97%AE%E9%A2%98\">Promise çš„ä¿¡ä»»é—®é¢˜</a></li>\n<li><a href=\"#%E9%93%BE%E5%BC%8F%E6%B5%81\">é“¾å¼æµ</a></li>\n<li><a href=\"#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86\">é”™è¯¯å¤„ç†</a></li>\n<li><a href=\"#promise-%E6%A8%A1%E5%BC%8F\">Promise æ¨¡å¼</a></li>\n<li><a href=\"#promise-api-%E6%A6%82%E8%BF%B0\">Promise API æ¦‚è¿°</a></li>\n<li><a href=\"#promise-%E5%B1%80%E9%99%90%E6%80%A7\">Promise å±€é™æ€§</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%94%9F%E6%88%90%E5%99%A8\">ç¬¬å››ç«  ç”Ÿæˆå™¨</a></p>\n<ul>\n<li><a href=\"#%E6%89%93%E7%A0%B4%E5%AE%8C%E6%95%B4%E7%9A%84%E8%BF%90%E8%A1%8C\">æ‰“ç ´å®Œæ•´çš„è¿è¡Œ</a></li>\n<li><a href=\"#%E7%94%9F%E6%88%90%E5%99%A8%E4%BA%A7%E7%94%9F%E5%80%BC\">ç”Ÿæˆå™¨äº§ç”Ÿå€¼</a></li>\n<li><a href=\"#%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E7%94%9F%E6%88%90%E5%99%A8\">å¼‚æ­¥è¿­ä»£ç”Ÿæˆå™¨</a></li>\n<li><a href=\"#%E7%94%9F%E6%88%90%E5%99%A8%E5%8A%A0%E8%BF%AD%E4%BB%A3%E5%99%A8\">ç”Ÿæˆå™¨åŠ è¿­ä»£å™¨</a></li>\n<li><a href=\"#%E7%94%9F%E6%88%90%E5%99%A8%E5%A7%94%E6%89%98\">ç”Ÿæˆå™¨å§”æ‰˜</a></li>\n<li><a href=\"#es6-%E4%B9%8B%E5%89%8D%E7%9A%84%E7%94%9F%E6%88%90%E5%99%A8\">ES6 ä¹‹å‰çš„ç”Ÿæˆå™¨</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD\">ç¨‹åºæ€§èƒ½</a></p>\n<ul>\n<li><a href=\"#web-worker\">Web Worker</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
    "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸­ç¯‡",
    "id": "8d1f79b5c05b29fa2dc83d23d583f1ce",
    "prev": {
      "name": "ç¬”è®°æ‘˜å½•-ä½ ä¸çŸ¥é“çš„JavaScript-ä¸‹ç¯‡",
      "id": "a99a03fe768754b82f7e545b55d5f3de"
    }
  }
]